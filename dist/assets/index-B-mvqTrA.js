function gP(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function JT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var YT={exports:{}},pf={},XT={exports:{}},he={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nu=Symbol.for("react.element"),yP=Symbol.for("react.portal"),vP=Symbol.for("react.fragment"),wP=Symbol.for("react.strict_mode"),_P=Symbol.for("react.profiler"),xP=Symbol.for("react.provider"),EP=Symbol.for("react.context"),kP=Symbol.for("react.forward_ref"),TP=Symbol.for("react.suspense"),bP=Symbol.for("react.memo"),SP=Symbol.for("react.lazy"),v_=Symbol.iterator;function IP(n){return n===null||typeof n!="object"?null:(n=v_&&n[v_]||n["@@iterator"],typeof n=="function"?n:null)}var ZT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},e1=Object.assign,t1={};function Ga(n,e,t){this.props=n,this.context=e,this.refs=t1,this.updater=t||ZT}Ga.prototype.isReactComponent={};Ga.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Ga.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function n1(){}n1.prototype=Ga.prototype;function Gy(n,e,t){this.props=n,this.context=e,this.refs=t1,this.updater=t||ZT}var Qy=Gy.prototype=new n1;Qy.constructor=Gy;e1(Qy,Ga.prototype);Qy.isPureReactComponent=!0;var w_=Array.isArray,r1=Object.prototype.hasOwnProperty,Jy={current:null},s1={key:!0,ref:!0,__self:!0,__source:!0};function i1(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)r1.call(e,r)&&!s1.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:nu,type:n,key:i,ref:o,props:s,_owner:Jy.current}}function CP(n,e){return{$$typeof:nu,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Yy(n){return typeof n=="object"&&n!==null&&n.$$typeof===nu}function NP(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var __=/\/+/g;function $p(n,e){return typeof n=="object"&&n!==null&&n.key!=null?NP(""+n.key):e.toString(36)}function bd(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case nu:case yP:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+$p(o,0):r,w_(s)?(t="",n!=null&&(t=n.replace(__,"$&/")+"/"),bd(s,e,t,"",function(c){return c})):s!=null&&(Yy(s)&&(s=CP(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(__,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",w_(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+$p(i,a);o+=bd(i,e,t,l,s)}else if(l=IP(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+$p(i,a++),o+=bd(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function qu(n,e,t){if(n==null)return n;var r=[],s=0;return bd(n,r,"","",function(i){return e.call(t,i,s++)}),r}function AP(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Jt={current:null},Sd={transition:null},RP={ReactCurrentDispatcher:Jt,ReactCurrentBatchConfig:Sd,ReactCurrentOwner:Jy};function o1(){throw Error("act(...) is not supported in production builds of React.")}he.Children={map:qu,forEach:function(n,e,t){qu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return qu(n,function(){e++}),e},toArray:function(n){return qu(n,function(e){return e})||[]},only:function(n){if(!Yy(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};he.Component=Ga;he.Fragment=vP;he.Profiler=_P;he.PureComponent=Gy;he.StrictMode=wP;he.Suspense=TP;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RP;he.act=o1;he.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=e1({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Jy.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)r1.call(e,l)&&!s1.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:nu,type:n.type,key:s,ref:i,props:r,_owner:o}};he.createContext=function(n){return n={$$typeof:EP,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:xP,_context:n},n.Consumer=n};he.createElement=i1;he.createFactory=function(n){var e=i1.bind(null,n);return e.type=n,e};he.createRef=function(){return{current:null}};he.forwardRef=function(n){return{$$typeof:kP,render:n}};he.isValidElement=Yy;he.lazy=function(n){return{$$typeof:SP,_payload:{_status:-1,_result:n},_init:AP}};he.memo=function(n,e){return{$$typeof:bP,type:n,compare:e===void 0?null:e}};he.startTransition=function(n){var e=Sd.transition;Sd.transition={};try{n()}finally{Sd.transition=e}};he.unstable_act=o1;he.useCallback=function(n,e){return Jt.current.useCallback(n,e)};he.useContext=function(n){return Jt.current.useContext(n)};he.useDebugValue=function(){};he.useDeferredValue=function(n){return Jt.current.useDeferredValue(n)};he.useEffect=function(n,e){return Jt.current.useEffect(n,e)};he.useId=function(){return Jt.current.useId()};he.useImperativeHandle=function(n,e,t){return Jt.current.useImperativeHandle(n,e,t)};he.useInsertionEffect=function(n,e){return Jt.current.useInsertionEffect(n,e)};he.useLayoutEffect=function(n,e){return Jt.current.useLayoutEffect(n,e)};he.useMemo=function(n,e){return Jt.current.useMemo(n,e)};he.useReducer=function(n,e,t){return Jt.current.useReducer(n,e,t)};he.useRef=function(n){return Jt.current.useRef(n)};he.useState=function(n){return Jt.current.useState(n)};he.useSyncExternalStore=function(n,e,t){return Jt.current.useSyncExternalStore(n,e,t)};he.useTransition=function(){return Jt.current.useTransition()};he.version="18.3.1";XT.exports=he;var M=XT.exports;const wt=JT(M),PP=gP({__proto__:null,default:wt},[M]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DP=M,MP=Symbol.for("react.element"),OP=Symbol.for("react.fragment"),VP=Object.prototype.hasOwnProperty,jP=DP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,LP={key:!0,ref:!0,__self:!0,__source:!0};function a1(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)VP.call(e,r)&&!LP.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:MP,type:n,key:i,ref:o,props:s,_owner:jP.current}}pf.Fragment=OP;pf.jsx=a1;pf.jsxs=a1;YT.exports=pf;var p=YT.exports,Jm={},l1={exports:{}},xn={},c1={exports:{}},u1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(B,G){var oe=B.length;B.push(G);e:for(;0<oe;){var Ie=oe-1>>>1,we=B[Ie];if(0<s(we,G))B[Ie]=G,B[oe]=we,oe=Ie;else break e}}function t(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var G=B[0],oe=B.pop();if(oe!==G){B[0]=oe;e:for(var Ie=0,we=B.length,He=we>>>1;Ie<He;){var wr=2*(Ie+1)-1,_r=B[wr],xr=wr+1,Er=B[xr];if(0>s(_r,oe))xr<we&&0>s(Er,_r)?(B[Ie]=Er,B[xr]=oe,Ie=xr):(B[Ie]=_r,B[wr]=oe,Ie=wr);else if(xr<we&&0>s(Er,oe))B[Ie]=Er,B[xr]=oe,Ie=xr;else break e}}return G}function s(B,G){var oe=B.sortIndex-G.sortIndex;return oe!==0?oe:B.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,m=!1,y=!1,v=!1,_=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(B){for(var G=t(c);G!==null;){if(G.callback===null)r(c);else if(G.startTime<=B)r(c),G.sortIndex=G.expirationTime,e(l,G);else break;G=t(c)}}function N(B){if(v=!1,b(B),!y)if(t(l)!==null)y=!0,X(R);else{var G=t(c);G!==null&&re(N,G.startTime-B)}}function R(B,G){y=!1,v&&(v=!1,x(E),E=-1),m=!0;var oe=f;try{for(b(G),h=t(l);h!==null&&(!(h.expirationTime>G)||B&&!D());){var Ie=h.callback;if(typeof Ie=="function"){h.callback=null,f=h.priorityLevel;var we=Ie(h.expirationTime<=G);G=n.unstable_now(),typeof we=="function"?h.callback=we:h===t(l)&&r(l),b(G)}else r(l);h=t(l)}if(h!==null)var He=!0;else{var wr=t(c);wr!==null&&re(N,wr.startTime-G),He=!1}return He}finally{h=null,f=oe,m=!1}}var P=!1,k=null,E=-1,S=5,C=-1;function D(){return!(n.unstable_now()-C<S)}function O(){if(k!==null){var B=n.unstable_now();C=B;var G=!0;try{G=k(!0,B)}finally{G?A():(P=!1,k=null)}}else P=!1}var A;if(typeof T=="function")A=function(){T(O)};else if(typeof MessageChannel<"u"){var qe=new MessageChannel,vr=qe.port2;qe.port1.onmessage=O,A=function(){vr.postMessage(null)}}else A=function(){_(O,0)};function X(B){k=B,P||(P=!0,A())}function re(B,G){E=_(function(){B(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,X(R))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(B){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var oe=f;f=G;try{return B()}finally{f=oe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,G){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var oe=f;f=B;try{return G()}finally{f=oe}},n.unstable_scheduleCallback=function(B,G,oe){var Ie=n.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?Ie+oe:Ie):oe=Ie,B){case 1:var we=-1;break;case 2:we=250;break;case 5:we=1073741823;break;case 4:we=1e4;break;default:we=5e3}return we=oe+we,B={id:u++,callback:G,priorityLevel:B,startTime:oe,expirationTime:we,sortIndex:-1},oe>Ie?(B.sortIndex=oe,e(c,B),t(l)===null&&B===t(c)&&(v?(x(E),E=-1):v=!0,re(N,oe-Ie))):(B.sortIndex=we,e(l,B),y||m||(y=!0,X(R))),B},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(B){var G=f;return function(){var oe=f;f=G;try{return B.apply(this,arguments)}finally{f=oe}}}})(u1);c1.exports=u1;var FP=c1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BP=M,wn=FP;function z(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d1=new Set,fc={};function Eo(n,e){Ta(n,e),Ta(n+"Capture",e)}function Ta(n,e){for(fc[n]=e,n=0;n<e.length;n++)d1.add(e[n])}var qr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ym=Object.prototype.hasOwnProperty,UP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,x_={},E_={};function $P(n){return Ym.call(E_,n)?!0:Ym.call(x_,n)?!1:UP.test(n)?E_[n]=!0:(x_[n]=!0,!1)}function zP(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function WP(n,e,t,r){if(e===null||typeof e>"u"||zP(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Yt(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){kt[n]=new Yt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];kt[e]=new Yt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){kt[n]=new Yt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){kt[n]=new Yt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){kt[n]=new Yt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){kt[n]=new Yt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){kt[n]=new Yt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){kt[n]=new Yt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){kt[n]=new Yt(n,5,!1,n.toLowerCase(),null,!1,!1)});var Xy=/[\-:]([a-z])/g;function Zy(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Xy,Zy);kt[e]=new Yt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Xy,Zy);kt[e]=new Yt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Xy,Zy);kt[e]=new Yt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){kt[n]=new Yt(n,1,!1,n.toLowerCase(),null,!1,!1)});kt.xlinkHref=new Yt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){kt[n]=new Yt(n,1,!1,n.toLowerCase(),null,!0,!0)});function e0(n,e,t,r){var s=kt.hasOwnProperty(e)?kt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(WP(e,t,s,r)&&(t=null),r||s===null?$P(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var es=BP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hu=Symbol.for("react.element"),Jo=Symbol.for("react.portal"),Yo=Symbol.for("react.fragment"),t0=Symbol.for("react.strict_mode"),Xm=Symbol.for("react.profiler"),h1=Symbol.for("react.provider"),f1=Symbol.for("react.context"),n0=Symbol.for("react.forward_ref"),Zm=Symbol.for("react.suspense"),eg=Symbol.for("react.suspense_list"),r0=Symbol.for("react.memo"),ps=Symbol.for("react.lazy"),p1=Symbol.for("react.offscreen"),k_=Symbol.iterator;function yl(n){return n===null||typeof n!="object"?null:(n=k_&&n[k_]||n["@@iterator"],typeof n=="function"?n:null)}var Fe=Object.assign,zp;function Ml(n){if(zp===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);zp=e&&e[1]||""}return`
`+zp+n}var Wp=!1;function qp(n,e){if(!n||Wp)return"";Wp=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Wp=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ml(n):""}function qP(n){switch(n.tag){case 5:return Ml(n.type);case 16:return Ml("Lazy");case 13:return Ml("Suspense");case 19:return Ml("SuspenseList");case 0:case 2:case 15:return n=qp(n.type,!1),n;case 11:return n=qp(n.type.render,!1),n;case 1:return n=qp(n.type,!0),n;default:return""}}function tg(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Yo:return"Fragment";case Jo:return"Portal";case Xm:return"Profiler";case t0:return"StrictMode";case Zm:return"Suspense";case eg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case f1:return(n.displayName||"Context")+".Consumer";case h1:return(n._context.displayName||"Context")+".Provider";case n0:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case r0:return e=n.displayName||null,e!==null?e:tg(n.type)||"Memo";case ps:e=n._payload,n=n._init;try{return tg(n(e))}catch{}}return null}function HP(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tg(e);case 8:return e===t0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Zs(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function m1(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function KP(n){var e=m1(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ku(n){n._valueTracker||(n._valueTracker=KP(n))}function g1(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=m1(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function th(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function ng(n,e){var t=e.checked;return Fe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function T_(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Zs(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function y1(n,e){e=e.checked,e!=null&&e0(n,"checked",e,!1)}function rg(n,e){y1(n,e);var t=Zs(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?sg(n,e.type,t):e.hasOwnProperty("defaultValue")&&sg(n,e.type,Zs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function b_(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function sg(n,e,t){(e!=="number"||th(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Ol=Array.isArray;function ha(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Zs(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function ig(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(z(91));return Fe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function S_(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(z(92));if(Ol(t)){if(1<t.length)throw Error(z(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Zs(t)}}function v1(n,e){var t=Zs(e.value),r=Zs(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function I_(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function w1(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function og(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?w1(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Gu,_1=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Gu=Gu||document.createElement("div"),Gu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Gu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function pc(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Gl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GP=["Webkit","ms","Moz","O"];Object.keys(Gl).forEach(function(n){GP.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Gl[e]=Gl[n]})});function x1(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Gl.hasOwnProperty(n)&&Gl[n]?(""+e).trim():e+"px"}function E1(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=x1(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var QP=Fe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ag(n,e){if(e){if(QP[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(z(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(z(62))}}function lg(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cg=null;function s0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ug=null,fa=null,pa=null;function C_(n){if(n=iu(n)){if(typeof ug!="function")throw Error(z(280));var e=n.stateNode;e&&(e=wf(e),ug(n.stateNode,n.type,e))}}function k1(n){fa?pa?pa.push(n):pa=[n]:fa=n}function T1(){if(fa){var n=fa,e=pa;if(pa=fa=null,C_(n),e)for(n=0;n<e.length;n++)C_(e[n])}}function b1(n,e){return n(e)}function S1(){}var Hp=!1;function I1(n,e,t){if(Hp)return n(e,t);Hp=!0;try{return b1(n,e,t)}finally{Hp=!1,(fa!==null||pa!==null)&&(S1(),T1())}}function mc(n,e){var t=n.stateNode;if(t===null)return null;var r=wf(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(z(231,e,typeof t));return t}var dg=!1;if(qr)try{var vl={};Object.defineProperty(vl,"passive",{get:function(){dg=!0}}),window.addEventListener("test",vl,vl),window.removeEventListener("test",vl,vl)}catch{dg=!1}function JP(n,e,t,r,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Ql=!1,nh=null,rh=!1,hg=null,YP={onError:function(n){Ql=!0,nh=n}};function XP(n,e,t,r,s,i,o,a,l){Ql=!1,nh=null,JP.apply(YP,arguments)}function ZP(n,e,t,r,s,i,o,a,l){if(XP.apply(this,arguments),Ql){if(Ql){var c=nh;Ql=!1,nh=null}else throw Error(z(198));rh||(rh=!0,hg=c)}}function ko(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function C1(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function N_(n){if(ko(n)!==n)throw Error(z(188))}function eD(n){var e=n.alternate;if(!e){if(e=ko(n),e===null)throw Error(z(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return N_(s),n;if(i===r)return N_(s),e;i=i.sibling}throw Error(z(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(z(189))}}if(t.alternate!==r)throw Error(z(190))}if(t.tag!==3)throw Error(z(188));return t.stateNode.current===t?n:e}function N1(n){return n=eD(n),n!==null?A1(n):null}function A1(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=A1(n);if(e!==null)return e;n=n.sibling}return null}var R1=wn.unstable_scheduleCallback,A_=wn.unstable_cancelCallback,tD=wn.unstable_shouldYield,nD=wn.unstable_requestPaint,Ke=wn.unstable_now,rD=wn.unstable_getCurrentPriorityLevel,i0=wn.unstable_ImmediatePriority,P1=wn.unstable_UserBlockingPriority,sh=wn.unstable_NormalPriority,sD=wn.unstable_LowPriority,D1=wn.unstable_IdlePriority,mf=null,or=null;function iD(n){if(or&&typeof or.onCommitFiberRoot=="function")try{or.onCommitFiberRoot(mf,n,void 0,(n.current.flags&128)===128)}catch{}}var Wn=Math.clz32?Math.clz32:lD,oD=Math.log,aD=Math.LN2;function lD(n){return n>>>=0,n===0?32:31-(oD(n)/aD|0)|0}var Qu=64,Ju=4194304;function Vl(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ih(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Vl(a):(i&=o,i!==0&&(r=Vl(i)))}else o=t&~s,o!==0?r=Vl(o):i!==0&&(r=Vl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Wn(e),s=1<<t,r|=n[t],e&=~s;return r}function cD(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function uD(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-Wn(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=cD(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function fg(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function M1(){var n=Qu;return Qu<<=1,!(Qu&4194240)&&(Qu=64),n}function Kp(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function ru(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Wn(e),n[e]=t}function dD(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Wn(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function o0(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Wn(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var ke=0;function O1(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var V1,a0,j1,L1,F1,pg=!1,Yu=[],Ms=null,Os=null,Vs=null,gc=new Map,yc=new Map,vs=[],hD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function R_(n,e){switch(n){case"focusin":case"focusout":Ms=null;break;case"dragenter":case"dragleave":Os=null;break;case"mouseover":case"mouseout":Vs=null;break;case"pointerover":case"pointerout":gc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":yc.delete(e.pointerId)}}function wl(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=iu(e),e!==null&&a0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function fD(n,e,t,r,s){switch(e){case"focusin":return Ms=wl(Ms,n,e,t,r,s),!0;case"dragenter":return Os=wl(Os,n,e,t,r,s),!0;case"mouseover":return Vs=wl(Vs,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return gc.set(i,wl(gc.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,yc.set(i,wl(yc.get(i)||null,n,e,t,r,s)),!0}return!1}function B1(n){var e=Li(n.target);if(e!==null){var t=ko(e);if(t!==null){if(e=t.tag,e===13){if(e=C1(t),e!==null){n.blockedOn=e,F1(n.priority,function(){j1(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Id(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=mg(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);cg=r,t.target.dispatchEvent(r),cg=null}else return e=iu(t),e!==null&&a0(e),n.blockedOn=t,!1;e.shift()}return!0}function P_(n,e,t){Id(n)&&t.delete(e)}function pD(){pg=!1,Ms!==null&&Id(Ms)&&(Ms=null),Os!==null&&Id(Os)&&(Os=null),Vs!==null&&Id(Vs)&&(Vs=null),gc.forEach(P_),yc.forEach(P_)}function _l(n,e){n.blockedOn===e&&(n.blockedOn=null,pg||(pg=!0,wn.unstable_scheduleCallback(wn.unstable_NormalPriority,pD)))}function vc(n){function e(s){return _l(s,n)}if(0<Yu.length){_l(Yu[0],n);for(var t=1;t<Yu.length;t++){var r=Yu[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ms!==null&&_l(Ms,n),Os!==null&&_l(Os,n),Vs!==null&&_l(Vs,n),gc.forEach(e),yc.forEach(e),t=0;t<vs.length;t++)r=vs[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<vs.length&&(t=vs[0],t.blockedOn===null);)B1(t),t.blockedOn===null&&vs.shift()}var ma=es.ReactCurrentBatchConfig,oh=!0;function mD(n,e,t,r){var s=ke,i=ma.transition;ma.transition=null;try{ke=1,l0(n,e,t,r)}finally{ke=s,ma.transition=i}}function gD(n,e,t,r){var s=ke,i=ma.transition;ma.transition=null;try{ke=4,l0(n,e,t,r)}finally{ke=s,ma.transition=i}}function l0(n,e,t,r){if(oh){var s=mg(n,e,t,r);if(s===null)rm(n,e,r,ah,t),R_(n,r);else if(fD(s,n,e,t,r))r.stopPropagation();else if(R_(n,r),e&4&&-1<hD.indexOf(n)){for(;s!==null;){var i=iu(s);if(i!==null&&V1(i),i=mg(n,e,t,r),i===null&&rm(n,e,r,ah,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else rm(n,e,r,null,t)}}var ah=null;function mg(n,e,t,r){if(ah=null,n=s0(r),n=Li(n),n!==null)if(e=ko(n),e===null)n=null;else if(t=e.tag,t===13){if(n=C1(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return ah=n,null}function U1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rD()){case i0:return 1;case P1:return 4;case sh:case sD:return 16;case D1:return 536870912;default:return 16}default:return 16}}var Is=null,c0=null,Cd=null;function $1(){if(Cd)return Cd;var n,e=c0,t=e.length,r,s="value"in Is?Is.value:Is.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Cd=s.slice(n,1<r?1-r:void 0)}function Nd(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Xu(){return!0}function D_(){return!1}function En(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Xu:D_,this.isPropagationStopped=D_,this}return Fe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Xu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Xu)},persist:function(){},isPersistent:Xu}),e}var Qa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},u0=En(Qa),su=Fe({},Qa,{view:0,detail:0}),yD=En(su),Gp,Qp,xl,gf=Fe({},su,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:d0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==xl&&(xl&&n.type==="mousemove"?(Gp=n.screenX-xl.screenX,Qp=n.screenY-xl.screenY):Qp=Gp=0,xl=n),Gp)},movementY:function(n){return"movementY"in n?n.movementY:Qp}}),M_=En(gf),vD=Fe({},gf,{dataTransfer:0}),wD=En(vD),_D=Fe({},su,{relatedTarget:0}),Jp=En(_D),xD=Fe({},Qa,{animationName:0,elapsedTime:0,pseudoElement:0}),ED=En(xD),kD=Fe({},Qa,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),TD=En(kD),bD=Fe({},Qa,{data:0}),O_=En(bD),SD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ID={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ND(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=CD[n])?!!e[n]:!1}function d0(){return ND}var AD=Fe({},su,{key:function(n){if(n.key){var e=SD[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Nd(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?ID[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:d0,charCode:function(n){return n.type==="keypress"?Nd(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Nd(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),RD=En(AD),PD=Fe({},gf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),V_=En(PD),DD=Fe({},su,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:d0}),MD=En(DD),OD=Fe({},Qa,{propertyName:0,elapsedTime:0,pseudoElement:0}),VD=En(OD),jD=Fe({},gf,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),LD=En(jD),FD=[9,13,27,32],h0=qr&&"CompositionEvent"in window,Jl=null;qr&&"documentMode"in document&&(Jl=document.documentMode);var BD=qr&&"TextEvent"in window&&!Jl,z1=qr&&(!h0||Jl&&8<Jl&&11>=Jl),j_=" ",L_=!1;function W1(n,e){switch(n){case"keyup":return FD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function q1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Xo=!1;function UD(n,e){switch(n){case"compositionend":return q1(e);case"keypress":return e.which!==32?null:(L_=!0,j_);case"textInput":return n=e.data,n===j_&&L_?null:n;default:return null}}function $D(n,e){if(Xo)return n==="compositionend"||!h0&&W1(n,e)?(n=$1(),Cd=c0=Is=null,Xo=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return z1&&e.locale!=="ko"?null:e.data;default:return null}}var zD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function F_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!zD[n.type]:e==="textarea"}function H1(n,e,t,r){k1(r),e=lh(e,"onChange"),0<e.length&&(t=new u0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Yl=null,wc=null;function WD(n){rb(n,0)}function yf(n){var e=ta(n);if(g1(e))return n}function qD(n,e){if(n==="change")return e}var K1=!1;if(qr){var Yp;if(qr){var Xp="oninput"in document;if(!Xp){var B_=document.createElement("div");B_.setAttribute("oninput","return;"),Xp=typeof B_.oninput=="function"}Yp=Xp}else Yp=!1;K1=Yp&&(!document.documentMode||9<document.documentMode)}function U_(){Yl&&(Yl.detachEvent("onpropertychange",G1),wc=Yl=null)}function G1(n){if(n.propertyName==="value"&&yf(wc)){var e=[];H1(e,wc,n,s0(n)),I1(WD,e)}}function HD(n,e,t){n==="focusin"?(U_(),Yl=e,wc=t,Yl.attachEvent("onpropertychange",G1)):n==="focusout"&&U_()}function KD(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return yf(wc)}function GD(n,e){if(n==="click")return yf(e)}function QD(n,e){if(n==="input"||n==="change")return yf(e)}function JD(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Hn=typeof Object.is=="function"?Object.is:JD;function _c(n,e){if(Hn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Ym.call(e,s)||!Hn(n[s],e[s]))return!1}return!0}function $_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function z_(n,e){var t=$_(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=$_(t)}}function Q1(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Q1(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function J1(){for(var n=window,e=th();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=th(n.document)}return e}function f0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function YD(n){var e=J1(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Q1(t.ownerDocument.documentElement,t)){if(r!==null&&f0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=z_(t,i);var o=z_(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var XD=qr&&"documentMode"in document&&11>=document.documentMode,Zo=null,gg=null,Xl=null,yg=!1;function W_(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;yg||Zo==null||Zo!==th(r)||(r=Zo,"selectionStart"in r&&f0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Xl&&_c(Xl,r)||(Xl=r,r=lh(gg,"onSelect"),0<r.length&&(e=new u0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Zo)))}function Zu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ea={animationend:Zu("Animation","AnimationEnd"),animationiteration:Zu("Animation","AnimationIteration"),animationstart:Zu("Animation","AnimationStart"),transitionend:Zu("Transition","TransitionEnd")},Zp={},Y1={};qr&&(Y1=document.createElement("div").style,"AnimationEvent"in window||(delete ea.animationend.animation,delete ea.animationiteration.animation,delete ea.animationstart.animation),"TransitionEvent"in window||delete ea.transitionend.transition);function vf(n){if(Zp[n])return Zp[n];if(!ea[n])return n;var e=ea[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Y1)return Zp[n]=e[t];return n}var X1=vf("animationend"),Z1=vf("animationiteration"),eb=vf("animationstart"),tb=vf("transitionend"),nb=new Map,q_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ci(n,e){nb.set(n,e),Eo(e,[n])}for(var em=0;em<q_.length;em++){var tm=q_[em],ZD=tm.toLowerCase(),eM=tm[0].toUpperCase()+tm.slice(1);ci(ZD,"on"+eM)}ci(X1,"onAnimationEnd");ci(Z1,"onAnimationIteration");ci(eb,"onAnimationStart");ci("dblclick","onDoubleClick");ci("focusin","onFocus");ci("focusout","onBlur");ci(tb,"onTransitionEnd");Ta("onMouseEnter",["mouseout","mouseover"]);Ta("onMouseLeave",["mouseout","mouseover"]);Ta("onPointerEnter",["pointerout","pointerover"]);Ta("onPointerLeave",["pointerout","pointerover"]);Eo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Eo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Eo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Eo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Eo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Eo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tM=new Set("cancel close invalid load scroll toggle".split(" ").concat(jl));function H_(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,ZP(r,e,void 0,n),n.currentTarget=null}function rb(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;H_(s,a,c),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;H_(s,a,c),i=l}}}if(rh)throw n=hg,rh=!1,hg=null,n}function Ae(n,e){var t=e[Eg];t===void 0&&(t=e[Eg]=new Set);var r=n+"__bubble";t.has(r)||(sb(e,n,2,!1),t.add(r))}function nm(n,e,t){var r=0;e&&(r|=4),sb(t,n,r,e)}var ed="_reactListening"+Math.random().toString(36).slice(2);function xc(n){if(!n[ed]){n[ed]=!0,d1.forEach(function(t){t!=="selectionchange"&&(tM.has(t)||nm(t,!1,n),nm(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[ed]||(e[ed]=!0,nm("selectionchange",!1,e))}}function sb(n,e,t,r){switch(U1(e)){case 1:var s=mD;break;case 4:s=gD;break;default:s=l0}t=s.bind(null,e,t,n),s=void 0,!dg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function rm(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Li(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}I1(function(){var c=i,u=s0(t),h=[];e:{var f=nb.get(n);if(f!==void 0){var m=u0,y=n;switch(n){case"keypress":if(Nd(t)===0)break e;case"keydown":case"keyup":m=RD;break;case"focusin":y="focus",m=Jp;break;case"focusout":y="blur",m=Jp;break;case"beforeblur":case"afterblur":m=Jp;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=M_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=wD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=MD;break;case X1:case Z1:case eb:m=ED;break;case tb:m=VD;break;case"scroll":m=yD;break;case"wheel":m=LD;break;case"copy":case"cut":case"paste":m=TD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=V_}var v=(e&4)!==0,_=!v&&n==="scroll",x=v?f!==null?f+"Capture":null:f;v=[];for(var T=c,b;T!==null;){b=T;var N=b.stateNode;if(b.tag===5&&N!==null&&(b=N,x!==null&&(N=mc(T,x),N!=null&&v.push(Ec(T,N,b)))),_)break;T=T.return}0<v.length&&(f=new m(f,y,null,t,u),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==cg&&(y=t.relatedTarget||t.fromElement)&&(Li(y)||y[Hr]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(y=t.relatedTarget||t.toElement,m=c,y=y?Li(y):null,y!==null&&(_=ko(y),y!==_||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=c),m!==y)){if(v=M_,N="onMouseLeave",x="onMouseEnter",T="mouse",(n==="pointerout"||n==="pointerover")&&(v=V_,N="onPointerLeave",x="onPointerEnter",T="pointer"),_=m==null?f:ta(m),b=y==null?f:ta(y),f=new v(N,T+"leave",m,t,u),f.target=_,f.relatedTarget=b,N=null,Li(u)===c&&(v=new v(x,T+"enter",y,t,u),v.target=b,v.relatedTarget=_,N=v),_=N,m&&y)t:{for(v=m,x=y,T=0,b=v;b;b=Oo(b))T++;for(b=0,N=x;N;N=Oo(N))b++;for(;0<T-b;)v=Oo(v),T--;for(;0<b-T;)x=Oo(x),b--;for(;T--;){if(v===x||x!==null&&v===x.alternate)break t;v=Oo(v),x=Oo(x)}v=null}else v=null;m!==null&&K_(h,f,m,v,!1),y!==null&&_!==null&&K_(h,_,y,v,!0)}}e:{if(f=c?ta(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var R=qD;else if(F_(f))if(K1)R=QD;else{R=KD;var P=HD}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(R=GD);if(R&&(R=R(n,c))){H1(h,R,t,u);break e}P&&P(n,f,c),n==="focusout"&&(P=f._wrapperState)&&P.controlled&&f.type==="number"&&sg(f,"number",f.value)}switch(P=c?ta(c):window,n){case"focusin":(F_(P)||P.contentEditable==="true")&&(Zo=P,gg=c,Xl=null);break;case"focusout":Xl=gg=Zo=null;break;case"mousedown":yg=!0;break;case"contextmenu":case"mouseup":case"dragend":yg=!1,W_(h,t,u);break;case"selectionchange":if(XD)break;case"keydown":case"keyup":W_(h,t,u)}var k;if(h0)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Xo?W1(n,t)&&(E="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(z1&&t.locale!=="ko"&&(Xo||E!=="onCompositionStart"?E==="onCompositionEnd"&&Xo&&(k=$1()):(Is=u,c0="value"in Is?Is.value:Is.textContent,Xo=!0)),P=lh(c,E),0<P.length&&(E=new O_(E,n,null,t,u),h.push({event:E,listeners:P}),k?E.data=k:(k=q1(t),k!==null&&(E.data=k)))),(k=BD?UD(n,t):$D(n,t))&&(c=lh(c,"onBeforeInput"),0<c.length&&(u=new O_("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=k))}rb(h,e)})}function Ec(n,e,t){return{instance:n,listener:e,currentTarget:t}}function lh(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=mc(n,t),i!=null&&r.unshift(Ec(n,i,s)),i=mc(n,e),i!=null&&r.push(Ec(n,i,s))),n=n.return}return r}function Oo(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function K_(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,s?(l=mc(t,i),l!=null&&o.unshift(Ec(t,l,a))):s||(l=mc(t,i),l!=null&&o.push(Ec(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var nM=/\r\n?/g,rM=/\u0000|\uFFFD/g;function G_(n){return(typeof n=="string"?n:""+n).replace(nM,`
`).replace(rM,"")}function td(n,e,t){if(e=G_(e),G_(n)!==e&&t)throw Error(z(425))}function ch(){}var vg=null,wg=null;function _g(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xg=typeof setTimeout=="function"?setTimeout:void 0,sM=typeof clearTimeout=="function"?clearTimeout:void 0,Q_=typeof Promise=="function"?Promise:void 0,iM=typeof queueMicrotask=="function"?queueMicrotask:typeof Q_<"u"?function(n){return Q_.resolve(null).then(n).catch(oM)}:xg;function oM(n){setTimeout(function(){throw n})}function sm(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),vc(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);vc(e)}function js(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function J_(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ja=Math.random().toString(36).slice(2),er="__reactFiber$"+Ja,kc="__reactProps$"+Ja,Hr="__reactContainer$"+Ja,Eg="__reactEvents$"+Ja,aM="__reactListeners$"+Ja,lM="__reactHandles$"+Ja;function Li(n){var e=n[er];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Hr]||t[er]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=J_(n);n!==null;){if(t=n[er])return t;n=J_(n)}return e}n=t,t=n.parentNode}return null}function iu(n){return n=n[er]||n[Hr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ta(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(z(33))}function wf(n){return n[kc]||null}var kg=[],na=-1;function ui(n){return{current:n}}function Re(n){0>na||(n.current=kg[na],kg[na]=null,na--)}function Ce(n,e){na++,kg[na]=n.current,n.current=e}var ei={},Mt=ui(ei),rn=ui(!1),to=ei;function ba(n,e){var t=n.type.contextTypes;if(!t)return ei;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function sn(n){return n=n.childContextTypes,n!=null}function uh(){Re(rn),Re(Mt)}function Y_(n,e,t){if(Mt.current!==ei)throw Error(z(168));Ce(Mt,e),Ce(rn,t)}function ib(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(z(108,HP(n)||"Unknown",s));return Fe({},t,r)}function dh(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ei,to=Mt.current,Ce(Mt,n),Ce(rn,rn.current),!0}function X_(n,e,t){var r=n.stateNode;if(!r)throw Error(z(169));t?(n=ib(n,e,to),r.__reactInternalMemoizedMergedChildContext=n,Re(rn),Re(Mt),Ce(Mt,n)):Re(rn),Ce(rn,t)}var Nr=null,_f=!1,im=!1;function ob(n){Nr===null?Nr=[n]:Nr.push(n)}function cM(n){_f=!0,ob(n)}function di(){if(!im&&Nr!==null){im=!0;var n=0,e=ke;try{var t=Nr;for(ke=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Nr=null,_f=!1}catch(s){throw Nr!==null&&(Nr=Nr.slice(n+1)),R1(i0,di),s}finally{ke=e,im=!1}}return null}var ra=[],sa=0,hh=null,fh=0,Tn=[],bn=0,no=null,Ar=1,Rr="";function Si(n,e){ra[sa++]=fh,ra[sa++]=hh,hh=n,fh=e}function ab(n,e,t){Tn[bn++]=Ar,Tn[bn++]=Rr,Tn[bn++]=no,no=n;var r=Ar;n=Rr;var s=32-Wn(r)-1;r&=~(1<<s),t+=1;var i=32-Wn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ar=1<<32-Wn(e)+s|t<<s|r,Rr=i+n}else Ar=1<<i|t<<s|r,Rr=n}function p0(n){n.return!==null&&(Si(n,1),ab(n,1,0))}function m0(n){for(;n===hh;)hh=ra[--sa],ra[sa]=null,fh=ra[--sa],ra[sa]=null;for(;n===no;)no=Tn[--bn],Tn[bn]=null,Rr=Tn[--bn],Tn[bn]=null,Ar=Tn[--bn],Tn[bn]=null}var yn=null,fn=null,De=!1,Un=null;function lb(n,e){var t=In(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Z_(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,yn=n,fn=js(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,yn=n,fn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=no!==null?{id:Ar,overflow:Rr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=In(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,yn=n,fn=null,!0):!1;default:return!1}}function Tg(n){return(n.mode&1)!==0&&(n.flags&128)===0}function bg(n){if(De){var e=fn;if(e){var t=e;if(!Z_(n,e)){if(Tg(n))throw Error(z(418));e=js(t.nextSibling);var r=yn;e&&Z_(n,e)?lb(r,t):(n.flags=n.flags&-4097|2,De=!1,yn=n)}}else{if(Tg(n))throw Error(z(418));n.flags=n.flags&-4097|2,De=!1,yn=n}}}function ex(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;yn=n}function nd(n){if(n!==yn)return!1;if(!De)return ex(n),De=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!_g(n.type,n.memoizedProps)),e&&(e=fn)){if(Tg(n))throw cb(),Error(z(418));for(;e;)lb(n,e),e=js(e.nextSibling)}if(ex(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(z(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){fn=js(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}fn=null}}else fn=yn?js(n.stateNode.nextSibling):null;return!0}function cb(){for(var n=fn;n;)n=js(n.nextSibling)}function Sa(){fn=yn=null,De=!1}function g0(n){Un===null?Un=[n]:Un.push(n)}var uM=es.ReactCurrentBatchConfig;function El(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(z(309));var r=t.stateNode}if(!r)throw Error(z(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(z(284));if(!t._owner)throw Error(z(290,n))}return n}function rd(n,e){throw n=Object.prototype.toString.call(e),Error(z(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function tx(n){var e=n._init;return e(n._payload)}function ub(n){function e(x,T){if(n){var b=x.deletions;b===null?(x.deletions=[T],x.flags|=16):b.push(T)}}function t(x,T){if(!n)return null;for(;T!==null;)e(x,T),T=T.sibling;return null}function r(x,T){for(x=new Map;T!==null;)T.key!==null?x.set(T.key,T):x.set(T.index,T),T=T.sibling;return x}function s(x,T){return x=Us(x,T),x.index=0,x.sibling=null,x}function i(x,T,b){return x.index=b,n?(b=x.alternate,b!==null?(b=b.index,b<T?(x.flags|=2,T):b):(x.flags|=2,T)):(x.flags|=1048576,T)}function o(x){return n&&x.alternate===null&&(x.flags|=2),x}function a(x,T,b,N){return T===null||T.tag!==6?(T=hm(b,x.mode,N),T.return=x,T):(T=s(T,b),T.return=x,T)}function l(x,T,b,N){var R=b.type;return R===Yo?u(x,T,b.props.children,N,b.key):T!==null&&(T.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===ps&&tx(R)===T.type)?(N=s(T,b.props),N.ref=El(x,T,b),N.return=x,N):(N=Vd(b.type,b.key,b.props,null,x.mode,N),N.ref=El(x,T,b),N.return=x,N)}function c(x,T,b,N){return T===null||T.tag!==4||T.stateNode.containerInfo!==b.containerInfo||T.stateNode.implementation!==b.implementation?(T=fm(b,x.mode,N),T.return=x,T):(T=s(T,b.children||[]),T.return=x,T)}function u(x,T,b,N,R){return T===null||T.tag!==7?(T=qi(b,x.mode,N,R),T.return=x,T):(T=s(T,b),T.return=x,T)}function h(x,T,b){if(typeof T=="string"&&T!==""||typeof T=="number")return T=hm(""+T,x.mode,b),T.return=x,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Hu:return b=Vd(T.type,T.key,T.props,null,x.mode,b),b.ref=El(x,null,T),b.return=x,b;case Jo:return T=fm(T,x.mode,b),T.return=x,T;case ps:var N=T._init;return h(x,N(T._payload),b)}if(Ol(T)||yl(T))return T=qi(T,x.mode,b,null),T.return=x,T;rd(x,T)}return null}function f(x,T,b,N){var R=T!==null?T.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return R!==null?null:a(x,T,""+b,N);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Hu:return b.key===R?l(x,T,b,N):null;case Jo:return b.key===R?c(x,T,b,N):null;case ps:return R=b._init,f(x,T,R(b._payload),N)}if(Ol(b)||yl(b))return R!==null?null:u(x,T,b,N,null);rd(x,b)}return null}function m(x,T,b,N,R){if(typeof N=="string"&&N!==""||typeof N=="number")return x=x.get(b)||null,a(T,x,""+N,R);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case Hu:return x=x.get(N.key===null?b:N.key)||null,l(T,x,N,R);case Jo:return x=x.get(N.key===null?b:N.key)||null,c(T,x,N,R);case ps:var P=N._init;return m(x,T,b,P(N._payload),R)}if(Ol(N)||yl(N))return x=x.get(b)||null,u(T,x,N,R,null);rd(T,N)}return null}function y(x,T,b,N){for(var R=null,P=null,k=T,E=T=0,S=null;k!==null&&E<b.length;E++){k.index>E?(S=k,k=null):S=k.sibling;var C=f(x,k,b[E],N);if(C===null){k===null&&(k=S);break}n&&k&&C.alternate===null&&e(x,k),T=i(C,T,E),P===null?R=C:P.sibling=C,P=C,k=S}if(E===b.length)return t(x,k),De&&Si(x,E),R;if(k===null){for(;E<b.length;E++)k=h(x,b[E],N),k!==null&&(T=i(k,T,E),P===null?R=k:P.sibling=k,P=k);return De&&Si(x,E),R}for(k=r(x,k);E<b.length;E++)S=m(k,x,E,b[E],N),S!==null&&(n&&S.alternate!==null&&k.delete(S.key===null?E:S.key),T=i(S,T,E),P===null?R=S:P.sibling=S,P=S);return n&&k.forEach(function(D){return e(x,D)}),De&&Si(x,E),R}function v(x,T,b,N){var R=yl(b);if(typeof R!="function")throw Error(z(150));if(b=R.call(b),b==null)throw Error(z(151));for(var P=R=null,k=T,E=T=0,S=null,C=b.next();k!==null&&!C.done;E++,C=b.next()){k.index>E?(S=k,k=null):S=k.sibling;var D=f(x,k,C.value,N);if(D===null){k===null&&(k=S);break}n&&k&&D.alternate===null&&e(x,k),T=i(D,T,E),P===null?R=D:P.sibling=D,P=D,k=S}if(C.done)return t(x,k),De&&Si(x,E),R;if(k===null){for(;!C.done;E++,C=b.next())C=h(x,C.value,N),C!==null&&(T=i(C,T,E),P===null?R=C:P.sibling=C,P=C);return De&&Si(x,E),R}for(k=r(x,k);!C.done;E++,C=b.next())C=m(k,x,E,C.value,N),C!==null&&(n&&C.alternate!==null&&k.delete(C.key===null?E:C.key),T=i(C,T,E),P===null?R=C:P.sibling=C,P=C);return n&&k.forEach(function(O){return e(x,O)}),De&&Si(x,E),R}function _(x,T,b,N){if(typeof b=="object"&&b!==null&&b.type===Yo&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Hu:e:{for(var R=b.key,P=T;P!==null;){if(P.key===R){if(R=b.type,R===Yo){if(P.tag===7){t(x,P.sibling),T=s(P,b.props.children),T.return=x,x=T;break e}}else if(P.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===ps&&tx(R)===P.type){t(x,P.sibling),T=s(P,b.props),T.ref=El(x,P,b),T.return=x,x=T;break e}t(x,P);break}else e(x,P);P=P.sibling}b.type===Yo?(T=qi(b.props.children,x.mode,N,b.key),T.return=x,x=T):(N=Vd(b.type,b.key,b.props,null,x.mode,N),N.ref=El(x,T,b),N.return=x,x=N)}return o(x);case Jo:e:{for(P=b.key;T!==null;){if(T.key===P)if(T.tag===4&&T.stateNode.containerInfo===b.containerInfo&&T.stateNode.implementation===b.implementation){t(x,T.sibling),T=s(T,b.children||[]),T.return=x,x=T;break e}else{t(x,T);break}else e(x,T);T=T.sibling}T=fm(b,x.mode,N),T.return=x,x=T}return o(x);case ps:return P=b._init,_(x,T,P(b._payload),N)}if(Ol(b))return y(x,T,b,N);if(yl(b))return v(x,T,b,N);rd(x,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,T!==null&&T.tag===6?(t(x,T.sibling),T=s(T,b),T.return=x,x=T):(t(x,T),T=hm(b,x.mode,N),T.return=x,x=T),o(x)):t(x,T)}return _}var Ia=ub(!0),db=ub(!1),ph=ui(null),mh=null,ia=null,y0=null;function v0(){y0=ia=mh=null}function w0(n){var e=ph.current;Re(ph),n._currentValue=e}function Sg(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ga(n,e){mh=n,y0=ia=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(tn=!0),n.firstContext=null)}function Mn(n){var e=n._currentValue;if(y0!==n)if(n={context:n,memoizedValue:e,next:null},ia===null){if(mh===null)throw Error(z(308));ia=n,mh.dependencies={lanes:0,firstContext:n}}else ia=ia.next=n;return e}var Fi=null;function _0(n){Fi===null?Fi=[n]:Fi.push(n)}function hb(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,_0(e)):(t.next=s.next,s.next=t),e.interleaved=t,Kr(n,r)}function Kr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ms=!1;function x0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fb(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function jr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Ls(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ye&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Kr(n,t)}return s=r.interleaved,s===null?(e.next=e,_0(r)):(e.next=s.next,s.next=e),r.interleaved=e,Kr(n,t)}function Ad(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,o0(n,t)}}function nx(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function gh(n,e,t,r){var s=n.updateQueue;ms=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,u=c=l=null,a=i;do{var f=a.lane,m=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=n,v=a;switch(f=e,m=t,v.tag){case 1:if(y=v.payload,typeof y=="function"){h=y.call(m,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=v.payload,f=typeof y=="function"?y.call(m,h,f):y,f==null)break e;h=Fe({},h,f);break e;case 2:ms=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);so|=o,n.lanes=o,n.memoizedState=h}}function rx(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(z(191,s));s.call(r)}}}var ou={},ar=ui(ou),Tc=ui(ou),bc=ui(ou);function Bi(n){if(n===ou)throw Error(z(174));return n}function E0(n,e){switch(Ce(bc,e),Ce(Tc,n),Ce(ar,ou),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:og(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=og(e,n)}Re(ar),Ce(ar,e)}function Ca(){Re(ar),Re(Tc),Re(bc)}function pb(n){Bi(bc.current);var e=Bi(ar.current),t=og(e,n.type);e!==t&&(Ce(Tc,n),Ce(ar,t))}function k0(n){Tc.current===n&&(Re(ar),Re(Tc))}var Oe=ui(0);function yh(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var om=[];function T0(){for(var n=0;n<om.length;n++)om[n]._workInProgressVersionPrimary=null;om.length=0}var Rd=es.ReactCurrentDispatcher,am=es.ReactCurrentBatchConfig,ro=0,je=null,tt=null,lt=null,vh=!1,Zl=!1,Sc=0,dM=0;function It(){throw Error(z(321))}function b0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Hn(n[t],e[t]))return!1;return!0}function S0(n,e,t,r,s,i){if(ro=i,je=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Rd.current=n===null||n.memoizedState===null?mM:gM,n=t(r,s),Zl){i=0;do{if(Zl=!1,Sc=0,25<=i)throw Error(z(301));i+=1,lt=tt=null,e.updateQueue=null,Rd.current=yM,n=t(r,s)}while(Zl)}if(Rd.current=wh,e=tt!==null&&tt.next!==null,ro=0,lt=tt=je=null,vh=!1,e)throw Error(z(300));return n}function I0(){var n=Sc!==0;return Sc=0,n}function Xn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?je.memoizedState=lt=n:lt=lt.next=n,lt}function On(){if(tt===null){var n=je.alternate;n=n!==null?n.memoizedState:null}else n=tt.next;var e=lt===null?je.memoizedState:lt.next;if(e!==null)lt=e,tt=n;else{if(n===null)throw Error(z(310));tt=n,n={memoizedState:tt.memoizedState,baseState:tt.baseState,baseQueue:tt.baseQueue,queue:tt.queue,next:null},lt===null?je.memoizedState=lt=n:lt=lt.next=n}return lt}function Ic(n,e){return typeof e=="function"?e(n):e}function lm(n){var e=On(),t=e.queue;if(t===null)throw Error(z(311));t.lastRenderedReducer=n;var r=tt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((ro&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,je.lanes|=u,so|=u}c=c.next}while(c!==null&&c!==i);l===null?o=r:l.next=a,Hn(r,e.memoizedState)||(tn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,je.lanes|=i,so|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function cm(n){var e=On(),t=e.queue;if(t===null)throw Error(z(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Hn(i,e.memoizedState)||(tn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function mb(){}function gb(n,e){var t=je,r=On(),s=e(),i=!Hn(r.memoizedState,s);if(i&&(r.memoizedState=s,tn=!0),r=r.queue,C0(wb.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||lt!==null&&lt.memoizedState.tag&1){if(t.flags|=2048,Cc(9,vb.bind(null,t,r,s,e),void 0,null),ut===null)throw Error(z(349));ro&30||yb(t,e,s)}return s}function yb(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=je.updateQueue,e===null?(e={lastEffect:null,stores:null},je.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function vb(n,e,t,r){e.value=t,e.getSnapshot=r,_b(e)&&xb(n)}function wb(n,e,t){return t(function(){_b(e)&&xb(n)})}function _b(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Hn(n,t)}catch{return!0}}function xb(n){var e=Kr(n,1);e!==null&&qn(e,n,1,-1)}function sx(n){var e=Xn();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ic,lastRenderedState:n},e.queue=n,n=n.dispatch=pM.bind(null,je,n),[e.memoizedState,n]}function Cc(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=je.updateQueue,e===null?(e={lastEffect:null,stores:null},je.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Eb(){return On().memoizedState}function Pd(n,e,t,r){var s=Xn();je.flags|=n,s.memoizedState=Cc(1|e,t,void 0,r===void 0?null:r)}function xf(n,e,t,r){var s=On();r=r===void 0?null:r;var i=void 0;if(tt!==null){var o=tt.memoizedState;if(i=o.destroy,r!==null&&b0(r,o.deps)){s.memoizedState=Cc(e,t,i,r);return}}je.flags|=n,s.memoizedState=Cc(1|e,t,i,r)}function ix(n,e){return Pd(8390656,8,n,e)}function C0(n,e){return xf(2048,8,n,e)}function kb(n,e){return xf(4,2,n,e)}function Tb(n,e){return xf(4,4,n,e)}function bb(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Sb(n,e,t){return t=t!=null?t.concat([n]):null,xf(4,4,bb.bind(null,e,n),t)}function N0(){}function Ib(n,e){var t=On();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&b0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Cb(n,e){var t=On();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&b0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Nb(n,e,t){return ro&21?(Hn(t,e)||(t=M1(),je.lanes|=t,so|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,tn=!0),n.memoizedState=t)}function hM(n,e){var t=ke;ke=t!==0&&4>t?t:4,n(!0);var r=am.transition;am.transition={};try{n(!1),e()}finally{ke=t,am.transition=r}}function Ab(){return On().memoizedState}function fM(n,e,t){var r=Bs(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Rb(n))Pb(e,t);else if(t=hb(n,e,t,r),t!==null){var s=zt();qn(t,n,r,s),Db(t,e,r)}}function pM(n,e,t){var r=Bs(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Rb(n))Pb(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Hn(a,o)){var l=e.interleaved;l===null?(s.next=s,_0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=hb(n,e,s,r),t!==null&&(s=zt(),qn(t,n,r,s),Db(t,e,r))}}function Rb(n){var e=n.alternate;return n===je||e!==null&&e===je}function Pb(n,e){Zl=vh=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Db(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,o0(n,t)}}var wh={readContext:Mn,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},mM={readContext:Mn,useCallback:function(n,e){return Xn().memoizedState=[n,e===void 0?null:e],n},useContext:Mn,useEffect:ix,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Pd(4194308,4,bb.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Pd(4194308,4,n,e)},useInsertionEffect:function(n,e){return Pd(4,2,n,e)},useMemo:function(n,e){var t=Xn();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Xn();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=fM.bind(null,je,n),[r.memoizedState,n]},useRef:function(n){var e=Xn();return n={current:n},e.memoizedState=n},useState:sx,useDebugValue:N0,useDeferredValue:function(n){return Xn().memoizedState=n},useTransition:function(){var n=sx(!1),e=n[0];return n=hM.bind(null,n[1]),Xn().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=je,s=Xn();if(De){if(t===void 0)throw Error(z(407));t=t()}else{if(t=e(),ut===null)throw Error(z(349));ro&30||yb(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,ix(wb.bind(null,r,i,n),[n]),r.flags|=2048,Cc(9,vb.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Xn(),e=ut.identifierPrefix;if(De){var t=Rr,r=Ar;t=(r&~(1<<32-Wn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Sc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=dM++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},gM={readContext:Mn,useCallback:Ib,useContext:Mn,useEffect:C0,useImperativeHandle:Sb,useInsertionEffect:kb,useLayoutEffect:Tb,useMemo:Cb,useReducer:lm,useRef:Eb,useState:function(){return lm(Ic)},useDebugValue:N0,useDeferredValue:function(n){var e=On();return Nb(e,tt.memoizedState,n)},useTransition:function(){var n=lm(Ic)[0],e=On().memoizedState;return[n,e]},useMutableSource:mb,useSyncExternalStore:gb,useId:Ab,unstable_isNewReconciler:!1},yM={readContext:Mn,useCallback:Ib,useContext:Mn,useEffect:C0,useImperativeHandle:Sb,useInsertionEffect:kb,useLayoutEffect:Tb,useMemo:Cb,useReducer:cm,useRef:Eb,useState:function(){return cm(Ic)},useDebugValue:N0,useDeferredValue:function(n){var e=On();return tt===null?e.memoizedState=n:Nb(e,tt.memoizedState,n)},useTransition:function(){var n=cm(Ic)[0],e=On().memoizedState;return[n,e]},useMutableSource:mb,useSyncExternalStore:gb,useId:Ab,unstable_isNewReconciler:!1};function Fn(n,e){if(n&&n.defaultProps){e=Fe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Ig(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Fe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ef={isMounted:function(n){return(n=n._reactInternals)?ko(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=zt(),s=Bs(n),i=jr(r,s);i.payload=e,t!=null&&(i.callback=t),e=Ls(n,i,s),e!==null&&(qn(e,n,s,r),Ad(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=zt(),s=Bs(n),i=jr(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Ls(n,i,s),e!==null&&(qn(e,n,s,r),Ad(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=zt(),r=Bs(n),s=jr(t,r);s.tag=2,e!=null&&(s.callback=e),e=Ls(n,s,r),e!==null&&(qn(e,n,r,t),Ad(e,n,r))}};function ox(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!_c(t,r)||!_c(s,i):!0}function Mb(n,e,t){var r=!1,s=ei,i=e.contextType;return typeof i=="object"&&i!==null?i=Mn(i):(s=sn(e)?to:Mt.current,r=e.contextTypes,i=(r=r!=null)?ba(n,s):ei),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ef,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function ax(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ef.enqueueReplaceState(e,e.state,null)}function Cg(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},x0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Mn(i):(i=sn(e)?to:Mt.current,s.context=ba(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ig(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Ef.enqueueReplaceState(s,s.state,null),gh(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Na(n,e){try{var t="",r=e;do t+=qP(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function um(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Ng(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var vM=typeof WeakMap=="function"?WeakMap:Map;function Ob(n,e,t){t=jr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){xh||(xh=!0,Fg=r),Ng(n,e)},t}function Vb(n,e,t){t=jr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Ng(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Ng(n,e),typeof r!="function"&&(Fs===null?Fs=new Set([this]):Fs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function lx(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new vM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=PM.bind(null,n,e,t),e.then(n,n))}function cx(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function ux(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=jr(-1,1),e.tag=2,Ls(t,e,1))),t.lanes|=1),n)}var wM=es.ReactCurrentOwner,tn=!1;function Bt(n,e,t,r){e.child=n===null?db(e,null,t,r):Ia(e,n.child,t,r)}function dx(n,e,t,r,s){t=t.render;var i=e.ref;return ga(e,s),r=S0(n,e,t,r,i,s),t=I0(),n!==null&&!tn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Gr(n,e,s)):(De&&t&&p0(e),e.flags|=1,Bt(n,e,r,s),e.child)}function hx(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!j0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,jb(n,e,i,r,s)):(n=Vd(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:_c,t(o,r)&&n.ref===e.ref)return Gr(n,e,s)}return e.flags|=1,n=Us(i,r),n.ref=e.ref,n.return=e,e.child=n}function jb(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(_c(i,r)&&n.ref===e.ref)if(tn=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(tn=!0);else return e.lanes=n.lanes,Gr(n,e,s)}return Ag(n,e,t,r,s)}function Lb(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ce(aa,un),un|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ce(aa,un),un|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Ce(aa,un),un|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Ce(aa,un),un|=r;return Bt(n,e,s,t),e.child}function Fb(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Ag(n,e,t,r,s){var i=sn(t)?to:Mt.current;return i=ba(e,i),ga(e,s),t=S0(n,e,t,r,i,s),r=I0(),n!==null&&!tn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Gr(n,e,s)):(De&&r&&p0(e),e.flags|=1,Bt(n,e,t,s),e.child)}function fx(n,e,t,r,s){if(sn(t)){var i=!0;dh(e)}else i=!1;if(ga(e,s),e.stateNode===null)Dd(n,e),Mb(e,t,r),Cg(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Mn(c):(c=sn(t)?to:Mt.current,c=ba(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&ax(e,o,r,c),ms=!1;var f=e.memoizedState;o.state=f,gh(e,r,o,s),l=e.memoizedState,a!==r||f!==l||rn.current||ms?(typeof u=="function"&&(Ig(e,t,u,r),l=e.memoizedState),(a=ms||ox(e,t,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,fb(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Fn(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Mn(l):(l=sn(t)?to:Mt.current,l=ba(e,l));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&ax(e,o,r,l),ms=!1,f=e.memoizedState,o.state=f,gh(e,r,o,s);var y=e.memoizedState;a!==h||f!==y||rn.current||ms?(typeof m=="function"&&(Ig(e,t,m,r),y=e.memoizedState),(c=ms||ox(e,t,c,r,f,y,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=y),o.props=r,o.state=y,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return Rg(n,e,t,r,i,s)}function Rg(n,e,t,r,s,i){Fb(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&X_(e,t,!1),Gr(n,e,i);r=e.stateNode,wM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Ia(e,n.child,null,i),e.child=Ia(e,null,a,i)):Bt(n,e,a,i),e.memoizedState=r.state,s&&X_(e,t,!0),e.child}function Bb(n){var e=n.stateNode;e.pendingContext?Y_(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Y_(n,e.context,!1),E0(n,e.containerInfo)}function px(n,e,t,r,s){return Sa(),g0(s),e.flags|=256,Bt(n,e,t,r),e.child}var Pg={dehydrated:null,treeContext:null,retryLane:0};function Dg(n){return{baseLanes:n,cachePool:null,transitions:null}}function Ub(n,e,t){var r=e.pendingProps,s=Oe.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Ce(Oe,s&1),n===null)return bg(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=bf(o,r,0,null),n=qi(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Dg(t),e.memoizedState=Pg,n):A0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return _M(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Us(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Us(a,i):(i=qi(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Dg(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=Pg,r}return i=n.child,n=i.sibling,r=Us(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function A0(n,e){return e=bf({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function sd(n,e,t,r){return r!==null&&g0(r),Ia(e,n.child,null,t),n=A0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function _M(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=um(Error(z(422))),sd(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=bf({mode:"visible",children:r.children},s,0,null),i=qi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ia(e,n.child,null,o),e.child.memoizedState=Dg(o),e.memoizedState=Pg,i);if(!(e.mode&1))return sd(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(z(419)),r=um(i,r,void 0),sd(n,e,o,r)}if(a=(o&n.childLanes)!==0,tn||a){if(r=ut,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Kr(n,s),qn(r,n,s,-1))}return V0(),r=um(Error(z(421))),sd(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=DM.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,fn=js(s.nextSibling),yn=e,De=!0,Un=null,n!==null&&(Tn[bn++]=Ar,Tn[bn++]=Rr,Tn[bn++]=no,Ar=n.id,Rr=n.overflow,no=e),e=A0(e,r.children),e.flags|=4096,e)}function mx(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Sg(n.return,e,t)}function dm(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function $b(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Bt(n,e,r.children,t),r=Oe.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&mx(n,t,e);else if(n.tag===19)mx(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ce(Oe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&yh(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),dm(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&yh(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}dm(e,!0,t,null,i);break;case"together":dm(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Dd(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Gr(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),so|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(z(153));if(e.child!==null){for(n=e.child,t=Us(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Us(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function xM(n,e,t){switch(e.tag){case 3:Bb(e),Sa();break;case 5:pb(e);break;case 1:sn(e.type)&&dh(e);break;case 4:E0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ce(ph,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ce(Oe,Oe.current&1),e.flags|=128,null):t&e.child.childLanes?Ub(n,e,t):(Ce(Oe,Oe.current&1),n=Gr(n,e,t),n!==null?n.sibling:null);Ce(Oe,Oe.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return $b(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ce(Oe,Oe.current),r)break;return null;case 22:case 23:return e.lanes=0,Lb(n,e,t)}return Gr(n,e,t)}var zb,Mg,Wb,qb;zb=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Mg=function(){};Wb=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Bi(ar.current);var i=null;switch(t){case"input":s=ng(n,s),r=ng(n,r),i=[];break;case"select":s=Fe({},s,{value:void 0}),r=Fe({},r,{value:void 0}),i=[];break;case"textarea":s=ig(n,s),r=ig(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=ch)}ag(t,r);var o;t=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(fc.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(a=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(fc.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ae("scroll",n),i||a===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};qb=function(n,e,t,r){t!==r&&(e.flags|=4)};function kl(n,e){if(!De)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Ct(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function EM(n,e,t){var r=e.pendingProps;switch(m0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ct(e),null;case 1:return sn(e.type)&&uh(),Ct(e),null;case 3:return r=e.stateNode,Ca(),Re(rn),Re(Mt),T0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(nd(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Un!==null&&($g(Un),Un=null))),Mg(n,e),Ct(e),null;case 5:k0(e);var s=Bi(bc.current);if(t=e.type,n!==null&&e.stateNode!=null)Wb(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(z(166));return Ct(e),null}if(n=Bi(ar.current),nd(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[er]=e,r[kc]=i,n=(e.mode&1)!==0,t){case"dialog":Ae("cancel",r),Ae("close",r);break;case"iframe":case"object":case"embed":Ae("load",r);break;case"video":case"audio":for(s=0;s<jl.length;s++)Ae(jl[s],r);break;case"source":Ae("error",r);break;case"img":case"image":case"link":Ae("error",r),Ae("load",r);break;case"details":Ae("toggle",r);break;case"input":T_(r,i),Ae("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ae("invalid",r);break;case"textarea":S_(r,i),Ae("invalid",r)}ag(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&td(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&td(r.textContent,a,n),s=["children",""+a]):fc.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ae("scroll",r)}switch(t){case"input":Ku(r),b_(r,i,!0);break;case"textarea":Ku(r),I_(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ch)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=w1(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[er]=e,n[kc]=r,zb(n,e,!1,!1),e.stateNode=n;e:{switch(o=lg(t,r),t){case"dialog":Ae("cancel",n),Ae("close",n),s=r;break;case"iframe":case"object":case"embed":Ae("load",n),s=r;break;case"video":case"audio":for(s=0;s<jl.length;s++)Ae(jl[s],n);s=r;break;case"source":Ae("error",n),s=r;break;case"img":case"image":case"link":Ae("error",n),Ae("load",n),s=r;break;case"details":Ae("toggle",n),s=r;break;case"input":T_(n,r),s=ng(n,r),Ae("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Fe({},r,{value:void 0}),Ae("invalid",n);break;case"textarea":S_(n,r),s=ig(n,r),Ae("invalid",n);break;default:s=r}ag(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?E1(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&_1(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&pc(n,l):typeof l=="number"&&pc(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(fc.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ae("scroll",n):l!=null&&e0(n,i,l,o))}switch(t){case"input":Ku(n),b_(n,r,!1);break;case"textarea":Ku(n),I_(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Zs(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?ha(n,!!r.multiple,i,!1):r.defaultValue!=null&&ha(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=ch)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ct(e),null;case 6:if(n&&e.stateNode!=null)qb(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(z(166));if(t=Bi(bc.current),Bi(ar.current),nd(e)){if(r=e.stateNode,t=e.memoizedProps,r[er]=e,(i=r.nodeValue!==t)&&(n=yn,n!==null))switch(n.tag){case 3:td(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&td(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[er]=e,e.stateNode=r}return Ct(e),null;case 13:if(Re(Oe),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(De&&fn!==null&&e.mode&1&&!(e.flags&128))cb(),Sa(),e.flags|=98560,i=!1;else if(i=nd(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(z(317));i[er]=e}else Sa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ct(e),i=!1}else Un!==null&&($g(Un),Un=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Oe.current&1?rt===0&&(rt=3):V0())),e.updateQueue!==null&&(e.flags|=4),Ct(e),null);case 4:return Ca(),Mg(n,e),n===null&&xc(e.stateNode.containerInfo),Ct(e),null;case 10:return w0(e.type._context),Ct(e),null;case 17:return sn(e.type)&&uh(),Ct(e),null;case 19:if(Re(Oe),i=e.memoizedState,i===null)return Ct(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)kl(i,!1);else{if(rt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=yh(n),o!==null){for(e.flags|=128,kl(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ce(Oe,Oe.current&1|2),e.child}n=n.sibling}i.tail!==null&&Ke()>Aa&&(e.flags|=128,r=!0,kl(i,!1),e.lanes=4194304)}else{if(!r)if(n=yh(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),kl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!De)return Ct(e),null}else 2*Ke()-i.renderingStartTime>Aa&&t!==1073741824&&(e.flags|=128,r=!0,kl(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ke(),e.sibling=null,t=Oe.current,Ce(Oe,r?t&1|2:t&1),e):(Ct(e),null);case 22:case 23:return O0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?un&1073741824&&(Ct(e),e.subtreeFlags&6&&(e.flags|=8192)):Ct(e),null;case 24:return null;case 25:return null}throw Error(z(156,e.tag))}function kM(n,e){switch(m0(e),e.tag){case 1:return sn(e.type)&&uh(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ca(),Re(rn),Re(Mt),T0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return k0(e),null;case 13:if(Re(Oe),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(z(340));Sa()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Re(Oe),null;case 4:return Ca(),null;case 10:return w0(e.type._context),null;case 22:case 23:return O0(),null;case 24:return null;default:return null}}var id=!1,Rt=!1,TM=typeof WeakSet=="function"?WeakSet:Set,Q=null;function oa(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ue(n,e,r)}else t.current=null}function Og(n,e,t){try{t()}catch(r){Ue(n,e,r)}}var gx=!1;function bM(n,e){if(vg=oh,n=J1(),f0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=n,f=null;t:for(;;){for(var m;h!==t||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===n)break t;if(f===t&&++c===s&&(a=o),f===i&&++u===r&&(l=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(wg={focusedElem:n,selectionRange:t},oh=!1,Q=e;Q!==null;)if(e=Q,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Q=n;else for(;Q!==null;){e=Q;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var v=y.memoizedProps,_=y.memoizedState,x=e.stateNode,T=x.getSnapshotBeforeUpdate(e.elementType===e.type?v:Fn(e.type,v),_);x.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(z(163))}}catch(N){Ue(e,e.return,N)}if(n=e.sibling,n!==null){n.return=e.return,Q=n;break}Q=e.return}return y=gx,gx=!1,y}function ec(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Og(e,t,i)}s=s.next}while(s!==r)}}function kf(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Vg(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Hb(n){var e=n.alternate;e!==null&&(n.alternate=null,Hb(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[er],delete e[kc],delete e[Eg],delete e[aM],delete e[lM])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Kb(n){return n.tag===5||n.tag===3||n.tag===4}function yx(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Kb(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function jg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ch));else if(r!==4&&(n=n.child,n!==null))for(jg(n,e,t),n=n.sibling;n!==null;)jg(n,e,t),n=n.sibling}function Lg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Lg(n,e,t),n=n.sibling;n!==null;)Lg(n,e,t),n=n.sibling}var mt=null,Bn=!1;function ls(n,e,t){for(t=t.child;t!==null;)Gb(n,e,t),t=t.sibling}function Gb(n,e,t){if(or&&typeof or.onCommitFiberUnmount=="function")try{or.onCommitFiberUnmount(mf,t)}catch{}switch(t.tag){case 5:Rt||oa(t,e);case 6:var r=mt,s=Bn;mt=null,ls(n,e,t),mt=r,Bn=s,mt!==null&&(Bn?(n=mt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):mt.removeChild(t.stateNode));break;case 18:mt!==null&&(Bn?(n=mt,t=t.stateNode,n.nodeType===8?sm(n.parentNode,t):n.nodeType===1&&sm(n,t),vc(n)):sm(mt,t.stateNode));break;case 4:r=mt,s=Bn,mt=t.stateNode.containerInfo,Bn=!0,ls(n,e,t),mt=r,Bn=s;break;case 0:case 11:case 14:case 15:if(!Rt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Og(t,e,o),s=s.next}while(s!==r)}ls(n,e,t);break;case 1:if(!Rt&&(oa(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Ue(t,e,a)}ls(n,e,t);break;case 21:ls(n,e,t);break;case 22:t.mode&1?(Rt=(r=Rt)||t.memoizedState!==null,ls(n,e,t),Rt=r):ls(n,e,t);break;default:ls(n,e,t)}}function vx(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new TM),e.forEach(function(r){var s=MM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function Ln(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:mt=a.stateNode,Bn=!1;break e;case 3:mt=a.stateNode.containerInfo,Bn=!0;break e;case 4:mt=a.stateNode.containerInfo,Bn=!0;break e}a=a.return}if(mt===null)throw Error(z(160));Gb(i,o,s),mt=null,Bn=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){Ue(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Qb(e,n),e=e.sibling}function Qb(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ln(e,n),Yn(n),r&4){try{ec(3,n,n.return),kf(3,n)}catch(v){Ue(n,n.return,v)}try{ec(5,n,n.return)}catch(v){Ue(n,n.return,v)}}break;case 1:Ln(e,n),Yn(n),r&512&&t!==null&&oa(t,t.return);break;case 5:if(Ln(e,n),Yn(n),r&512&&t!==null&&oa(t,t.return),n.flags&32){var s=n.stateNode;try{pc(s,"")}catch(v){Ue(n,n.return,v)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&y1(s,i),lg(a,o);var c=lg(a,i);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?E1(s,h):u==="dangerouslySetInnerHTML"?_1(s,h):u==="children"?pc(s,h):e0(s,u,h,c)}switch(a){case"input":rg(s,i);break;case"textarea":v1(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?ha(s,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?ha(s,!!i.multiple,i.defaultValue,!0):ha(s,!!i.multiple,i.multiple?[]:"",!1))}s[kc]=i}catch(v){Ue(n,n.return,v)}}break;case 6:if(Ln(e,n),Yn(n),r&4){if(n.stateNode===null)throw Error(z(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(v){Ue(n,n.return,v)}}break;case 3:if(Ln(e,n),Yn(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{vc(e.containerInfo)}catch(v){Ue(n,n.return,v)}break;case 4:Ln(e,n),Yn(n);break;case 13:Ln(e,n),Yn(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(D0=Ke())),r&4&&vx(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(Rt=(c=Rt)||u,Ln(e,n),Rt=c):Ln(e,n),Yn(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(Q=n,u=n.child;u!==null;){for(h=Q=u;Q!==null;){switch(f=Q,m=f.child,f.tag){case 0:case 11:case 14:case 15:ec(4,f,f.return);break;case 1:oa(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(v){Ue(r,t,v)}}break;case 5:oa(f,f.return);break;case 22:if(f.memoizedState!==null){_x(h);continue}}m!==null?(m.return=f,Q=m):_x(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=x1("display",o))}catch(v){Ue(n,n.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){Ue(n,n.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ln(e,n),Yn(n),r&4&&vx(n);break;case 21:break;default:Ln(e,n),Yn(n)}}function Yn(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Kb(t)){var r=t;break e}t=t.return}throw Error(z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(pc(s,""),r.flags&=-33);var i=yx(n);Lg(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=yx(n);jg(n,a,o);break;default:throw Error(z(161))}}catch(l){Ue(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function SM(n,e,t){Q=n,Jb(n)}function Jb(n,e,t){for(var r=(n.mode&1)!==0;Q!==null;){var s=Q,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||id;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Rt;a=id;var c=Rt;if(id=o,(Rt=l)&&!c)for(Q=s;Q!==null;)o=Q,l=o.child,o.tag===22&&o.memoizedState!==null?xx(s):l!==null?(l.return=o,Q=l):xx(s);for(;i!==null;)Q=i,Jb(i),i=i.sibling;Q=s,id=a,Rt=c}wx(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Q=i):wx(n)}}function wx(n){for(;Q!==null;){var e=Q;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Rt||kf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Rt)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Fn(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&rx(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}rx(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&vc(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(z(163))}Rt||e.flags&512&&Vg(e)}catch(f){Ue(e,e.return,f)}}if(e===n){Q=null;break}if(t=e.sibling,t!==null){t.return=e.return,Q=t;break}Q=e.return}}function _x(n){for(;Q!==null;){var e=Q;if(e===n){Q=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Q=t;break}Q=e.return}}function xx(n){for(;Q!==null;){var e=Q;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{kf(4,e)}catch(l){Ue(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Ue(e,s,l)}}var i=e.return;try{Vg(e)}catch(l){Ue(e,i,l)}break;case 5:var o=e.return;try{Vg(e)}catch(l){Ue(e,o,l)}}}catch(l){Ue(e,e.return,l)}if(e===n){Q=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Q=a;break}Q=e.return}}var IM=Math.ceil,_h=es.ReactCurrentDispatcher,R0=es.ReactCurrentOwner,An=es.ReactCurrentBatchConfig,ye=0,ut=null,Ye=null,Et=0,un=0,aa=ui(0),rt=0,Nc=null,so=0,Tf=0,P0=0,tc=null,en=null,D0=0,Aa=1/0,Ir=null,xh=!1,Fg=null,Fs=null,od=!1,Cs=null,Eh=0,nc=0,Bg=null,Md=-1,Od=0;function zt(){return ye&6?Ke():Md!==-1?Md:Md=Ke()}function Bs(n){return n.mode&1?ye&2&&Et!==0?Et&-Et:uM.transition!==null?(Od===0&&(Od=M1()),Od):(n=ke,n!==0||(n=window.event,n=n===void 0?16:U1(n.type)),n):1}function qn(n,e,t,r){if(50<nc)throw nc=0,Bg=null,Error(z(185));ru(n,t,r),(!(ye&2)||n!==ut)&&(n===ut&&(!(ye&2)&&(Tf|=t),rt===4&&ws(n,Et)),on(n,r),t===1&&ye===0&&!(e.mode&1)&&(Aa=Ke()+500,_f&&di()))}function on(n,e){var t=n.callbackNode;uD(n,e);var r=ih(n,n===ut?Et:0);if(r===0)t!==null&&A_(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&A_(t),e===1)n.tag===0?cM(Ex.bind(null,n)):ob(Ex.bind(null,n)),iM(function(){!(ye&6)&&di()}),t=null;else{switch(O1(r)){case 1:t=i0;break;case 4:t=P1;break;case 16:t=sh;break;case 536870912:t=D1;break;default:t=sh}t=sS(t,Yb.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Yb(n,e){if(Md=-1,Od=0,ye&6)throw Error(z(327));var t=n.callbackNode;if(ya()&&n.callbackNode!==t)return null;var r=ih(n,n===ut?Et:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=kh(n,r);else{e=r;var s=ye;ye|=2;var i=Zb();(ut!==n||Et!==e)&&(Ir=null,Aa=Ke()+500,Wi(n,e));do try{AM();break}catch(a){Xb(n,a)}while(!0);v0(),_h.current=i,ye=s,Ye!==null?e=0:(ut=null,Et=0,e=rt)}if(e!==0){if(e===2&&(s=fg(n),s!==0&&(r=s,e=Ug(n,s))),e===1)throw t=Nc,Wi(n,0),ws(n,r),on(n,Ke()),t;if(e===6)ws(n,r);else{if(s=n.current.alternate,!(r&30)&&!CM(s)&&(e=kh(n,r),e===2&&(i=fg(n),i!==0&&(r=i,e=Ug(n,i))),e===1))throw t=Nc,Wi(n,0),ws(n,r),on(n,Ke()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(z(345));case 2:Ii(n,en,Ir);break;case 3:if(ws(n,r),(r&130023424)===r&&(e=D0+500-Ke(),10<e)){if(ih(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){zt(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=xg(Ii.bind(null,n,en,Ir),e);break}Ii(n,en,Ir);break;case 4:if(ws(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-Wn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ke()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*IM(r/1960))-r,10<r){n.timeoutHandle=xg(Ii.bind(null,n,en,Ir),r);break}Ii(n,en,Ir);break;case 5:Ii(n,en,Ir);break;default:throw Error(z(329))}}}return on(n,Ke()),n.callbackNode===t?Yb.bind(null,n):null}function Ug(n,e){var t=tc;return n.current.memoizedState.isDehydrated&&(Wi(n,e).flags|=256),n=kh(n,e),n!==2&&(e=en,en=t,e!==null&&$g(e)),n}function $g(n){en===null?en=n:en.push.apply(en,n)}function CM(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Hn(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ws(n,e){for(e&=~P0,e&=~Tf,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Wn(e),r=1<<t;n[t]=-1,e&=~r}}function Ex(n){if(ye&6)throw Error(z(327));ya();var e=ih(n,0);if(!(e&1))return on(n,Ke()),null;var t=kh(n,e);if(n.tag!==0&&t===2){var r=fg(n);r!==0&&(e=r,t=Ug(n,r))}if(t===1)throw t=Nc,Wi(n,0),ws(n,e),on(n,Ke()),t;if(t===6)throw Error(z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Ii(n,en,Ir),on(n,Ke()),null}function M0(n,e){var t=ye;ye|=1;try{return n(e)}finally{ye=t,ye===0&&(Aa=Ke()+500,_f&&di())}}function io(n){Cs!==null&&Cs.tag===0&&!(ye&6)&&ya();var e=ye;ye|=1;var t=An.transition,r=ke;try{if(An.transition=null,ke=1,n)return n()}finally{ke=r,An.transition=t,ye=e,!(ye&6)&&di()}}function O0(){un=aa.current,Re(aa)}function Wi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,sM(t)),Ye!==null)for(t=Ye.return;t!==null;){var r=t;switch(m0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&uh();break;case 3:Ca(),Re(rn),Re(Mt),T0();break;case 5:k0(r);break;case 4:Ca();break;case 13:Re(Oe);break;case 19:Re(Oe);break;case 10:w0(r.type._context);break;case 22:case 23:O0()}t=t.return}if(ut=n,Ye=n=Us(n.current,null),Et=un=e,rt=0,Nc=null,P0=Tf=so=0,en=tc=null,Fi!==null){for(e=0;e<Fi.length;e++)if(t=Fi[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Fi=null}return n}function Xb(n,e){do{var t=Ye;try{if(v0(),Rd.current=wh,vh){for(var r=je.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}vh=!1}if(ro=0,lt=tt=je=null,Zl=!1,Sc=0,R0.current=null,t===null||t.return===null){rt=1,Nc=e,Ye=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Et,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=cx(o);if(m!==null){m.flags&=-257,ux(m,o,a,i,e),m.mode&1&&lx(i,c,e),e=m,l=c;var y=e.updateQueue;if(y===null){var v=new Set;v.add(l),e.updateQueue=v}else y.add(l);break e}else{if(!(e&1)){lx(i,c,e),V0();break e}l=Error(z(426))}}else if(De&&a.mode&1){var _=cx(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),ux(_,o,a,i,e),g0(Na(l,a));break e}}i=l=Na(l,a),rt!==4&&(rt=2),tc===null?tc=[i]:tc.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=Ob(i,l,e);nx(i,x);break e;case 1:a=l;var T=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof T.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Fs===null||!Fs.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var N=Vb(i,a,e);nx(i,N);break e}}i=i.return}while(i!==null)}tS(t)}catch(R){e=R,Ye===t&&t!==null&&(Ye=t=t.return);continue}break}while(!0)}function Zb(){var n=_h.current;return _h.current=wh,n===null?wh:n}function V0(){(rt===0||rt===3||rt===2)&&(rt=4),ut===null||!(so&268435455)&&!(Tf&268435455)||ws(ut,Et)}function kh(n,e){var t=ye;ye|=2;var r=Zb();(ut!==n||Et!==e)&&(Ir=null,Wi(n,e));do try{NM();break}catch(s){Xb(n,s)}while(!0);if(v0(),ye=t,_h.current=r,Ye!==null)throw Error(z(261));return ut=null,Et=0,rt}function NM(){for(;Ye!==null;)eS(Ye)}function AM(){for(;Ye!==null&&!tD();)eS(Ye)}function eS(n){var e=rS(n.alternate,n,un);n.memoizedProps=n.pendingProps,e===null?tS(n):Ye=e,R0.current=null}function tS(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=kM(t,e),t!==null){t.flags&=32767,Ye=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{rt=6,Ye=null;return}}else if(t=EM(t,e,un),t!==null){Ye=t;return}if(e=e.sibling,e!==null){Ye=e;return}Ye=e=n}while(e!==null);rt===0&&(rt=5)}function Ii(n,e,t){var r=ke,s=An.transition;try{An.transition=null,ke=1,RM(n,e,t,r)}finally{An.transition=s,ke=r}return null}function RM(n,e,t,r){do ya();while(Cs!==null);if(ye&6)throw Error(z(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(z(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(dD(n,i),n===ut&&(Ye=ut=null,Et=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||od||(od=!0,sS(sh,function(){return ya(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=An.transition,An.transition=null;var o=ke;ke=1;var a=ye;ye|=4,R0.current=null,bM(n,t),Qb(t,n),YD(wg),oh=!!vg,wg=vg=null,n.current=t,SM(t),nD(),ye=a,ke=o,An.transition=i}else n.current=t;if(od&&(od=!1,Cs=n,Eh=s),i=n.pendingLanes,i===0&&(Fs=null),iD(t.stateNode),on(n,Ke()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(xh)throw xh=!1,n=Fg,Fg=null,n;return Eh&1&&n.tag!==0&&ya(),i=n.pendingLanes,i&1?n===Bg?nc++:(nc=0,Bg=n):nc=0,di(),null}function ya(){if(Cs!==null){var n=O1(Eh),e=An.transition,t=ke;try{if(An.transition=null,ke=16>n?16:n,Cs===null)var r=!1;else{if(n=Cs,Cs=null,Eh=0,ye&6)throw Error(z(331));var s=ye;for(ye|=4,Q=n.current;Q!==null;){var i=Q,o=i.child;if(Q.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Q=c;Q!==null;){var u=Q;switch(u.tag){case 0:case 11:case 15:ec(8,u,i)}var h=u.child;if(h!==null)h.return=u,Q=h;else for(;Q!==null;){u=Q;var f=u.sibling,m=u.return;if(Hb(u),u===c){Q=null;break}if(f!==null){f.return=m,Q=f;break}Q=m}}}var y=i.alternate;if(y!==null){var v=y.child;if(v!==null){y.child=null;do{var _=v.sibling;v.sibling=null,v=_}while(v!==null)}}Q=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Q=o;else e:for(;Q!==null;){if(i=Q,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ec(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,Q=x;break e}Q=i.return}}var T=n.current;for(Q=T;Q!==null;){o=Q;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Q=b;else e:for(o=T;Q!==null;){if(a=Q,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:kf(9,a)}}catch(R){Ue(a,a.return,R)}if(a===o){Q=null;break e}var N=a.sibling;if(N!==null){N.return=a.return,Q=N;break e}Q=a.return}}if(ye=s,di(),or&&typeof or.onPostCommitFiberRoot=="function")try{or.onPostCommitFiberRoot(mf,n)}catch{}r=!0}return r}finally{ke=t,An.transition=e}}return!1}function kx(n,e,t){e=Na(t,e),e=Ob(n,e,1),n=Ls(n,e,1),e=zt(),n!==null&&(ru(n,1,e),on(n,e))}function Ue(n,e,t){if(n.tag===3)kx(n,n,t);else for(;e!==null;){if(e.tag===3){kx(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Fs===null||!Fs.has(r))){n=Na(t,n),n=Vb(e,n,1),e=Ls(e,n,1),n=zt(),e!==null&&(ru(e,1,n),on(e,n));break}}e=e.return}}function PM(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=zt(),n.pingedLanes|=n.suspendedLanes&t,ut===n&&(Et&t)===t&&(rt===4||rt===3&&(Et&130023424)===Et&&500>Ke()-D0?Wi(n,0):P0|=t),on(n,e)}function nS(n,e){e===0&&(n.mode&1?(e=Ju,Ju<<=1,!(Ju&130023424)&&(Ju=4194304)):e=1);var t=zt();n=Kr(n,e),n!==null&&(ru(n,e,t),on(n,t))}function DM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),nS(n,t)}function MM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(z(314))}r!==null&&r.delete(e),nS(n,t)}var rS;rS=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||rn.current)tn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return tn=!1,xM(n,e,t);tn=!!(n.flags&131072)}else tn=!1,De&&e.flags&1048576&&ab(e,fh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Dd(n,e),n=e.pendingProps;var s=ba(e,Mt.current);ga(e,t),s=S0(null,e,r,n,s,t);var i=I0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,sn(r)?(i=!0,dh(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,x0(e),s.updater=Ef,e.stateNode=s,s._reactInternals=e,Cg(e,r,n,t),e=Rg(null,e,r,!0,i,t)):(e.tag=0,De&&i&&p0(e),Bt(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Dd(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=VM(r),n=Fn(r,n),s){case 0:e=Ag(null,e,r,n,t);break e;case 1:e=fx(null,e,r,n,t);break e;case 11:e=dx(null,e,r,n,t);break e;case 14:e=hx(null,e,r,Fn(r.type,n),t);break e}throw Error(z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fn(r,s),Ag(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fn(r,s),fx(n,e,r,s,t);case 3:e:{if(Bb(e),n===null)throw Error(z(387));r=e.pendingProps,i=e.memoizedState,s=i.element,fb(n,e),gh(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Na(Error(z(423)),e),e=px(n,e,r,t,s);break e}else if(r!==s){s=Na(Error(z(424)),e),e=px(n,e,r,t,s);break e}else for(fn=js(e.stateNode.containerInfo.firstChild),yn=e,De=!0,Un=null,t=db(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Sa(),r===s){e=Gr(n,e,t);break e}Bt(n,e,r,t)}e=e.child}return e;case 5:return pb(e),n===null&&bg(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,_g(r,s)?o=null:i!==null&&_g(r,i)&&(e.flags|=32),Fb(n,e),Bt(n,e,o,t),e.child;case 6:return n===null&&bg(e),null;case 13:return Ub(n,e,t);case 4:return E0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Ia(e,null,r,t):Bt(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fn(r,s),dx(n,e,r,s,t);case 7:return Bt(n,e,e.pendingProps,t),e.child;case 8:return Bt(n,e,e.pendingProps.children,t),e.child;case 12:return Bt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ce(ph,r._currentValue),r._currentValue=o,i!==null)if(Hn(i.value,o)){if(i.children===s.children&&!rn.current){e=Gr(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=jr(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),Sg(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(z(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Sg(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Bt(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ga(e,t),s=Mn(s),r=r(s),e.flags|=1,Bt(n,e,r,t),e.child;case 14:return r=e.type,s=Fn(r,e.pendingProps),s=Fn(r.type,s),hx(n,e,r,s,t);case 15:return jb(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fn(r,s),Dd(n,e),e.tag=1,sn(r)?(n=!0,dh(e)):n=!1,ga(e,t),Mb(e,r,s),Cg(e,r,s,t),Rg(null,e,r,!0,n,t);case 19:return $b(n,e,t);case 22:return Lb(n,e,t)}throw Error(z(156,e.tag))};function sS(n,e){return R1(n,e)}function OM(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(n,e,t,r){return new OM(n,e,t,r)}function j0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function VM(n){if(typeof n=="function")return j0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===n0)return 11;if(n===r0)return 14}return 2}function Us(n,e){var t=n.alternate;return t===null?(t=In(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Vd(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")j0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Yo:return qi(t.children,s,i,e);case t0:o=8,s|=8;break;case Xm:return n=In(12,t,e,s|2),n.elementType=Xm,n.lanes=i,n;case Zm:return n=In(13,t,e,s),n.elementType=Zm,n.lanes=i,n;case eg:return n=In(19,t,e,s),n.elementType=eg,n.lanes=i,n;case p1:return bf(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case h1:o=10;break e;case f1:o=9;break e;case n0:o=11;break e;case r0:o=14;break e;case ps:o=16,r=null;break e}throw Error(z(130,n==null?n:typeof n,""))}return e=In(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function qi(n,e,t,r){return n=In(7,n,r,e),n.lanes=t,n}function bf(n,e,t,r){return n=In(22,n,r,e),n.elementType=p1,n.lanes=t,n.stateNode={isHidden:!1},n}function hm(n,e,t){return n=In(6,n,null,e),n.lanes=t,n}function fm(n,e,t){return e=In(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function jM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Kp(0),this.expirationTimes=Kp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kp(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function L0(n,e,t,r,s,i,o,a,l){return n=new jM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=In(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},x0(i),n}function LM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Jo,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function iS(n){if(!n)return ei;n=n._reactInternals;e:{if(ko(n)!==n||n.tag!==1)throw Error(z(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(sn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(z(171))}if(n.tag===1){var t=n.type;if(sn(t))return ib(n,t,e)}return e}function oS(n,e,t,r,s,i,o,a,l){return n=L0(t,r,!0,n,s,i,o,a,l),n.context=iS(null),t=n.current,r=zt(),s=Bs(t),i=jr(r,s),i.callback=e??null,Ls(t,i,s),n.current.lanes=s,ru(n,s,r),on(n,r),n}function Sf(n,e,t,r){var s=e.current,i=zt(),o=Bs(s);return t=iS(t),e.context===null?e.context=t:e.pendingContext=t,e=jr(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Ls(s,e,o),n!==null&&(qn(n,s,o,i),Ad(n,s,o)),o}function Th(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Tx(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function F0(n,e){Tx(n,e),(n=n.alternate)&&Tx(n,e)}function FM(){return null}var aS=typeof reportError=="function"?reportError:function(n){console.error(n)};function B0(n){this._internalRoot=n}If.prototype.render=B0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(z(409));Sf(n,e,null,null)};If.prototype.unmount=B0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;io(function(){Sf(null,n,null,null)}),e[Hr]=null}};function If(n){this._internalRoot=n}If.prototype.unstable_scheduleHydration=function(n){if(n){var e=L1();n={blockedOn:null,target:n,priority:e};for(var t=0;t<vs.length&&e!==0&&e<vs[t].priority;t++);vs.splice(t,0,n),t===0&&B1(n)}};function U0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Cf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function bx(){}function BM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=Th(o);i.call(c)}}var o=oS(e,r,n,0,null,!1,!1,"",bx);return n._reactRootContainer=o,n[Hr]=o.current,xc(n.nodeType===8?n.parentNode:n),io(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var c=Th(l);a.call(c)}}var l=L0(n,0,!1,null,null,!1,!1,"",bx);return n._reactRootContainer=l,n[Hr]=l.current,xc(n.nodeType===8?n.parentNode:n),io(function(){Sf(e,l,t,r)}),l}function Nf(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Th(o);a.call(l)}}Sf(e,o,n,s)}else o=BM(t,e,n,s,r);return Th(o)}V1=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Vl(e.pendingLanes);t!==0&&(o0(e,t|1),on(e,Ke()),!(ye&6)&&(Aa=Ke()+500,di()))}break;case 13:io(function(){var r=Kr(n,1);if(r!==null){var s=zt();qn(r,n,1,s)}}),F0(n,1)}};a0=function(n){if(n.tag===13){var e=Kr(n,134217728);if(e!==null){var t=zt();qn(e,n,134217728,t)}F0(n,134217728)}};j1=function(n){if(n.tag===13){var e=Bs(n),t=Kr(n,e);if(t!==null){var r=zt();qn(t,n,e,r)}F0(n,e)}};L1=function(){return ke};F1=function(n,e){var t=ke;try{return ke=n,e()}finally{ke=t}};ug=function(n,e,t){switch(e){case"input":if(rg(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=wf(r);if(!s)throw Error(z(90));g1(r),rg(r,s)}}}break;case"textarea":v1(n,t);break;case"select":e=t.value,e!=null&&ha(n,!!t.multiple,e,!1)}};b1=M0;S1=io;var UM={usingClientEntryPoint:!1,Events:[iu,ta,wf,k1,T1,M0]},Tl={findFiberByHostInstance:Li,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$M={bundleType:Tl.bundleType,version:Tl.version,rendererPackageName:Tl.rendererPackageName,rendererConfig:Tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:es.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=N1(n),n===null?null:n.stateNode},findFiberByHostInstance:Tl.findFiberByHostInstance||FM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ad=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ad.isDisabled&&ad.supportsFiber)try{mf=ad.inject($M),or=ad}catch{}}xn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UM;xn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!U0(e))throw Error(z(200));return LM(n,e,null,t)};xn.createRoot=function(n,e){if(!U0(n))throw Error(z(299));var t=!1,r="",s=aS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=L0(n,1,!1,null,null,t,!1,r,s),n[Hr]=e.current,xc(n.nodeType===8?n.parentNode:n),new B0(e)};xn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(z(188)):(n=Object.keys(n).join(","),Error(z(268,n)));return n=N1(e),n=n===null?null:n.stateNode,n};xn.flushSync=function(n){return io(n)};xn.hydrate=function(n,e,t){if(!Cf(e))throw Error(z(200));return Nf(null,n,e,!0,t)};xn.hydrateRoot=function(n,e,t){if(!U0(n))throw Error(z(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=aS;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=oS(e,null,n,1,t??null,s,!1,i,o),n[Hr]=e.current,xc(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new If(e)};xn.render=function(n,e,t){if(!Cf(e))throw Error(z(200));return Nf(null,n,e,!1,t)};xn.unmountComponentAtNode=function(n){if(!Cf(n))throw Error(z(40));return n._reactRootContainer?(io(function(){Nf(null,null,n,!1,function(){n._reactRootContainer=null,n[Hr]=null})}),!0):!1};xn.unstable_batchedUpdates=M0;xn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Cf(t))throw Error(z(200));if(n==null||n._reactInternals===void 0)throw Error(z(38));return Nf(n,e,t,!1,r)};xn.version="18.3.1-next-f1338f8080-20240426";function lS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lS)}catch(n){console.error(n)}}lS(),l1.exports=xn;var cS=l1.exports;const zM=JT(cS);var Sx=cS;Jm.createRoot=Sx.createRoot,Jm.hydrateRoot=Sx.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ac(){return Ac=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ac.apply(this,arguments)}var Ns;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Ns||(Ns={}));const Ix="popstate";function WM(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return zg("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:bh(s)}return HM(e,t,null,n)}function Ze(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function uS(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function qM(){return Math.random().toString(36).substr(2,8)}function Cx(n,e){return{usr:n.state,key:n.key,idx:e}}function zg(n,e,t,r){return t===void 0&&(t=null),Ac({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Ya(e):e,{state:t,key:e&&e.key||r||qM()})}function bh(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ya(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function HM(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=Ns.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(Ac({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function h(){a=Ns.Pop;let _=u(),x=_==null?null:_-c;c=_,l&&l({action:a,location:v.location,delta:x})}function f(_,x){a=Ns.Push;let T=zg(v.location,_,x);c=u()+1;let b=Cx(T,c),N=v.createHref(T);try{o.pushState(b,"",N)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;s.location.assign(N)}i&&l&&l({action:a,location:v.location,delta:1})}function m(_,x){a=Ns.Replace;let T=zg(v.location,_,x);c=u();let b=Cx(T,c),N=v.createHref(T);o.replaceState(b,"",N),i&&l&&l({action:a,location:v.location,delta:0})}function y(_){let x=s.location.origin!=="null"?s.location.origin:s.location.href,T=typeof _=="string"?_:bh(_);return T=T.replace(/ $/,"%20"),Ze(x,"No window.location.(origin|href) available to create URL for href: "+T),new URL(T,x)}let v={get action(){return a},get location(){return n(s,o)},listen(_){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(Ix,h),l=_,()=>{s.removeEventListener(Ix,h),l=null}},createHref(_){return e(s,_)},createURL:y,encodeLocation(_){let x=y(_);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:f,replace:m,go(_){return o.go(_)}};return v}var Nx;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Nx||(Nx={}));function KM(n,e,t){return t===void 0&&(t="/"),GM(n,e,t)}function GM(n,e,t,r){let s=typeof e=="string"?Ya(e):e,i=$0(s.pathname||"/",t);if(i==null)return null;let o=dS(n);QM(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=aO(i);a=sO(o[l],c)}return a}function dS(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Ze(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=$s([r,l.relativePath]),u=t.concat(l);i.children&&i.children.length>0&&(Ze(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),dS(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:nO(c,i.index),routesMeta:u})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of hS(i.path))s(i,o,l)}),e}function hS(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=hS(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function QM(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:rO(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const JM=/^:[\w-]+$/,YM=3,XM=2,ZM=1,eO=10,tO=-2,Ax=n=>n==="*";function nO(n,e){let t=n.split("/"),r=t.length;return t.some(Ax)&&(r+=tO),e&&(r+=XM),t.filter(s=>!Ax(s)).reduce((s,i)=>s+(JM.test(i)?YM:i===""?ZM:eO),r)}function rO(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function sO(n,e,t){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=i==="/"?e:e.slice(i.length)||"/",h=iO({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:$s([i,h.pathname]),pathnameBase:dO($s([i,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(i=$s([i,h.pathnameBase]))}return o}function iO(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=oO(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,u,h)=>{let{paramName:f,isOptional:m}=u;if(f==="*"){let v=a[h]||"";o=i.slice(0,i.length-v.length).replace(/(.)\/+$/,"$1")}const y=a[h];return m&&!y?c[f]=void 0:c[f]=(y||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:n}}function oO(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),uS(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function aO(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return uS(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function $0(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function lO(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Ya(n):n;return{pathname:t?t.startsWith("/")?t:cO(t,e):e,search:hO(r),hash:fO(s)}}function cO(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function pm(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function uO(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function fS(n,e){let t=uO(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function pS(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Ya(n):(s=Ac({},n),Ze(!s.pathname||!s.pathname.includes("?"),pm("?","pathname","search",s)),Ze(!s.pathname||!s.pathname.includes("#"),pm("#","pathname","hash",s)),Ze(!s.search||!s.search.includes("#"),pm("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;s.pathname=f.join("/")}a=h>=0?e[h]:"/"}let l=lO(s,a),c=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const $s=n=>n.join("/").replace(/\/\/+/g,"/"),dO=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),hO=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,fO=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function pO(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const mS=["post","put","patch","delete"];new Set(mS);const mO=["get",...mS];new Set(mO);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Rc(){return Rc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Rc.apply(this,arguments)}const z0=M.createContext(null),gO=M.createContext(null),To=M.createContext(null),Af=M.createContext(null),hi=M.createContext({outlet:null,matches:[],isDataRoute:!1}),gS=M.createContext(null);function yO(n,e){let{relative:t}=e===void 0?{}:e;au()||Ze(!1);let{basename:r,navigator:s}=M.useContext(To),{hash:i,pathname:o,search:a}=vS(n,{relative:t}),l=o;return r!=="/"&&(l=o==="/"?r:$s([r,o])),s.createHref({pathname:l,search:a,hash:i})}function au(){return M.useContext(Af)!=null}function lu(){return au()||Ze(!1),M.useContext(Af).location}function yS(n){M.useContext(To).static||M.useLayoutEffect(n)}function vO(){let{isDataRoute:n}=M.useContext(hi);return n?PO():wO()}function wO(){au()||Ze(!1);let n=M.useContext(z0),{basename:e,future:t,navigator:r}=M.useContext(To),{matches:s}=M.useContext(hi),{pathname:i}=lu(),o=JSON.stringify(fS(s,t.v7_relativeSplatPath)),a=M.useRef(!1);return yS(()=>{a.current=!0}),M.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){r.go(c);return}let h=pS(c,JSON.parse(o),i,u.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:$s([e,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[e,r,o,i,n])}function _O(){let{matches:n}=M.useContext(hi),e=n[n.length-1];return e?e.params:{}}function vS(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=M.useContext(To),{matches:s}=M.useContext(hi),{pathname:i}=lu(),o=JSON.stringify(fS(s,r.v7_relativeSplatPath));return M.useMemo(()=>pS(n,JSON.parse(o),i,t==="path"),[n,o,i,t])}function xO(n,e){return EO(n,e)}function EO(n,e,t,r){au()||Ze(!1);let{navigator:s}=M.useContext(To),{matches:i}=M.useContext(hi),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=lu(),u;if(e){var h;let _=typeof e=="string"?Ya(e):e;l==="/"||(h=_.pathname)!=null&&h.startsWith(l)||Ze(!1),u=_}else u=c;let f=u.pathname||"/",m=f;if(l!=="/"){let _=l.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(_.length).join("/")}let y=KM(n,{pathname:m}),v=IO(y&&y.map(_=>Object.assign({},_,{params:Object.assign({},a,_.params),pathname:$s([l,s.encodeLocation?s.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?l:$s([l,s.encodeLocation?s.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),i,t,r);return e&&v?M.createElement(Af.Provider,{value:{location:Rc({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ns.Pop}},v):v}function kO(){let n=RO(),e=pO(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return M.createElement(M.Fragment,null,M.createElement("h2",null,"Unexpected Application Error!"),M.createElement("h3",{style:{fontStyle:"italic"}},e),t?M.createElement("pre",{style:s},t):null,null)}const TO=M.createElement(kO,null);class bO extends M.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?M.createElement(hi.Provider,{value:this.props.routeContext},M.createElement(gS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function SO(n){let{routeContext:e,match:t,children:r}=n,s=M.useContext(z0);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),M.createElement(hi.Provider,{value:e},r)}function IO(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let u=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);u>=0||Ze(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:f,errors:m}=t,y=h.route.loader&&f[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||y){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,h,f)=>{let m,y=!1,v=null,_=null;t&&(m=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||TO,l&&(c<0&&f===0?(DO("route-fallback"),y=!0,_=null):c===f&&(y=!0,_=h.route.hydrateFallbackElement||null)));let x=e.concat(o.slice(0,f+1)),T=()=>{let b;return m?b=v:y?b=_:h.route.Component?b=M.createElement(h.route.Component,null):h.route.element?b=h.route.element:b=u,M.createElement(SO,{match:h,routeContext:{outlet:u,matches:x,isDataRoute:t!=null},children:b})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?M.createElement(bO,{location:t.location,revalidation:t.revalidation,component:v,error:m,children:T(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):T()},null)}var wS=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(wS||{}),_S=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(_S||{});function CO(n){let e=M.useContext(z0);return e||Ze(!1),e}function NO(n){let e=M.useContext(gO);return e||Ze(!1),e}function AO(n){let e=M.useContext(hi);return e||Ze(!1),e}function xS(n){let e=AO(),t=e.matches[e.matches.length-1];return t.route.id||Ze(!1),t.route.id}function RO(){var n;let e=M.useContext(gS),t=NO(),r=xS();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function PO(){let{router:n}=CO(wS.UseNavigateStable),e=xS(_S.UseNavigateStable),t=M.useRef(!1);return yS(()=>{t.current=!0}),M.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,Rc({fromRouteId:e},i)))},[n,e])}const Rx={};function DO(n,e,t){Rx[n]||(Rx[n]=!0)}function MO(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Ci(n){Ze(!1)}function OO(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Ns.Pop,navigator:i,static:o=!1,future:a}=n;au()&&Ze(!1);let l=e.replace(/^\/*/,"/"),c=M.useMemo(()=>({basename:l,navigator:i,static:o,future:Rc({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=Ya(r));let{pathname:u="/",search:h="",hash:f="",state:m=null,key:y="default"}=r,v=M.useMemo(()=>{let _=$0(u,l);return _==null?null:{location:{pathname:_,search:h,hash:f,state:m,key:y},navigationType:s}},[l,u,h,f,m,y,s]);return v==null?null:M.createElement(To.Provider,{value:c},M.createElement(Af.Provider,{children:t,value:v}))}function VO(n){let{children:e,location:t}=n;return xO(Wg(e),t)}new Promise(()=>{});function Wg(n,e){e===void 0&&(e=[]);let t=[];return M.Children.forEach(n,(r,s)=>{if(!M.isValidElement(r))return;let i=[...e,s];if(r.type===M.Fragment){t.push.apply(t,Wg(r.props.children,i));return}r.type!==Ci&&Ze(!1),!r.props.index||!r.props.children||Ze(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Wg(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qg(){return qg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},qg.apply(this,arguments)}function jO(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function LO(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function FO(n,e){return n.button===0&&(!e||e==="_self")&&!LO(n)}const BO=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],UO="6";try{window.__reactRouterVersion=UO}catch{}const $O="startTransition",Px=PP[$O];function zO(n){let{basename:e,children:t,future:r,window:s}=n,i=M.useRef();i.current==null&&(i.current=WM({window:s,v5Compat:!0}));let o=i.current,[a,l]=M.useState({action:o.action,location:o.location}),{v7_startTransition:c}=r||{},u=M.useCallback(h=>{c&&Px?Px(()=>l(h)):l(h)},[l,c]);return M.useLayoutEffect(()=>o.listen(u),[o,u]),M.useEffect(()=>MO(r),[r]),M.createElement(OO,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const WO=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qO=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dn=M.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:h}=e,f=jO(e,BO),{basename:m}=M.useContext(To),y,v=!1;if(typeof c=="string"&&qO.test(c)&&(y=c,WO))try{let b=new URL(window.location.href),N=c.startsWith("//")?new URL(b.protocol+c):new URL(c),R=$0(N.pathname,m);N.origin===b.origin&&R!=null?c=R+N.search+N.hash:v=!0}catch{}let _=yO(c,{relative:s}),x=HO(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:s,viewTransition:h});function T(b){r&&r(b),b.defaultPrevented||x(b)}return M.createElement("a",qg({},f,{href:y||_,onClick:v||i?r:T,ref:t,target:l}))});var Dx;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Dx||(Dx={}));var Mx;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Mx||(Mx={}));function HO(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:a}=e===void 0?{}:e,l=vO(),c=lu(),u=vS(n,{relative:o});return M.useCallback(h=>{if(FO(h,t)){h.preventDefault();let f=r!==void 0?r:bh(c)===bh(u);l(n,{replace:f,state:s,preventScrollReset:i,relative:o,viewTransition:a})}},[c,l,u,r,s,t,n,i,o,a])}let KO={data:""},GO=n=>{if(typeof window=="object"){let e=(n?n.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(n||document.head).appendChild(e),e.firstChild}return n||KO},QO=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,JO=/\/\*[^]*?\*\/|  +/g,Ox=/\n+/g,_s=(n,e)=>{let t="",r="",s="";for(let i in n){let o=n[i];i[0]=="@"?i[1]=="i"?t=i+" "+o+";":r+=i[1]=="f"?_s(o,i):i+"{"+_s(o,i[1]=="k"?"":e)+"}":typeof o=="object"?r+=_s(o,e?e.replace(/([^,])+/g,a=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,l=>/&/.test(l)?l.replace(/&/g,a):a?a+" "+l:l)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=_s.p?_s.p(i,o):i+":"+o+";")}return t+(e&&s?e+"{"+s+"}":s)+r},br={},ES=n=>{if(typeof n=="object"){let e="";for(let t in n)e+=t+ES(n[t]);return e}return n},YO=(n,e,t,r,s)=>{let i=ES(n),o=br[i]||(br[i]=(l=>{let c=0,u=11;for(;c<l.length;)u=101*u+l.charCodeAt(c++)>>>0;return"go"+u})(i));if(!br[o]){let l=i!==n?n:(c=>{let u,h,f=[{}];for(;u=QO.exec(c.replace(JO,""));)u[4]?f.shift():u[3]?(h=u[3].replace(Ox," ").trim(),f.unshift(f[0][h]=f[0][h]||{})):f[0][u[1]]=u[2].replace(Ox," ").trim();return f[0]})(n);br[o]=_s(s?{["@keyframes "+o]:l}:l,t?"":"."+o)}let a=t&&br.g?br.g:null;return t&&(br.g=br[o]),((l,c,u,h)=>{h?c.data=c.data.replace(h,l):c.data.indexOf(l)===-1&&(c.data=u?l+c.data:c.data+l)})(br[o],e,r,a),o},XO=(n,e,t)=>n.reduce((r,s,i)=>{let o=e[i];if(o&&o.call){let a=o(t),l=a&&a.props&&a.props.className||/^go/.test(a)&&a;o=l?"."+l:a&&typeof a=="object"?a.props?"":_s(a,""):a===!1?"":a}return r+s+(o??"")},"");function Rf(n){let e=this||{},t=n.call?n(e.p):n;return YO(t.unshift?t.raw?XO(t,[].slice.call(arguments,1),e.p):t.reduce((r,s)=>Object.assign(r,s&&s.call?s(e.p):s),{}):t,GO(e.target),e.g,e.o,e.k)}let kS,Hg,Kg;Rf.bind({g:1});let Qr=Rf.bind({k:1});function ZO(n,e,t,r){_s.p=e,kS=n,Hg=t,Kg=r}function fi(n,e){let t=this||{};return function(){let r=arguments;function s(i,o){let a=Object.assign({},i),l=a.className||s.className;t.p=Object.assign({theme:Hg&&Hg()},a),t.o=/ *go\d+/.test(l),a.className=Rf.apply(t,r)+(l?" "+l:"");let c=n;return n[0]&&(c=a.as||n,delete a.as),Kg&&c[0]&&Kg(a),kS(c,a)}return s}}var e2=n=>typeof n=="function",Sh=(n,e)=>e2(n)?n(e):n,t2=(()=>{let n=0;return()=>(++n).toString()})(),TS=(()=>{let n;return()=>{if(n===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");n=!e||e.matches}return n}})(),n2=20,W0="default",bS=(n,e)=>{let{toastLimit:t}=n.settings;switch(e.type){case 0:return{...n,toasts:[e.toast,...n.toasts].slice(0,t)};case 1:return{...n,toasts:n.toasts.map(o=>o.id===e.toast.id?{...o,...e.toast}:o)};case 2:let{toast:r}=e;return bS(n,{type:n.toasts.find(o=>o.id===r.id)?1:0,toast:r});case 3:let{toastId:s}=e;return{...n,toasts:n.toasts.map(o=>o.id===s||s===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(o=>o.id!==e.toastId)};case 5:return{...n,pausedAt:e.time};case 6:let i=e.time-(n.pausedAt||0);return{...n,pausedAt:void 0,toasts:n.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},jd=[],SS={toasts:[],pausedAt:void 0,settings:{toastLimit:n2}},tr={},IS=(n,e=W0)=>{tr[e]=bS(tr[e]||SS,n),jd.forEach(([t,r])=>{t===e&&r(tr[e])})},CS=n=>Object.keys(tr).forEach(e=>IS(n,e)),r2=n=>Object.keys(tr).find(e=>tr[e].toasts.some(t=>t.id===n)),Pf=(n=W0)=>e=>{IS(e,n)},s2={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},i2=(n={},e=W0)=>{let[t,r]=M.useState(tr[e]||SS),s=M.useRef(tr[e]);M.useEffect(()=>(s.current!==tr[e]&&r(tr[e]),jd.push([e,r]),()=>{let o=jd.findIndex(([a])=>a===e);o>-1&&jd.splice(o,1)}),[e]);let i=t.toasts.map(o=>{var a,l,c;return{...n,...n[o.type],...o,removeDelay:o.removeDelay||((a=n[o.type])==null?void 0:a.removeDelay)||(n==null?void 0:n.removeDelay),duration:o.duration||((l=n[o.type])==null?void 0:l.duration)||(n==null?void 0:n.duration)||s2[o.type],style:{...n.style,...(c=n[o.type])==null?void 0:c.style,...o.style}}});return{...t,toasts:i}},o2=(n,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:n,pauseDuration:0,...t,id:(t==null?void 0:t.id)||t2()}),cu=n=>(e,t)=>{let r=o2(e,n,t);return Pf(r.toasterId||r2(r.id))({type:2,toast:r}),r.id},nt=(n,e)=>cu("blank")(n,e);nt.error=cu("error");nt.success=cu("success");nt.loading=cu("loading");nt.custom=cu("custom");nt.dismiss=(n,e)=>{let t={type:3,toastId:n};e?Pf(e)(t):CS(t)};nt.dismissAll=n=>nt.dismiss(void 0,n);nt.remove=(n,e)=>{let t={type:4,toastId:n};e?Pf(e)(t):CS(t)};nt.removeAll=n=>nt.remove(void 0,n);nt.promise=(n,e,t)=>{let r=nt.loading(e.loading,{...t,...t==null?void 0:t.loading});return typeof n=="function"&&(n=n()),n.then(s=>{let i=e.success?Sh(e.success,s):void 0;return i?nt.success(i,{id:r,...t,...t==null?void 0:t.success}):nt.dismiss(r),s}).catch(s=>{let i=e.error?Sh(e.error,s):void 0;i?nt.error(i,{id:r,...t,...t==null?void 0:t.error}):nt.dismiss(r)}),n};var a2=1e3,l2=(n,e="default")=>{let{toasts:t,pausedAt:r}=i2(n,e),s=M.useRef(new Map).current,i=M.useCallback((h,f=a2)=>{if(s.has(h))return;let m=setTimeout(()=>{s.delete(h),o({type:4,toastId:h})},f);s.set(h,m)},[]);M.useEffect(()=>{if(r)return;let h=Date.now(),f=t.map(m=>{if(m.duration===1/0)return;let y=(m.duration||0)+m.pauseDuration-(h-m.createdAt);if(y<0){m.visible&&nt.dismiss(m.id);return}return setTimeout(()=>nt.dismiss(m.id,e),y)});return()=>{f.forEach(m=>m&&clearTimeout(m))}},[t,r,e]);let o=M.useCallback(Pf(e),[e]),a=M.useCallback(()=>{o({type:5,time:Date.now()})},[o]),l=M.useCallback((h,f)=>{o({type:1,toast:{id:h,height:f}})},[o]),c=M.useCallback(()=>{r&&o({type:6,time:Date.now()})},[r,o]),u=M.useCallback((h,f)=>{let{reverseOrder:m=!1,gutter:y=8,defaultPosition:v}=f||{},_=t.filter(b=>(b.position||v)===(h.position||v)&&b.height),x=_.findIndex(b=>b.id===h.id),T=_.filter((b,N)=>N<x&&b.visible).length;return _.filter(b=>b.visible).slice(...m?[T+1]:[0,T]).reduce((b,N)=>b+(N.height||0)+y,0)},[t]);return M.useEffect(()=>{t.forEach(h=>{if(h.dismissed)i(h.id,h.removeDelay);else{let f=s.get(h.id);f&&(clearTimeout(f),s.delete(h.id))}})},[t,i]),{toasts:t,handlers:{updateHeight:l,startPause:a,endPause:c,calculateOffset:u}}},c2=Qr`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,u2=Qr`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,d2=Qr`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,h2=fi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${c2} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${u2} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${n=>n.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${d2} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,f2=Qr`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,p2=fi("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${n=>n.secondary||"#e0e0e0"};
  border-right-color: ${n=>n.primary||"#616161"};
  animation: ${f2} 1s linear infinite;
`,m2=Qr`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,g2=Qr`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,y2=fi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${m2} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${g2} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${n=>n.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,v2=fi("div")`
  position: absolute;
`,w2=fi("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,_2=Qr`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,x2=fi("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${_2} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,E2=({toast:n})=>{let{icon:e,type:t,iconTheme:r}=n;return e!==void 0?typeof e=="string"?M.createElement(x2,null,e):e:t==="blank"?null:M.createElement(w2,null,M.createElement(p2,{...r}),t!=="loading"&&M.createElement(v2,null,t==="error"?M.createElement(h2,{...r}):M.createElement(y2,{...r})))},k2=n=>`
0% {transform: translate3d(0,${n*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,T2=n=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${n*-150}%,-1px) scale(.6); opacity:0;}
`,b2="0%{opacity:0;} 100%{opacity:1;}",S2="0%{opacity:1;} 100%{opacity:0;}",I2=fi("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,C2=fi("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,N2=(n,e)=>{let t=n.includes("top")?1:-1,[r,s]=TS()?[b2,S2]:[k2(t),T2(t)];return{animation:e?`${Qr(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Qr(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},A2=M.memo(({toast:n,position:e,style:t,children:r})=>{let s=n.height?N2(n.position||e||"top-center",n.visible):{opacity:0},i=M.createElement(E2,{toast:n}),o=M.createElement(C2,{...n.ariaProps},Sh(n.message,n));return M.createElement(I2,{className:n.className,style:{...s,...t,...n.style}},typeof r=="function"?r({icon:i,message:o}):M.createElement(M.Fragment,null,i,o))});ZO(M.createElement);var R2=({id:n,className:e,style:t,onHeightUpdate:r,children:s})=>{let i=M.useCallback(o=>{if(o){let a=()=>{let l=o.getBoundingClientRect().height;r(n,l)};a(),new MutationObserver(a).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[n,r]);return M.createElement("div",{ref:i,className:e,style:t},s)},P2=(n,e)=>{let t=n.includes("top"),r=t?{top:0}:{bottom:0},s=n.includes("center")?{justifyContent:"center"}:n.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:TS()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...r,...s}},D2=Rf`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,ld=16,M2=({reverseOrder:n,position:e="top-center",toastOptions:t,gutter:r,children:s,toasterId:i,containerStyle:o,containerClassName:a})=>{let{toasts:l,handlers:c}=l2(t,i);return M.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:ld,left:ld,right:ld,bottom:ld,pointerEvents:"none",...o},className:a,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map(u=>{let h=u.position||e,f=c.calculateOffset(u,{reverseOrder:n,gutter:r,defaultPosition:e}),m=P2(h,f);return M.createElement(R2,{id:u.id,key:u.id,onHeightUpdate:c.updateHeight,className:u.visible?D2:"",style:m},u.type==="custom"?Sh(u.message,u):s?s(u):M.createElement(A2,{toast:u,position:h}))}))},pe=nt,Vx={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NS=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},O2=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},AS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,u=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),r.push(t[u],t[h],t[f],t[m])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(NS(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):O2(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||h==null)throw new V2;const f=i<<2|a>>4;if(r.push(f),c!==64){const m=a<<4&240|c>>2;if(r.push(m),h!==64){const y=c<<6&192|h;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class V2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const j2=function(n){const e=NS(n);return AS.encodeByteArray(e,!0)},Ih=function(n){return j2(n).replace(/\./g,"")},RS=function(n){try{return AS.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2=()=>L2().__FIREBASE_DEFAULTS__,B2=()=>{if(typeof process>"u"||typeof Vx>"u")return;const n=Vx.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},U2=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&RS(n[1]);return e&&JSON.parse(e)},Df=()=>{try{return F2()||B2()||U2()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},PS=n=>{var e,t;return(t=(e=Df())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},DS=n=>{const e=PS(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},MS=()=>{var n;return(n=Df())===null||n===void 0?void 0:n.config},OS=n=>{var e;return(e=Df())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VS(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ih(JSON.stringify(t)),Ih(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function z2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(st())}function W2(){var n;const e=(n=Df())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function q2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function H2(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function K2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function G2(){const n=st();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function jS(){return!W2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function LS(){try{return typeof indexedDB=="object"}catch{return!1}}function Q2(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2="FirebaseError";class gr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=J2,Object.setPrototypeOf(this,gr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uu.prototype.create)}}class uu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?Y2(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new gr(s,a,r)}}function Y2(n,e){return n.replace(X2,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const X2=/\{\$([^}]+)}/g;function Z2(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ch(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(jx(i)&&jx(o)){if(!Ch(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function jx(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ll(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Fl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function eV(n,e){const t=new tV(n,e);return t.subscribe.bind(t)}class tV{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");nV(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=mm),s.error===void 0&&(s.error=mm),s.complete===void 0&&(s.complete=mm);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nV(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function mm(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function it(n){return n&&n._delegate?n._delegate:n}class ti{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ni="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new $2;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(iV(e))try{this.getOrInitializeService({instanceIdentifier:Ni})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ni){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ni){return this.instances.has(e)}getOptions(e=Ni){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:sV(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ni){return this.component?this.component.multipleInstances?e:Ni:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sV(n){return n===Ni?void 0:n}function iV(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oV{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new rV(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(fe||(fe={}));const aV={debug:fe.DEBUG,verbose:fe.VERBOSE,info:fe.INFO,warn:fe.WARN,error:fe.ERROR,silent:fe.SILENT},lV=fe.INFO,cV={[fe.DEBUG]:"log",[fe.VERBOSE]:"log",[fe.INFO]:"info",[fe.WARN]:"warn",[fe.ERROR]:"error"},uV=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=cV[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class q0{constructor(e){this.name=e,this._logLevel=lV,this._logHandler=uV,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in fe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?aV[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,fe.DEBUG,...e),this._logHandler(this,fe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,fe.VERBOSE,...e),this._logHandler(this,fe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,fe.INFO,...e),this._logHandler(this,fe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,fe.WARN,...e),this._logHandler(this,fe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,fe.ERROR,...e),this._logHandler(this,fe.ERROR,...e)}}const dV=(n,e)=>e.some(t=>n instanceof t);let Lx,Fx;function hV(){return Lx||(Lx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fV(){return Fx||(Fx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const FS=new WeakMap,Gg=new WeakMap,BS=new WeakMap,gm=new WeakMap,H0=new WeakMap;function pV(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(zs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&FS.set(t,n)}).catch(()=>{}),H0.set(e,n),e}function mV(n){if(Gg.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Gg.set(n,e)}let Qg={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Gg.get(n);if(e==="objectStoreNames")return n.objectStoreNames||BS.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return zs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function gV(n){Qg=n(Qg)}function yV(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(ym(this),e,...t);return BS.set(r,e.sort?e.sort():[e]),zs(r)}:fV().includes(n)?function(...e){return n.apply(ym(this),e),zs(FS.get(this))}:function(...e){return zs(n.apply(ym(this),e))}}function vV(n){return typeof n=="function"?yV(n):(n instanceof IDBTransaction&&mV(n),dV(n,hV())?new Proxy(n,Qg):n)}function zs(n){if(n instanceof IDBRequest)return pV(n);if(gm.has(n))return gm.get(n);const e=vV(n);return e!==n&&(gm.set(n,e),H0.set(e,n)),e}const ym=n=>H0.get(n);function wV(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=zs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(zs(o.result),l.oldVersion,l.newVersion,zs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const _V=["get","getKey","getAll","getAllKeys","count"],xV=["put","add","delete","clear"],vm=new Map;function Bx(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(vm.get(e))return vm.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=xV.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||_V.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return vm.set(e,i),i}gV(n=>({...n,get:(e,t,r)=>Bx(e,t)||n.get(e,t,r),has:(e,t)=>!!Bx(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(kV(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function kV(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Jg="@firebase/app",Ux="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jr=new q0("@firebase/app"),TV="@firebase/app-compat",bV="@firebase/analytics-compat",SV="@firebase/analytics",IV="@firebase/app-check-compat",CV="@firebase/app-check",NV="@firebase/auth",AV="@firebase/auth-compat",RV="@firebase/database",PV="@firebase/data-connect",DV="@firebase/database-compat",MV="@firebase/functions",OV="@firebase/functions-compat",VV="@firebase/installations",jV="@firebase/installations-compat",LV="@firebase/messaging",FV="@firebase/messaging-compat",BV="@firebase/performance",UV="@firebase/performance-compat",$V="@firebase/remote-config",zV="@firebase/remote-config-compat",WV="@firebase/storage",qV="@firebase/storage-compat",HV="@firebase/firestore",KV="@firebase/vertexai-preview",GV="@firebase/firestore-compat",QV="firebase",JV="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yg="[DEFAULT]",YV={[Jg]:"fire-core",[TV]:"fire-core-compat",[SV]:"fire-analytics",[bV]:"fire-analytics-compat",[CV]:"fire-app-check",[IV]:"fire-app-check-compat",[NV]:"fire-auth",[AV]:"fire-auth-compat",[RV]:"fire-rtdb",[PV]:"fire-data-connect",[DV]:"fire-rtdb-compat",[MV]:"fire-fn",[OV]:"fire-fn-compat",[VV]:"fire-iid",[jV]:"fire-iid-compat",[LV]:"fire-fcm",[FV]:"fire-fcm-compat",[BV]:"fire-perf",[UV]:"fire-perf-compat",[$V]:"fire-rc",[zV]:"fire-rc-compat",[WV]:"fire-gcs",[qV]:"fire-gcs-compat",[HV]:"fire-fst",[GV]:"fire-fst-compat",[KV]:"fire-vertex","fire-js":"fire-js",[QV]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nh=new Map,XV=new Map,Xg=new Map;function $x(n,e){try{n.container.addComponent(e)}catch(t){Jr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function oo(n){const e=n.name;if(Xg.has(e))return Jr.debug(`There were multiple attempts to register component ${e}.`),!1;Xg.set(e,n);for(const t of Nh.values())$x(t,n);for(const t of XV.values())$x(t,n);return!0}function Mf(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function nr(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ws=new uu("app","Firebase",ZV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ti("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ws.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo=JV;function US(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Yg,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Ws.create("bad-app-name",{appName:String(s)});if(t||(t=MS()),!t)throw Ws.create("no-options");const i=Nh.get(s);if(i){if(Ch(t,i.options)&&Ch(r,i.config))return i;throw Ws.create("duplicate-app",{appName:s})}const o=new oV(s);for(const l of Xg.values())o.addComponent(l);const a=new ej(t,r,o);return Nh.set(s,a),a}function K0(n=Yg){const e=Nh.get(n);if(!e&&n===Yg&&MS())return US();if(!e)throw Ws.create("no-app",{appName:n});return e}function lr(n,e,t){var r;let s=(r=YV[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Jr.warn(a.join(" "));return}oo(new ti(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tj="firebase-heartbeat-database",nj=1,Pc="firebase-heartbeat-store";let wm=null;function $S(){return wm||(wm=wV(tj,nj,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Pc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ws.create("idb-open",{originalErrorMessage:n.message})})),wm}async function rj(n){try{const t=(await $S()).transaction(Pc),r=await t.objectStore(Pc).get(zS(n));return await t.done,r}catch(e){if(e instanceof gr)Jr.warn(e.message);else{const t=Ws.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Jr.warn(t.message)}}}async function zx(n,e){try{const r=(await $S()).transaction(Pc,"readwrite");await r.objectStore(Pc).put(e,zS(n)),await r.done}catch(t){if(t instanceof gr)Jr.warn(t.message);else{const r=Ws.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Jr.warn(r.message)}}}function zS(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sj=1024,ij=30*24*60*60*1e3;class oj{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new lj(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Wx();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=ij}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Jr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Wx(),{heartbeatsToSend:r,unsentEntries:s}=aj(this._heartbeatsCache.heartbeats),i=Ih(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Jr.warn(t),""}}}function Wx(){return new Date().toISOString().substring(0,10)}function aj(n,e=sj){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),qx(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),qx(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class lj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return LS()?Q2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await rj(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return zx(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return zx(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function qx(n){return Ih(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cj(n){oo(new ti("platform-logger",e=>new EV(e),"PRIVATE")),oo(new ti("heartbeat",e=>new oj(e),"PRIVATE")),lr(Jg,Ux,n),lr(Jg,Ux,"esm2017"),lr("fire-js","")}cj("");function G0(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function WS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const uj=WS,qS=new uu("auth","Firebase",WS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah=new q0("@firebase/auth");function dj(n,...e){Ah.logLevel<=fe.WARN&&Ah.warn(`Auth (${bo}): ${n}`,...e)}function Ld(n,...e){Ah.logLevel<=fe.ERROR&&Ah.error(`Auth (${bo}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(n,...e){throw Q0(n,...e)}function cr(n,...e){return Q0(n,...e)}function HS(n,e,t){const r=Object.assign(Object.assign({},uj()),{[e]:t});return new uu("auth","Firebase",r).create(e,{appName:n.name})}function Lr(n){return HS(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Q0(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return qS.create(n,...e)}function ne(n,e,...t){if(!n)throw Q0(e,...t)}function Pr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ld(e),new Error(e)}function Yr(n,e){n||Pr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zg(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function hj(){return Hx()==="http:"||Hx()==="https:"}function Hx(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fj(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hj()||H2()||"connection"in navigator)?navigator.onLine:!0}function pj(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t){this.shortDelay=e,this.longDelay=t,Yr(t>e,"Short delay should be less than long delay!"),this.isMobile=z2()||K2()}get(){return fj()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J0(n,e){Yr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Pr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Pr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Pr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gj=new hu(3e4,6e4);function ts(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function ns(n,e,t,r,s={}){return GS(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=du(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return q2()||(c.referrerPolicy="no-referrer"),KS.fetch()(QS(n,n.config.apiHost,t,a),c)})}async function GS(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},mj),e);try{const s=new vj(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw cd(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw cd(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw cd(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw cd(n,"user-disabled",o);const u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw HS(n,u,c);Kn(n,u)}}catch(s){if(s instanceof gr)throw s;Kn(n,"network-request-failed",{message:String(s)})}}async function fu(n,e,t,r,s={}){const i=await ns(n,e,t,r,s);return"mfaPendingCredential"in i&&Kn(n,"multi-factor-auth-required",{_serverResponse:i}),i}function QS(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?J0(n.config,s):`${n.config.apiScheme}://${s}`}function yj(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class vj{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(cr(this.auth,"network-request-failed")),gj.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function cd(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=cr(n,e,r);return s.customData._tokenResponse=t,s}function Kx(n){return n!==void 0&&n.enterprise!==void 0}class wj{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return yj(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function _j(n,e){return ns(n,"GET","/v2/recaptchaConfig",ts(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xj(n,e){return ns(n,"POST","/v1/accounts:delete",e)}async function JS(n,e){return ns(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Ej(n,e=!1){const t=it(n),r=await t.getIdToken(e),s=Y0(r);ne(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:rc(_m(s.auth_time)),issuedAtTime:rc(_m(s.iat)),expirationTime:rc(_m(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function _m(n){return Number(n)*1e3}function Y0(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ld("JWT malformed, contained fewer than 3 sections"),null;try{const s=RS(t);return s?JSON.parse(s):(Ld("Failed to decode base64 JWT payload"),null)}catch(s){return Ld("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Gx(n){const e=Y0(n);return ne(e,"internal-error"),ne(typeof e.exp<"u","internal-error"),ne(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dc(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof gr&&kj(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function kj({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=rc(this.lastLoginAt),this.creationTime=rc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rh(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Dc(n,JS(t,{idToken:r}));ne(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?YS(i.providerUserInfo):[],a=Sj(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),u=l?c:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new ey(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function bj(n){const e=it(n);await Rh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Sj(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function YS(n){return n.map(e=>{var{providerId:t}=e,r=G0(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ij(n,e){const t=await GS(n,{},async()=>{const r=du({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=QS(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",KS.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Cj(n,e){return ns(n,"POST","/v2/accounts:revokeToken",ts(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ne(e.idToken,"internal-error"),ne(typeof e.idToken<"u","internal-error"),ne(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Gx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ne(e.length!==0,"internal-error");const t=Gx(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ne(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Ij(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new va;return r&&(ne(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ne(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ne(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new va,this.toJSON())}_performRefresh(){return Pr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(n,e){ne(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Dr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=G0(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Tj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ey(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Dc(this,this.stsTokenManager.getToken(this.auth,e));return ne(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Ej(this,e)}reload(){return bj(this)}_assign(e){this!==e&&(ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Dr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Rh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(nr(this.auth.app))return Promise.reject(Lr(this.auth));const e=await this.getIdToken();return await Dc(this,xj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,u;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,f=(s=t.email)!==null&&s!==void 0?s:void 0,m=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,y=(o=t.photoURL)!==null&&o!==void 0?o:void 0,v=(a=t.tenantId)!==null&&a!==void 0?a:void 0,_=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,x=(c=t.createdAt)!==null&&c!==void 0?c:void 0,T=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:b,emailVerified:N,isAnonymous:R,providerData:P,stsTokenManager:k}=t;ne(b&&k,e,"internal-error");const E=va.fromJSON(this.name,k);ne(typeof b=="string",e,"internal-error"),cs(h,e.name),cs(f,e.name),ne(typeof N=="boolean",e,"internal-error"),ne(typeof R=="boolean",e,"internal-error"),cs(m,e.name),cs(y,e.name),cs(v,e.name),cs(_,e.name),cs(x,e.name),cs(T,e.name);const S=new Dr({uid:b,auth:e,email:f,emailVerified:N,displayName:h,isAnonymous:R,photoURL:y,phoneNumber:m,tenantId:v,stsTokenManager:E,createdAt:x,lastLoginAt:T});return P&&Array.isArray(P)&&(S.providerData=P.map(C=>Object.assign({},C))),_&&(S._redirectEventId=_),S}static async _fromIdTokenResponse(e,t,r=!1){const s=new va;s.updateFromServerResponse(t);const i=new Dr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Rh(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ne(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?YS(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new va;a.updateFromIdToken(r);const l=new Dr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new ey(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qx=new Map;function Mr(n){Yr(n instanceof Function,"Expected a class definition");let e=Qx.get(n);return e?(Yr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Qx.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}XS.type="NONE";const Jx=XS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fd(n,e,t){return`firebase:${n}:${e}:${t}`}class wa{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Fd(this.userKey,s.apiKey,i),this.fullPersistenceKey=Fd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Dr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new wa(Mr(Jx),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Mr(Jx);const o=Fd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const u=await c._get(o);if(u){const h=Dr._fromJSON(e,u);c!==i&&(a=h),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new wa(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new wa(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yx(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(nI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ZS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sI(e))return"Blackberry";if(iI(e))return"Webos";if(eI(e))return"Safari";if((e.includes("chrome/")||tI(e))&&!e.includes("edge/"))return"Chrome";if(rI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ZS(n=st()){return/firefox\//i.test(n)}function eI(n=st()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tI(n=st()){return/crios\//i.test(n)}function nI(n=st()){return/iemobile/i.test(n)}function rI(n=st()){return/android/i.test(n)}function sI(n=st()){return/blackberry/i.test(n)}function iI(n=st()){return/webos/i.test(n)}function X0(n=st()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Nj(n=st()){var e;return X0(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Aj(){return G2()&&document.documentMode===10}function oI(n=st()){return X0(n)||rI(n)||iI(n)||sI(n)||/windows phone/i.test(n)||nI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n,e=[]){let t;switch(n){case"Browser":t=Yx(st());break;case"Worker":t=`${Yx(st())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${bo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rj{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pj(n,e={}){return ns(n,"GET","/v2/passwordPolicy",ts(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dj=6;class Mj{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Dj,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xx(this),this.idTokenSubscription=new Xx(this),this.beforeStateQueue=new Rj(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=qS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Mr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await wa.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await JS(this,{idToken:e}),r=await Dr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(nr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Rh(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(nr(this.app))return Promise.reject(Lr(this));const t=e?it(e):null;return t&&ne(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return nr(this.app)?Promise.reject(Lr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return nr(this.app)?Promise.reject(Lr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Pj(this),t=new Mj(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new uu("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Cj(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Mr(e)||this._popupRedirectResolver;ne(t,this,"argument-error"),this.redirectPersistenceManager=await wa.create(this,[Mr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ne(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=aI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&dj(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function pi(n){return it(n)}class Xx{constructor(e){this.auth=e,this.observer=null,this.addObserver=eV(t=>this.observer=t)}get next(){return ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Of={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Vj(n){Of=n}function lI(n){return Of.loadJS(n)}function jj(){return Of.recaptchaEnterpriseScript}function Lj(){return Of.gapiScript}function Fj(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const Bj="recaptcha-enterprise",Uj="NO_RECAPTCHA";class $j{constructor(e){this.type=Bj,this.auth=pi(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{_j(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new wj(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;Kx(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(Uj)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&Kx(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=jj();l.length!==0&&(l+=a),lI(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Zx(n,e,t,r=!1){const s=new $j(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ph(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Zx(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Zx(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zj(n,e){const t=Mf(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ch(i,e??{}))return s;Kn(s,"already-initialized")}return t.initialize({options:e})}function Wj(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Mr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function qj(n,e,t){const r=pi(n);ne(r._canInitEmulator,r,"emulator-config-failed"),ne(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=cI(e),{host:o,port:a}=Hj(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),Kj()}function cI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Hj(n){const e=cI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:eE(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:eE(o)}}}function eE(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Kj(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Pr("not implemented")}_getIdTokenResponse(e){return Pr("not implemented")}_linkToIdToken(e,t){return Pr("not implemented")}_getReauthenticationResolver(e){return Pr("not implemented")}}async function Gj(n,e){return ns(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qj(n,e){return fu(n,"POST","/v1/accounts:signInWithPassword",ts(n,e))}async function Jj(n,e){return ns(n,"POST","/v1/accounts:sendOobCode",ts(n,e))}async function Yj(n,e){return Jj(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xj(n,e){return fu(n,"POST","/v1/accounts:signInWithEmailLink",ts(n,e))}async function Zj(n,e){return fu(n,"POST","/v1/accounts:signInWithEmailLink",ts(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc extends Z0{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Mc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Mc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ph(e,t,"signInWithPassword",Qj);case"emailLink":return Xj(e,{email:this._email,oobCode:this._password});default:Kn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ph(e,r,"signUpPassword",Gj);case"emailLink":return Zj(e,{idToken:t,email:this._email,oobCode:this._password});default:Kn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _a(n,e){return fu(n,"POST","/v1/accounts:signInWithIdp",ts(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL="http://localhost";class ao extends Z0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ao(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Kn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=G0(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ao(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return _a(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_a(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_a(e,t)}buildRequest(){const e={requestUri:eL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=du(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tL(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function nL(n){const e=Ll(Fl(n)).link,t=e?Ll(Fl(e)).deep_link_id:null,r=Ll(Fl(n)).deep_link_id;return(r?Ll(Fl(r)).link:null)||r||t||e||n}class ev{constructor(e){var t,r,s,i,o,a;const l=Ll(Fl(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,u=(r=l.oobCode)!==null&&r!==void 0?r:null,h=tL((s=l.mode)!==null&&s!==void 0?s:null);ne(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=nL(e);try{return new ev(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(){this.providerId=Xa.PROVIDER_ID}static credential(e,t){return Mc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ev.parseLink(t);return ne(r,"argument-error"),Mc._fromEmailAndCode(e,r.code,r.tenantId)}}Xa.PROVIDER_ID="password";Xa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu extends uI{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends pu{constructor(){super("facebook.com")}static credential(e){return ao._fromParams({providerId:xs.PROVIDER_ID,signInMethod:xs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xs.credentialFromTaggedObject(e)}static credentialFromError(e){return xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xs.credential(e.oauthAccessToken)}catch{return null}}}xs.FACEBOOK_SIGN_IN_METHOD="facebook.com";xs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends pu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ao._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Es.credential(t,r)}catch{return null}}}Es.GOOGLE_SIGN_IN_METHOD="google.com";Es.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends pu{constructor(){super("github.com")}static credential(e){return ao._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ks.credential(e.oauthAccessToken)}catch{return null}}}ks.GITHUB_SIGN_IN_METHOD="github.com";ks.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends pu{constructor(){super("twitter.com")}static credential(e,t){return ao._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ts.credential(t,r)}catch{return null}}}Ts.TWITTER_SIGN_IN_METHOD="twitter.com";Ts.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rL(n,e){return fu(n,"POST","/v1/accounts:signUp",ts(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Dr._fromIdTokenResponse(e,r,s),o=tE(r);return new lo({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=tE(r);return new lo({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function tE(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends gr{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Dh(e,t,r,s)}}function dI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dh._fromErrorAndOperation(n,i,e,r):i})}async function sL(n,e,t=!1){const r=await Dc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return lo._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iL(n,e,t=!1){const{auth:r}=n;if(nr(r.app))return Promise.reject(Lr(r));const s="reauthenticate";try{const i=await Dc(n,dI(r,s,e,n),t);ne(i.idToken,r,"internal-error");const o=Y0(i.idToken);ne(o,r,"internal-error");const{sub:a}=o;return ne(n.uid===a,r,"user-mismatch"),lo._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Kn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hI(n,e,t=!1){if(nr(n.app))return Promise.reject(Lr(n));const r="signIn",s=await dI(n,r,e),i=await lo._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function oL(n,e){return hI(pi(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fI(n){const e=pi(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function aL(n,e,t){const r=pi(n);await Ph(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Yj)}async function lL(n,e,t){if(nr(n.app))return Promise.reject(Lr(n));const r=pi(n),o=await Ph(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rL).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&fI(n),l}),a=await lo._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function cL(n,e,t){return nr(n.app)?Promise.reject(Lr(n)):oL(it(n),Xa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&fI(n),r})}function uL(n,e,t,r){return it(n).onIdTokenChanged(e,t,r)}function dL(n,e,t){return it(n).beforeAuthStateChanged(e,t)}function hL(n,e,t,r){return it(n).onAuthStateChanged(e,t,r)}function fL(n){return it(n).signOut()}const Mh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Mh,"1"),this.storage.removeItem(Mh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pL=1e3,mL=10;class mI extends pI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);Aj()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,mL):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},pL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}mI.type="LOCAL";const gL=mI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gI extends pI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}gI.type="SESSION";const yI=gI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yL(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Vf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await yL(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Vf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=tv("",20);s.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ur(){return window}function wL(n){ur().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vI(){return typeof ur().WorkerGlobalScope<"u"&&typeof ur().importScripts=="function"}async function _L(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function xL(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function EL(){return vI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wI="firebaseLocalStorageDb",kL=1,Oh="firebaseLocalStorage",_I="fbase_key";class mu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function jf(n,e){return n.transaction([Oh],e?"readwrite":"readonly").objectStore(Oh)}function TL(){const n=indexedDB.deleteDatabase(wI);return new mu(n).toPromise()}function ty(){const n=indexedDB.open(wI,kL);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Oh,{keyPath:_I})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Oh)?e(r):(r.close(),await TL(),e(await ty()))})})}async function nE(n,e,t){const r=jf(n,!0).put({[_I]:e,value:t});return new mu(r).toPromise()}async function bL(n,e){const t=jf(n,!1).get(e),r=await new mu(t).toPromise();return r===void 0?null:r.value}function rE(n,e){const t=jf(n,!0).delete(e);return new mu(t).toPromise()}const SL=800,IL=3;class xI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ty(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>IL)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vf._getInstance(EL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await _L(),!this.activeServiceWorker)return;this.sender=new vL(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||xL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ty();return await nE(e,Mh,"1"),await rE(e,Mh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>nE(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>bL(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=jf(s,!1).getAll();return new mu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),SL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}xI.type="LOCAL";const CL=xI;new hu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NL(n,e){return e?Mr(e):(ne(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv extends Z0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _a(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _a(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _a(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function AL(n){return hI(n.auth,new nv(n),n.bypassAuthState)}function RL(n){const{auth:e,user:t}=n;return ne(t,e,"internal-error"),iL(t,new nv(n),n.bypassAuthState)}async function PL(n){const{auth:e,user:t}=n;return ne(t,e,"internal-error"),sL(t,new nv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return AL;case"linkViaPopup":case"linkViaRedirect":return PL;case"reauthViaPopup":case"reauthViaRedirect":return RL;default:Kn(this.auth,"internal-error")}}resolve(e){Yr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DL=new hu(2e3,1e4);class la extends EI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,la.currentPopupAction&&la.currentPopupAction.cancel(),la.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ne(e,this.auth,"internal-error"),e}async onExecution(){Yr(this.filter.length===1,"Popup operations only handle one event");const e=tv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(cr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(cr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,la.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(cr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,DL.get())};e()}}la.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ML="pendingRedirect",Bd=new Map;class OL extends EI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Bd.get(this.auth._key());if(!e){try{const r=await VL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Bd.set(this.auth._key(),e)}return this.bypassAuthState||Bd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function VL(n,e){const t=FL(e),r=LL(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function jL(n,e){Bd.set(n._key(),e)}function LL(n){return Mr(n._redirectPersistence)}function FL(n){return Fd(ML,n.config.apiKey,n.name)}async function BL(n,e,t=!1){if(nr(n.app))return Promise.reject(Lr(n));const r=pi(n),s=NL(r,e),o=await new OL(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL=10*60*1e3;class $L{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zL(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!kI(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(cr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=UL&&this.cachedEventUids.clear(),this.cachedEventUids.has(sE(e))}saveEventToCache(e){this.cachedEventUids.add(sE(e)),this.lastProcessedEventTime=Date.now()}}function sE(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function kI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function zL(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return kI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WL(n,e={}){return ns(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HL=/^https?/;async function KL(n){if(n.config.emulator)return;const{authorizedDomains:e}=await WL(n);for(const t of e)try{if(GL(t))return}catch{}Kn(n,"unauthorized-domain")}function GL(n){const e=Zg(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!HL.test(t))return!1;if(qL.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QL=new hu(3e4,6e4);function iE(){const n=ur().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function JL(n){return new Promise((e,t)=>{var r,s,i;function o(){iE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{iE(),t(cr(n,"network-request-failed"))},timeout:QL.get()})}if(!((s=(r=ur().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=ur().gapi)===null||i===void 0)&&i.load)o();else{const a=Fj("iframefcb");return ur()[a]=()=>{gapi.load?o():t(cr(n,"network-request-failed"))},lI(`${Lj()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Ud=null,e})}let Ud=null;function YL(n){return Ud=Ud||JL(n),Ud}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XL=new hu(5e3,15e3),ZL="__/auth/iframe",e4="emulator/auth/iframe",t4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},n4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function r4(n){const e=n.config;ne(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?J0(e,e4):`https://${n.config.authDomain}/${ZL}`,r={apiKey:e.apiKey,appName:n.name,v:bo},s=n4.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${du(r).slice(1)}`}async function s4(n){const e=await YL(n),t=ur().gapi;return ne(t,n,"internal-error"),e.open({where:document.body,url:r4(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:t4,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=cr(n,"network-request-failed"),a=ur().setTimeout(()=>{i(o)},XL.get());function l(){ur().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},o4=500,a4=600,l4="_blank",c4="http://localhost";class oE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function u4(n,e,t,r=o4,s=a4){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},i4),{width:r.toString(),height:s.toString(),top:i,left:o}),c=st().toLowerCase();t&&(a=tI(c)?l4:t),ZS(c)&&(e=e||c4,l.scrollbars="yes");const u=Object.entries(l).reduce((f,[m,y])=>`${f}${m}=${y},`,"");if(Nj(c)&&a!=="_self")return d4(e||"",a),new oE(null);const h=window.open(e||"",a,u);ne(h,n,"popup-blocked");try{h.focus()}catch{}return new oE(h)}function d4(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4="__/auth/handler",f4="emulator/auth/handler",p4=encodeURIComponent("fac");async function aE(n,e,t,r,s,i){ne(n.config.authDomain,n,"auth-domain-config-required"),ne(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:bo,eventId:s};if(e instanceof uI){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Z2(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof pu){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await n._getAppCheckToken(),c=l?`#${p4}=${encodeURIComponent(l)}`:"";return`${m4(n)}?${du(a).slice(1)}${c}`}function m4({config:n}){return n.emulator?J0(n,f4):`https://${n.authDomain}/${h4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xm="webStorageSupport";class g4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yI,this._completeRedirectFn=BL,this._overrideRedirectResult=jL}async _openPopup(e,t,r,s){var i;Yr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await aE(e,t,r,Zg(),s);return u4(e,o,tv())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await aE(e,t,r,Zg(),s);return wL(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Yr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await s4(e),r=new $L(e);return t.register("authEvent",s=>(ne(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(xm,{type:xm},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[xm];o!==void 0&&t(!!o),Kn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=KL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oI()||eI()||X0()}}const y4=g4;var lE="@firebase/auth",cE="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w4(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _4(n){oo(new ti("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ne(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:aI(n)},c=new Oj(r,s,i,l);return Wj(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),oo(new ti("auth-internal",e=>{const t=pi(e.getProvider("auth").getImmediate());return(r=>new v4(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),lr(lE,cE,w4(n)),lr(lE,cE,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x4=5*60,E4=OS("authIdTokenMaxAge")||x4;let uE=null;const k4=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>E4)return;const s=t==null?void 0:t.token;uE!==s&&(uE=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function T4(n=K0()){const e=Mf(n,"auth");if(e.isInitialized())return e.getImmediate();const t=zj(n,{popupRedirectResolver:y4,persistence:[CL,gL,yI]}),r=OS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=k4(i.toString());dL(t,o,()=>o(t.currentUser)),uL(t,a=>o(a))}}const s=PS("auth");return s&&qj(t,`http://${s}`),t}function b4(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Vj({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=cr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",b4().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_4("Browser");var S4="firebase",I4="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */lr(S4,I4,"app");var dE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Hi,TI;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,E){function S(){}S.prototype=E.prototype,k.D=E.prototype,k.prototype=new S,k.prototype.constructor=k,k.C=function(C,D,O){for(var A=Array(arguments.length-2),qe=2;qe<arguments.length;qe++)A[qe-2]=arguments[qe];return E.prototype[D].apply(C,A)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,E,S){S||(S=0);var C=Array(16);if(typeof E=="string")for(var D=0;16>D;++D)C[D]=E.charCodeAt(S++)|E.charCodeAt(S++)<<8|E.charCodeAt(S++)<<16|E.charCodeAt(S++)<<24;else for(D=0;16>D;++D)C[D]=E[S++]|E[S++]<<8|E[S++]<<16|E[S++]<<24;E=k.g[0],S=k.g[1],D=k.g[2];var O=k.g[3],A=E+(O^S&(D^O))+C[0]+3614090360&4294967295;E=S+(A<<7&4294967295|A>>>25),A=O+(D^E&(S^D))+C[1]+3905402710&4294967295,O=E+(A<<12&4294967295|A>>>20),A=D+(S^O&(E^S))+C[2]+606105819&4294967295,D=O+(A<<17&4294967295|A>>>15),A=S+(E^D&(O^E))+C[3]+3250441966&4294967295,S=D+(A<<22&4294967295|A>>>10),A=E+(O^S&(D^O))+C[4]+4118548399&4294967295,E=S+(A<<7&4294967295|A>>>25),A=O+(D^E&(S^D))+C[5]+1200080426&4294967295,O=E+(A<<12&4294967295|A>>>20),A=D+(S^O&(E^S))+C[6]+2821735955&4294967295,D=O+(A<<17&4294967295|A>>>15),A=S+(E^D&(O^E))+C[7]+4249261313&4294967295,S=D+(A<<22&4294967295|A>>>10),A=E+(O^S&(D^O))+C[8]+1770035416&4294967295,E=S+(A<<7&4294967295|A>>>25),A=O+(D^E&(S^D))+C[9]+2336552879&4294967295,O=E+(A<<12&4294967295|A>>>20),A=D+(S^O&(E^S))+C[10]+4294925233&4294967295,D=O+(A<<17&4294967295|A>>>15),A=S+(E^D&(O^E))+C[11]+2304563134&4294967295,S=D+(A<<22&4294967295|A>>>10),A=E+(O^S&(D^O))+C[12]+1804603682&4294967295,E=S+(A<<7&4294967295|A>>>25),A=O+(D^E&(S^D))+C[13]+4254626195&4294967295,O=E+(A<<12&4294967295|A>>>20),A=D+(S^O&(E^S))+C[14]+2792965006&4294967295,D=O+(A<<17&4294967295|A>>>15),A=S+(E^D&(O^E))+C[15]+1236535329&4294967295,S=D+(A<<22&4294967295|A>>>10),A=E+(D^O&(S^D))+C[1]+4129170786&4294967295,E=S+(A<<5&4294967295|A>>>27),A=O+(S^D&(E^S))+C[6]+3225465664&4294967295,O=E+(A<<9&4294967295|A>>>23),A=D+(E^S&(O^E))+C[11]+643717713&4294967295,D=O+(A<<14&4294967295|A>>>18),A=S+(O^E&(D^O))+C[0]+3921069994&4294967295,S=D+(A<<20&4294967295|A>>>12),A=E+(D^O&(S^D))+C[5]+3593408605&4294967295,E=S+(A<<5&4294967295|A>>>27),A=O+(S^D&(E^S))+C[10]+38016083&4294967295,O=E+(A<<9&4294967295|A>>>23),A=D+(E^S&(O^E))+C[15]+3634488961&4294967295,D=O+(A<<14&4294967295|A>>>18),A=S+(O^E&(D^O))+C[4]+3889429448&4294967295,S=D+(A<<20&4294967295|A>>>12),A=E+(D^O&(S^D))+C[9]+568446438&4294967295,E=S+(A<<5&4294967295|A>>>27),A=O+(S^D&(E^S))+C[14]+3275163606&4294967295,O=E+(A<<9&4294967295|A>>>23),A=D+(E^S&(O^E))+C[3]+4107603335&4294967295,D=O+(A<<14&4294967295|A>>>18),A=S+(O^E&(D^O))+C[8]+1163531501&4294967295,S=D+(A<<20&4294967295|A>>>12),A=E+(D^O&(S^D))+C[13]+2850285829&4294967295,E=S+(A<<5&4294967295|A>>>27),A=O+(S^D&(E^S))+C[2]+4243563512&4294967295,O=E+(A<<9&4294967295|A>>>23),A=D+(E^S&(O^E))+C[7]+1735328473&4294967295,D=O+(A<<14&4294967295|A>>>18),A=S+(O^E&(D^O))+C[12]+2368359562&4294967295,S=D+(A<<20&4294967295|A>>>12),A=E+(S^D^O)+C[5]+4294588738&4294967295,E=S+(A<<4&4294967295|A>>>28),A=O+(E^S^D)+C[8]+2272392833&4294967295,O=E+(A<<11&4294967295|A>>>21),A=D+(O^E^S)+C[11]+1839030562&4294967295,D=O+(A<<16&4294967295|A>>>16),A=S+(D^O^E)+C[14]+4259657740&4294967295,S=D+(A<<23&4294967295|A>>>9),A=E+(S^D^O)+C[1]+2763975236&4294967295,E=S+(A<<4&4294967295|A>>>28),A=O+(E^S^D)+C[4]+1272893353&4294967295,O=E+(A<<11&4294967295|A>>>21),A=D+(O^E^S)+C[7]+4139469664&4294967295,D=O+(A<<16&4294967295|A>>>16),A=S+(D^O^E)+C[10]+3200236656&4294967295,S=D+(A<<23&4294967295|A>>>9),A=E+(S^D^O)+C[13]+681279174&4294967295,E=S+(A<<4&4294967295|A>>>28),A=O+(E^S^D)+C[0]+3936430074&4294967295,O=E+(A<<11&4294967295|A>>>21),A=D+(O^E^S)+C[3]+3572445317&4294967295,D=O+(A<<16&4294967295|A>>>16),A=S+(D^O^E)+C[6]+76029189&4294967295,S=D+(A<<23&4294967295|A>>>9),A=E+(S^D^O)+C[9]+3654602809&4294967295,E=S+(A<<4&4294967295|A>>>28),A=O+(E^S^D)+C[12]+3873151461&4294967295,O=E+(A<<11&4294967295|A>>>21),A=D+(O^E^S)+C[15]+530742520&4294967295,D=O+(A<<16&4294967295|A>>>16),A=S+(D^O^E)+C[2]+3299628645&4294967295,S=D+(A<<23&4294967295|A>>>9),A=E+(D^(S|~O))+C[0]+4096336452&4294967295,E=S+(A<<6&4294967295|A>>>26),A=O+(S^(E|~D))+C[7]+1126891415&4294967295,O=E+(A<<10&4294967295|A>>>22),A=D+(E^(O|~S))+C[14]+2878612391&4294967295,D=O+(A<<15&4294967295|A>>>17),A=S+(O^(D|~E))+C[5]+4237533241&4294967295,S=D+(A<<21&4294967295|A>>>11),A=E+(D^(S|~O))+C[12]+1700485571&4294967295,E=S+(A<<6&4294967295|A>>>26),A=O+(S^(E|~D))+C[3]+2399980690&4294967295,O=E+(A<<10&4294967295|A>>>22),A=D+(E^(O|~S))+C[10]+4293915773&4294967295,D=O+(A<<15&4294967295|A>>>17),A=S+(O^(D|~E))+C[1]+2240044497&4294967295,S=D+(A<<21&4294967295|A>>>11),A=E+(D^(S|~O))+C[8]+1873313359&4294967295,E=S+(A<<6&4294967295|A>>>26),A=O+(S^(E|~D))+C[15]+4264355552&4294967295,O=E+(A<<10&4294967295|A>>>22),A=D+(E^(O|~S))+C[6]+2734768916&4294967295,D=O+(A<<15&4294967295|A>>>17),A=S+(O^(D|~E))+C[13]+1309151649&4294967295,S=D+(A<<21&4294967295|A>>>11),A=E+(D^(S|~O))+C[4]+4149444226&4294967295,E=S+(A<<6&4294967295|A>>>26),A=O+(S^(E|~D))+C[11]+3174756917&4294967295,O=E+(A<<10&4294967295|A>>>22),A=D+(E^(O|~S))+C[2]+718787259&4294967295,D=O+(A<<15&4294967295|A>>>17),A=S+(O^(D|~E))+C[9]+3951481745&4294967295,k.g[0]=k.g[0]+E&4294967295,k.g[1]=k.g[1]+(D+(A<<21&4294967295|A>>>11))&4294967295,k.g[2]=k.g[2]+D&4294967295,k.g[3]=k.g[3]+O&4294967295}r.prototype.u=function(k,E){E===void 0&&(E=k.length);for(var S=E-this.blockSize,C=this.B,D=this.h,O=0;O<E;){if(D==0)for(;O<=S;)s(this,k,O),O+=this.blockSize;if(typeof k=="string"){for(;O<E;)if(C[D++]=k.charCodeAt(O++),D==this.blockSize){s(this,C),D=0;break}}else for(;O<E;)if(C[D++]=k[O++],D==this.blockSize){s(this,C),D=0;break}}this.h=D,this.o+=E},r.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var E=1;E<k.length-8;++E)k[E]=0;var S=8*this.o;for(E=k.length-8;E<k.length;++E)k[E]=S&255,S/=256;for(this.u(k),k=Array(16),E=S=0;4>E;++E)for(var C=0;32>C;C+=8)k[S++]=this.g[E]>>>C&255;return k};function i(k,E){var S=a;return Object.prototype.hasOwnProperty.call(S,k)?S[k]:S[k]=E(k)}function o(k,E){this.h=E;for(var S=[],C=!0,D=k.length-1;0<=D;D--){var O=k[D]|0;C&&O==E||(S[D]=O,C=!1)}this.g=S}var a={};function l(k){return-128<=k&&128>k?i(k,function(E){return new o([E|0],0>E?-1:0)}):new o([k|0],0>k?-1:0)}function c(k){if(isNaN(k)||!isFinite(k))return h;if(0>k)return _(c(-k));for(var E=[],S=1,C=0;k>=S;C++)E[C]=k/S|0,S*=4294967296;return new o(E,0)}function u(k,E){if(k.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k.charAt(0)=="-")return _(u(k.substring(1),E));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=c(Math.pow(E,8)),C=h,D=0;D<k.length;D+=8){var O=Math.min(8,k.length-D),A=parseInt(k.substring(D,D+O),E);8>O?(O=c(Math.pow(E,O)),C=C.j(O).add(c(A))):(C=C.j(S),C=C.add(c(A)))}return C}var h=l(0),f=l(1),m=l(16777216);n=o.prototype,n.m=function(){if(v(this))return-_(this).m();for(var k=0,E=1,S=0;S<this.g.length;S++){var C=this.i(S);k+=(0<=C?C:4294967296+C)*E,E*=4294967296}return k},n.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if(y(this))return"0";if(v(this))return"-"+_(this).toString(k);for(var E=c(Math.pow(k,6)),S=this,C="";;){var D=N(S,E).g;S=x(S,D.j(E));var O=((0<S.g.length?S.g[0]:S.h)>>>0).toString(k);if(S=D,y(S))return O+C;for(;6>O.length;)O="0"+O;C=O+C}},n.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function y(k){if(k.h!=0)return!1;for(var E=0;E<k.g.length;E++)if(k.g[E]!=0)return!1;return!0}function v(k){return k.h==-1}n.l=function(k){return k=x(this,k),v(k)?-1:y(k)?0:1};function _(k){for(var E=k.g.length,S=[],C=0;C<E;C++)S[C]=~k.g[C];return new o(S,~k.h).add(f)}n.abs=function(){return v(this)?_(this):this},n.add=function(k){for(var E=Math.max(this.g.length,k.g.length),S=[],C=0,D=0;D<=E;D++){var O=C+(this.i(D)&65535)+(k.i(D)&65535),A=(O>>>16)+(this.i(D)>>>16)+(k.i(D)>>>16);C=A>>>16,O&=65535,A&=65535,S[D]=A<<16|O}return new o(S,S[S.length-1]&-2147483648?-1:0)};function x(k,E){return k.add(_(E))}n.j=function(k){if(y(this)||y(k))return h;if(v(this))return v(k)?_(this).j(_(k)):_(_(this).j(k));if(v(k))return _(this.j(_(k)));if(0>this.l(m)&&0>k.l(m))return c(this.m()*k.m());for(var E=this.g.length+k.g.length,S=[],C=0;C<2*E;C++)S[C]=0;for(C=0;C<this.g.length;C++)for(var D=0;D<k.g.length;D++){var O=this.i(C)>>>16,A=this.i(C)&65535,qe=k.i(D)>>>16,vr=k.i(D)&65535;S[2*C+2*D]+=A*vr,T(S,2*C+2*D),S[2*C+2*D+1]+=O*vr,T(S,2*C+2*D+1),S[2*C+2*D+1]+=A*qe,T(S,2*C+2*D+1),S[2*C+2*D+2]+=O*qe,T(S,2*C+2*D+2)}for(C=0;C<E;C++)S[C]=S[2*C+1]<<16|S[2*C];for(C=E;C<2*E;C++)S[C]=0;return new o(S,0)};function T(k,E){for(;(k[E]&65535)!=k[E];)k[E+1]+=k[E]>>>16,k[E]&=65535,E++}function b(k,E){this.g=k,this.h=E}function N(k,E){if(y(E))throw Error("division by zero");if(y(k))return new b(h,h);if(v(k))return E=N(_(k),E),new b(_(E.g),_(E.h));if(v(E))return E=N(k,_(E)),new b(_(E.g),E.h);if(30<k.g.length){if(v(k)||v(E))throw Error("slowDivide_ only works with positive integers.");for(var S=f,C=E;0>=C.l(k);)S=R(S),C=R(C);var D=P(S,1),O=P(C,1);for(C=P(C,2),S=P(S,2);!y(C);){var A=O.add(C);0>=A.l(k)&&(D=D.add(S),O=A),C=P(C,1),S=P(S,1)}return E=x(k,D.j(E)),new b(D,E)}for(D=h;0<=k.l(E);){for(S=Math.max(1,Math.floor(k.m()/E.m())),C=Math.ceil(Math.log(S)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),O=c(S),A=O.j(E);v(A)||0<A.l(k);)S-=C,O=c(S),A=O.j(E);y(O)&&(O=f),D=D.add(O),k=x(k,A)}return new b(D,k)}n.A=function(k){return N(this,k).h},n.and=function(k){for(var E=Math.max(this.g.length,k.g.length),S=[],C=0;C<E;C++)S[C]=this.i(C)&k.i(C);return new o(S,this.h&k.h)},n.or=function(k){for(var E=Math.max(this.g.length,k.g.length),S=[],C=0;C<E;C++)S[C]=this.i(C)|k.i(C);return new o(S,this.h|k.h)},n.xor=function(k){for(var E=Math.max(this.g.length,k.g.length),S=[],C=0;C<E;C++)S[C]=this.i(C)^k.i(C);return new o(S,this.h^k.h)};function R(k){for(var E=k.g.length+1,S=[],C=0;C<E;C++)S[C]=k.i(C)<<1|k.i(C-1)>>>31;return new o(S,k.h)}function P(k,E){var S=E>>5;E%=32;for(var C=k.g.length-S,D=[],O=0;O<C;O++)D[O]=0<E?k.i(O+S)>>>E|k.i(O+S+1)<<32-E:k.i(O+S);return new o(D,k.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,TI=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Hi=o}).apply(typeof dE<"u"?dE:typeof self<"u"?self:typeof window<"u"?window:{});var ud=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bI,Bl,SI,$d,ny,II,CI,NI;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,g,w){return d==Array.prototype||d==Object.prototype||(d[g]=w.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof ud=="object"&&ud];for(var g=0;g<d.length;++g){var w=d[g];if(w&&w.Math==Math)return w}throw Error("Cannot find global object")}var r=t(this);function s(d,g){if(g)e:{var w=r;d=d.split(".");for(var I=0;I<d.length-1;I++){var V=d[I];if(!(V in w))break e;w=w[V]}d=d[d.length-1],I=w[d],g=g(I),g!=I&&g!=null&&e(w,d,{configurable:!0,writable:!0,value:g})}}function i(d,g){d instanceof String&&(d+="");var w=0,I=!1,V={next:function(){if(!I&&w<d.length){var L=w++;return{value:g(L,d[L]),done:!1}}return I=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}s("Array.prototype.values",function(d){return d||function(){return i(this,function(g,w){return w})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(d){var g=typeof d;return g=g!="object"?g:d?Array.isArray(d)?"array":g:"null",g=="array"||g=="object"&&typeof d.length=="number"}function c(d){var g=typeof d;return g=="object"&&d!=null||g=="function"}function u(d,g,w){return d.call.apply(d.bind,arguments)}function h(d,g,w){if(!d)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var V=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(V,I),d.apply(g,V)}}return function(){return d.apply(g,arguments)}}function f(d,g,w){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:h,f.apply(null,arguments)}function m(d,g){var w=Array.prototype.slice.call(arguments,1);return function(){var I=w.slice();return I.push.apply(I,arguments),d.apply(this,I)}}function y(d,g){function w(){}w.prototype=g.prototype,d.aa=g.prototype,d.prototype=new w,d.prototype.constructor=d,d.Qb=function(I,V,L){for(var W=Array(arguments.length-2),be=2;be<arguments.length;be++)W[be-2]=arguments[be];return g.prototype[V].apply(I,W)}}function v(d){const g=d.length;if(0<g){const w=Array(g);for(let I=0;I<g;I++)w[I]=d[I];return w}return[]}function _(d,g){for(let w=1;w<arguments.length;w++){const I=arguments[w];if(l(I)){const V=d.length||0,L=I.length||0;d.length=V+L;for(let W=0;W<L;W++)d[V+W]=I[W]}else d.push(I)}}class x{constructor(g,w){this.i=g,this.j=w,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function T(d){return/^[\s\xa0]*$/.test(d)}function b(){var d=a.navigator;return d&&(d=d.userAgent)?d:""}function N(d){return N[" "](d),d}N[" "]=function(){};var R=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function P(d,g,w){for(const I in d)g.call(w,d[I],I,d)}function k(d,g){for(const w in d)g.call(void 0,d[w],w,d)}function E(d){const g={};for(const w in d)g[w]=d[w];return g}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(d,g){let w,I;for(let V=1;V<arguments.length;V++){I=arguments[V];for(w in I)d[w]=I[w];for(let L=0;L<S.length;L++)w=S[L],Object.prototype.hasOwnProperty.call(I,w)&&(d[w]=I[w])}}function D(d){var g=1;d=d.split(":");const w=[];for(;0<g&&d.length;)w.push(d.shift()),g--;return d.length&&w.push(d.join(":")),w}function O(d){a.setTimeout(()=>{throw d},0)}function A(){var d=G;let g=null;return d.g&&(g=d.g,d.g=d.g.next,d.g||(d.h=null),g.next=null),g}class qe{constructor(){this.h=this.g=null}add(g,w){const I=vr.get();I.set(g,w),this.h?this.h.next=I:this.g=I,this.h=I}}var vr=new x(()=>new X,d=>d.reset());class X{constructor(){this.next=this.g=this.h=null}set(g,w){this.h=g,this.g=w,this.next=null}reset(){this.next=this.g=this.h=null}}let re,B=!1,G=new qe,oe=()=>{const d=a.Promise.resolve(void 0);re=()=>{d.then(Ie)}};var Ie=()=>{for(var d;d=A();){try{d.h.call(d.g)}catch(w){O(w)}var g=vr;g.j(d),100>g.h&&(g.h++,d.next=g.g,g.g=d)}B=!1};function we(){this.s=this.s,this.C=this.C}we.prototype.s=!1,we.prototype.ma=function(){this.s||(this.s=!0,this.N())},we.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function He(d,g){this.type=d,this.g=this.target=g,this.defaultPrevented=!1}He.prototype.h=function(){this.defaultPrevented=!0};var wr=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var d=!1,g=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const w=()=>{};a.addEventListener("test",w,g),a.removeEventListener("test",w,g)}catch{}return d}();function _r(d,g){if(He.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var w=this.type=d.type,I=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=g,g=d.relatedTarget){if(R){e:{try{N(g.nodeName);var V=!0;break e}catch{}V=!1}V||(g=null)}}else w=="mouseover"?g=d.fromElement:w=="mouseout"&&(g=d.toElement);this.relatedTarget=g,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:xr[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&_r.aa.h.call(this)}}y(_r,He);var xr={2:"touch",3:"pen",4:"mouse"};_r.prototype.h=function(){_r.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var Er="closure_listenable_"+(1e6*Math.random()|0),FR=0;function BR(d,g,w,I,V){this.listener=d,this.proxy=null,this.src=g,this.type=w,this.capture=!!I,this.ha=V,this.key=++FR,this.da=this.fa=!1}function Iu(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Cu(d){this.src=d,this.g={},this.h=0}Cu.prototype.add=function(d,g,w,I,V){var L=d.toString();d=this.g[L],d||(d=this.g[L]=[],this.h++);var W=_p(d,g,I,V);return-1<W?(g=d[W],w||(g.fa=!1)):(g=new BR(g,this.src,L,!!I,V),g.fa=w,d.push(g)),g};function wp(d,g){var w=g.type;if(w in d.g){var I=d.g[w],V=Array.prototype.indexOf.call(I,g,void 0),L;(L=0<=V)&&Array.prototype.splice.call(I,V,1),L&&(Iu(g),d.g[w].length==0&&(delete d.g[w],d.h--))}}function _p(d,g,w,I){for(var V=0;V<d.length;++V){var L=d[V];if(!L.da&&L.listener==g&&L.capture==!!w&&L.ha==I)return V}return-1}var xp="closure_lm_"+(1e6*Math.random()|0),Ep={};function ww(d,g,w,I,V){if(Array.isArray(g)){for(var L=0;L<g.length;L++)ww(d,g[L],w,I,V);return null}return w=Ew(w),d&&d[Er]?d.K(g,w,c(I)?!!I.capture:!1,V):UR(d,g,w,!1,I,V)}function UR(d,g,w,I,V,L){if(!g)throw Error("Invalid event type");var W=c(V)?!!V.capture:!!V,be=Tp(d);if(be||(d[xp]=be=new Cu(d)),w=be.add(g,w,I,W,L),w.proxy)return w;if(I=$R(),w.proxy=I,I.src=d,I.listener=w,d.addEventListener)wr||(V=W),V===void 0&&(V=!1),d.addEventListener(g.toString(),I,V);else if(d.attachEvent)d.attachEvent(xw(g.toString()),I);else if(d.addListener&&d.removeListener)d.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return w}function $R(){function d(w){return g.call(d.src,d.listener,w)}const g=zR;return d}function _w(d,g,w,I,V){if(Array.isArray(g))for(var L=0;L<g.length;L++)_w(d,g[L],w,I,V);else I=c(I)?!!I.capture:!!I,w=Ew(w),d&&d[Er]?(d=d.i,g=String(g).toString(),g in d.g&&(L=d.g[g],w=_p(L,w,I,V),-1<w&&(Iu(L[w]),Array.prototype.splice.call(L,w,1),L.length==0&&(delete d.g[g],d.h--)))):d&&(d=Tp(d))&&(g=d.g[g.toString()],d=-1,g&&(d=_p(g,w,I,V)),(w=-1<d?g[d]:null)&&kp(w))}function kp(d){if(typeof d!="number"&&d&&!d.da){var g=d.src;if(g&&g[Er])wp(g.i,d);else{var w=d.type,I=d.proxy;g.removeEventListener?g.removeEventListener(w,I,d.capture):g.detachEvent?g.detachEvent(xw(w),I):g.addListener&&g.removeListener&&g.removeListener(I),(w=Tp(g))?(wp(w,d),w.h==0&&(w.src=null,g[xp]=null)):Iu(d)}}}function xw(d){return d in Ep?Ep[d]:Ep[d]="on"+d}function zR(d,g){if(d.da)d=!0;else{g=new _r(g,this);var w=d.listener,I=d.ha||d.src;d.fa&&kp(d),d=w.call(I,g)}return d}function Tp(d){return d=d[xp],d instanceof Cu?d:null}var bp="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ew(d){return typeof d=="function"?d:(d[bp]||(d[bp]=function(g){return d.handleEvent(g)}),d[bp])}function Tt(){we.call(this),this.i=new Cu(this),this.M=this,this.F=null}y(Tt,we),Tt.prototype[Er]=!0,Tt.prototype.removeEventListener=function(d,g,w,I){_w(this,d,g,w,I)};function Lt(d,g){var w,I=d.F;if(I)for(w=[];I;I=I.F)w.push(I);if(d=d.M,I=g.type||g,typeof g=="string")g=new He(g,d);else if(g instanceof He)g.target=g.target||d;else{var V=g;g=new He(I,d),C(g,V)}if(V=!0,w)for(var L=w.length-1;0<=L;L--){var W=g.g=w[L];V=Nu(W,I,!0,g)&&V}if(W=g.g=d,V=Nu(W,I,!0,g)&&V,V=Nu(W,I,!1,g)&&V,w)for(L=0;L<w.length;L++)W=g.g=w[L],V=Nu(W,I,!1,g)&&V}Tt.prototype.N=function(){if(Tt.aa.N.call(this),this.i){var d=this.i,g;for(g in d.g){for(var w=d.g[g],I=0;I<w.length;I++)Iu(w[I]);delete d.g[g],d.h--}}this.F=null},Tt.prototype.K=function(d,g,w,I){return this.i.add(String(d),g,!1,w,I)},Tt.prototype.L=function(d,g,w,I){return this.i.add(String(d),g,!0,w,I)};function Nu(d,g,w,I){if(g=d.i.g[String(g)],!g)return!0;g=g.concat();for(var V=!0,L=0;L<g.length;++L){var W=g[L];if(W&&!W.da&&W.capture==w){var be=W.listener,pt=W.ha||W.src;W.fa&&wp(d.i,W),V=be.call(pt,I)!==!1&&V}}return V&&!I.defaultPrevented}function kw(d,g,w){if(typeof d=="function")w&&(d=f(d,w));else if(d&&typeof d.handleEvent=="function")d=f(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:a.setTimeout(d,g||0)}function Tw(d){d.g=kw(()=>{d.g=null,d.i&&(d.i=!1,Tw(d))},d.l);const g=d.h;d.h=null,d.m.apply(null,g)}class WR extends we{constructor(g,w){super(),this.m=g,this.l=w,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:Tw(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function sl(d){we.call(this),this.h=d,this.g={}}y(sl,we);var bw=[];function Sw(d){P(d.g,function(g,w){this.g.hasOwnProperty(w)&&kp(g)},d),d.g={}}sl.prototype.N=function(){sl.aa.N.call(this),Sw(this)},sl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Sp=a.JSON.stringify,qR=a.JSON.parse,HR=class{stringify(d){return a.JSON.stringify(d,void 0)}parse(d){return a.JSON.parse(d,void 0)}};function Ip(){}Ip.prototype.h=null;function Iw(d){return d.h||(d.h=d.i())}function Cw(){}var il={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Cp(){He.call(this,"d")}y(Cp,He);function Np(){He.call(this,"c")}y(Np,He);var xi={},Nw=null;function Au(){return Nw=Nw||new Tt}xi.La="serverreachability";function Aw(d){He.call(this,xi.La,d)}y(Aw,He);function ol(d){const g=Au();Lt(g,new Aw(g))}xi.STAT_EVENT="statevent";function Rw(d,g){He.call(this,xi.STAT_EVENT,d),this.stat=g}y(Rw,He);function Ft(d){const g=Au();Lt(g,new Rw(g,d))}xi.Ma="timingevent";function Pw(d,g){He.call(this,xi.Ma,d),this.size=g}y(Pw,He);function al(d,g){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){d()},g)}function ll(){this.g=!0}ll.prototype.xa=function(){this.g=!1};function KR(d,g,w,I,V,L){d.info(function(){if(d.g)if(L)for(var W="",be=L.split("&"),pt=0;pt<be.length;pt++){var ve=be[pt].split("=");if(1<ve.length){var bt=ve[0];ve=ve[1];var St=bt.split("_");W=2<=St.length&&St[1]=="type"?W+(bt+"="+ve+"&"):W+(bt+"=redacted&")}}else W=null;else W=L;return"XMLHTTP REQ ("+I+") [attempt "+V+"]: "+g+`
`+w+`
`+W})}function GR(d,g,w,I,V,L,W){d.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+V+"]: "+g+`
`+w+`
`+L+" "+W})}function Ro(d,g,w,I){d.info(function(){return"XMLHTTP TEXT ("+g+"): "+JR(d,w)+(I?" "+I:"")})}function QR(d,g){d.info(function(){return"TIMEOUT: "+g})}ll.prototype.info=function(){};function JR(d,g){if(!d.g)return g;if(!g)return null;try{var w=JSON.parse(g);if(w){for(d=0;d<w.length;d++)if(Array.isArray(w[d])){var I=w[d];if(!(2>I.length)){var V=I[1];if(Array.isArray(V)&&!(1>V.length)){var L=V[0];if(L!="noop"&&L!="stop"&&L!="close")for(var W=1;W<V.length;W++)V[W]=""}}}}return Sp(w)}catch{return g}}var Ru={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Dw={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ap;function Pu(){}y(Pu,Ip),Pu.prototype.g=function(){return new XMLHttpRequest},Pu.prototype.i=function(){return{}},Ap=new Pu;function ss(d,g,w,I){this.j=d,this.i=g,this.l=w,this.R=I||1,this.U=new sl(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Mw}function Mw(){this.i=null,this.g="",this.h=!1}var Ow={},Rp={};function Pp(d,g,w){d.L=1,d.v=Vu(kr(g)),d.m=w,d.P=!0,Vw(d,null)}function Vw(d,g){d.F=Date.now(),Du(d),d.A=kr(d.v);var w=d.A,I=d.R;Array.isArray(I)||(I=[String(I)]),Jw(w.i,"t",I),d.C=0,w=d.j.J,d.h=new Mw,d.g=p_(d.j,w?g:null,!d.m),0<d.O&&(d.M=new WR(f(d.Y,d,d.g),d.O)),g=d.U,w=d.g,I=d.ca;var V="readystatechange";Array.isArray(V)||(V&&(bw[0]=V.toString()),V=bw);for(var L=0;L<V.length;L++){var W=ww(w,V[L],I||g.handleEvent,!1,g.h||g);if(!W)break;g.g[W.key]=W}g=d.H?E(d.H):{},d.m?(d.u||(d.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,g)):(d.u="GET",d.g.ea(d.A,d.u,null,g)),ol(),KR(d.i,d.u,d.A,d.l,d.R,d.m)}ss.prototype.ca=function(d){d=d.target;const g=this.M;g&&Tr(d)==3?g.j():this.Y(d)},ss.prototype.Y=function(d){try{if(d==this.g)e:{const St=Tr(this.g);var g=this.g.Ba();const Mo=this.g.Z();if(!(3>St)&&(St!=3||this.g&&(this.h.h||this.g.oa()||r_(this.g)))){this.J||St!=4||g==7||(g==8||0>=Mo?ol(3):ol(2)),Dp(this);var w=this.g.Z();this.X=w;t:if(jw(this)){var I=r_(this.g);d="";var V=I.length,L=Tr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ei(this),cl(this);var W="";break t}this.h.i=new a.TextDecoder}for(g=0;g<V;g++)this.h.h=!0,d+=this.h.i.decode(I[g],{stream:!(L&&g==V-1)});I.length=0,this.h.g+=d,this.C=0,W=this.h.g}else W=this.g.oa();if(this.o=w==200,GR(this.i,this.u,this.A,this.l,this.R,St,w),this.o){if(this.T&&!this.K){t:{if(this.g){var be,pt=this.g;if((be=pt.g?pt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(be)){var ve=be;break t}}ve=null}if(w=ve)Ro(this.i,this.l,w,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Mp(this,w);else{this.o=!1,this.s=3,Ft(12),Ei(this),cl(this);break e}}if(this.P){w=!0;let jn;for(;!this.J&&this.C<W.length;)if(jn=YR(this,W),jn==Rp){St==4&&(this.s=4,Ft(14),w=!1),Ro(this.i,this.l,null,"[Incomplete Response]");break}else if(jn==Ow){this.s=4,Ft(15),Ro(this.i,this.l,W,"[Invalid Chunk]"),w=!1;break}else Ro(this.i,this.l,jn,null),Mp(this,jn);if(jw(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),St!=4||W.length!=0||this.h.h||(this.s=1,Ft(16),w=!1),this.o=this.o&&w,!w)Ro(this.i,this.l,W,"[Invalid Chunked Response]"),Ei(this),cl(this);else if(0<W.length&&!this.W){this.W=!0;var bt=this.j;bt.g==this&&bt.ba&&!bt.M&&(bt.j.info("Great, no buffering proxy detected. Bytes received: "+W.length),Bp(bt),bt.M=!0,Ft(11))}}else Ro(this.i,this.l,W,null),Mp(this,W);St==4&&Ei(this),this.o&&!this.J&&(St==4?u_(this.j,this):(this.o=!1,Du(this)))}else pP(this.g),w==400&&0<W.indexOf("Unknown SID")?(this.s=3,Ft(12)):(this.s=0,Ft(13)),Ei(this),cl(this)}}}catch{}finally{}};function jw(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function YR(d,g){var w=d.C,I=g.indexOf(`
`,w);return I==-1?Rp:(w=Number(g.substring(w,I)),isNaN(w)?Ow:(I+=1,I+w>g.length?Rp:(g=g.slice(I,I+w),d.C=I+w,g)))}ss.prototype.cancel=function(){this.J=!0,Ei(this)};function Du(d){d.S=Date.now()+d.I,Lw(d,d.I)}function Lw(d,g){if(d.B!=null)throw Error("WatchDog timer not null");d.B=al(f(d.ba,d),g)}function Dp(d){d.B&&(a.clearTimeout(d.B),d.B=null)}ss.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(QR(this.i,this.A),this.L!=2&&(ol(),Ft(17)),Ei(this),this.s=2,cl(this)):Lw(this,this.S-d)};function cl(d){d.j.G==0||d.J||u_(d.j,d)}function Ei(d){Dp(d);var g=d.M;g&&typeof g.ma=="function"&&g.ma(),d.M=null,Sw(d.U),d.g&&(g=d.g,d.g=null,g.abort(),g.ma())}function Mp(d,g){try{var w=d.j;if(w.G!=0&&(w.g==d||Op(w.h,d))){if(!d.K&&Op(w.h,d)&&w.G==3){try{var I=w.Da.g.parse(g)}catch{I=null}if(Array.isArray(I)&&I.length==3){var V=I;if(V[0]==0){e:if(!w.u){if(w.g)if(w.g.F+3e3<d.F)$u(w),Bu(w);else break e;Fp(w),Ft(18)}}else w.za=V[1],0<w.za-w.T&&37500>V[2]&&w.F&&w.v==0&&!w.C&&(w.C=al(f(w.Za,w),6e3));if(1>=Uw(w.h)&&w.ca){try{w.ca()}catch{}w.ca=void 0}}else Ti(w,11)}else if((d.K||w.g==d)&&$u(w),!T(g))for(V=w.Da.g.parse(g),g=0;g<V.length;g++){let ve=V[g];if(w.T=ve[0],ve=ve[1],w.G==2)if(ve[0]=="c"){w.K=ve[1],w.ia=ve[2];const bt=ve[3];bt!=null&&(w.la=bt,w.j.info("VER="+w.la));const St=ve[4];St!=null&&(w.Aa=St,w.j.info("SVER="+w.Aa));const Mo=ve[5];Mo!=null&&typeof Mo=="number"&&0<Mo&&(I=1.5*Mo,w.L=I,w.j.info("backChannelRequestTimeoutMs_="+I)),I=w;const jn=d.g;if(jn){const Wu=jn.g?jn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wu){var L=I.h;L.g||Wu.indexOf("spdy")==-1&&Wu.indexOf("quic")==-1&&Wu.indexOf("h2")==-1||(L.j=L.l,L.g=new Set,L.h&&(Vp(L,L.h),L.h=null))}if(I.D){const Up=jn.g?jn.g.getResponseHeader("X-HTTP-Session-Id"):null;Up&&(I.ya=Up,Ne(I.I,I.D,Up))}}w.G=3,w.l&&w.l.ua(),w.ba&&(w.R=Date.now()-d.F,w.j.info("Handshake RTT: "+w.R+"ms")),I=w;var W=d;if(I.qa=f_(I,I.J?I.ia:null,I.W),W.K){$w(I.h,W);var be=W,pt=I.L;pt&&(be.I=pt),be.B&&(Dp(be),Du(be)),I.g=W}else l_(I);0<w.i.length&&Uu(w)}else ve[0]!="stop"&&ve[0]!="close"||Ti(w,7);else w.G==3&&(ve[0]=="stop"||ve[0]=="close"?ve[0]=="stop"?Ti(w,7):Lp(w):ve[0]!="noop"&&w.l&&w.l.ta(ve),w.v=0)}}ol(4)}catch{}}var XR=class{constructor(d,g){this.g=d,this.map=g}};function Fw(d){this.l=d||10,a.PerformanceNavigationTiming?(d=a.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Bw(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function Uw(d){return d.h?1:d.g?d.g.size:0}function Op(d,g){return d.h?d.h==g:d.g?d.g.has(g):!1}function Vp(d,g){d.g?d.g.add(g):d.h=g}function $w(d,g){d.h&&d.h==g?d.h=null:d.g&&d.g.has(g)&&d.g.delete(g)}Fw.prototype.cancel=function(){if(this.i=zw(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function zw(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let g=d.i;for(const w of d.g.values())g=g.concat(w.D);return g}return v(d.i)}function ZR(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(l(d)){for(var g=[],w=d.length,I=0;I<w;I++)g.push(d[I]);return g}g=[],w=0;for(I in d)g[w++]=d[I];return g}function eP(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(l(d)||typeof d=="string"){var g=[];d=d.length;for(var w=0;w<d;w++)g.push(w);return g}g=[],w=0;for(const I in d)g[w++]=I;return g}}}function Ww(d,g){if(d.forEach&&typeof d.forEach=="function")d.forEach(g,void 0);else if(l(d)||typeof d=="string")Array.prototype.forEach.call(d,g,void 0);else for(var w=eP(d),I=ZR(d),V=I.length,L=0;L<V;L++)g.call(void 0,I[L],w&&w[L],d)}var qw=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tP(d,g){if(d){d=d.split("&");for(var w=0;w<d.length;w++){var I=d[w].indexOf("="),V=null;if(0<=I){var L=d[w].substring(0,I);V=d[w].substring(I+1)}else L=d[w];g(L,V?decodeURIComponent(V.replace(/\+/g," ")):"")}}}function ki(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof ki){this.h=d.h,Mu(this,d.j),this.o=d.o,this.g=d.g,Ou(this,d.s),this.l=d.l;var g=d.i,w=new hl;w.i=g.i,g.g&&(w.g=new Map(g.g),w.h=g.h),Hw(this,w),this.m=d.m}else d&&(g=String(d).match(qw))?(this.h=!1,Mu(this,g[1]||"",!0),this.o=ul(g[2]||""),this.g=ul(g[3]||"",!0),Ou(this,g[4]),this.l=ul(g[5]||"",!0),Hw(this,g[6]||"",!0),this.m=ul(g[7]||"")):(this.h=!1,this.i=new hl(null,this.h))}ki.prototype.toString=function(){var d=[],g=this.j;g&&d.push(dl(g,Kw,!0),":");var w=this.g;return(w||g=="file")&&(d.push("//"),(g=this.o)&&d.push(dl(g,Kw,!0),"@"),d.push(encodeURIComponent(String(w)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),w=this.s,w!=null&&d.push(":",String(w))),(w=this.l)&&(this.g&&w.charAt(0)!="/"&&d.push("/"),d.push(dl(w,w.charAt(0)=="/"?sP:rP,!0))),(w=this.i.toString())&&d.push("?",w),(w=this.m)&&d.push("#",dl(w,oP)),d.join("")};function kr(d){return new ki(d)}function Mu(d,g,w){d.j=w?ul(g,!0):g,d.j&&(d.j=d.j.replace(/:$/,""))}function Ou(d,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);d.s=g}else d.s=null}function Hw(d,g,w){g instanceof hl?(d.i=g,aP(d.i,d.h)):(w||(g=dl(g,iP)),d.i=new hl(g,d.h))}function Ne(d,g,w){d.i.set(g,w)}function Vu(d){return Ne(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function ul(d,g){return d?g?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function dl(d,g,w){return typeof d=="string"?(d=encodeURI(d).replace(g,nP),w&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function nP(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var Kw=/[#\/\?@]/g,rP=/[#\?:]/g,sP=/[#\?]/g,iP=/[#\?@]/g,oP=/#/g;function hl(d,g){this.h=this.g=null,this.i=d||null,this.j=!!g}function is(d){d.g||(d.g=new Map,d.h=0,d.i&&tP(d.i,function(g,w){d.add(decodeURIComponent(g.replace(/\+/g," ")),w)}))}n=hl.prototype,n.add=function(d,g){is(this),this.i=null,d=Po(this,d);var w=this.g.get(d);return w||this.g.set(d,w=[]),w.push(g),this.h+=1,this};function Gw(d,g){is(d),g=Po(d,g),d.g.has(g)&&(d.i=null,d.h-=d.g.get(g).length,d.g.delete(g))}function Qw(d,g){return is(d),g=Po(d,g),d.g.has(g)}n.forEach=function(d,g){is(this),this.g.forEach(function(w,I){w.forEach(function(V){d.call(g,V,I,this)},this)},this)},n.na=function(){is(this);const d=Array.from(this.g.values()),g=Array.from(this.g.keys()),w=[];for(let I=0;I<g.length;I++){const V=d[I];for(let L=0;L<V.length;L++)w.push(g[I])}return w},n.V=function(d){is(this);let g=[];if(typeof d=="string")Qw(this,d)&&(g=g.concat(this.g.get(Po(this,d))));else{d=Array.from(this.g.values());for(let w=0;w<d.length;w++)g=g.concat(d[w])}return g},n.set=function(d,g){return is(this),this.i=null,d=Po(this,d),Qw(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[g]),this.h+=1,this},n.get=function(d,g){return d?(d=this.V(d),0<d.length?String(d[0]):g):g};function Jw(d,g,w){Gw(d,g),0<w.length&&(d.i=null,d.g.set(Po(d,g),v(w)),d.h+=w.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],g=Array.from(this.g.keys());for(var w=0;w<g.length;w++){var I=g[w];const L=encodeURIComponent(String(I)),W=this.V(I);for(I=0;I<W.length;I++){var V=L;W[I]!==""&&(V+="="+encodeURIComponent(String(W[I]))),d.push(V)}}return this.i=d.join("&")};function Po(d,g){return g=String(g),d.j&&(g=g.toLowerCase()),g}function aP(d,g){g&&!d.j&&(is(d),d.i=null,d.g.forEach(function(w,I){var V=I.toLowerCase();I!=V&&(Gw(this,I),Jw(this,V,w))},d)),d.j=g}function lP(d,g){const w=new ll;if(a.Image){const I=new Image;I.onload=m(as,w,"TestLoadImage: loaded",!0,g,I),I.onerror=m(as,w,"TestLoadImage: error",!1,g,I),I.onabort=m(as,w,"TestLoadImage: abort",!1,g,I),I.ontimeout=m(as,w,"TestLoadImage: timeout",!1,g,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=d}else g(!1)}function cP(d,g){const w=new ll,I=new AbortController,V=setTimeout(()=>{I.abort(),as(w,"TestPingServer: timeout",!1,g)},1e4);fetch(d,{signal:I.signal}).then(L=>{clearTimeout(V),L.ok?as(w,"TestPingServer: ok",!0,g):as(w,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(V),as(w,"TestPingServer: error",!1,g)})}function as(d,g,w,I,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),I(w)}catch{}}function uP(){this.g=new HR}function dP(d,g,w){const I=w||"";try{Ww(d,function(V,L){let W=V;c(V)&&(W=Sp(V)),g.push(I+L+"="+encodeURIComponent(W))})}catch(V){throw g.push(I+"type="+encodeURIComponent("_badmap")),V}}function ju(d){this.l=d.Ub||null,this.j=d.eb||!1}y(ju,Ip),ju.prototype.g=function(){return new Lu(this.l,this.j)},ju.prototype.i=function(d){return function(){return d}}({});function Lu(d,g){Tt.call(this),this.D=d,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(Lu,Tt),n=Lu.prototype,n.open=function(d,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=g,this.readyState=1,pl(this)},n.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(g.body=d),(this.D||a).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fl(this)),this.readyState=0},n.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,pl(this)),this.g&&(this.readyState=3,pl(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Yw(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function Yw(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}n.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var g=d.value?d.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!d.done}))&&(this.response=this.responseText+=g)}d.done?fl(this):pl(this),this.readyState==3&&Yw(this)}},n.Ra=function(d){this.g&&(this.response=this.responseText=d,fl(this))},n.Qa=function(d){this.g&&(this.response=d,fl(this))},n.ga=function(){this.g&&fl(this)};function fl(d){d.readyState=4,d.l=null,d.j=null,d.v=null,pl(d)}n.setRequestHeader=function(d,g){this.u.append(d,g)},n.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],g=this.h.entries();for(var w=g.next();!w.done;)w=w.value,d.push(w[0]+": "+w[1]),w=g.next();return d.join(`\r
`)};function pl(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Lu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function Xw(d){let g="";return P(d,function(w,I){g+=I,g+=":",g+=w,g+=`\r
`}),g}function jp(d,g,w){e:{for(I in w){var I=!1;break e}I=!0}I||(w=Xw(w),typeof d=="string"?w!=null&&encodeURIComponent(String(w)):Ne(d,g,w))}function Be(d){Tt.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(Be,Tt);var hP=/^https?$/i,fP=["POST","PUT"];n=Be.prototype,n.Ha=function(d){this.J=d},n.ea=function(d,g,w,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);g=g?g.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ap.g(),this.v=this.o?Iw(this.o):Iw(Ap),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(g,String(d),!0),this.B=!1}catch(L){Zw(this,L);return}if(d=w||"",w=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var V in I)w.set(V,I[V]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const L of I.keys())w.set(L,I.get(L));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(w.keys()).find(L=>L.toLowerCase()=="content-type"),V=a.FormData&&d instanceof a.FormData,!(0<=Array.prototype.indexOf.call(fP,g,void 0))||I||V||w.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[L,W]of w)this.g.setRequestHeader(L,W);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{n_(this),this.u=!0,this.g.send(d),this.u=!1}catch(L){Zw(this,L)}};function Zw(d,g){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=g,d.m=5,e_(d),Fu(d)}function e_(d){d.A||(d.A=!0,Lt(d,"complete"),Lt(d,"error"))}n.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,Lt(this,"complete"),Lt(this,"abort"),Fu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Fu(this,!0)),Be.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?t_(this):this.bb())},n.bb=function(){t_(this)};function t_(d){if(d.h&&typeof o<"u"&&(!d.v[1]||Tr(d)!=4||d.Z()!=2)){if(d.u&&Tr(d)==4)kw(d.Ea,0,d);else if(Lt(d,"readystatechange"),Tr(d)==4){d.h=!1;try{const W=d.Z();e:switch(W){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var w;if(!(w=g)){var I;if(I=W===0){var V=String(d.D).match(qw)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),I=!hP.test(V?V.toLowerCase():"")}w=I}if(w)Lt(d,"complete"),Lt(d,"success");else{d.m=6;try{var L=2<Tr(d)?d.g.statusText:""}catch{L=""}d.l=L+" ["+d.Z()+"]",e_(d)}}finally{Fu(d)}}}}function Fu(d,g){if(d.g){n_(d);const w=d.g,I=d.v[0]?()=>{}:null;d.g=null,d.v=null,g||Lt(d,"ready");try{w.onreadystatechange=I}catch{}}}function n_(d){d.I&&(a.clearTimeout(d.I),d.I=null)}n.isActive=function(){return!!this.g};function Tr(d){return d.g?d.g.readyState:0}n.Z=function(){try{return 2<Tr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(d){if(this.g){var g=this.g.responseText;return d&&g.indexOf(d)==0&&(g=g.substring(d.length)),qR(g)}};function r_(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function pP(d){const g={};d=(d.g&&2<=Tr(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<d.length;I++){if(T(d[I]))continue;var w=D(d[I]);const V=w[0];if(w=w[1],typeof w!="string")continue;w=w.trim();const L=g[V]||[];g[V]=L,L.push(w)}k(g,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ml(d,g,w){return w&&w.internalChannelParams&&w.internalChannelParams[d]||g}function s_(d){this.Aa=0,this.i=[],this.j=new ll,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ml("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ml("baseRetryDelayMs",5e3,d),this.cb=ml("retryDelaySeedMs",1e4,d),this.Wa=ml("forwardChannelMaxRetries",2,d),this.wa=ml("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new Fw(d&&d.concurrentRequestLimit),this.Da=new uP,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=s_.prototype,n.la=8,n.G=1,n.connect=function(d,g,w,I){Ft(0),this.W=d,this.H=g||{},w&&I!==void 0&&(this.H.OSID=w,this.H.OAID=I),this.F=this.X,this.I=f_(this,null,this.W),Uu(this)};function Lp(d){if(i_(d),d.G==3){var g=d.U++,w=kr(d.I);if(Ne(w,"SID",d.K),Ne(w,"RID",g),Ne(w,"TYPE","terminate"),gl(d,w),g=new ss(d,d.j,g),g.L=2,g.v=Vu(kr(w)),w=!1,a.navigator&&a.navigator.sendBeacon)try{w=a.navigator.sendBeacon(g.v.toString(),"")}catch{}!w&&a.Image&&(new Image().src=g.v,w=!0),w||(g.g=p_(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Du(g)}h_(d)}function Bu(d){d.g&&(Bp(d),d.g.cancel(),d.g=null)}function i_(d){Bu(d),d.u&&(a.clearTimeout(d.u),d.u=null),$u(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&a.clearTimeout(d.s),d.s=null)}function Uu(d){if(!Bw(d.h)&&!d.s){d.s=!0;var g=d.Ga;re||oe(),B||(re(),B=!0),G.add(g,d),d.B=0}}function mP(d,g){return Uw(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=g.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=al(f(d.Ga,d,g),d_(d,d.B)),d.B++,!0)}n.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const V=new ss(this,this.j,d);let L=this.o;if(this.S&&(L?(L=E(L),C(L,this.S)):L=this.S),this.m!==null||this.O||(V.H=L,L=null),this.P)e:{for(var g=0,w=0;w<this.i.length;w++){t:{var I=this.i[w];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(g+=I,4096<g){g=w;break e}if(g===4096||w===this.i.length-1){g=w+1;break e}}g=1e3}else g=1e3;g=a_(this,V,g),w=kr(this.I),Ne(w,"RID",d),Ne(w,"CVER",22),this.D&&Ne(w,"X-HTTP-Session-Id",this.D),gl(this,w),L&&(this.O?g="headers="+encodeURIComponent(String(Xw(L)))+"&"+g:this.m&&jp(w,this.m,L)),Vp(this.h,V),this.Ua&&Ne(w,"TYPE","init"),this.P?(Ne(w,"$req",g),Ne(w,"SID","null"),V.T=!0,Pp(V,w,null)):Pp(V,w,g),this.G=2}}else this.G==3&&(d?o_(this,d):this.i.length==0||Bw(this.h)||o_(this))};function o_(d,g){var w;g?w=g.l:w=d.U++;const I=kr(d.I);Ne(I,"SID",d.K),Ne(I,"RID",w),Ne(I,"AID",d.T),gl(d,I),d.m&&d.o&&jp(I,d.m,d.o),w=new ss(d,d.j,w,d.B+1),d.m===null&&(w.H=d.o),g&&(d.i=g.D.concat(d.i)),g=a_(d,w,1e3),w.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),Vp(d.h,w),Pp(w,I,g)}function gl(d,g){d.H&&P(d.H,function(w,I){Ne(g,I,w)}),d.l&&Ww({},function(w,I){Ne(g,I,w)})}function a_(d,g,w){w=Math.min(d.i.length,w);var I=d.l?f(d.l.Na,d.l,d):null;e:{var V=d.i;let L=-1;for(;;){const W=["count="+w];L==-1?0<w?(L=V[0].g,W.push("ofs="+L)):L=0:W.push("ofs="+L);let be=!0;for(let pt=0;pt<w;pt++){let ve=V[pt].g;const bt=V[pt].map;if(ve-=L,0>ve)L=Math.max(0,V[pt].g-100),be=!1;else try{dP(bt,W,"req"+ve+"_")}catch{I&&I(bt)}}if(be){I=W.join("&");break e}}}return d=d.i.splice(0,w),g.D=d,I}function l_(d){if(!d.g&&!d.u){d.Y=1;var g=d.Fa;re||oe(),B||(re(),B=!0),G.add(g,d),d.v=0}}function Fp(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=al(f(d.Fa,d),d_(d,d.v)),d.v++,!0)}n.Fa=function(){if(this.u=null,c_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=al(f(this.ab,this),d)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ft(10),Bu(this),c_(this))};function Bp(d){d.A!=null&&(a.clearTimeout(d.A),d.A=null)}function c_(d){d.g=new ss(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var g=kr(d.qa);Ne(g,"RID","rpc"),Ne(g,"SID",d.K),Ne(g,"AID",d.T),Ne(g,"CI",d.F?"0":"1"),!d.F&&d.ja&&Ne(g,"TO",d.ja),Ne(g,"TYPE","xmlhttp"),gl(d,g),d.m&&d.o&&jp(g,d.m,d.o),d.L&&(d.g.I=d.L);var w=d.g;d=d.ia,w.L=1,w.v=Vu(kr(g)),w.m=null,w.P=!0,Vw(w,d)}n.Za=function(){this.C!=null&&(this.C=null,Bu(this),Fp(this),Ft(19))};function $u(d){d.C!=null&&(a.clearTimeout(d.C),d.C=null)}function u_(d,g){var w=null;if(d.g==g){$u(d),Bp(d),d.g=null;var I=2}else if(Op(d.h,g))w=g.D,$w(d.h,g),I=1;else return;if(d.G!=0){if(g.o)if(I==1){w=g.m?g.m.length:0,g=Date.now()-g.F;var V=d.B;I=Au(),Lt(I,new Pw(I,w)),Uu(d)}else l_(d);else if(V=g.s,V==3||V==0&&0<g.X||!(I==1&&mP(d,g)||I==2&&Fp(d)))switch(w&&0<w.length&&(g=d.h,g.i=g.i.concat(w)),V){case 1:Ti(d,5);break;case 4:Ti(d,10);break;case 3:Ti(d,6);break;default:Ti(d,2)}}}function d_(d,g){let w=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(w*=2),w*g}function Ti(d,g){if(d.j.info("Error code "+g),g==2){var w=f(d.fb,d),I=d.Xa;const V=!I;I=new ki(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Mu(I,"https"),Vu(I),V?lP(I.toString(),w):cP(I.toString(),w)}else Ft(2);d.G=0,d.l&&d.l.sa(g),h_(d),i_(d)}n.fb=function(d){d?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function h_(d){if(d.G=0,d.ka=[],d.l){const g=zw(d.h);(g.length!=0||d.i.length!=0)&&(_(d.ka,g),_(d.ka,d.i),d.h.i.length=0,v(d.i),d.i.length=0),d.l.ra()}}function f_(d,g,w){var I=w instanceof ki?kr(w):new ki(w);if(I.g!="")g&&(I.g=g+"."+I.g),Ou(I,I.s);else{var V=a.location;I=V.protocol,g=g?g+"."+V.hostname:V.hostname,V=+V.port;var L=new ki(null);I&&Mu(L,I),g&&(L.g=g),V&&Ou(L,V),w&&(L.l=w),I=L}return w=d.D,g=d.ya,w&&g&&Ne(I,w,g),Ne(I,"VER",d.la),gl(d,I),I}function p_(d,g,w){if(g&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=d.Ca&&!d.pa?new Be(new ju({eb:w})):new Be(d.pa),g.Ha(d.J),g}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function m_(){}n=m_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function zu(){}zu.prototype.g=function(d,g){return new cn(d,g)};function cn(d,g){Tt.call(this),this.g=new s_(g),this.l=d,this.h=g&&g.messageUrlParams||null,d=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(d?d["X-WebChannel-Content-Type"]=g.messageContentType:d={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(d?d["X-WebChannel-Client-Profile"]=g.va:d={"X-WebChannel-Client-Profile":g.va}),this.g.S=d,(d=g&&g.Sb)&&!T(d)&&(this.g.m=d),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!T(g)&&(this.g.D=g,d=this.h,d!==null&&g in d&&(d=this.h,g in d&&delete d[g])),this.j=new Do(this)}y(cn,Tt),cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},cn.prototype.close=function(){Lp(this.g)},cn.prototype.o=function(d){var g=this.g;if(typeof d=="string"){var w={};w.__data__=d,d=w}else this.u&&(w={},w.__data__=Sp(d),d=w);g.i.push(new XR(g.Ya++,d)),g.G==3&&Uu(g)},cn.prototype.N=function(){this.g.l=null,delete this.j,Lp(this.g),delete this.g,cn.aa.N.call(this)};function g_(d){Cp.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var g=d.__sm__;if(g){e:{for(const w in g){d=w;break e}d=void 0}(this.i=d)&&(d=this.i,g=g!==null&&d in g?g[d]:void 0),this.data=g}else this.data=d}y(g_,Cp);function y_(){Np.call(this),this.status=1}y(y_,Np);function Do(d){this.g=d}y(Do,m_),Do.prototype.ua=function(){Lt(this.g,"a")},Do.prototype.ta=function(d){Lt(this.g,new g_(d))},Do.prototype.sa=function(d){Lt(this.g,new y_)},Do.prototype.ra=function(){Lt(this.g,"b")},zu.prototype.createWebChannel=zu.prototype.g,cn.prototype.send=cn.prototype.o,cn.prototype.open=cn.prototype.m,cn.prototype.close=cn.prototype.close,NI=function(){return new zu},CI=function(){return Au()},II=xi,ny={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ru.NO_ERROR=0,Ru.TIMEOUT=8,Ru.HTTP_ERROR=6,$d=Ru,Dw.COMPLETE="complete",SI=Dw,Cw.EventType=il,il.OPEN="a",il.CLOSE="b",il.ERROR="c",il.MESSAGE="d",Tt.prototype.listen=Tt.prototype.K,Bl=Cw,Be.prototype.listenOnce=Be.prototype.L,Be.prototype.getLastError=Be.prototype.Ka,Be.prototype.getLastErrorCode=Be.prototype.Ba,Be.prototype.getStatus=Be.prototype.Z,Be.prototype.getResponseJson=Be.prototype.Oa,Be.prototype.getResponseText=Be.prototype.oa,Be.prototype.send=Be.prototype.ea,Be.prototype.setWithCredentials=Be.prototype.Ha,bI=Be}).apply(typeof ud<"u"?ud:typeof self<"u"?self:typeof window<"u"?window:{});const hE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};yt.UNAUTHENTICATED=new yt(null),yt.GOOGLE_CREDENTIALS=new yt("google-credentials-uid"),yt.FIRST_PARTY=new yt("first-party-uid"),yt.MOCK_USER=new yt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Za="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co=new q0("@firebase/firestore");function zo(){return co.logLevel}function $(n,...e){if(co.logLevel<=fe.DEBUG){const t=e.map(rv);co.debug(`Firestore (${Za}): ${n}`,...t)}}function Ut(n,...e){if(co.logLevel<=fe.ERROR){const t=e.map(rv);co.error(`Firestore (${Za}): ${n}`,...t)}}function uo(n,...e){if(co.logLevel<=fe.WARN){const t=e.map(rv);co.warn(`Firestore (${Za}): ${n}`,...t)}}function rv(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y(n="Unexpected state"){const e=`FIRESTORE (${Za}) INTERNAL ASSERTION FAILED: `+n;throw Ut(e),new Error(e)}function Z(n,e){n||Y()}function ie(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends gr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class C4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(yt.UNAUTHENTICATED))}shutdown(){}}class N4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class A4{constructor(e){this.t=e,this.currentUser=yt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Z(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new dr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new dr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{$("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):($("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new dr)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?($("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Z(typeof r.accessToken=="string"),new AI(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Z(e===null||typeof e=="string"),new yt(e)}}class R4{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=yt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class P4{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new R4(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(yt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class D4{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class M4{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Z(this.o===void 0);const r=i=>{i.error!=null&&$("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,$("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{$("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):$("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Z(typeof t.token=="string"),this.R=t.token,new D4(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=O4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function ae(n,e){return n<e?-1:n>e?1:0}function Ra(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function PI(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new q(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Le.fromMillis(Date.now())}static fromDate(e){return Le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Le(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ae(this.nanoseconds,e.nanoseconds):ae(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new te(e)}static min(){return new te(new Le(0,0))}static max(){return new te(new Le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(e,t,r){t===void 0?t=0:t>e.length&&Y(),r===void 0?r=e.length-t:r>e.length-t&&Y(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Oc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Oc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class _e extends Oc{construct(e,t,r){return new _e(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new q(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new _e(t)}static emptyPath(){return new _e([])}}const V4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ve extends Oc{construct(e,t,r){return new Ve(e,t,r)}static isValidIdentifier(e){return V4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ve.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ve(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new q(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new q(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new q(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new q(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ve(t)}static emptyPath(){return new Ve([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.path=e}static fromPath(e){return new H(_e.fromString(e))}static fromName(e){return new H(_e.fromString(e).popFirst(5))}static empty(){return new H(_e.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_e.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return _e.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new _e(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function ry(n){return n.fields.find(e=>e.kind===2)}function Ai(n){return n.fields.filter(e=>e.kind!==2)}Vh.UNKNOWN_ID=-1;class zd{constructor(e,t){this.fieldPath=e,this.kind=t}}class Vc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Vc(0,_n.min())}}function j4(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=te.fromTimestamp(r===1e9?new Le(t+1,0):new Le(t,r));return new _n(s,H.empty(),e)}function DI(n){return new _n(n.readTime,n.key,-1)}class _n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new _n(te.min(),H.empty(),-1)}static max(){return new _n(te.max(),H.empty(),-1)}}function sv(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=H.comparator(n.documentKey,e.documentKey),t!==0?t:ae(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class OI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function So(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==MI)throw n;$("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):j.reject(t)}static resolve(e){return new j((t,r)=>{t(e)})}static reject(e){return new j((t,r)=>{r(e)})}static waitFor(e){return new j((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=j.resolve(!1);for(const r of e)t=t.next(s=>s?j.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new j((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(u=>{o[c]=u,++a,a===i&&r(o)},u=>s(u))}})}static doWhile(e,t){return new j((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new dr,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new sc(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=iv(r.target.error);this.V.reject(new sc(e,s))}}static open(e,t,r,s){try{return new Lf(t,e.transaction(s,r))}catch(i){throw new sc(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||($("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new F4(t)}}class qs{constructor(e,t,r){this.name=e,this.version=t,this.p=r,qs.S(st())===12.2&&Ut("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return $("SimpleDb","Removing database:",e),Pi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!LS())return!1;if(qs.v())return!0;const e=st(),t=qs.S(e),r=0<t&&t<10,s=VI(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||($("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new sc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new q(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new q(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new sc(e,o))},s.onupgradeneeded=i=>{$("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{$("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Lf.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),j.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if($("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function VI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class L4{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Pi(this.B.delete())}}class sc extends q{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function mi(n){return n.name==="IndexedDbTransactionError"}class F4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?($("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):($("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Pi(r)}add(e){return $("SimpleDb","ADD",this.store.name,e,e),Pi(this.store.add(e))}get(e){return Pi(this.store.get(e)).next(t=>(t===void 0&&(t=null),$("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return $("SimpleDb","DELETE",this.store.name,e),Pi(this.store.delete(e))}count(){return $("SimpleDb","COUNT",this.store.name),Pi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new j((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new j((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){$("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new j((r,s)=>{t.onerror=i=>{const o=iv(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new j((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new L4(a),c=t(a.primaryKey,a.value,l);if(c instanceof j){const u=c.catch(h=>(l.done(),j.reject(h)));r.push(u)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>j.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pi(n){return new j((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=iv(r.target.error);t(s)}})}let fE=!1;function iv(n){const e=qs.S(st());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return fE||(fE=!0,setTimeout(()=>{throw r},0)),r}}return n}class B4{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){$("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{$("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){mi(t)?$("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await So(t)}await this.X(6e4)})}}class U4{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return j.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return $("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>($("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=DI(i);sv(o,r)>0&&(r=o)}),new _n(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Cn.oe=-1;function Ff(n){return n==null}function jc(n){return n===0&&1/n==-1/0}function $4(n){return typeof n=="number"&&Number.isInteger(n)&&!jc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=pE(e)),e=z4(n.get(t),e);return pE(e)}function z4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function pE(n){return n+""}function rr(n){const e=n.length;if(Z(e>=2),e===2)return Z(n.charAt(0)===""&&n.charAt(1)===""),_e.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Y(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Y()}i=o+2}return new _e(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(n,e){return[n,Wt(e)]}function jI(n,e,t){return[n,Wt(e),t]}const W4={},q4=["prefixPath","collectionGroup","readTime","documentId"],H4=["prefixPath","collectionGroup","documentId"],K4=["collectionGroup","readTime","prefixPath","documentId"],G4=["canonicalId","targetId"],Q4=["targetId","path"],J4=["path","targetId"],Y4=["collectionId","parent"],X4=["indexId","uid"],Z4=["uid","sequenceNumber"],eF=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tF=["indexId","uid","orderedDocumentKey"],nF=["userId","collectionPath","documentId"],rF=["userId","collectionPath","largestBatchId"],sF=["userId","collectionGroup","largestBatchId"],LI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],iF=[...LI,"documentOverlays"],FI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],BI=FI,ov=[...BI,"indexConfiguration","indexState","indexEntries"],oF=ov,aF=[...ov,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy extends OI{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function ot(n,e){const t=ie(n);return qs.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Io(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function UI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e,t){this.comparator=e,this.root=t||vt.EMPTY}insert(e,t){return new Me(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,vt.BLACK,null,null))}remove(e){return new Me(this.comparator,this.root.remove(e,this.comparator).copy(null,null,vt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new dd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new dd(this.root,e,this.comparator,!1)}getReverseIterator(){return new dd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new dd(this.root,e,this.comparator,!0)}}class dd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class vt{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??vt.RED,this.left=s??vt.EMPTY,this.right=i??vt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new vt(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return vt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return vt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,vt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,vt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Y();const e=this.left.check();if(e!==this.right.check())throw Y();return e+(this.isRed()?0:1)}}vt.EMPTY=null,vt.RED=!0,vt.BLACK=!1;vt.EMPTY=new class{constructor(){this.size=0}get key(){throw Y()}get value(){throw Y()}get color(){throw Y()}get left(){throw Y()}get right(){throw Y()}copy(e,t,r,s,i){return this}insert(e,t,r){return new vt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.comparator=e,this.data=new Me(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yE(this.data.getIterator())}getIteratorFrom(e){return new yE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Te)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Te(this.comparator);return t.data=e,t}}class yE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Vo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e){this.fields=e,e.sort(Ve.comparator)}static empty(){return new nn([])}unionWith(e){let t=new Te(Ve.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new nn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ra(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $I extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new $I("Invalid base64 string: "+i):i}}(e);return new et(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new et(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ae(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}et.EMPTY_BYTE_STRING=new et("");const lF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xr(n){if(Z(!!n),typeof n=="string"){let e=0;const t=lF.exec(n);if(Z(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pe(n.seconds),nanos:Pe(n.nanos)}}function Pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ni(n){return typeof n=="string"?et.fromBase64String(n):et.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function av(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function lv(n){const e=n.mapValue.fields.__previous_value__;return av(e)?lv(e):e}function Lc(n){const e=Xr(n.mapValue.fields.__local_write_time__.timestampValue);return new Le(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cF{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class ho{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ho("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ho&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},qd={nullValue:"NULL_VALUE"};function fo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?av(n)?4:zI(n)?9007199254740991:Bf(n)?10:11:Y()}function hr(n,e){if(n===e)return!0;const t=fo(n);if(t!==fo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lc(n).isEqual(Lc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Xr(s.timestampValue),a=Xr(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ni(s.bytesValue).isEqual(ni(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Pe(s.geoPointValue.latitude)===Pe(i.geoPointValue.latitude)&&Pe(s.geoPointValue.longitude)===Pe(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Pe(s.integerValue)===Pe(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Pe(s.doubleValue),a=Pe(i.doubleValue);return o===a?jc(o)===jc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ra(n.arrayValue.values||[],e.arrayValue.values||[],hr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(gE(o)!==gE(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!hr(o[l],a[l])))return!1;return!0}(n,e);default:return Y()}}function Fc(n,e){return(n.values||[]).find(t=>hr(t,e))!==void 0}function ri(n,e){if(n===e)return 0;const t=fo(n),r=fo(e);if(t!==r)return ae(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ae(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Pe(i.integerValue||i.doubleValue),l=Pe(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return vE(n.timestampValue,e.timestampValue);case 4:return vE(Lc(n),Lc(e));case 5:return ae(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ni(i),l=ni(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=ae(a[c],l[c]);if(u!==0)return u}return ae(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=ae(Pe(i.latitude),Pe(o.latitude));return a!==0?a:ae(Pe(i.longitude),Pe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return wE(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,u;const h=i.fields||{},f=o.fields||{},m=(a=h.value)===null||a===void 0?void 0:a.arrayValue,y=(l=f.value)===null||l===void 0?void 0:l.arrayValue,v=ae(((c=m==null?void 0:m.values)===null||c===void 0?void 0:c.length)||0,((u=y==null?void 0:y.values)===null||u===void 0?void 0:u.length)||0);return v!==0?v:wE(m,y)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===As.mapValue&&o===As.mapValue)return 0;if(i===As.mapValue)return 1;if(o===As.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const f=ae(l[h],u[h]);if(f!==0)return f;const m=ri(a[l[h]],c[u[h]]);if(m!==0)return m}return ae(l.length,u.length)}(n.mapValue,e.mapValue);default:throw Y()}}function vE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ae(n,e);const t=Xr(n),r=Xr(e),s=ae(t.seconds,r.seconds);return s!==0?s:ae(t.nanos,r.nanos)}function wE(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=ri(t[s],r[s]);if(i)return i}return ae(t.length,r.length)}function Pa(n){return iy(n)}function iy(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Xr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ni(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return H.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=iy(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${iy(t.fields[o])}`;return s+"}"}(n.mapValue):Y()}function Bc(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function oy(n){return!!n&&"integerValue"in n}function Uc(n){return!!n&&"arrayValue"in n}function _E(n){return!!n&&"nullValue"in n}function xE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hd(n){return!!n&&"mapValue"in n}function Bf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ic(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Io(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ic(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ic(n.arrayValue.values[t]);return e}return Object.assign({},n)}function zI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const WI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function uF(n){return"nullValue"in n?qd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Bc(ho.empty(),H.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Bf(n)?WI:{mapValue:{}}:Y()}function dF(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Bc(ho.empty(),H.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?WI:"mapValue"in n?Bf(n)?{mapValue:{}}:As:Y()}function EE(n,e){const t=ri(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function kE(n,e){const t=ri(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this.value=e}static empty(){return new Pt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Hd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ic(t)}setAll(e){let t=Ve.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=ic(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Hd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return hr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Hd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Io(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Pt(ic(this.value))}}function qI(n){const e=[];return Io(n.fields,(t,r)=>{const s=new Ve([t]);if(Hd(r)){const i=qI(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new nn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ze(e,0,te.min(),te.min(),te.min(),Pt.empty(),0)}static newFoundDocument(e,t,r,s){return new ze(e,1,t,te.min(),r,s,0)}static newNoDocument(e,t){return new ze(e,2,t,te.min(),te.min(),Pt.empty(),0)}static newUnknownDocument(e,t){return new ze(e,3,t,te.min(),te.min(),Pt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ze&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ze(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(e,t){this.position=e,this.inclusive=t}}function TE(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=H.comparator(H.fromName(o.referenceValue),t.key):r=ri(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function bE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!hr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e,t="asc"){this.field=e,this.dir=t}}function hF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{}class me extends HI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new fF(e,t,r):t==="array-contains"?new gF(e,r):t==="in"?new XI(e,r):t==="not-in"?new yF(e,r):t==="array-contains-any"?new vF(e,r):new me(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new pF(e,r):new mF(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ri(t,this.value)):t!==null&&fo(this.value)===fo(t)&&this.matchesComparison(ri(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Y()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ee extends HI{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ee(e,t)}matches(e){return Ma(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ma(n){return n.op==="and"}function ay(n){return n.op==="or"}function cv(n){return KI(n)&&Ma(n)}function KI(n){for(const e of n.filters)if(e instanceof Ee)return!1;return!0}function ly(n){if(n instanceof me)return n.field.canonicalString()+n.op.toString()+Pa(n.value);if(cv(n))return n.filters.map(e=>ly(e)).join(",");{const e=n.filters.map(t=>ly(t)).join(",");return`${n.op}(${e})`}}function GI(n,e){return n instanceof me?function(r,s){return s instanceof me&&r.op===s.op&&r.field.isEqual(s.field)&&hr(r.value,s.value)}(n,e):n instanceof Ee?function(r,s){return s instanceof Ee&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&GI(o,s.filters[a]),!0):!1}(n,e):void Y()}function QI(n,e){const t=n.filters.concat(e);return Ee.create(t,n.op)}function JI(n){return n instanceof me?function(t){return`${t.field.canonicalString()} ${t.op} ${Pa(t.value)}`}(n):n instanceof Ee?function(t){return t.op.toString()+" {"+t.getFilters().map(JI).join(" ,")+"}"}(n):"Filter"}class fF extends me{constructor(e,t,r){super(e,t,r),this.key=H.fromName(r.referenceValue)}matches(e){const t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class pF extends me{constructor(e,t){super(e,"in",t),this.keys=YI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class mF extends me{constructor(e,t){super(e,"not-in",t),this.keys=YI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function YI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>H.fromName(r.referenceValue))}class gF extends me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Uc(t)&&Fc(t.arrayValue,this.value)}}class XI extends me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fc(this.value.arrayValue,t)}}class yF extends me{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Fc(this.value.arrayValue,t)}}class vF extends me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Uc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wF{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function cy(n,e=null,t=[],r=[],s=null,i=null,o=null){return new wF(n,e,t,r,s,i,o)}function po(n){const e=ie(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ly(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ff(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Pa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Pa(r)).join(",")),e.ue=t}return e.ue}function gu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!hF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!GI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!bE(n.startAt,e.startAt)&&bE(n.endAt,e.endAt)}function jh(n){return H.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Lh(n,e){return n.filters.filter(t=>t instanceof me&&t.field.isEqual(e))}function SE(n,e,t){let r=qd,s=!0;for(const i of Lh(n,e)){let o=qd,a=!0;switch(i.op){case"<":case"<=":o=uF(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=qd}EE({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];EE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function IE(n,e,t){let r=As,s=!0;for(const i of Lh(n,e)){let o=As,a=!0;switch(i.op){case">=":case">":o=dF(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=As}kE({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];kE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function _F(n,e,t,r,s,i,o,a){return new el(n,e,t,r,s,i,o,a)}function Uf(n){return new el(n)}function CE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ZI(n){return n.collectionGroup!==null}function oc(n){const e=ie(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Te(Ve.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new $c(i,r))}),t.has(Ve.keyField().canonicalString())||e.ce.push(new $c(Ve.keyField(),r))}return e.ce}function Rn(n){const e=ie(n);return e.le||(e.le=xF(e,oc(n))),e.le}function xF(n,e){if(n.limitType==="F")return cy(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new $c(s.field,i)});const t=n.endAt?new Da(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Da(n.startAt.position,n.startAt.inclusive):null;return cy(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function uy(n,e){const t=n.filters.concat([e]);return new el(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Fh(n,e,t){return new el(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function $f(n,e){return gu(Rn(n),Rn(e))&&n.limitType===e.limitType}function eC(n){return`${po(Rn(n))}|lt:${n.limitType}`}function Wo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>JI(s)).join(", ")}]`),Ff(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Pa(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Pa(s)).join(",")),`Target(${r})`}(Rn(n))}; limitType=${n.limitType})`}function yu(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):H.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of oc(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=TE(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,oc(r),s)||r.endAt&&!function(o,a,l){const c=TE(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,oc(r),s))}(n,e)}function EF(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function tC(n){return(e,t)=>{let r=!1;for(const s of oc(n)){const i=kF(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function kF(n,e,t){const r=n.field.isKeyField()?H.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?ri(l,c):Y()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Y()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Io(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return UI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TF=new Me(H.comparator);function pn(){return TF}const nC=new Me(H.comparator);function Ul(...n){let e=nC;for(const t of n)e=e.insert(t.key,t);return e}function rC(n){let e=nC;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function sr(){return ac()}function sC(){return ac()}function ac(){return new gi(n=>n.toString(),(n,e)=>n.isEqual(e))}const bF=new Me(H.comparator),SF=new Te(H.comparator);function de(...n){let e=SF;for(const t of n)e=e.add(t);return e}const IF=new Te(ae);function CF(){return IF}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uv(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jc(e)?"-0":e}}function iC(n){return{integerValue:""+n}}function NF(n,e){return $4(e)?iC(e):uv(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(){this._=void 0}}function AF(n,e,t){return n instanceof Oa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&av(i)&&(i=lv(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Va?aC(n,e):n instanceof ja?lC(n,e):function(s,i){const o=oC(s,i),a=NE(o)+NE(s.Pe);return oy(o)&&oy(s.Pe)?iC(a):uv(s.serializer,a)}(n,e)}function RF(n,e,t){return n instanceof Va?aC(n,e):n instanceof ja?lC(n,e):t}function oC(n,e){return n instanceof zc?function(r){return oy(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Oa extends zf{}class Va extends zf{constructor(e){super(),this.elements=e}}function aC(n,e){const t=cC(e);for(const r of n.elements)t.some(s=>hr(s,r))||t.push(r);return{arrayValue:{values:t}}}class ja extends zf{constructor(e){super(),this.elements=e}}function lC(n,e){let t=cC(e);for(const r of n.elements)t=t.filter(s=>!hr(s,r));return{arrayValue:{values:t}}}class zc extends zf{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function NE(n){return Pe(n.integerValue||n.doubleValue)}function cC(n){return Uc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(e,t){this.field=e,this.transform=t}}function PF(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Va&&s instanceof Va||r instanceof ja&&s instanceof ja?Ra(r.elements,s.elements,hr):r instanceof zc&&s instanceof zc?hr(r.Pe,s.Pe):r instanceof Oa&&s instanceof Oa}(n.transform,e.transform)}class DF{constructor(e,t){this.version=e,this.transformResults=t}}class $t{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new $t}static exists(e){return new $t(void 0,e)}static updateTime(e){return new $t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Kd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Wf{}function dC(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new qf(n.key,$t.none()):new tl(n.key,n.data,$t.none());{const t=n.data,r=Pt.empty();let s=new Te(Ve.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new rs(n.key,r,new nn(s.toArray()),$t.none())}}function MF(n,e,t){n instanceof tl?function(s,i,o){const a=s.value.clone(),l=RE(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof rs?function(s,i,o){if(!Kd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=RE(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(hC(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function lc(n,e,t,r){return n instanceof tl?function(i,o,a,l){if(!Kd(i.precondition,o))return a;const c=i.value.clone(),u=PE(i.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof rs?function(i,o,a,l){if(!Kd(i.precondition,o))return a;const c=PE(i.fieldTransforms,l,o),u=o.data;return u.setAll(hC(i)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(i,o,a){return Kd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function OF(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=oC(r.transform,s||null);i!=null&&(t===null&&(t=Pt.empty()),t.set(r.field,i))}return t||null}function AE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ra(r,s,(i,o)=>PF(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class tl extends Wf{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class rs extends Wf{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function hC(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function RE(n,e,t){const r=new Map;Z(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,RF(o,a,t[s]))}return r}function PE(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,AF(i,o,e))}return r}class qf extends Wf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fC extends Wf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&MF(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=lc(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=lc(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=sC();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=dC(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),de())}isEqual(e){return this.batchId===e.batchId&&Ra(this.mutations,e.mutations,(t,r)=>AE(t,r))&&Ra(this.baseMutations,e.baseMutations,(t,r)=>AE(t,r))}}class hv{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Z(e.mutations.length===r.length);let s=function(){return bF}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new hv(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qe,ge;function jF(n){switch(n){default:return Y();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}function pC(n){if(n===void 0)return Ut("GRPC error has no .code"),F.UNKNOWN;switch(n){case Qe.OK:return F.OK;case Qe.CANCELLED:return F.CANCELLED;case Qe.UNKNOWN:return F.UNKNOWN;case Qe.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case Qe.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case Qe.INTERNAL:return F.INTERNAL;case Qe.UNAVAILABLE:return F.UNAVAILABLE;case Qe.UNAUTHENTICATED:return F.UNAUTHENTICATED;case Qe.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case Qe.NOT_FOUND:return F.NOT_FOUND;case Qe.ALREADY_EXISTS:return F.ALREADY_EXISTS;case Qe.PERMISSION_DENIED:return F.PERMISSION_DENIED;case Qe.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case Qe.ABORTED:return F.ABORTED;case Qe.OUT_OF_RANGE:return F.OUT_OF_RANGE;case Qe.UNIMPLEMENTED:return F.UNIMPLEMENTED;case Qe.DATA_LOSS:return F.DATA_LOSS;default:return Y()}}(ge=Qe||(Qe={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FF=new Hi([4294967295,4294967295],0);function DE(n){const e=LF().encode(n),t=new TI;return t.update(e),new Uint8Array(t.digest())}function ME(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Hi([t,r],0),new Hi([s,i],0)]}class pv{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new $l(`Invalid padding: ${t}`);if(r<0)throw new $l(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new $l(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new $l(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Hi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Hi.fromNumber(r)));return s.compare(FF)===1&&(s=new Hi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=DE(e),[r,s]=ME(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new pv(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=DE(e),[r,s]=ME(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class $l extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,vu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Hf(te.min(),s,new Me(ae),pn(),de())}}class vu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new vu(r,t,de(),de(),de())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class mC{constructor(e,t){this.targetId=e,this.me=t}}class gC{constructor(e,t,r=et.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class OE{constructor(){this.fe=0,this.ge=jE(),this.pe=et.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=de(),t=de(),r=de();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Y()}}),new vu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=jE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Z(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class BF{constructor(e){this.Le=e,this.Be=new Map,this.ke=pn(),this.qe=VE(),this.Qe=new Me(ae)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Y()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(jh(i))if(r===0){const o=new H(i.path);this.Ue(t,o,ze.newNoDocument(o,te.min()))}else Z(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ni(r).toUint8Array()}catch(l){if(l instanceof $I)return uo("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new pv(o,s,i)}catch(l){return uo(l instanceof $l?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&jh(a.target)){const l=new H(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,ze.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=de();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Hf(e,t,this.Qe,this.ke,r);return this.ke=pn(),this.qe=VE(),this.Qe=new Me(ae),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new OE,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Te(ae),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||$("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new OE),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function VE(){return new Me(H.comparator)}function jE(){return new Me(H.comparator)}const UF={asc:"ASCENDING",desc:"DESCENDING"},$F={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zF={and:"AND",or:"OR"};class WF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function dy(n,e){return n.useProto3Json||Ff(e)?e:{value:e}}function La(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function yC(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function qF(n,e){return La(n,e.toTimestamp())}function qt(n){return Z(!!n),te.fromTimestamp(function(t){const r=Xr(t);return new Le(r.seconds,r.nanos)}(n))}function mv(n,e){return hy(n,e).canonicalString()}function hy(n,e){const t=function(s){return new _e(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function vC(n){const e=_e.fromString(n);return Z(IC(e)),e}function Bh(n,e){return mv(n.databaseId,e.path)}function Ki(n,e){const t=vC(e);if(t.get(1)!==n.databaseId.projectId)throw new q(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new H(xC(t))}function wC(n,e){return mv(n.databaseId,e)}function _C(n){const e=vC(n);return e.length===4?_e.emptyPath():xC(e)}function fy(n){return new _e(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xC(n){return Z(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function LE(n,e,t){return{name:Bh(n,e),fields:t.value.mapValue.fields}}function HF(n,e,t){const r=Ki(n,e.name),s=qt(e.updateTime),i=e.createTime?qt(e.createTime):te.min(),o=new Pt({mapValue:{fields:e.fields}}),a=ze.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function KF(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Y()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,u){return c.useProto3Json?(Z(u===void 0||typeof u=="string"),et.fromBase64String(u||"")):(Z(u===void 0||u instanceof Buffer||u instanceof Uint8Array),et.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?F.UNKNOWN:pC(c.code);return new q(u,c.message||"")}(o);t=new gC(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ki(n,r.document.name),i=qt(r.document.updateTime),o=r.document.createTime?qt(r.document.createTime):te.min(),a=new Pt({mapValue:{fields:r.document.fields}}),l=ze.newFoundDocument(s,i,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Gd(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ki(n,r.document),i=r.readTime?qt(r.readTime):te.min(),o=ze.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Gd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ki(n,r.document),i=r.removedTargetIds||[];t=new Gd([],i,s,null)}else{if(!("filter"in e))return Y();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new VF(s,i),a=r.targetId;t=new mC(a,o)}}return t}function Uh(n,e){let t;if(e instanceof tl)t={update:LE(n,e.key,e.value)};else if(e instanceof qf)t={delete:Bh(n,e.key)};else if(e instanceof rs)t={update:LE(n,e.key,e.data),updateMask:ZF(e.fieldMask)};else{if(!(e instanceof fC))return Y();t={verify:Bh(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Oa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Va)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ja)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof zc)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Y()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:qF(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Y()}(n,e.precondition)),t}function py(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?$t.updateTime(qt(i.updateTime)):i.exists!==void 0?$t.exists(i.exists):$t.none()}(e.currentDocument):$t.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Z(a.setToServerValue==="REQUEST_TIME"),l=new Oa;else if("appendMissingElements"in a){const u=a.appendMissingElements.values||[];l=new Va(u)}else if("removeAllFromArray"in a){const u=a.removeAllFromArray.values||[];l=new ja(u)}else"increment"in a?l=new zc(o,a.increment):Y();const c=Ve.fromServerFormat(a.fieldPath);return new uC(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Ki(n,e.update.name),i=new Pt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new nn(c.map(u=>Ve.fromServerFormat(u)))}(e.updateMask);return new rs(s,i,o,t,r)}return new tl(s,i,t,r)}if(e.delete){const s=Ki(n,e.delete);return new qf(s,t)}if(e.verify){const s=Ki(n,e.verify);return new fC(s,t)}return Y()}function GF(n,e){return n&&n.length>0?(Z(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?qt(s.updateTime):qt(i);return o.isEqual(te.min())&&(o=qt(i)),new DF(o,s.transformResults||[])}(t,e))):[]}function EC(n,e){return{documents:[wC(n,e.path)]}}function kC(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=wC(n,s);const i=function(c){if(c.length!==0)return SC(Ee.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(u=>function(f){return{field:qo(f.field),direction:JF(f.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=dy(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function TC(n){let e=_C(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Z(r===1);const u=t.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let i=[];t.where&&(i=function(h){const f=bC(h);return f instanceof Ee&&cv(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(f=>function(y){return new $c(Ho(y.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,Ff(f)?null:f}(t.limit));let l=null;t.startAt&&(l=function(h){const f=!!h.before,m=h.values||[];return new Da(m,f)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const f=!h.before,m=h.values||[];return new Da(m,f)}(t.endAt)),_F(e,s,o,i,a,"F",l,c)}function QF(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function bC(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ho(t.unaryFilter.field);return me.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ho(t.unaryFilter.field);return me.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ho(t.unaryFilter.field);return me.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ho(t.unaryFilter.field);return me.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Y()}}(n):n.fieldFilter!==void 0?function(t){return me.create(Ho(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Y()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ee.create(t.compositeFilter.filters.map(r=>bC(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Y()}}(t.compositeFilter.op))}(n):Y()}function JF(n){return UF[n]}function YF(n){return $F[n]}function XF(n){return zF[n]}function qo(n){return{fieldPath:n.canonicalString()}}function Ho(n){return Ve.fromServerFormat(n.fieldPath)}function SC(n){return n instanceof me?function(t){if(t.op==="=="){if(xE(t.value))return{unaryFilter:{field:qo(t.field),op:"IS_NAN"}};if(_E(t.value))return{unaryFilter:{field:qo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(xE(t.value))return{unaryFilter:{field:qo(t.field),op:"IS_NOT_NAN"}};if(_E(t.value))return{unaryFilter:{field:qo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qo(t.field),op:YF(t.op),value:t.value}}}(n):n instanceof Ee?function(t){const r=t.getFilters().map(s=>SC(s));return r.length===1?r[0]:{compositeFilter:{op:XF(t.op),filters:r}}}(n):Y()}function ZF(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function IC(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e,t,r,s,i=te.min(),o=te.min(),a=et.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Or(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Or(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{constructor(e){this.ct=e}}function eB(n,e){let t;if(e.document)t=HF(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=H.fromSegments(e.noDocument.path),s=go(e.noDocument.readTime);t=ze.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Y();{const r=H.fromSegments(e.unknownDocument.path),s=go(e.unknownDocument.version);t=ze.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Le(s[0],s[1]);return te.fromTimestamp(i)}(e.readTime)),t}function FE(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$h(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Bh(i,o.key),fields:o.data.value.mapValue.fields,updateTime:La(i,o.version.toTimestamp()),createTime:La(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:mo(e.version)};else{if(!e.isUnknownDocument())return Y();r.unknownDocument={path:t.path.toArray(),version:mo(e.version)}}return r}function $h(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function mo(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function go(n){const e=new Le(n.seconds,n.nanoseconds);return te.fromTimestamp(e)}function Di(n,e){const t=(e.baseMutations||[]).map(i=>py(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>py(n.ct,i)),s=Le.fromMillis(e.localWriteTimeMs);return new dv(e.batchId,s,t,r)}function zl(n){const e=go(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?go(n.lastLimboFreeSnapshotVersion):te.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Z(i.documents.length===1),Rn(Uf(_C(i.documents[0])))}(n.query):function(i){return Rn(TC(i))}(n.query),new Or(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,et.fromBase64String(n.resumeToken))}function NC(n,e){const t=mo(e.snapshotVersion),r=mo(e.lastLimboFreeSnapshotVersion);let s;s=jh(e.target)?EC(n.ct,e.target):kC(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:po(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function AC(n){const e=TC({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fh(e,e.limit,"L"):e}function Em(n,e){return new fv(e.largestBatchId,py(n.ct,e.overlayMutation))}function BE(n,e){const t=e.path.lastSegment();return[n,Wt(e.path.popLast()),t]}function UE(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:mo(r.readTime),documentKey:Wt(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tB{getBundleMetadata(e,t){return $E(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:go(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return $E(e).put(function(s){return{bundleId:s.id,createTime:mo(qt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return zE(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:AC(i.bundledQuery),readTime:go(i.readTime)}}(r)})}saveNamedQuery(e,t){return zE(e).put(function(s){return{name:s.name,readTime:mo(qt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function $E(n){return ot(n,"bundles")}function zE(n){return ot(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Kf(e,r)}getOverlay(e,t){return bl(e).get(BE(this.userId,t)).next(r=>r?Em(this.serializer,r):null)}getOverlays(e,t){const r=sr();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new fv(t,o);s.push(this.ht(e,a))}),j.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Wt(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(bl(e).j("collectionPathOverlayIndex",a))}),j.waitFor(i)}getOverlaysForCollection(e,t,r){const s=sr(),i=Wt(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return bl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Em(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=sr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return bl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,u)=>{const h=Em(this.serializer,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>i)}ht(e,t){return bl(e).put(function(s,i,o){const[a,l,c]=BE(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Uh(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function bl(n){return ot(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB{Pt(e){return ot(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?et.fromUint8Array(r):et.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Pe(e.integerValue));else if("doubleValue"in e){const r=Pe(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),jc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Xr(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ni(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?zI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Bf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Y()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Pe(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),H.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Mi.vt=new Mi;function rB(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function WE(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=rB(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class sB{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=WE(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=WE(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class iB{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class oB{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Sl{constructor(){this.jt=new sB,this.Ht=new iB(this.jt),this.Jt=new oB(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Oi(this.indexId,this.documentKey,this.arrayValue,r)}}function us(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=qE(n.arrayValue,e.arrayValue),t!==0?t:(t=qE(n.directionalValue,e.directionalValue),t!==0?t:H.comparator(n.documentKey,e.documentKey)))}function qE(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HE{constructor(e){this.Xt=new Te((t,r)=>Ve.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Z(e.collectionGroup===this.collectionId),this.nn)return!1;const t=ry(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ai(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Te(Ve.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new zd(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new zd(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new zd(r.field,r.dir==="asc"?0:1)));return new Vh(Vh.UNKNOWN_ID,this.collectionId,t,Vc.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RC(n){var e,t;if(Z(n instanceof me||n instanceof Ee),n instanceof me){if(n instanceof XI){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>me.create(n.field,"==",i)))||[];return Ee.create(s,"or")}return n}const r=n.filters.map(s=>RC(s));return Ee.create(r,n.op)}function aB(n){if(n.getFilters().length===0)return[];const e=yy(RC(n));return Z(PC(e)),my(e)||gy(e)?[e]:e.getFilters()}function my(n){return n instanceof me}function gy(n){return n instanceof Ee&&cv(n)}function PC(n){return my(n)||gy(n)||function(t){if(t instanceof Ee&&ay(t)){for(const r of t.getFilters())if(!my(r)&&!gy(r))return!1;return!0}return!1}(n)}function yy(n){if(Z(n instanceof me||n instanceof Ee),n instanceof me)return n;if(n.filters.length===1)return yy(n.filters[0]);const e=n.filters.map(r=>yy(r));let t=Ee.create(e,n.op);return t=zh(t),PC(t)?t:(Z(t instanceof Ee),Z(Ma(t)),Z(t.filters.length>1),t.filters.reduce((r,s)=>gv(r,s)))}function gv(n,e){let t;return Z(n instanceof me||n instanceof Ee),Z(e instanceof me||e instanceof Ee),t=n instanceof me?e instanceof me?function(s,i){return Ee.create([s,i],"and")}(n,e):KE(n,e):e instanceof me?KE(e,n):function(s,i){if(Z(s.filters.length>0&&i.filters.length>0),Ma(s)&&Ma(i))return QI(s,i.getFilters());const o=ay(s)?s:i,a=ay(s)?i:s,l=o.filters.map(c=>gv(c,a));return Ee.create(l,"or")}(n,e),zh(t)}function KE(n,e){if(Ma(e))return QI(e,n.getFilters());{const t=e.filters.map(r=>gv(n,r));return Ee.create(t,"or")}}function zh(n){if(Z(n instanceof me||n instanceof Ee),n instanceof me)return n;const e=n.getFilters();if(e.length===1)return zh(e[0]);if(KI(n))return n;const t=e.map(s=>zh(s)),r=[];return t.forEach(s=>{s instanceof me?r.push(s):s instanceof Ee&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ee.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lB{constructor(){this.un=new yv}addToCollectionParentIndex(e,t){return this.un.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(_n.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(_n.min())}updateCollectionGroup(e,t,r){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class yv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Te(_e.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Te(_e.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hd=new Uint8Array(0);class cB{constructor(e,t){this.databaseId=t,this.cn=new yv,this.ln=new gi(r=>po(r),(r,s)=>gu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Wt(s)};return GE(e).put(i)}return j.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[PI(t),""],!1,!0);return GE(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(rr(o.parent))}return r})}addFieldIndex(e,t){const r=Il(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Lo(e);return i.next(a=>{o.put(UE(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Il(e),s=Lo(e),i=jo(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Il(e),r=jo(e),s=Lo(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return j.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new HE(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=jo(e);let s=!0;const i=new Map;return j.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=de();const a=[];return j.forEach(i,(l,c)=>{$("IndexedDbIndexManager",`Using index ${function(b){return`id=${b.indexId}|cg=${b.collectionGroup}|f=${b.fields.map(N=>`${N.fieldPath}:${N.kind}`).join(",")}`}(l)} to execute ${po(t)}`);const u=function(b,N){const R=ry(N);if(R===void 0)return null;for(const P of Lh(b,R.fieldPath))switch(P.op){case"array-contains-any":return P.value.arrayValue.values||[];case"array-contains":return[P.value]}return null}(c,l),h=function(b,N){const R=new Map;for(const P of Ai(N))for(const k of Lh(b,P.fieldPath))switch(k.op){case"==":case"in":R.set(P.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return R.set(P.fieldPath.canonicalString(),k.value),Array.from(R.values())}return null}(c,l),f=function(b,N){const R=[];let P=!0;for(const k of Ai(N)){const E=k.kind===0?SE(b,k.fieldPath,b.startAt):IE(b,k.fieldPath,b.startAt);R.push(E.value),P&&(P=E.inclusive)}return new Da(R,P)}(c,l),m=function(b,N){const R=[];let P=!0;for(const k of Ai(N)){const E=k.kind===0?IE(b,k.fieldPath,b.endAt):SE(b,k.fieldPath,b.endAt);R.push(E.value),P&&(P=E.inclusive)}return new Da(R,P)}(c,l),y=this.In(l,c,f),v=this.In(l,c,m),_=this.Tn(l,c,h),x=this.En(l.indexId,u,y,f.inclusive,v,m.inclusive,_);return j.forEach(x,T=>r.G(T,t.limit).next(b=>{b.forEach(N=>{const R=H.fromSegments(N.documentKey);o.has(R)||(o=o.add(R),a.push(R))})}))}).next(()=>a)}return j.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=aB(Ee.create(e.filters,"and")).map(r=>cy(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),u=[];for(let h=0;h<l;++h){const f=t?this.dn(t[h/c]):hd,m=this.An(e,f,r[h%c],s),y=this.Rn(e,f,i[h%c],o),v=a.map(_=>this.An(e,f,_,!0));u.push(...this.createRange(m,y,v))}return u}An(e,t,r,s){const i=new Oi(e,H.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Oi(e,H.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new HE(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return j.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Te(Ve.comparator),u=!1;for(const h of l.filters)for(const f of h.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?u=!0:c=c.add(f.field));for(const h of l.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(u?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Sl;for(const s of Ai(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Mi.vt.It(i,o)}return r.zt()}dn(e){const t=new Sl;return Mi.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Sl;return Mi.vt.It(Bc(this.databaseId,t),r.Yt(function(i){const o=Ai(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Sl);let i=0;for(const o of Ai(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Uc(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Mi.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Sl;l.seed(a.zt()),Mi.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof me&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Il(e),s=Lo(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return j.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(u,h){const f=h?new Vc(h.sequenceNumber,new _n(go(h.readTime),new H(rr(h.documentKey)),h.largestBatchId)):Vc.empty(),m=u.fields.map(([y,v])=>new zd(Ve.fromServerFormat(y),v));return new Vh(u.indexId,u.collectionGroup,m,f)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ae(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Il(e),i=Lo(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>j.forEach(a,l=>i.put(UE(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return j.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?j.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),j.forEach(a,l=>this.wn(e,s,l).next(c=>{const u=this.Sn(i,l);return c.isEqual(u)?j.resolve():this.bn(e,i,l,c,u)}))))})}Dn(e,t,r,s){return jo(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return jo(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=jo(e);let i=new Te(us);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Oi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Te(us);const s=this.Vn(t,e);if(s==null)return r;const i=ry(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Uc(o))for(const a of o.arrayValue.values||[])r=r.add(new Oi(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Oi(t.indexId,e.key,hd,s));return r}bn(e,t,r,s,i){$("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,u,h,f){const m=l.getIterator(),y=c.getIterator();let v=Vo(m),_=Vo(y);for(;v||_;){let x=!1,T=!1;if(v&&_){const b=u(v,_);b<0?T=!0:b>0&&(x=!0)}else v!=null?T=!0:x=!0;x?(h(_),_=Vo(y)):T?(f(v),v=Vo(m)):(v=Vo(m),_=Vo(y))}}(s,i,us,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),j.waitFor(o)}yn(e){let t=1;return Lo(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>us(o,a)).filter((o,a,l)=>!a||us(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=us(o,e),l=us(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,hd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,hd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return us(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(QE)}getMinOffset(e,t){return j.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Y())).next(QE)}}function GE(n){return ot(n,"collectionParents")}function jo(n){return ot(n,"indexEntries")}function Il(n){return ot(n,"indexConfiguration")}function Lo(n){return ot(n,"indexState")}function QE(n){Z(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;sv(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new _n(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Zt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Zt(e,Zt.DEFAULT_COLLECTION_PERCENTILE,Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DC(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(u,h,f)=>(a++,f.delete()));i.push(l.next(()=>{Z(a===1)}));const c=[];for(const u of t.mutations){const h=jI(e,u.key.path,t.batchId);i.push(s.delete(h)),c.push(u.key)}return j.waitFor(i).next(()=>c)}function Wh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Y();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zt.DEFAULT_COLLECTION_PERCENTILE=10,Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zt.DEFAULT=new Zt(41943040,Zt.DEFAULT_COLLECTION_PERCENTILE,Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zt.DISABLED=new Zt(-1,0,0);class Gf{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Z(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Gf(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ds(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ko(e),o=ds(e);return o.add({}).next(a=>{Z(typeof a=="number");const l=new dv(a,t,r,s),c=function(m,y,v){const _=v.baseMutations.map(T=>Uh(m.ct,T)),x=v.mutations.map(T=>Uh(m.ct,T));return{userId:y,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:_,mutations:x}}(this.serializer,this.userId,l),u=[];let h=new Te((f,m)=>ae(f.canonicalString(),m.canonicalString()));for(const f of s){const m=jI(this.userId,f.key.path,a);h=h.add(f.key.path.popLast()),u.push(o.put(c)),u.push(i.put(m,W4))}return h.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),j.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return ds(e).get(t).next(r=>r?(Z(r.userId===this.userId),Di(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?j.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ds(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Z(a.batchId>=r),i=Di(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ds(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ds(e).U("userMutationsIndex",t).next(r=>r.map(s=>Di(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Wd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ko(e).J({range:s},(o,a,l)=>{const[c,u,h]=o,f=rr(u);if(c===this.userId&&t.path.isEqual(f))return ds(e).get(h).next(m=>{if(!m)throw Y();Z(m.userId===this.userId),i.push(Di(this.serializer,m))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Te(ae);const s=[];return t.forEach(i=>{const o=Wd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ko(e).J({range:a},(c,u,h)=>{const[f,m,y]=c,v=rr(m);f===this.userId&&i.path.isEqual(v)?r=r.add(y):h.done()});s.push(l)}),j.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Wd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Te(ae);return Ko(e).J({range:o},(l,c,u)=>{const[h,f,m]=l,y=rr(f);h===this.userId&&r.isPrefixOf(y)?y.length===s&&(a=a.add(m)):u.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ds(e).get(i).next(o=>{if(o===null)throw Y();Z(o.userId===this.userId),r.push(Di(this.serializer,o))}))}),j.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return DC(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),j.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return j.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ko(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=rr(i[1]);s.push(l)}else a.done()}).next(()=>{Z(s.length===0)})})}containsKey(e,t){return MC(e,this.userId,t)}Nn(e){return OC(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function MC(n,e,t){const r=Wd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ko(n).J({range:i,H:!0},(a,l,c)=>{const[u,h,f]=a;u===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function ds(n){return ot(n,"mutations")}function Ko(n){return ot(n,"documentMutations")}function OC(n){return ot(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new yo(0)}static kn(){return new yo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uB{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new yo(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>te.fromTimestamp(new Le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Fo(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Z(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Fo(e).J((o,a)=>{const l=zl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>j.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Fo(e).J((r,s)=>{const i=zl(s);t(i)})}qn(e){return YE(e).get("targetGlobalKey").next(t=>(Z(t!==null),t))}Qn(e,t){return YE(e).put("targetGlobalKey",t)}Kn(e,t){return Fo(e).put(NC(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=po(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Fo(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=zl(a);gu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=bs(e);return t.forEach(o=>{const a=Wt(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),j.waitFor(s)}removeMatchingKeys(e,t,r){const s=bs(e);return j.forEach(t,i=>{const o=Wt(i.path);return j.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=bs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=bs(e);let i=de();return s.J({range:r,H:!0},(o,a,l)=>{const c=rr(o[1]),u=new H(c);i=i.add(u)}).next(()=>i)}containsKey(e,t){const r=Wt(t.path),s=IDBKeyRange.bound([r],[PI(r)],!1,!0);let i=0;return bs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Fo(e).get(t).next(r=>r?zl(r):null)}}function Fo(n){return ot(n,"targets")}function YE(n){return ot(n,"targetGlobal")}function bs(n){return ot(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XE([n,e],[t,r]){const s=ae(n,t);return s===0?ae(e,r):s}class dB{constructor(e){this.Un=e,this.buffer=new Te(XE),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();XE(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hB{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){$("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){mi(t)?$("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await So(t)}await this.Hn(3e5)})}}class fB{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return j.resolve(Cn.oe);const r=new dB(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?($("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(JE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?($("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),JE):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?($("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),zo()<=fe.DEBUG&&$("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function pB(n,e){return new fB(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mB{constructor(e,t){this.db=e,this.garbageCollector=pB(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return fd(e,r)}removeReference(e,t,r){return fd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return fd(e,t)}nr(e,t){return function(s,i){let o=!1;return OC(s).Y(a=>MC(s,a,i).next(l=>(l&&(o=!0),j.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,te.min()),bs(e).delete(function(h){return[0,Wt(h.path)]}(o))))});s.push(l)}}).next(()=>j.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return fd(e,t)}tr(e,t){const r=bs(e);let s,i=Cn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Cn.oe&&t(new H(rr(s)),i),i=c,s=l):i=Cn.oe}).next(()=>{i!==Cn.oe&&t(new H(rr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function fd(n,e){return bs(n).put(function(r,s){return{targetId:0,path:Wt(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VC{constructor(){this.changes=new gi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ze.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?j.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return bi(e).put(r)}removeEntry(e,t,r){return bi(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],$h(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=ze.newInvalidDocument(t);return bi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Cl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:ze.newInvalidDocument(t)};return bi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Cl(t))},(s,i)=>{r={document:this.ir(t,i),size:Wh(i)}}).next(()=>r)}getEntries(e,t){let r=pn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=pn(),s=new Me(H.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Wh(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return j.resolve();let s=new Te(tk);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Cl(s.first()),Cl(s.last())),o=s.getIterator();let a=o.getNext();return bi(e).J({index:"documentKeyIndex",range:i},(l,c,u)=>{const h=H.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&tk(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.$(Cl(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),$h(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return bi(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let u=pn();for(const h of c){const f=this.ir(H.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);f.isFoundDocument()&&(yu(t,f)||s.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,s){let i=pn();const o=ek(t,r),a=ek(t,_n.max());return bi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{const h=this.ir(H.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&u.done()}).next(()=>i)}newChangeBuffer(e){return new yB(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ZE(e).get("remoteDocumentGlobalKey").next(t=>(Z(!!t),t))}rr(e,t){return ZE(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=eB(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(te.min())))return r}return ze.newInvalidDocument(e)}}function jC(n){return new gB(n)}class yB extends VC{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new gi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Te((i,o)=>ae(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=FE(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Wh(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=FE(this.cr.serializer,o.convertToNoDocument(te.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),j.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function ZE(n){return ot(n,"remoteDocumentGlobal")}function bi(n){return ot(n,"remoteDocumentsV14")}function Cl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ek(n,e){const t=e.documentKey.path.toArray();return[n,$h(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function tk(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=ae(t[i],r[i]),s)return s;return s=ae(t.length,r.length),s||(s=ae(t[t.length-2],r[r.length-2]),s||ae(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vB{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&lc(r.mutation,s,nn.empty(),Le.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,de()).next(()=>r))}getLocalViewOfDocuments(e,t,r=de()){const s=sr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Ul();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=sr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,de()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=pn();const o=ac(),a=function(){return ac()}();return t.forEach((l,c)=>{const u=r.get(c.key);s.has(c.key)&&(u===void 0||u.mutation instanceof rs)?i=i.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),lc(u.mutation,c,u.mutation.getFieldMask(),Le.now())):o.set(c.key,nn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var h;return a.set(c,new vB(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ac();let s=new Me((o,a)=>o-a),i=de();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let u=r.get(l)||nn.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(s.get(a.batchId)||de()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=sC();u.forEach(f=>{if(!i.has(f)){const m=dC(t.get(f),r.get(f));m!==null&&h.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return j.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return H.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ZI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):j.resolve(sr());let a=-1,l=i;return o.next(c=>j.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(u)?j.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,de())).next(u=>({batchId:a,changes:rC(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(r=>{let s=Ul();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Ul();return this.indexManager.getCollectionParents(e,i).next(a=>j.forEach(a,l=>{const c=function(h,f){return new el(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(u=>{u.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,ze.newInvalidDocument(u)))});let a=Ul();return o.forEach((l,c)=>{const u=i.get(l);u!==void 0&&lc(u.mutation,c,nn.empty(),Le.now()),yu(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wB{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return j.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:qt(s.createTime)}}(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:AC(s.bundledQuery),readTime:qt(s.readTime)}}(t)),j.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _B{constructor(){this.overlays=new Me(H.comparator),this.Ir=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const r=sr();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),j.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),j.resolve()}getOverlaysForCollection(e,t,r){const s=sr(),i=t.length+1,o=new H(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return j.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Me((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let u=i.get(c.largestBatchId);u===null&&(u=sr(),i=i.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=sr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=s)););return j.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new fv(t,r));let i=this.Ir.get(t);i===void 0&&(i=de(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xB{constructor(){this.sessionToken=et.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(){this.Tr=new Te(at.Er),this.dr=new Te(at.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new at(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new at(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new H(new _e([])),r=new at(t,e),s=new at(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new H(new _e([])),r=new at(t,e),s=new at(t,e+1);let i=de();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new at(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class at{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return H.comparator(e.key,t.key)||ae(e.wr,t.wr)}static Ar(e,t){return ae(e.wr,t.wr)||H.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Te(at.Er)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new dv(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new at(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return j.resolve(o)}lookupMutationBatch(e,t){return j.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return j.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new at(t,0),s=new at(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),j.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Te(ae);return t.forEach(s=>{const i=new at(s,0),o=new at(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),j.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;H.isDocumentKey(i)||(i=i.child(""));const o=new at(new H(i),0);let a=new Te(ae);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),j.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Z(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return j.forEach(t.mutations,s=>{const i=new at(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new at(t,0),s=this.br.firstAfterOrEqual(r);return j.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kB{constructor(e){this.Mr=e,this.docs=function(){return new Me(H.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return j.resolve(r?r.document.mutableCopy():ze.newInvalidDocument(t))}getEntries(e,t){let r=pn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ze.newInvalidDocument(s))}),j.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=pn();const o=t.path,a=new H(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||sv(DI(u),r)<=0||(s.has(u.key)||yu(t,u))&&(i=i.insert(u.key,u.mutableCopy()))}return j.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Y()}Or(e,t){return j.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new TB(this)}getSize(e){return j.resolve(this.size)}}class TB extends VC{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),j.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bB{constructor(e){this.persistence=e,this.Nr=new gi(t=>po(t),gu),this.lastRemoteSnapshotVersion=te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new vv,this.targetCount=0,this.kr=yo.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),j.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new yo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.Kn(t),j.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),j.waitFor(i).next(()=>s)}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return j.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),j.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),j.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return j.resolve(r)}containsKey(e,t){return j.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Cn(0),this.Kr=!1,this.Kr=!0,this.$r=new xB,this.referenceDelegate=e(this),this.Ur=new bB(this),this.indexManager=new lB,this.remoteDocumentCache=function(s){return new kB(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new CC(t),this.Gr=new wB(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _B,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new EB(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){$("MemoryPersistence","Starting transaction:",e);const s=new SB(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return j.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class SB extends OI{constructor(e){super(),this.currentSequenceNumber=e}}class Qf{constructor(e){this.persistence=e,this.Jr=new vv,this.Yr=null}static Zr(e){return new Qf(e)}get Xr(){if(this.Yr)return this.Yr;throw Y()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),j.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),j.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.Xr,r=>{const s=H.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return j.or([()=>j.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IB{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Lf("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",mE,{unique:!0}),l.createObjectStore("documentMutations")}(e),nk(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=j.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),nk(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),u={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:te.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",u)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(u=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",mE,{unique:!0});const h=c.store("mutations"),f=u.map(m=>h.put(m));return j.waitFor(f)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:nF});c.createIndex("collectionPathOverlayIndex",rF,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",sF,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:q4});c.createIndex("documentKeyIndex",H4),c.createIndex("collectionGroupIndex",K4)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:X4}).createIndex("sequenceNumberIndex",Z4,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:eF}).createIndex("documentKeyIndex",tF,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Wh(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>j.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>j.forEach(a,l=>{Z(l.userId===i.userId);const c=Di(this.serializer,l);return DC(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new _e(o),c=function(h){return[0,Wt(h)]}(l);i.push(t.get(c).next(u=>u?j.resolve():(h=>t.put({targetId:0,path:Wt(h),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>j.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Y4});const r=t.store("collectionParents"),s=new yv,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Wt(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new _e(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const u=rr(a);return i(u.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=zl(s),o=NC(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(h){return h.document?new H(_e.fromString(h.document.name).popFirst(5)):h.noDocument?H.fromSegments(h.noDocument.path):h.unknownDocument?H.fromSegments(h.unknownDocument.path):Y()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>j.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=jC(this.serializer),i=new FC(Qf.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:de();Di(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),j.forEach(a,(l,c)=>{const u=new yt(c),h=Kf.lt(this.serializer,u),f=i.getIndexManager(u),m=Gf.lt(u,this.serializer,f,i.referenceDelegate);return new LC(s,m,h,f).recalculateAndSaveOverlaysForDocumentKeys(new sy(t,Cn.oe),l).next()})})}}function nk(n){n.createObjectStore("targetDocuments",{keyPath:Q4}).createIndex("documentTargetsIndex",J4,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",G4,{unique:!0}),n.createObjectStore("targetGlobal")}const km="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class wv{constructor(e,t,r,s,i,o,a,l,c,u,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=u,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=f=>Promise.resolve(),!wv.D())throw new q(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new mB(this,s),this.Ai=t+"main",this.serializer=new CC(l),this.Ri=new qs(this.Ai,this.hi,new IB(this.serializer)),this.$r=new nB,this.Ur=new uB(this.referenceDelegate,this.serializer),this.remoteDocumentCache=jC(this.serializer),this.Gr=new tB,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,u===!1&&Ut("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new q(F.FAILED_PRECONDITION,km);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Cn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>pd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(mi(e))return $("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return $("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Nl(e).get("owner").next(t=>j.resolve(this.vi(t)))}Ci(e){return pd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=ot(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return j.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?j.resolve(!0):Nl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new q(F.FAILED_PRECONDITION,km);return!1}}return!(!this.networkEnabled||!this.inForeground)||pd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&$("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new sy(e,Cn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>pd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Gf.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new cB(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Kf.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){$("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?aF:l===16?oF:l===15?ov:l===14?BI:l===13?FI:l===12?iF:l===11?LI:void Y()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new sy(a,this.Qr?this.Qr.next():Cn.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Ut(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new q(F.FAILED_PRECONDITION,MI);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Nl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new q(F.FAILED_PRECONDITION,km)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Nl(e).put("owner",t)}static D(){return qs.D()}bi(e){const t=Nl(e);return t.get("owner").next(r=>this.vi(r)?($("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):j.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Ut(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;jS()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return $("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ut("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Ut("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Nl(n){return ot(n,"owner")}function pd(n){return ot(n,"clientMetadata")}function CB(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=de(),s=de();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new _v(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NB{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return jS()?8:VI(st())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new NB;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(zo()<=fe.DEBUG&&$("QueryEngine","SDK will not create cache indexes for query:",Wo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),j.resolve()):(zo()<=fe.DEBUG&&$("QueryEngine","Query:",Wo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(zo()<=fe.DEBUG&&$("QueryEngine","The SDK decides to create cache indexes for query:",Wo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Rn(t))):j.resolve())}Yi(e,t){if(CE(t))return j.resolve(null);let r=Rn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Fh(t,null,"F"),r=Rn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=de(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Fh(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return CE(t)||s.isEqual(te.min())?j.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?j.resolve(null):(zo()<=fe.DEBUG&&$("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Wo(t)),this.rs(e,o,t,j4(s,-1)).next(a=>a))})}ts(e,t){let r=new Te(tC(e));return t.forEach((s,i)=>{yu(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return zo()<=fe.DEBUG&&$("QueryEngine","Using full collection scan to execute query:",Wo(t)),this.Ji.getDocumentsMatchingQuery(e,t,_n.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AB{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Me(ae),this._s=new gi(i=>po(i),gu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LC(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function UC(n,e,t,r){return new AB(n,e,t,r)}async function $C(n,e){const t=ie(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=de();for(const c of s){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of i){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function RB(n,e){const t=ie(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const h=c.batch,f=h.keys();let m=j.resolve();return f.forEach(y=>{m=m.next(()=>u.getEntry(l,y)).next(v=>{const _=c.docVersions.get(y);Z(_!==null),v.version.compareTo(_)<0&&(h.applyToRemoteDocument(v,c),v.isValidDocument()&&(v.setReadTime(c.commitVersion),u.addEntry(v)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=de();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function zC(n){const e=ie(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function PB(n,e){const t=ie(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((u,h)=>{const f=s.get(h);if(!f)return;a.push(t.Ur.removeMatchingKeys(i,u.removedDocuments,h).next(()=>t.Ur.addMatchingKeys(i,u.addedDocuments,h)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(et.EMPTY_BYTE_STRING,te.min()).withLastLimboFreeSnapshotVersion(te.min()):u.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(u.resumeToken,r)),s=s.insert(h,m),function(v,_,x){return v.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(f,m,u)&&a.push(t.Ur.updateTargetData(i,m))});let l=pn(),c=de();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(DB(i,o,e.documentUpdates).next(u=>{l=u.Ps,c=u.Is})),!r.isEqual(te.min())){const u=t.Ur.getLastRemoteSnapshotVersion(i).next(h=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(u)}return j.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function DB(n,e,t){let r=de(),s=de();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=pn();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(te.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):$("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function MB(n,e){const t=ie(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function OB(n,e){const t=ie(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,j.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Or(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function vy(n,e,t){const r=ie(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!mi(o))throw o;$("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function rk(n,e,t){const r=ie(n);let s=te.min(),i=de();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const h=ie(l),f=h._s.get(u);return f!==void 0?j.resolve(h.os.get(f)):h.Ur.getTargetData(c,u)}(r,o,Rn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:te.min(),t?i:de())).next(a=>(VB(r,EF(e),a),{documents:a,Ts:i})))}function VB(n,e,t){let r=n.us.get(e)||te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}class sk{constructor(){this.activeTargetIds=CF()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class WC{constructor(){this.so=new sk,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new sk,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jB{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){$("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){$("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let md=null;function Tm(){return md===null?md=function(){return 268435456+Math.round(2147483648*Math.random())}():md++,"0x"+md.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LB={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FB{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="WebChannelConnection";class BB extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Tm(),l=this.xo(t,r.toUriEncodedString());$("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(u=>($("RestConnection",`Received RPC '${t}' ${a}: `,u),u),u=>{throw uo("RestConnection",`RPC '${t}' ${a} failed with error: `,u,"url: ",l,"request:",s),u})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Za}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=LB[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Tm();return new Promise((o,a)=>{const l=new bI;l.setWithCredentials(!0),l.listenOnce(SI.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case $d.NO_ERROR:const u=l.getResponseJson();$(Nt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(u)),o(u);break;case $d.TIMEOUT:$(Nt,`RPC '${e}' ${i} timed out`),a(new q(F.DEADLINE_EXCEEDED,"Request time out"));break;case $d.HTTP_ERROR:const h=l.getStatus();if($(Nt,`RPC '${e}' ${i} failed with status:`,h,"response text:",l.getResponseText()),h>0){let f=l.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const y=function(_){const x=_.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(x)>=0?x:F.UNKNOWN}(m.status);a(new q(y,m.message))}else a(new q(F.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new q(F.UNAVAILABLE,"Connection failed."));break;default:Y()}}finally{$(Nt,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);$(Nt,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Tm(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=NI(),a=CI(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const u=i.join("");$(Nt,`Creating RPC '${e}' stream ${s}: ${u}`,l);const h=o.createWebChannel(u,l);let f=!1,m=!1;const y=new FB({Io:_=>{m?$(Nt,`Not sending because RPC '${e}' stream ${s} is closed:`,_):(f||($(Nt,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),$(Nt,`RPC '${e}' stream ${s} sending:`,_),h.send(_))},To:()=>h.close()}),v=(_,x,T)=>{_.listen(x,b=>{try{T(b)}catch(N){setTimeout(()=>{throw N},0)}})};return v(h,Bl.EventType.OPEN,()=>{m||($(Nt,`RPC '${e}' stream ${s} transport opened.`),y.yo())}),v(h,Bl.EventType.CLOSE,()=>{m||(m=!0,$(Nt,`RPC '${e}' stream ${s} transport closed`),y.So())}),v(h,Bl.EventType.ERROR,_=>{m||(m=!0,uo(Nt,`RPC '${e}' stream ${s} transport errored:`,_),y.So(new q(F.UNAVAILABLE,"The operation could not be completed")))}),v(h,Bl.EventType.MESSAGE,_=>{var x;if(!m){const T=_.data[0];Z(!!T);const b=T,N=b.error||((x=b[0])===null||x===void 0?void 0:x.error);if(N){$(Nt,`RPC '${e}' stream ${s} received error:`,N);const R=N.status;let P=function(S){const C=Qe[S];if(C!==void 0)return pC(C)}(R),k=N.message;P===void 0&&(P=F.INTERNAL,k="Unknown error status: "+R+" with message "+N.message),m=!0,y.So(new q(P,k)),h.close()}else $(Nt,`RPC '${e}' stream ${s} received:`,T),y.bo(T)}}),v(a,II.STAT_EVENT,_=>{_.stat===ny.PROXY?$(Nt,`RPC '${e}' stream ${s} detected buffering proxy`):_.stat===ny.NOPROXY&&$(Nt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.wo()},0),y}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UB(){return typeof window<"u"?window:null}function Qd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jf(n){return new WF(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&$("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new qC(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(Ut(t.toString()),Ut("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new q(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return $("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():($("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $B extends HC{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=KF(this.serializer,e),r=function(i){if(!("targetChange"in i))return te.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?te.min():o.readTime?qt(o.readTime):te.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=fy(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=jh(l)?{documents:EC(i,l)}:{query:kC(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=yC(i,o.resumeToken);const c=dy(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(te.min())>0){a.readTime=La(i,o.snapshotVersion.toTimestamp());const c=dy(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=QF(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=fy(this.serializer),t.removeTarget=e,this.a_(t)}}class zB extends HC{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Z(!!e.streamToken),this.lastStreamToken=e.streamToken,Z(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=GF(e.writeResults,e.commitTime),r=qt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=fy(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Uh(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WB extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new q(F.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,hy(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new q(F.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,hy(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(F.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class qB{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ut(t),this.D_=!1):$("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HB{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Co(this)&&($("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=ie(l);c.L_.add(4),await wu(c),c.q_.set("Unknown"),c.L_.delete(4),await Yf(c)}(this))})}),this.q_=new qB(r,s)}}async function Yf(n){if(Co(n))for(const e of n.B_)await e(!0)}async function wu(n){for(const e of n.B_)await e(!1)}function KC(n,e){const t=ie(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Tv(t)?kv(t):nl(t).r_()&&Ev(t,e))}function xv(n,e){const t=ie(n),r=nl(t);t.N_.delete(e),r.r_()&&GC(t,e),t.N_.size===0&&(r.r_()?r.o_():Co(t)&&t.q_.set("Unknown"))}function Ev(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}nl(n).A_(e)}function GC(n,e){n.Q_.xe(e),nl(n).R_(e)}function kv(n){n.Q_=new BF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),nl(n).start(),n.q_.v_()}function Tv(n){return Co(n)&&!nl(n).n_()&&n.N_.size>0}function Co(n){return ie(n).L_.size===0}function QC(n){n.Q_=void 0}async function KB(n){n.q_.set("Online")}async function GB(n){n.N_.forEach((e,t)=>{Ev(n,e)})}async function QB(n,e){QC(n),Tv(n)?(n.q_.M_(e),kv(n)):n.q_.set("Unknown")}async function JB(n,e,t){if(n.q_.set("Online"),e instanceof gC&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){$("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await qh(n,r)}else if(e instanceof Gd?n.Q_.Ke(e):e instanceof mC?n.Q_.He(e):n.Q_.We(e),!t.isEqual(te.min()))try{const r=await zC(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=i.N_.get(c);u&&i.N_.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=i.N_.get(l);if(!u)return;i.N_.set(l,u.withResumeToken(et.EMPTY_BYTE_STRING,u.snapshotVersion)),GC(i,l);const h=new Or(u.target,l,c,u.sequenceNumber);Ev(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){$("RemoteStore","Failed to raise snapshot:",r),await qh(n,r)}}async function qh(n,e,t){if(!mi(e))throw e;n.L_.add(1),await wu(n),n.q_.set("Offline"),t||(t=()=>zC(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{$("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Yf(n)})}function JC(n,e){return e().catch(t=>qh(n,t,e))}async function _u(n){const e=ie(n),t=si(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;YB(e);)try{const s=await MB(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,XB(e,s)}catch(s){await qh(e,s)}YC(e)&&XC(e)}function YB(n){return Co(n)&&n.O_.length<10}function XB(n,e){n.O_.push(e);const t=si(n);t.r_()&&t.V_&&t.m_(e.mutations)}function YC(n){return Co(n)&&!si(n).n_()&&n.O_.length>0}function XC(n){si(n).start()}async function ZB(n){si(n).p_()}async function e3(n){const e=si(n);for(const t of n.O_)e.m_(t.mutations)}async function t3(n,e,t){const r=n.O_.shift(),s=hv.from(r,e,t);await JC(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await _u(n)}async function n3(n,e){e&&si(n).V_&&await async function(r,s){if(function(o){return jF(o)&&o!==F.ABORTED}(s.code)){const i=r.O_.shift();si(r).s_(),await JC(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await _u(r)}}(n,e),YC(n)&&XC(n)}async function ok(n,e){const t=ie(n);t.asyncQueue.verifyOperationInProgress(),$("RemoteStore","RemoteStore received new credentials");const r=Co(t);t.L_.add(3),await wu(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Yf(t)}async function r3(n,e){const t=ie(n);e?(t.L_.delete(2),await Yf(t)):e||(t.L_.add(2),await wu(t),t.q_.set("Unknown"))}function nl(n){return n.K_||(n.K_=function(t,r,s){const i=ie(t);return i.w_(),new $B(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:KB.bind(null,n),Ro:GB.bind(null,n),mo:QB.bind(null,n),d_:JB.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Tv(n)?kv(n):n.q_.set("Unknown")):(await n.K_.stop(),QC(n))})),n.K_}function si(n){return n.U_||(n.U_=function(t,r,s){const i=ie(t);return i.w_(),new zB(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ZB.bind(null,n),mo:n3.bind(null,n),f_:e3.bind(null,n),g_:t3.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await _u(n)):(await n.U_.stop(),n.O_.length>0&&($("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new dr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new bv(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Sv(n,e){if(Ut("AsyncQueue",`${e}: ${n}`),mi(n))return new q(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||H.comparator(t.key,r.key):(t,r)=>H.comparator(t.key,r.key),this.keyedMap=Ul(),this.sortedSet=new Me(this.comparator)}static emptySet(e){return new xa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new xa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(){this.W_=new Me(H.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Y():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Fa{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Fa(e,t,xa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&$f(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class i3{constructor(){this.queries=lk(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=ie(t),i=s.queries;s.queries=lk(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new q(F.ABORTED,"Firestore shutting down"))}}function lk(){return new gi(n=>eC(n),$f)}async function ZC(n,e){const t=ie(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new s3,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Sv(o,`Initialization of query '${Wo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Iv(t)}async function eN(n,e){const t=ie(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function o3(n,e){const t=ie(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Iv(t)}function a3(n,e,t){const r=ie(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Iv(n){n.Y_.forEach(e=>{e.next()})}var wy,ck;(ck=wy||(wy={})).ea="default",ck.Cache="cache";class tN{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Fa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Fa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==wy.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(e){this.key=e}}class rN{constructor(e){this.key=e}}class l3{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=de(),this.mutatedKeys=de(),this.Aa=tC(e),this.Ra=new xa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new ak,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,h)=>{const f=s.get(u),m=yu(this.query,h)?h:null,y=!!f&&this.mutatedKeys.has(f.key),v=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let _=!1;f&&m?f.data.isEqual(m.data)?y!==v&&(r.track({type:3,doc:m}),_=!0):this.ga(f,m)||(r.track({type:2,doc:m}),_=!0,(l&&this.Aa(m,l)>0||c&&this.Aa(m,c)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),_=!0):f&&!m&&(r.track({type:1,doc:f}),_=!0,(l||c)&&(a=!0)),_&&(m?(o=o.add(m),i=v?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),r.track({type:1,doc:u})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((u,h)=>function(m,y){const v=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y()}};return v(m)-v(y)}(u.type,h.type)||this.Aa(u.doc,h.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Fa(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ak,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=de(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new rN(r))}),this.da.forEach(r=>{e.has(r)||t.push(new nN(r))}),t}ba(e){this.Ta=e.Ts,this.da=de();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Fa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class c3{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class u3{constructor(e){this.key=e,this.va=!1}}class d3{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new gi(a=>eC(a),$f),this.Ma=new Map,this.xa=new Set,this.Oa=new Me(H.comparator),this.Na=new Map,this.La=new vv,this.Ba={},this.ka=new Map,this.qa=yo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function h3(n,e,t=!0){const r=cN(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await sN(r,e,t,!0),s}async function f3(n,e){const t=cN(n);await sN(t,e,!0,!1)}async function sN(n,e,t,r){const s=await OB(n.localStore,Rn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await p3(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&KC(n.remoteStore,s),a}async function p3(n,e,t,r,s){n.Ka=(h,f,m)=>async function(v,_,x,T){let b=_.view.ma(x);b.ns&&(b=await rk(v.localStore,_.query,!1).then(({documents:k})=>_.view.ma(k,b)));const N=T&&T.targetChanges.get(_.targetId),R=T&&T.targetMismatches.get(_.targetId)!=null,P=_.view.applyChanges(b,v.isPrimaryClient,N,R);return dk(v,_.targetId,P.wa),P.snapshot}(n,h,f,m);const i=await rk(n.localStore,e,!0),o=new l3(e,i.Ts),a=o.ma(i.documents),l=vu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);dk(n,t,c.wa);const u=new c3(e,t,o);return n.Fa.set(e,u),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function m3(n,e,t){const r=ie(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!$f(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await vy(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&xv(r.remoteStore,s.targetId),_y(r,s.targetId)}).catch(So)):(_y(r,s.targetId),await vy(r.localStore,s.targetId,!0))}async function g3(n,e){const t=ie(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),xv(t.remoteStore,r.targetId))}async function y3(n,e,t){const r=uN(n);try{const s=await function(o,a){const l=ie(o),c=Le.now(),u=a.reduce((m,y)=>m.add(y.key),de());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let y=pn(),v=de();return l.cs.getEntries(m,u).next(_=>{y=_,y.forEach((x,T)=>{T.isValidDocument()||(v=v.add(x))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,y)).next(_=>{h=_;const x=[];for(const T of a){const b=OF(T,h.get(T.key).overlayedDocument);b!=null&&x.push(new rs(T.key,b,qI(b.value.mapValue),$t.exists(!0)))}return l.mutationQueue.addMutationBatch(m,c,x,a)}).next(_=>{f=_;const x=_.applyToLocalDocumentSet(h,v);return l.documentOverlayCache.saveOverlays(m,_.batchId,x)})}).then(()=>({batchId:f.batchId,changes:rC(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Me(ae)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await xu(r,s.changes),await _u(r.remoteStore)}catch(s){const i=Sv(s,"Failed to persist write");t.reject(i)}}async function iN(n,e){const t=ie(n);try{const r=await PB(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Z(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Z(o.va):s.removedDocuments.size>0&&(Z(o.va),o.va=!1))}),await xu(t,r,e)}catch(r){await So(r)}}function uk(n,e,t){const r=ie(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ie(o);l.onlineState=a;let c=!1;l.queries.forEach((u,h)=>{for(const f of h.j_)f.Z_(a)&&(c=!0)}),c&&Iv(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function v3(n,e,t){const r=ie(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Me(H.comparator);o=o.insert(i,ze.newNoDocument(i,te.min()));const a=de().add(i),l=new Hf(te.min(),new Map,new Me(ae),o,a);await iN(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Cv(r)}else await vy(r.localStore,e,!1).then(()=>_y(r,e,t)).catch(So)}async function w3(n,e){const t=ie(n),r=e.batch.batchId;try{const s=await RB(t.localStore,e);aN(t,r,null),oN(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await xu(t,s)}catch(s){await So(s)}}async function _3(n,e,t){const r=ie(n);try{const s=await function(o,a){const l=ie(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(Z(h!==null),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(r.localStore,e);aN(r,e,t),oN(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await xu(r,s)}catch(s){await So(s)}}function oN(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function aN(n,e,t){const r=ie(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function _y(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||lN(n,r)})}function lN(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(xv(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Cv(n))}function dk(n,e,t){for(const r of t)r instanceof nN?(n.La.addReference(r.key,e),x3(n,r)):r instanceof rN?($("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||lN(n,r.key)):Y()}function x3(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||($("SyncEngine","New document in limbo: "+t),n.xa.add(r),Cv(n))}function Cv(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new H(_e.fromString(e)),r=n.qa.next();n.Na.set(r,new u3(t)),n.Oa=n.Oa.insert(t,r),KC(n.remoteStore,new Or(Rn(Uf(t.path)),r,"TargetPurposeLimboResolution",Cn.oe))}}async function xu(n,e,t){const r=ie(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){const h=c?!c.fromCache:(u=t==null?void 0:t.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){s.push(c);const h=_v.Wi(l.targetId,c);i.push(h)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const u=ie(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>j.forEach(c,f=>j.forEach(f.$i,m=>u.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>j.forEach(f.Ui,m=>u.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!mi(h))throw h;$("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const f=h.targetId;if(!h.fromCache){const m=u.os.get(f),y=m.snapshotVersion,v=m.withLastLimboFreeSnapshotVersion(y);u.os=u.os.insert(f,v)}}}(r.localStore,i))}async function E3(n,e){const t=ie(n);if(!t.currentUser.isEqual(e)){$("SyncEngine","User change. New user:",e.toKey());const r=await $C(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new q(F.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await xu(t,r.hs)}}function k3(n,e){const t=ie(n),r=t.Na.get(e);if(r&&r.va)return de().add(r.key);{let s=de();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}function cN(n){const e=ie(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=iN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=k3.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=v3.bind(null,e),e.Ca.d_=o3.bind(null,e.eventManager),e.Ca.$a=a3.bind(null,e.eventManager),e}function uN(n){const e=ie(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=w3.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_3.bind(null,e),e}class Wc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Jf(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return UC(this.persistence,new BC,e.initialUser,this.serializer)}Ga(e){return new FC(Qf.Zr,this.serializer)}Wa(e){return new WC}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Wc.provider={build:()=>new Wc};class T3 extends Wc{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await uN(this.Ja.syncEngine),await _u(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return UC(this.persistence,new BC,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new hB(r,e.asyncQueue,t)}Ha(e,t){const r=new U4(t,this.persistence);return new B4(e.asyncQueue,r)}Ga(e){const t=CB(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Zt.withCacheSize(this.cacheSizeBytes):Zt.DEFAULT;return new wv(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,UB(),Qd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new WC}}class Hh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>uk(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=E3.bind(null,this.syncEngine),await r3(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new i3}()}createDatastore(e){const t=Jf(e.databaseInfo.databaseId),r=function(i){return new BB(i)}(e.databaseInfo);return function(i,o,a,l){return new WB(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new HB(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>uk(this.syncEngine,t,0),function(){return ik.D()?new ik:new jB}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,u){const h=new d3(s,i,o,a,l,c);return u&&(h.Qa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ie(s);$("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await wu(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Hh.provider={build:()=>new Hh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Ut("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=yt.UNAUTHENTICATED,this.clientId=RI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{$("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>($("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new dr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Sv(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function bm(n,e){n.asyncQueue.verifyOperationInProgress(),$("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await $C(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function hk(n,e){n.asyncQueue.verifyOperationInProgress();const t=await S3(n);$("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>ok(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>ok(e.remoteStore,s)),n._onlineComponents=e}async function S3(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){$("FirestoreClient","Using user provided OfflineComponentProvider");try{await bm(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;uo("Error using user provided cache. Falling back to memory cache: "+t),await bm(n,new Wc)}}else $("FirestoreClient","Using default OfflineComponentProvider"),await bm(n,new Wc);return n._offlineComponents}async function hN(n){return n._onlineComponents||(n._uninitializedComponentsProvider?($("FirestoreClient","Using user provided OnlineComponentProvider"),await hk(n,n._uninitializedComponentsProvider._online)):($("FirestoreClient","Using default OnlineComponentProvider"),await hk(n,new Hh))),n._onlineComponents}function I3(n){return hN(n).then(e=>e.syncEngine)}async function fN(n){const e=await hN(n),t=e.eventManager;return t.onListen=h3.bind(null,e.syncEngine),t.onUnlisten=m3.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=f3.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=g3.bind(null,e.syncEngine),t}function C3(n,e,t={}){const r=new dr;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new dN({next:f=>{u.Za(),o.enqueueAndForget(()=>eN(i,h));const m=f.docs.has(a);!m&&f.fromCache?c.reject(new q(F.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?c.reject(new q(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new tN(Uf(a.path),u,{includeMetadataChanges:!0,_a:!0});return ZC(i,h)}(await fN(n),n.asyncQueue,e,t,r)),r.promise}function N3(n,e,t={}){const r=new dr;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new dN({next:f=>{u.Za(),o.enqueueAndForget(()=>eN(i,h)),f.fromCache&&l.source==="server"?c.reject(new q(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new tN(a,u,{includeMetadataChanges:!0,_a:!0});return ZC(i,h)}(await fN(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pN(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mN(n,e,t){if(!t)throw new q(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function A3(n,e,t,r){if(e===!0&&r===!0)throw new q(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pk(n){if(!H.isDocumentKey(n))throw new q(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mk(n){if(H.isDocumentKey(n))throw new q(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Xf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Y()}function Gn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xf(n);throw new q(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function R3(n,e){if(e<=0)throw new q(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new q(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new q(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}A3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pN((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new q(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new q(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new q(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Zf{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gk({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gk(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new C4;switch(r.type){case"firstParty":return new P4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new q(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=fk.get(t);r&&($("ComponentProvider","Removing Datastore"),fk.delete(t),r.terminate())}(this),Promise.resolve()}}function P3(n,e,t,r={}){var s;const i=(n=Gn(n,Zf))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&uo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=yt.MOCK_USER;else{a=VS(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new q(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new yt(c)}n._authCredentials=new N4(new AI(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yi(this.firestore,e,this._query)}}class Ht{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Hs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ht(this.firestore,e,this._key)}}class Hs extends yi{constructor(e,t,r){super(e,t,Uf(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ht(this.firestore,null,new H(e))}withConverter(e){return new Hs(this.firestore,e,this._path)}}function Fr(n,e,...t){if(n=it(n),mN("collection","path",e),n instanceof Zf){const r=_e.fromString(e,...t);return mk(r),new Hs(n,null,r)}{if(!(n instanceof Ht||n instanceof Hs))throw new q(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(_e.fromString(e,...t));return mk(r),new Hs(n.firestore,null,r)}}function Nn(n,e,...t){if(n=it(n),arguments.length===1&&(e=RI.newId()),mN("doc","path",e),n instanceof Zf){const r=_e.fromString(e,...t);return pk(r),new Ht(n,null,new H(r))}{if(!(n instanceof Ht||n instanceof Hs))throw new q(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(_e.fromString(e,...t));return pk(r),new Ht(n.firestore,n instanceof Hs?n.converter:null,new H(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new qC(this,"async_queue_retry"),this.Vu=()=>{const r=Qd();r&&$("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Qd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Qd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new dr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!mi(e))throw e;$("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Ut("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=bv.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Y()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class No extends Zf{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new yk,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yk(e),this._firestoreClient=void 0,await e}}}function D3(n,e){const t=typeof n=="object"?n:K0(),r=typeof n=="string"?n:"(default)",s=Mf(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=DS("firestore");i&&P3(s,...i)}return s}function Nv(n){if(n._terminated)throw new q(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||gN(n),n._firestoreClient}function gN(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,u){return new cF(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,pN(u.experimentalLongPollingOptions),u.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new b3(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function M3(n,e){uo("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return O3(n,Hh.provider,{build:r=>new T3(r,t.cacheSizeBytes,void 0)}),Promise.resolve()}function O3(n,e,t){if((n=Gn(n,No))._firestoreClient||n._terminated)throw new q(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new q(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},gN(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ba(et.fromBase64String(e))}catch(t){throw new q(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ba(et.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ve(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ae(this._lat,e._lat)||ae(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V3=/^__.*__$/;class j3{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new rs(e,this.data,this.fieldMask,t,this.fieldTransforms):new tl(e,this.data,t,this.fieldTransforms)}}class yN{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new rs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vN(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y()}}class Pv{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Pv(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Kh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(vN(this.Cu)&&V3.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class L3{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Jf(e)}Qu(e,t,r,s=!1){return new Pv({Cu:e,methodName:t,qu:r,path:Ve.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Dv(n){const e=n._freezeSettings(),t=Jf(n._databaseId);return new L3(n._databaseId,!!e.ignoreUndefinedProperties,t)}function F3(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Ov("Data must be an object, but it was:",o,r);const a=wN(r,o);let l,c;if(i.merge)l=new nn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const u=[];for(const h of i.mergeFields){const f=xy(e,h,t);if(!o.contains(f))throw new q(F.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);xN(u,f)||u.push(f)}l=new nn(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new j3(new Pt(a),l,c)}class np extends tp{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof np}}class Mv extends tp{_toFieldTransform(e){return new uC(e.path,new Oa)}isEqual(e){return e instanceof Mv}}function B3(n,e,t,r){const s=n.Qu(1,e,t);Ov("Data must be an object, but it was:",s,r);const i=[],o=Pt.empty();Io(r,(l,c)=>{const u=Vv(e,l,t);c=it(c);const h=s.Nu(u);if(c instanceof np)i.push(u);else{const f=Eu(c,h);f!=null&&(i.push(u),o.set(u,f))}});const a=new nn(i);return new yN(o,a,s.fieldTransforms)}function U3(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[xy(e,r,t)],l=[s];if(i.length%2!=0)throw new q(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(xy(e,i[f])),l.push(i[f+1]);const c=[],u=Pt.empty();for(let f=a.length-1;f>=0;--f)if(!xN(c,a[f])){const m=a[f];let y=l[f];y=it(y);const v=o.Nu(m);if(y instanceof np)c.push(m);else{const _=Eu(y,v);_!=null&&(c.push(m),u.set(m,_))}}const h=new nn(c);return new yN(u,h,o.fieldTransforms)}function $3(n,e,t,r=!1){return Eu(t,n.Qu(r?4:3,e))}function Eu(n,e){if(_N(n=it(n)))return Ov("Unsupported field value:",e,n),wN(n,e);if(n instanceof tp)return function(r,s){if(!vN(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Eu(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=it(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return NF(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Le.fromDate(r);return{timestampValue:La(s.serializer,i)}}if(r instanceof Le){const i=new Le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:La(s.serializer,i)}}if(r instanceof Av)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ba)return{bytesValue:yC(s.serializer,r._byteString)};if(r instanceof Ht){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:mv(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Rv)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return uv(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Xf(r)}`)}(n,e)}function wN(n,e){const t={};return UI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Io(n,(r,s)=>{const i=Eu(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function _N(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Le||n instanceof Av||n instanceof Ba||n instanceof Ht||n instanceof tp||n instanceof Rv)}function Ov(n,e,t){if(!_N(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Xf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function xy(n,e,t){if((e=it(e))instanceof ep)return e._internalPath;if(typeof e=="string")return Vv(n,e);throw Kh("Field path arguments must be of type string or ",n,!1,void 0,t)}const z3=new RegExp("[~\\*/\\[\\]]");function Vv(n,e,t){if(e.search(z3)>=0)throw Kh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ep(...e.split("."))._internalPath}catch{throw Kh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Kh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new q(F.INVALID_ARGUMENT,a+n+l)}function xN(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ht(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new W3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(rp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class W3 extends EN{data(){return super.data()}}function rp(n,e){return typeof e=="string"?Vv(n,e):e instanceof ep?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q3(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jv{}class Lv extends jv{}function Br(n,e,...t){let r=[];e instanceof jv&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Fv).length,a=i.filter(l=>l instanceof sp).length;if(o>1||o>0&&a>0)throw new q(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class sp extends Lv{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new sp(e,t,r)}_apply(e){const t=this._parse(e);return kN(e._query,t),new yi(e.firestore,e.converter,uy(e._query,t))}_parse(e){const t=Dv(e.firestore);return function(i,o,a,l,c,u,h){let f;if(c.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new q(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){_k(h,u);const m=[];for(const y of h)m.push(wk(l,i,y));f={arrayValue:{values:m}}}else f=wk(l,i,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||_k(h,u),f=$3(a,o,h,u==="in"||u==="not-in");return me.create(c,u,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function mn(n,e,t){const r=e,s=rp("where",n);return sp._create(s,r,t)}class Fv extends jv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Fv(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ee.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)kN(o,l),o=uy(o,l)}(e._query,t),new yi(e.firestore,e.converter,uy(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Bv extends Lv{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Bv(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new q(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new q(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new $c(i,o)}(e._query,this._field,this._direction);return new yi(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new el(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function Ua(n,e="asc"){const t=e,r=rp("orderBy",n);return Bv._create(r,t)}class Uv extends Lv{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Uv(e,t,r)}_apply(e){return new yi(e.firestore,e.converter,Fh(e._query,this._limit,this._limitType))}}function vk(n){return R3("limit",n),Uv._create("limit",n,"F")}function wk(n,e,t){if(typeof(t=it(t))=="string"){if(t==="")throw new q(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ZI(e)&&t.indexOf("/")!==-1)throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(_e.fromString(t));if(!H.isDocumentKey(r))throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Bc(n,new H(r))}if(t instanceof Ht)return Bc(n,t._key);throw new q(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xf(t)}.`)}function _k(n,e){if(!Array.isArray(n)||n.length===0)throw new q(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function kN(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new q(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new q(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class H3{convertValue(e,t="none"){switch(fo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Y()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Io(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Pe(o.doubleValue));return new Rv(i)}convertGeoPoint(e){return new Av(Pe(e.latitude),Pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=lv(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Lc(e));default:return null}}convertTimestamp(e){const t=Xr(e);return new Le(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=_e.fromString(e);Z(IC(r));const s=new ho(r.get(1),r.get(3)),i=new H(r.popFirst(5));return s.isEqual(t)||Ut(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K3(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class TN extends EN{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Jd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(rp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Jd extends TN{data(e={}){return super.data(e)}}class G3{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Wl(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Jd(this._firestore,this._userDataWriter,r.key,r,new Wl(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Jd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wl(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Jd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wl(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:Q3(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Q3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Y()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bN(n){n=Gn(n,Ht);const e=Gn(n.firestore,No);return C3(Nv(e),n._key).then(t=>Y3(e,n,t))}class SN extends H3{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ba(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ht(this.firestore,null,t)}}function Ur(n){n=Gn(n,yi);const e=Gn(n.firestore,No),t=Nv(e),r=new SN(e);return q3(n._query),N3(t,n._query).then(s=>new G3(e,r,n,s))}function Gi(n,e,t){n=Gn(n,Ht);const r=Gn(n.firestore,No),s=K3(n.converter,e,t);return $v(r,[F3(Dv(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,$t.none())])}function J3(n,e,t,...r){n=Gn(n,Ht);const s=Gn(n.firestore,No),i=Dv(s);let o;return o=typeof(e=it(e))=="string"||e instanceof ep?U3(i,"updateDoc",n._key,e,t,r):B3(i,"updateDoc",n._key,e),$v(s,[o.toMutation(n._key,$t.exists(!0))])}function IN(n){return $v(Gn(n.firestore,No),[new qf(n._key,$t.none())])}function $v(n,e){return function(r,s){const i=new dr;return r.asyncQueue.enqueueAndForget(async()=>y3(await I3(r),s,i)),i.promise}(Nv(n),e)}function Y3(n,e,t){const r=t.docs.get(e._key),s=new SN(n);return new TN(n,s,e._key,r,new Wl(t.hasPendingWrites,t.fromCache),e.converter)}function Ks(){return new Mv("serverTimestamp")}(function(e,t=!0){(function(s){Za=s})(bo),oo(new ti("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new No(new A4(r.getProvider("auth-internal")),new M4(r.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new q(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ho(c.options.projectId,u)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),lr(hE,"4.7.3",e),lr(hE,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CN="firebasestorage.googleapis.com",X3="storageBucket",Z3=2*60*1e3,e6=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr extends gr{constructor(e,t,r=0){super(Sm(e),`Firebase Storage: ${t} (${Sm(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,yr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Sm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var fr;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(fr||(fr={}));function Sm(n){return"storage/"+n}function t6(){const n="An unknown error occurred, please check the error payload for server response.";return new yr(fr.UNKNOWN,n)}function n6(){return new yr(fr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function r6(){return new yr(fr.CANCELED,"User canceled the upload/download.")}function s6(n){return new yr(fr.INVALID_URL,"Invalid URL '"+n+"'.")}function i6(n){return new yr(fr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function xk(n){return new yr(fr.INVALID_ARGUMENT,n)}function NN(){return new yr(fr.APP_DELETED,"The Firebase app was deleted.")}function o6(n){return new yr(fr.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=zn.makeFromUrl(e,t)}catch{return new zn(e,"")}if(r.path==="")return r;throw i6(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(N){N.path.charAt(N.path.length-1)==="/"&&(N.path_=N.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(N){N.path_=decodeURIComponent(N.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${u}/b/${s}/o${f}`,"i"),y={bucket:1,path:3},v=t===CN?"(?:storage.googleapis.com|storage.cloud.google.com)":t,_="([^?#]*)",x=new RegExp(`^https?://${v}/${s}/${_}`,"i"),b=[{regex:a,indices:l,postModify:i},{regex:m,indices:y,postModify:c},{regex:x,indices:{bucket:1,path:2},postModify:c}];for(let N=0;N<b.length;N++){const R=b[N],P=R.regex.exec(e);if(P){const k=P[R.indices.bucket];let E=P[R.indices.path];E||(E=""),r=new zn(k,E),R.postModify(r);break}}if(r==null)throw s6(e);return r}}class a6{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l6(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(..._){c||(c=!0,e.apply(null,_))}function h(_){s=setTimeout(()=>{s=null,n(m,l())},_)}function f(){i&&clearTimeout(i)}function m(_,...x){if(c){f();return}if(_){f(),u.call(null,_,...x);return}if(l()||o){f(),u.call(null,_,...x);return}r<64&&(r*=2);let b;a===1?(a=2,b=0):b=(r+Math.random())*1e3,h(b)}let y=!1;function v(_){y||(y=!0,f(),!c&&(s!==null?(_||(a=2),clearTimeout(s),h(0)):_||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,v(!0)},t),v}function c6(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u6(n){return n!==void 0}function Ek(n,e,t,r){if(r<e)throw xk(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw xk(`Invalid value for '${n}'. Expected ${t} or less.`)}function d6(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var Gh;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Gh||(Gh={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h6(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{constructor(e,t,r,s,i,o,a,l,c,u,h,f=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((m,y)=>{this.resolve_=m,this.reject_=y,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new gd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Gh.NO_ERROR,l=i.getStatus();if(!a||h6(l,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===Gh.ABORT;r(!1,new gd(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new gd(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());u6(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=t6();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?NN():r6();o(l)}else{const l=n6();o(l)}};this.canceled_?t(!1,new gd(!1,null,!0)):this.backoffId_=l6(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&c6(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class gd{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function p6(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function m6(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function g6(n,e){e&&(n["X-Firebase-GMPID"]=e)}function y6(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function v6(n,e,t,r,s,i,o=!0){const a=d6(n.urlParams),l=n.url+a,c=Object.assign({},n.headers);return g6(c,e),p6(c,t),m6(c,i),y6(c,r),new f6(l,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w6(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function _6(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e,t){this._service=e,t instanceof zn?this._location=t:this._location=zn.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Qh(e,t)}get root(){const e=new zn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return _6(this._location.path)}get storage(){return this._service}get parent(){const e=w6(this._location.path);if(e===null)return null;const t=new zn(this._location.bucket,e);return new Qh(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw o6(e)}}function kk(n,e){const t=e==null?void 0:e[X3];return t==null?null:zn.makeFromBucketSpec(t,n)}function x6(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:VS(s,n.app.options.projectId))}class E6{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=CN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Z3,this._maxUploadRetryTime=e6,this._requests=new Set,s!=null?this._bucket=zn.makeFromBucketSpec(s,this._host):this._bucket=kk(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=zn.makeFromBucketSpec(this._url,e):this._bucket=kk(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ek("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ek("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Qh(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new a6(NN());{const o=v6(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const Tk="@firebase/storage",bk="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AN="storage";function k6(n=K0(),e){n=it(n);const r=Mf(n,AN).getImmediate({identifier:e}),s=DS("storage");return s&&T6(r,...s),r}function T6(n,e,t,r={}){x6(n,e,t,r)}function b6(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new E6(t,r,s,e,bo)}function S6(){oo(new ti(AN,b6,"PUBLIC").setMultipleInstances(!0)),lr(Tk,bk,""),lr(Tk,bk,"esm2017")}S6();const I6={apiKey:"AIzaSyA27iKEalAwT1wgZFkfYNzqTpyIh7DfL10",authDomain:"personal-development-d15b5.firebaseapp.com",projectId:"personal-development-d15b5",storageBucket:"personal-development-d15b5.firebasestorage.app",messagingSenderId:"926131095327",appId:"1:926131095327:web:f11083575d57529d3a522a"},zv=US(I6),Al=T4(zv),We=D3(zv);k6(zv);M3(We).catch(n=>{n.code==="failed-precondition"?console.warn("Multiple tabs open, persistence can only be enabled in one tab at a time."):n.code==="unimplemented"&&console.warn("The current browser does not support offline persistence.")});const C6=["pmdunn78@gmail.com"],RN=M.createContext({}),Vn=()=>{const n=M.useContext(RN);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},N6=({children:n})=>{const[e,t]=M.useState(null),[r,s]=M.useState(!0),[i,o]=M.useState(null),a=async(y,v)=>{if(!C6.includes(y.toLowerCase()))throw new Error("This email is not authorized to create an account.");try{const{user:_}=await lL(Al,y,v);await Gi(Nn(We,"users",_.uid),{email:_.email,createdAt:Ks(),settings:{theme:"light",emailNotifications:!0,journalReminders:!1}});const x=["general","finances","fitness","jiu-jitsu","women","attractiveness","nutrition","philosophy","languages"];for(const T of x)await Gi(Nn(We,"lifeSubsections",`${_.uid}_${T}`),{name:T,userId:_.uid,winState:{description:"",targetValue:0,currentValue:0,unit:"",metrics:[]},createdAt:Ks()});return pe.success("Account created successfully!"),_}catch(_){throw console.error("Signup error:",_),pe.error(_.message),_}},l=async(y,v)=>{try{const{user:_}=await cL(Al,y,v);return pe.success("Welcome back!"),_}catch(_){throw console.error("Login error:",_),pe.error("Invalid email or password"),_}},c=async()=>{try{await fL(Al),pe.success("Logged out successfully")}catch(y){throw console.error("Logout error:",y),pe.error("Error logging out"),y}},u=async y=>{try{await aL(Al,y),pe.success("Password reset email sent!")}catch(v){throw console.error("Password reset error:",v),pe.error("Error sending password reset email"),v}},h=async y=>{try{const v=await bN(Nn(We,"users",y));v.exists()&&o({id:v.id,...v.data()})}catch(v){console.error("Error fetching user profile:",v)}},f=async y=>{if(e)try{const v={settings:{theme:y.theme,emailNotifications:y.emailNotifications,journalReminders:y.journalReminders,goalDeadlineAlerts:y.goalDeadlineAlerts,weeklyReports:y.weeklyReports}};y.displayName!==void 0&&(v.displayName=y.displayName),await Gi(Nn(We,"users",e.uid),v,{merge:!0}),o(_=>({..._,...v})),pe.success("Settings updated")}catch(v){throw console.error("Error updating settings:",v),pe.error("Failed to update settings"),v}};M.useEffect(()=>hL(Al,async v=>{t(v),v?await h(v.uid):o(null),s(!1)}),[]);const m={currentUser:e,userProfile:i,signup:a,login:l,logout:c,resetPassword:u,updateUserSettings:f,loading:r};return p.jsx(RN.Provider,{value:m,children:n})},PN=M.createContext({}),DN=()=>{const n=M.useContext(PN);if(!n)throw new Error("useTheme must be used within a ThemeProvider");return n},A6=({children:n})=>{const[e,t]=M.useState(()=>{const a=localStorage.getItem("theme");return a||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});M.useEffect(()=>{const a=window.document.documentElement;a.classList.remove("light","dark"),a.classList.add(e),localStorage.setItem("theme",e)},[e]);const o={theme:e,toggleTheme:()=>{t(a=>a==="light"?"dark":"light")},setLightTheme:()=>t("light"),setDarkTheme:()=>t("dark"),isDark:e==="dark",isLight:e==="light"};return p.jsx(PN.Provider,{value:o,children:n})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R6=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),P6=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Sk=n=>{const e=P6(n);return e.charAt(0).toUpperCase()+e.slice(1)},MN=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),D6=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var M6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O6=M.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:o,...a},l)=>M.createElement("svg",{ref:l,...M6,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:MN("lucide",s),...!i&&!D6(a)&&{"aria-hidden":"true"},...a},[...o.map(([c,u])=>M.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=(n,e)=>{const t=M.forwardRef(({className:r,...s},i)=>M.createElement(O6,{ref:i,iconNode:e,className:MN(`lucide-${R6(Sk(n))}`,`lucide-${n}`,r),...s}));return t.displayName=Sk(n),t};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V6=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],j6=le("award",V6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L6=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],F6=le("bell",L6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B6=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],U6=le("bold",B6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $6=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Qi=le("book-open",$6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z6=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Jh=le("calendar",z6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Wv=le("chevron-down",W6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q6=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ey=le("chevron-right",q6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H6=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],K6=le("chevron-up",H6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Q6=le("circle-check",G6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Y6=le("circle",J6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ON=le("clock",X6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],eU=le("download",Z6);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tU=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],nU=le("eye-off",tU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rU=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],sU=le("eye",rU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iU=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],oU=le("italic",iU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aU=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],lU=le("link-2",aU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cU=[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]],uU=le("list-ordered",cU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dU=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],hU=le("list",dU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fU=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ky=le("loader-circle",fU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pU=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],mU=le("lock",pU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gU=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ty=le("log-out",gU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yU=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],by=le("mail",yU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vU=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],wU=le("menu",vU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _U=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],VN=le("moon",_U);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xU=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],qv=le("pen",xU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EU=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ii=le("plus",EU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kU=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],TU=le("redo",kU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bU=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Yh=le("save",bU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SU=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],IU=le("search",SU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CU=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],NU=le("settings",CU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AU=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],RU=le("shield",AU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PU=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],jN=le("sun",PU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DU=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],LN=le("tag",DU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MU=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],oi=le("target",MU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OU=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Xh=le("trash-2",OU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VU=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],FN=le("trending-up",VU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jU=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],LU=le("trophy",jU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FU=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],BU=le("underline",FU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UU=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],$U=le("undo",UU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zU=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],BN=le("user",zU);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WU=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],qc=le("x",WU),qU=()=>{const[n,e]=M.useState(""),[t,r]=M.useState(""),[s,i]=M.useState(!1),[o,a]=M.useState(!1),[l,c]=M.useState(!1),[u,h]=M.useState(!1),{login:f,signup:m,resetPassword:y}=Vn(),v=async x=>{if(x.preventDefault(),!n||!t){pe.error("Please fill in all fields");return}c(!0);try{o?await m(n,t):await f(n,t)}catch(T){console.error("Auth error:",T)}finally{c(!1)}},_=async x=>{if(x.preventDefault(),!n){pe.error("Please enter your email address");return}c(!0);try{await y(n),h(!1)}catch(T){console.error("Reset password error:",T)}finally{c(!1)}};return u?p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 px-4",children:p.jsx("div",{className:"max-w-md w-full",children:p.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Reset Password"}),p.jsxs("form",{onSubmit:_,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Email Address"}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:"email",value:n,onChange:x=>e(x.target.value),className:"input pl-10",placeholder:"you@example.com",disabled:l}),p.jsx(by,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),p.jsx("button",{type:"submit",disabled:l,className:"w-full btn-primary flex items-center justify-center",children:l?p.jsx(ky,{className:"h-5 w-5 animate-spin"}):"Send Reset Email"}),p.jsx("button",{type:"button",onClick:()=>h(!1),className:"w-full text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",children:"Back to login"})]})]})})}):p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 px-4",children:p.jsx("div",{className:"max-w-md w-full",children:p.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:o?"Create Account":"Welcome Back"}),p.jsxs("form",{onSubmit:v,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Email Address"}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:"email",value:n,onChange:x=>e(x.target.value),className:"input pl-10",placeholder:"you@example.com",disabled:l}),p.jsx(by,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Password"}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:s?"text":"password",value:t,onChange:x=>r(x.target.value),className:"input pl-10 pr-10",placeholder:"••••••••",disabled:l}),p.jsx(mU,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"}),p.jsx("button",{type:"button",onClick:()=>i(!s),className:"absolute right-3 top-2.5",children:s?p.jsx(nU,{className:"h-5 w-5 text-gray-400"}):p.jsx(sU,{className:"h-5 w-5 text-gray-400"})})]})]}),!o&&p.jsx("div",{className:"text-right",children:p.jsx("button",{type:"button",onClick:()=>h(!0),className:"text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300",children:"Forgot password?"})}),p.jsx("button",{type:"submit",disabled:l,className:"w-full btn-primary flex items-center justify-center",children:l?p.jsx(ky,{className:"h-5 w-5 animate-spin"}):o?"Sign Up":"Sign In"})]}),p.jsx("div",{className:"mt-6 text-center",children:p.jsx("button",{onClick:()=>a(!o),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",children:o?"Already have an account? Sign in":"Don't have an account? Sign up"})}),o&&p.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:p.jsx("p",{className:"text-xs text-amber-800 dark:text-amber-200",children:"Note: Only whitelisted emails can create accounts. Contact the administrator if you need access."})})]})})})},HU=({children:n})=>{const{currentUser:e,loading:t}=Vn();return t?p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ky,{className:"h-12 w-12 animate-spin text-primary-600 mx-auto mb-4"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})}):e?p.jsx(p.Fragment,{children:n}):p.jsx(qU,{})},KU=()=>{var m;const{currentUser:n,userProfile:e,logout:t}=Vn(),{theme:r,toggleTheme:s}=DN(),[i,o]=M.useState(!1),[a,l]=M.useState(!1),c=lu(),u=[{name:"Dashboard",href:"/"},{name:"Journal",href:"/journal"},{name:"Goals",href:"/goals"},{name:"Stats",href:"/stats"}],h=[{name:"Finances",href:"/subsection/finances"},{name:"Fitness",href:"/subsection/fitness"},{name:"Jiu Jitsu",href:"/subsection/jiu-jitsu"},{name:"Women",href:"/subsection/women"},{name:"Attractiveness",href:"/subsection/attractiveness"},{name:"Nutrition",href:"/subsection/nutrition"},{name:"Philosophy",href:"/subsection/philosophy"},{name:"Languages",href:"/subsection/languages"}],f=y=>c.pathname===y;return p.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50",children:p.jsxs("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsxs("div",{className:"flex justify-between h-16",children:[p.jsxs("div",{className:"flex",children:[p.jsx("div",{className:"flex-shrink-0 flex items-center",children:p.jsxs(dn,{to:"/",className:"flex items-center space-x-2",children:[p.jsx(oi,{className:"h-8 w-8 text-primary-600"}),p.jsx("span",{className:"font-bold text-xl text-gray-900 dark:text-white hidden sm:block",children:"PDT"})]})}),p.jsxs("div",{className:"hidden md:ml-8 md:flex md:space-x-4",children:[u.map(y=>p.jsx(dn,{to:y.href,className:`inline-flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${f(y.href)?"text-primary-600 bg-primary-50 dark:text-primary-400 dark:bg-primary-900/20":"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:y.name},y.name)),p.jsxs("div",{className:"relative group inline-flex",children:[p.jsxs("button",{className:"inline-flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:["Life Areas",p.jsx(Wv,{className:"ml-1 h-4 w-4"})]}),p.jsx("div",{className:"absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200",children:p.jsx("div",{className:"py-1",children:h.map(y=>p.jsx(dn,{to:y.href,className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:y.name},y.name))})})]})]})]}),p.jsxs("div",{className:"flex items-center space-x-4",children:[p.jsx("button",{onClick:s,className:"p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Toggle theme",children:r==="light"?p.jsx(VN,{className:"h-5 w-5"}):p.jsx(jN,{className:"h-5 w-5"})}),p.jsxs("div",{className:"hidden md:block relative",children:[p.jsxs("button",{onClick:()=>l(!a),className:"flex items-center space-x-2 p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[p.jsx(BN,{className:"h-5 w-5"}),p.jsx("span",{className:"text-sm",children:(e==null?void 0:e.displayName)||((m=n==null?void 0:n.email)==null?void 0:m.split("@")[0])})]}),a&&p.jsx("div",{className:"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5",children:p.jsxs("div",{className:"py-1",children:[p.jsxs(dn,{to:"/settings",className:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>l(!1),children:[p.jsx(NU,{className:"h-4 w-4 mr-2"}),"Settings"]}),p.jsxs("button",{onClick:()=>{t(),l(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[p.jsx(Ty,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})})]}),p.jsx("button",{onClick:()=>o(!i),className:"md:hidden p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:i?p.jsx(qc,{className:"h-6 w-6"}):p.jsx(wU,{className:"h-6 w-6"})})]})]}),i&&p.jsx("div",{className:"md:hidden py-4 border-t border-gray-200 dark:border-gray-700",children:p.jsxs("div",{className:"space-y-1",children:[u.map(y=>p.jsx(dn,{to:y.href,className:`block px-3 py-2 rounded-md text-base font-medium ${f(y.href)?"text-primary-600 bg-primary-50 dark:text-primary-400 dark:bg-primary-900/20":"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"}`,onClick:()=>o(!1),children:y.name},y.name)),p.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-2 mt-2",children:[p.jsx("p",{className:"px-3 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Life Areas"}),h.map(y=>p.jsx(dn,{to:y.href,className:"block px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>o(!1),children:y.name},y.name))]}),p.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-2 mt-2",children:[p.jsx(dn,{to:"/settings",className:"block px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>o(!1),children:"Settings"}),p.jsx("button",{onClick:()=>{t(),o(!1)},className:"block w-full text-left px-3 py-2 text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700",children:"Sign Out"})]})]})})]})})};function Ge(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function Qn(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}function Sy(n,e){const t=Ge(n);return isNaN(e)?Qn(n,NaN):(e&&t.setDate(t.getDate()+e),t)}function GU(n,e){const t=Ge(n);if(isNaN(e))return Qn(n,NaN);const r=t.getDate(),s=Qn(n,t.getTime());s.setMonth(t.getMonth()+e+1,0);const i=s.getDate();return r>=i?s:(t.setFullYear(s.getFullYear(),s.getMonth(),r),t)}const UN=6048e5,QU=864e5;let JU={};function ku(){return JU}function ai(n,e){var a,l,c,u;const t=ku(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??t.weekStartsOn??((u=(c=t.locale)==null?void 0:c.options)==null?void 0:u.weekStartsOn)??0,s=Ge(n),i=s.getDay(),o=(i<r?7:0)+i-r;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function Zh(n){return ai(n,{weekStartsOn:1})}function $N(n){const e=Ge(n),t=e.getFullYear(),r=Qn(n,0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);const s=Zh(r),i=Qn(n,0);i.setFullYear(t,0,4),i.setHours(0,0,0,0);const o=Zh(i);return e.getTime()>=s.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function Ik(n){const e=Ge(n);return e.setHours(0,0,0,0),e}function Ck(n){const e=Ge(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function YU(n,e){const t=Ik(n),r=Ik(e),s=+t-Ck(t),i=+r-Ck(r);return Math.round((s-i)/QU)}function XU(n){const e=$N(n),t=Qn(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Zh(t)}function Hv(n){return Qn(n,Date.now())}function ZU(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function e$(n){if(!ZU(n)&&typeof n!="number")return!1;const e=Ge(n);return!isNaN(Number(e))}function zN(n){const e=Ge(n),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function WN(n){const e=Ge(n);return e.setDate(1),e.setHours(0,0,0,0),e}function t$(n){const e=Ge(n),t=e.getFullYear();return e.setFullYear(t+1,0,0),e.setHours(23,59,59,999),e}function qN(n){const e=Ge(n),t=Qn(n,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}function n$(n,e){var a,l;const t=ku(),r=t.weekStartsOn??((l=(a=t.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??0,s=Ge(n),i=s.getDay(),o=(i<r?-7:0)+6-(i-r);return s.setDate(s.getDate()+o),s.setHours(23,59,59,999),s}const r$={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},s$=(n,e,t)=>{let r;const s=r$[n];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function Im(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const i$={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},o$={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},a$={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},l$={date:Im({formats:i$,defaultWidth:"full"}),time:Im({formats:o$,defaultWidth:"full"}),dateTime:Im({formats:a$,defaultWidth:"full"})},c$={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},u$=(n,e,t,r)=>c$[n];function Rl(n){return(e,t)=>{const r=t!=null&&t.context?String(t.context):"standalone";let s;if(r==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,a=t!=null&&t.width?String(t.width):o;s=n.formattingValues[a]||n.formattingValues[o]}else{const o=n.defaultWidth,a=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[a]||n.values[o]}const i=n.argumentCallback?n.argumentCallback(e):e;return s[i]}}const d$={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},h$={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},f$={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},p$={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},m$={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},g$={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},y$=(n,e)=>{const t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},v$={ordinalNumber:y$,era:Rl({values:d$,defaultWidth:"wide"}),quarter:Rl({values:h$,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Rl({values:f$,defaultWidth:"wide"}),day:Rl({values:p$,defaultWidth:"wide"}),dayPeriod:Rl({values:m$,defaultWidth:"wide",formattingValues:g$,defaultFormattingWidth:"wide"})};function Pl(n){return(e,t={})=>{const r=t.width,s=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],i=e.match(s);if(!i)return null;const o=i[0],a=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(a)?_$(a,h=>h.test(o)):w$(a,h=>h.test(o));let c;c=n.valueCallback?n.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;const u=e.slice(o.length);return{value:c,rest:u}}}function w$(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function _$(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function x$(n){return(e,t={})=>{const r=e.match(n.matchPattern);if(!r)return null;const s=r[0],i=e.match(n.parsePattern);if(!i)return null;let o=n.valueCallback?n.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}const E$=/^(\d+)(th|st|nd|rd)?/i,k$=/\d+/i,T$={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},b$={any:[/^b/i,/^(a|c)/i]},S$={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},I$={any:[/1/i,/2/i,/3/i,/4/i]},C$={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},N$={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},A$={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},R$={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},P$={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},D$={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},M$={ordinalNumber:x$({matchPattern:E$,parsePattern:k$,valueCallback:n=>parseInt(n,10)}),era:Pl({matchPatterns:T$,defaultMatchWidth:"wide",parsePatterns:b$,defaultParseWidth:"any"}),quarter:Pl({matchPatterns:S$,defaultMatchWidth:"wide",parsePatterns:I$,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Pl({matchPatterns:C$,defaultMatchWidth:"wide",parsePatterns:N$,defaultParseWidth:"any"}),day:Pl({matchPatterns:A$,defaultMatchWidth:"wide",parsePatterns:R$,defaultParseWidth:"any"}),dayPeriod:Pl({matchPatterns:P$,defaultMatchWidth:"any",parsePatterns:D$,defaultParseWidth:"any"})},O$={code:"en-US",formatDistance:s$,formatLong:l$,formatRelative:u$,localize:v$,match:M$,options:{weekStartsOn:0,firstWeekContainsDate:1}};function V$(n){const e=Ge(n);return YU(e,qN(e))+1}function j$(n){const e=Ge(n),t=+Zh(e)-+XU(e);return Math.round(t/UN)+1}function HN(n,e){var u,h,f,m;const t=Ge(n),r=t.getFullYear(),s=ku(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??s.firstWeekContainsDate??((m=(f=s.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,o=Qn(n,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const a=ai(o,e),l=Qn(n,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const c=ai(l,e);return t.getTime()>=a.getTime()?r+1:t.getTime()>=c.getTime()?r:r-1}function L$(n,e){var a,l,c,u;const t=ku(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??t.firstWeekContainsDate??((u=(c=t.locale)==null?void 0:c.options)==null?void 0:u.firstWeekContainsDate)??1,s=HN(n,e),i=Qn(n,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),ai(i,e)}function F$(n,e){const t=Ge(n),r=+ai(t,e)-+L$(t,e);return Math.round(r/UN)+1}function xe(n,e){const t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}const hs={y(n,e){const t=n.getFullYear(),r=t>0?t:1-t;return xe(e==="yy"?r%100:r,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):xe(t+1,2)},d(n,e){return xe(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return xe(n.getHours()%12||12,e.length)},H(n,e){return xe(n.getHours(),e.length)},m(n,e){return xe(n.getMinutes(),e.length)},s(n,e){return xe(n.getSeconds(),e.length)},S(n,e){const t=e.length,r=n.getMilliseconds(),s=Math.trunc(r*Math.pow(10,t-3));return xe(s,e.length)}},Bo={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Nk={G:function(n,e,t){const r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const r=n.getFullYear(),s=r>0?r:1-r;return t.ordinalNumber(s,{unit:"year"})}return hs.y(n,e)},Y:function(n,e,t,r){const s=HN(n,r),i=s>0?s:1-s;if(e==="YY"){const o=i%100;return xe(o,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):xe(i,e.length)},R:function(n,e){const t=$N(n);return xe(t,e.length)},u:function(n,e){const t=n.getFullYear();return xe(t,e.length)},Q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return xe(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return xe(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){const r=n.getMonth();switch(e){case"M":case"MM":return hs.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){const r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return xe(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){const s=F$(n,r);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):xe(s,e.length)},I:function(n,e,t){const r=j$(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):xe(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):hs.d(n,e)},D:function(n,e,t){const r=V$(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):xe(r,e.length)},E:function(n,e,t){const r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){const s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return xe(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){const s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return xe(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){const r=n.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return xe(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){const s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){const r=n.getHours();let s;switch(r===12?s=Bo.noon:r===0?s=Bo.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){const r=n.getHours();let s;switch(r>=17?s=Bo.evening:r>=12?s=Bo.afternoon:r>=4?s=Bo.morning:s=Bo.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return hs.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):hs.H(n,e)},K:function(n,e,t){const r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):xe(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):xe(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):hs.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):hs.s(n,e)},S:function(n,e){return hs.S(n,e)},X:function(n,e,t){const r=n.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return Rk(r);case"XXXX":case"XX":return Ri(r);case"XXXXX":case"XXX":default:return Ri(r,":")}},x:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"x":return Rk(r);case"xxxx":case"xx":return Ri(r);case"xxxxx":case"xxx":default:return Ri(r,":")}},O:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Ak(r,":");case"OOOO":default:return"GMT"+Ri(r,":")}},z:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Ak(r,":");case"zzzz":default:return"GMT"+Ri(r,":")}},t:function(n,e,t){const r=Math.trunc(n.getTime()/1e3);return xe(r,e.length)},T:function(n,e,t){const r=n.getTime();return xe(r,e.length)}};function Ak(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),s=Math.trunc(r/60),i=r%60;return i===0?t+String(s):t+String(s)+e+xe(i,2)}function Rk(n,e){return n%60===0?(n>0?"-":"+")+xe(Math.abs(n)/60,2):Ri(n,e)}function Ri(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),s=xe(Math.trunc(r/60),2),i=xe(r%60,2);return t+s+e+i}const Pk=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},KN=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},B$=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],r=t[1],s=t[2];if(!s)return Pk(n,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",Pk(r,e)).replace("{{time}}",KN(s,e))},U$={p:KN,P:B$},$$=/^D+$/,z$=/^Y+$/,W$=["D","DD","YY","YYYY"];function q$(n){return $$.test(n)}function H$(n){return z$.test(n)}function K$(n,e,t){const r=G$(n,e,t);if(console.warn(r),W$.includes(n))throw new RangeError(r)}function G$(n,e,t){const r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Q$=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,J$=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Y$=/^'([^]*?)'?$/,X$=/''/g,Z$=/[a-zA-Z]/;function $r(n,e,t){var u,h,f,m;const r=ku(),s=r.locale??O$,i=r.firstWeekContainsDate??((h=(u=r.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??1,o=r.weekStartsOn??((m=(f=r.locale)==null?void 0:f.options)==null?void 0:m.weekStartsOn)??0,a=Ge(n);if(!e$(a))throw new RangeError("Invalid time value");let l=e.match(J$).map(y=>{const v=y[0];if(v==="p"||v==="P"){const _=U$[v];return _(y,s.formatLong)}return y}).join("").match(Q$).map(y=>{if(y==="''")return{isToken:!1,value:"'"};const v=y[0];if(v==="'")return{isToken:!1,value:ez(y)};if(Nk[v])return{isToken:!0,value:y};if(v.match(Z$))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:y}});s.localize.preprocessor&&(l=s.localize.preprocessor(a,l));const c={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return l.map(y=>{if(!y.isToken)return y.value;const v=y.value;(H$(v)||q$(v))&&K$(v,e,String(n));const _=Nk[v[0]];return _(a,v,s.localize,c)}).join("")}function ez(n){const e=n.match(Y$);return e?e[1].replace(X$,"'"):n}function tz(n,e,t){const r=ai(n,t),s=ai(e,t);return+r==+s}function nz(n,e){const t=Ge(n),r=Ge(e);return t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()}function rz(n,e){const t=Ge(n),r=Ge(e);return t.getFullYear()===r.getFullYear()}function sz(n){return nz(n,Hv(n))}function iz(n,e){return tz(n,Hv(n),e)}function oz(n){return rz(n,Hv(n))}function Dk(n,e){return Sy(n,-e)}function az(n,e){return GU(n,-3)}const lz=()=>{var y;const{currentUser:n,userProfile:e}=Vn(),[t,r]=M.useState([]),[s,i]=M.useState([]),[o,a]=M.useState({totalGoals:0,completedGoals:0,journalStreak:0,weeklyProgress:0}),[l,c]=M.useState(!0),u=[{id:"finances",name:"Finances",icon:"💰",color:"bg-green-500"},{id:"fitness",name:"Fitness",icon:"💪",color:"bg-blue-500"},{id:"jiu-jitsu",name:"Jiu Jitsu",icon:"🥋",color:"bg-purple-500"},{id:"women",name:"Women",icon:"💑",color:"bg-pink-500"},{id:"attractiveness",name:"Attractiveness",icon:"✨",color:"bg-yellow-500"},{id:"nutrition",name:"Nutrition",icon:"🥗",color:"bg-green-400"},{id:"philosophy",name:"Philosophy",icon:"🧠",color:"bg-indigo-500"},{id:"languages",name:"Languages",icon:"🌍",color:"bg-teal-500"}];M.useEffect(()=>{h()},[n]);const h=async()=>{if(n)try{const v=Br(Fr(We,"goals"),mn("userId","==",n.uid),mn("status","==","active"),Ua("createdAt","desc"),vk(5)),x=(await Ur(v)).docs.map(S=>({id:S.id,...S.data()}));r(x);const T=Br(Fr(We,"journalEntries"),mn("userId","==",n.uid),Ua("createdAt","desc"),vk(3)),N=(await Ur(T)).docs.map(S=>({id:S.id,...S.data()}));i(N);const R=Br(Fr(We,"goals"),mn("userId","==",n.uid)),P=await Ur(R),k=P.size,E=P.docs.filter(S=>S.data().status==="completed").length;a({totalGoals:k,completedGoals:E,journalStreak:f(N),weeklyProgress:m(x)})}catch(v){console.error("Error fetching dashboard data:",v)}finally{c(!1)}},f=v=>{var b;if(v.length===0)return 0;const _=new Date,x=((b=v[0].createdAt)==null?void 0:b.toDate())||new Date;return Math.floor((_-x)/(1e3*60*60*24))===0?1:0},m=v=>{if(v.length===0)return 0;const _=v.reduce((x,T)=>x+(T.progress||0),0);return Math.round(_/v.length)};return l?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg p-6 text-white",children:[p.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back,"," ",(e==null?void 0:e.displayName)||((y=n==null?void 0:n.email)==null?void 0:y.split("@")[0]),"!"]}),p.jsx("p",{className:"opacity-90",children:$r(new Date,"EEEE, MMMM d, yyyy")})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p.jsx("div",{className:"card",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Active Goals"}),p.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.length})]}),p.jsx(oi,{className:"h-8 w-8 text-primary-600"})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Completed"}),p.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.completedGoals})]}),p.jsx(j6,{className:"h-8 w-8 text-green-600"})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Journal Streak"}),p.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[o.journalStreak," days"]})]}),p.jsx(Qi,{className:"h-8 w-8 text-purple-600"})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Weekly Progress"}),p.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[o.weeklyProgress,"%"]})]}),p.jsx(FN,{className:"h-8 w-8 text-blue-600"})]})})]}),p.jsxs("div",{children:[p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Life Areas"}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:u.map(v=>p.jsx(dn,{to:`/subsection/${v.id}`,className:"card hover:scale-105 transition-transform duration-200",children:p.jsxs("div",{className:"flex flex-col items-center text-center",children:[p.jsx("div",{className:`w-16 h-16 ${v.color} rounded-full flex items-center justify-center text-2xl mb-3`,children:v.icon}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:v.name})]})},v.id))})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Active Goals"}),p.jsxs(dn,{to:"/goals",className:"text-primary-600 hover:text-primary-700 flex items-center text-sm",children:["View all",p.jsx(Ey,{className:"h-4 w-4 ml-1"})]})]}),t.length===0?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(oi,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No active goals yet"}),p.jsxs(dn,{to:"/goals",className:"btn-primary inline-flex items-center",children:[p.jsx(ii,{className:"h-4 w-4 mr-2"}),"Create Goal"]})]}):p.jsx("div",{className:"space-y-3",children:t.map(v=>p.jsxs("div",{className:"border-l-4 border-primary-500 pl-4 py-2",children:[p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:v.title}),p.jsxs("div",{className:"flex items-center justify-between mt-2",children:[p.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:v.timeframe}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mr-2",children:p.jsx("div",{className:"h-full bg-primary-500 rounded-full",style:{width:`${v.progress||0}%`}})}),p.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[v.progress||0,"%"]})]})]})]},v.id))})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Recent Journal Entries"}),p.jsxs(dn,{to:"/journal",className:"text-primary-600 hover:text-primary-700 flex items-center text-sm",children:["View all",p.jsx(Ey,{className:"h-4 w-4 ml-1"})]})]}),s.length===0?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(Qi,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No journal entries yet"}),p.jsxs(dn,{to:"/journal",className:"btn-primary inline-flex items-center",children:[p.jsx(ii,{className:"h-4 w-4 mr-2"}),"Write Entry"]})]}):p.jsx("div",{className:"space-y-3",children:s.map(v=>{var _;return p.jsxs("div",{className:"border-l-4 border-purple-500 pl-4 py-2",children:[p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:v.title||"Untitled Entry"}),p.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:[(_=v.content)==null?void 0:_.replace(/<[^>]*>/g,"").substring(0,100),"..."]}),p.jsxs("div",{className:"flex items-center mt-2 text-xs text-gray-500 dark:text-gray-400",children:[p.jsx(ON,{className:"h-3 w-3 mr-1"}),v.createdAt&&$r(v.createdAt.toDate(),"MMM d, yyyy")]})]},v.id)})})]})]})]})};function gt(n){this.content=n}gt.prototype={constructor:gt,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var r=t&&t!=n?this.remove(t):this,s=r.find(n),i=r.content.slice();return s==-1?i.push(t||n,e):(i[s+1]=e,t&&(i[s]=t)),new gt(i)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new gt(t)},addToStart:function(n,e){return new gt([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new gt(t)},addBefore:function(n,e,t){var r=this.remove(e),s=r.content.slice(),i=r.find(n);return s.splice(i==-1?s.length:i,0,e,t),new gt(s)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=gt.from(n),n.size?new gt(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=gt.from(n),n.size?new gt(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=gt.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};gt.from=function(n){if(n instanceof gt)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new gt(e)};function GN(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let s=n.child(r),i=e.child(r);if(s==i){t+=s.nodeSize;continue}if(!s.sameMarkup(i))return t;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)t++;return t}if(s.content.size||i.content.size){let o=GN(s.content,i.content,t+1);if(o!=null)return o}t+=s.nodeSize}}function QN(n,e,t,r){for(let s=n.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:t,b:r};let o=n.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){t-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:t,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,r--;return{a:t,b:r}}if(o.content.size||a.content.size){let c=QN(o.content,a.content,t-1,r-1);if(c)return c}t-=l,r-=l}}class U{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,s=0,i){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),r,s+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,s){let i="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(r)&&(s[s.length-1]=t.withText(t.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new U(s,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],s=0;if(t>e)for(let i=0,o=0;o<t;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),r.push(a),s+=a.nodeSize),o=l}return new U(r,s)}cutByIndex(e,t){return e==t?U.empty:e==0&&t==this.content.length?this:new U(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let s=this.content.slice(),i=this.size+t.nodeSize-r.nodeSize;return s[e]=t,new U(s,i)}addToStart(e){return new U([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new U(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let s=this.content[t];e(s,r,t),r+=s.nodeSize}}findDiffStart(e,t=0){return GN(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return QN(this,e,t,r)}findIndex(e){if(e==0)return yd(0,e);if(e==this.size)return yd(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,r=0;;t++){let s=this.child(t),i=r+s.nodeSize;if(i>=e)return i==e?yd(t+1,i):yd(t,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return U.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new U(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return U.empty;let t,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(t||(t=e.slice(0,s)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new U(t||e,r)}static from(e){if(!e)return U.empty;if(e instanceof U)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new U([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}U.empty=new U([],0);const Cm={index:0,offset:0};function yd(n,e){return Cm.index=n,Cm.offset=e,Cm}function ef(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!ef(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!ef(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}let Se=class Iy{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),r=!0),t&&t.push(i)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ef(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=r.create(t.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Iy.none;if(e instanceof Iy)return[e];let t=e.slice();return t.sort((r,s)=>r.type.rank-s.type.rank),t}};Se.none=[];class tf extends Error{}class K{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=YN(this.content,e+this.openStart,t);return r&&new K(r,this.openStart,this.openEnd)}removeBetween(e,t){return new K(JN(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return K.empty;let r=t.openStart||0,s=t.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new K(U.fromJSON(e,t.content),r,s)}static maxOpen(e,t=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)s++;return new K(e,r,s)}}K.empty=new K(U.empty,0,0);function JN(n,e,t){let{index:r,offset:s}=n.findIndex(e),i=n.maybeChild(r),{index:o,offset:a}=n.findIndex(t);if(s==e||i.isText){if(a!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(r,i.copy(JN(i.content,e-s-1,t-s-1)))}function YN(n,e,t,r){let{index:s,offset:i}=n.findIndex(e),o=n.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,t)?null:n.cut(0,e).append(t).append(n.cut(e));let a=YN(o.content,e-i-1,t,o);return a&&n.replaceChild(s,o.copy(a))}function cz(n,e,t){if(t.openStart>n.depth)throw new tf("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new tf("Inconsistent open depths");return XN(n,e,t,0)}function XN(n,e,t,r){let s=n.index(r),i=n.node(r);if(s==e.index(r)&&r<n.depth-t.openStart){let o=XN(n,e,t,r+1);return i.copy(i.content.replaceChild(s,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let o=n.parent,a=o.content;return Yi(o,a.cut(0,n.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=uz(t,n);return Yi(i,eA(n,o,a,e,r))}else return Yi(i,nf(n,e,r))}function ZN(n,e){if(!e.type.compatibleContent(n.type))throw new tf("Cannot join "+e.type.name+" onto "+n.type.name)}function Cy(n,e,t){let r=n.node(t);return ZN(r,e.node(t)),r}function Ji(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function cc(n,e,t,r){let s=(e||n).node(t),i=0,o=e?e.index(t):s.childCount;n&&(i=n.index(t),n.depth>t?i++:n.textOffset&&(Ji(n.nodeAfter,r),i++));for(let a=i;a<o;a++)Ji(s.child(a),r);e&&e.depth==t&&e.textOffset&&Ji(e.nodeBefore,r)}function Yi(n,e){return n.type.checkContent(e),n.copy(e)}function eA(n,e,t,r,s){let i=n.depth>s&&Cy(n,e,s+1),o=r.depth>s&&Cy(t,r,s+1),a=[];return cc(null,n,s,a),i&&o&&e.index(s)==t.index(s)?(ZN(i,o),Ji(Yi(i,eA(n,e,t,r,s+1)),a)):(i&&Ji(Yi(i,nf(n,e,s+1)),a),cc(e,t,s,a),o&&Ji(Yi(o,nf(t,r,s+1)),a)),cc(r,null,s,a),new U(a)}function nf(n,e,t){let r=[];if(cc(null,n,t,r),n.depth>t){let s=Cy(n,e,t+1);Ji(Yi(s,nf(n,e,t+1)),r)}return cc(e,null,t,r),new U(r)}function uz(n,e){let t=e.depth-n.openStart,s=e.node(t).copy(n.content);for(let i=t-1;i>=0;i--)s=e.node(i).copy(U.from(s));return{start:s.resolveNoCache(n.openStart+t),end:s.resolveNoCache(s.content.size-n.openEnd-t)}}class Hc{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(t);return r?e.child(t).cut(r):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],s=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Se.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),s=e.maybeChild(t);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new rf(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],s=0,i=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),c=i-l;if(r.push(o,a,s+l),!c||(o=o.child(a),o.isText))break;i=c-1,s+=l+1}return new Hc(t,r,i)}static resolveCached(e,t){let r=Mk.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==t)return o}else Mk.set(e,r=new dz);let s=r.elts[r.i]=Hc.resolve(e,t);return r.i=(r.i+1)%hz,s}}class dz{constructor(){this.elts=[],this.i=0}}const hz=12,Mk=new WeakMap;class rf{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const fz=Object.create(null);let Gs=class Ny{constructor(e,t,r,s=Se.none){this.type=e,this.attrs=t,this.marks=s,this.content=r||U.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,s=0){this.content.nodesBetween(e,t,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,s){return this.content.textBetween(e,t,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&ef(this.attrs,t||e.defaultAttrs||fz)&&Se.sameSet(this.marks,r||Se.none)}copy(e=null){return e==this.content?this:new Ny(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Ny(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return K.empty;let s=this.resolve(e),i=this.resolve(t),o=r?0:s.sharedDepth(t),a=s.start(o),c=s.node(o).content.cut(s.pos-a,i.pos-a);return new K(c,s.depth-o,i.depth-o)}replace(e,t,r){return cz(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let s=this.content.child(t-1);return{node:s,index:t-1,offset:r-s.nodeSize}}resolve(e){return Hc.resolveCached(this,e)}resolveNoCache(e){return Hc.resolve(this,e)}rangeHasMark(e,t,r){let s=!1;return t>e&&this.nodesBetween(e,t,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),tA(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=U.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,t,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Se.none;for(let t=0;t<this.marks.length;t++){let r=this.marks[t];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Se.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let s=U.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Gs.prototype.text=void 0;class sf extends Gs{constructor(e,t,r,s){if(super(e,t,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):tA(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new sf(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new sf(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function tA(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class vo{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new pz(e,t);if(r.next==null)return vo.empty;let s=nA(r);r.next&&r.err("Unexpected trailing text");let i=xz(_z(s));return Ez(i,r),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let s=this;for(let i=t;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!t||l.validEnd))return U.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:h}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let f=i(h,a.concat(u));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&t(r.next[s].next)}return t(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}vo.empty=new vo(!0);class pz{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function nA(n){let e=[];do e.push(mz(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function mz(n){let e=[];do e.push(gz(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function gz(n){let e=wz(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=yz(n,e);else break;return e}function Ok(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function yz(n,e){let t=Ok(n),r=t;return n.eat(",")&&(n.next!="}"?r=Ok(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}function vz(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let s=[];for(let i in t){let o=t[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&n.err("No node type or group '"+e+"' found"),s}function wz(n){if(n.eat("(")){let e=nA(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=vz(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function _z(n){let e=[[]];return s(i(n,0),t()),e;function t(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(i(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=i(o.exprs[l],a);if(l==o.exprs.length-1)return c;s(c,a=t())}else if(o.type=="star"){let l=t();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=t();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();s(i(o.expr,l),u),l=u}if(o.max==-1)s(i(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();r(l,u),s(i(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function rA(n,e){return e-n}function Vk(n,e){let t=[];return r(e),t.sort(rA);function r(s){let i=n[s];if(i.length==1&&!i[0].term)return r(i[0].to);t.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&t.indexOf(l)==-1&&r(l)}}}function xz(n){let e=Object.create(null);return t(Vk(n,0));function t(r){let s=[];r.forEach(o=>{n[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<s.length;u++)s[u][0]==a&&(c=s[u][1]);Vk(n,l).forEach(u=>{c||s.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let i=e[r.join(",")]=new vo(r.indexOf(n.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(rA);i.next.push({type:s[o][0],next:e[a.join(",")]||t(a)})}return i}}function Ez(n,e){for(let t=0,r=[n];t<r.length;t++){let s=r[t],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:c}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(c)==-1&&r.push(c)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function sA(n){let e=Object.create(null);for(let t in n){let r=n[t];if(!r.hasDefault)return null;e[t]=r.default}return e}function iA(n,e){let t=Object.create(null);for(let r in n){let s=e&&e[r];if(s===void 0){let i=n[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}t[r]=s}return t}function oA(n,e,t,r){for(let s in e)if(!(s in n))throw new RangeError(`Unsupported attribute ${s} for ${t} of type ${s}`);for(let s in n){let i=n[s];i.validate&&i.validate(e[s])}}function aA(n,e){let t=Object.create(null);if(e)for(let r in e)t[r]=new Tz(n,r,e[r]);return t}let jk=class lA{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=aA(e,r.attrs),this.defaultAttrs=sA(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==vo.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:iA(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Gs(this,this.computeAttrs(e),U.from(t),Se.setFrom(r))}createChecked(e=null,t,r){return t=U.from(t),this.checkContent(t),new Gs(this,this.computeAttrs(e),t,Se.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),t=U.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let s=this.contentMatch.matchFragment(t),i=s&&s.fillBefore(U.empty,!0);return i?new Gs(this,e,t.append(i),Se.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){oA(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:Se.none:e}static compile(e,t){let r=Object.create(null);e.forEach((i,o)=>r[i]=new lA(i,t,o));let s=t.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function kz(n,e,t){let r=t.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${n}, got ${i}`)}}class Tz{constructor(e,t,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?kz(e,t,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class ip{constructor(e,t,r,s){this.name=e,this.rank=t,this.schema=r,this.spec=s,this.attrs=aA(e,s.attrs),this.excluded=null;let i=sA(this.attrs);this.instance=i?new Se(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Se(this,iA(this.attrs,e))}static compile(e,t){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new ip(i,s++,t,o)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){oA(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class cA{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=gt.from(e.nodes),t.marks=gt.from(e.marks||{}),this.nodes=jk.compile(this.spec.nodes,this),this.marks=ip.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=vo.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?Lk(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:Lk(this,o.split(" "))}this.nodeFromJSON=s=>Gs.fromJSON(this,s),this.markFromJSON=s=>Se.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof jk){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,s)}text(e,t){let r=this.nodes.text;return new sf(r,r.defaultAttrs,e,Se.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Lk(n,e){let t=[];for(let r=0;r<e.length;r++){let s=e[r],i=n.marks[s],o=i;if(i)t.push(i);else for(let a in n.marks){let l=n.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return t}function bz(n){return n.tag!=null}function Sz(n){return n.style!=null}class Qs{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let r=this.matchedStyles=[];t.forEach(s=>{if(bz(s))this.tags.push(s);else if(Sz(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let r=new Bk(this,t,!1);return r.addAll(e,Se.none,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new Bk(this,t,!0);return r.addAll(e,Se.none,t.from,t.to),K.maxOpen(r.finish())}matchTag(e,t,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(Nz(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,t,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<i)break}t.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=Uk(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=Uk(o)),o.node||o.ignore||o.mark||(o.node=s)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Qs(e,Qs.schemaRules(e)))}}const uA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Iz={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},dA={ol:!0,ul:!0},Kc=1,Ay=2,uc=4;function Fk(n,e,t){return e!=null?(e?Kc:0)|(e==="full"?Ay:0):n&&n.whitespace=="pre"?Kc|Ay:t&~uc}class vd{constructor(e,t,r,s,i,o){this.type=e,this.attrs=t,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Se.none,this.match=i||(o&uc?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(U.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Kc)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let t=U.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(U.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!uA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Bk{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=t.topNode,i,o=Fk(null,t.preserveWhitespace,0)|(r?uc:0);s?i=new vd(s.type,s.attrs,Se.none,!0,t.topMatch||s.type.contentMatch,o):r?i=new vd(null,null,Se.none,!0,null,o):i=new vd(e.schema.topNodeType,null,Se.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let r=e.nodeValue,s=this.top,i=s.options&Ay?"full":this.localPreserveWS||(s.options&Kc)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),t,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,t,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;dA.hasOwnProperty(o)&&this.parser.normalizeLists&&Cz(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:Iz.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(uA.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let h=l&&l.skip?t:this.readStyles(e,t);h&&this.addAll(e,h),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,r,s){let i,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,t.attrs||null,r,t.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[t.mark];r=r.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,t,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,t);this.findAtPoint(e,i)}findPlace(e,t,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!s||s.length>c.length+a)&&(s=c,i=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)t=this.enterInner(s[o],null,t,!1);return t}insertNode(e,t,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let s=this.findPlace(e,t,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Se.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):$k(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,t,r,s){let i=this.findPlace(e.create(t),r,!1);return i&&(i=this.enterInner(e,t,r,!0,s)),i}enterInner(e,t,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=Fk(e,i,o.options);o.options&uc&&o.content.length==0&&(a|=uc);let l=Se.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):$k(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new vd(e,t,l,s,null,a)),this.open++,r}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Kc)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&t.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}}function Cz(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&dA.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}function Nz(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function Uk(n){let e={};for(let t in n)e[t]=n[t];return e}function $k(n,e){let t=e.schema.nodes;for(let r in t){let s=t[r];if(!s.allowsMarkType(n))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&o(u))return!0}};if(o(s.contentMatch))return!0}}class Ao{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=Nm(t).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,t);u&&(i.push([c,s]),s.appendChild(u.dom),s=u.contentDOM||u.dom)}}s.appendChild(this.serializeNodeInner(o,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:s}=Yd(Nm(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,t,r={}){let s=this.marks[e.type.name];return s&&Yd(Nm(r),s(e,t),null,e.attrs)}static renderSpec(e,t,r=null,s){return Yd(e,t,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Ao(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=zk(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return zk(e.marks)}}function zk(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}function Nm(n){return n.document||window.document}const Wk=new WeakMap;function Az(n){let e=Wk.get(n);return e===void 0&&Wk.set(n,e=Rz(n)),e}function Rz(n){let e=null;function t(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)t(r[s]);else for(let s in r)t(r[s])}return t(n),e}function Yd(n,e,t,r){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=Az(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(t=s.slice(0,o),s=s.slice(o+1));let a,l=t?n.createElementNS(t,s):n.createElement(s),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let h in c)if(c[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),c[h]):h=="style"&&l.style?l.style.cssText=c[h]:l.setAttribute(h,c[h])}}for(let h=u;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:m,contentDOM:y}=Yd(n,f,t,r);if(l.appendChild(m),y){if(a)throw new RangeError("Multiple content holes");a=y}}}return{dom:l,contentDOM:a}}const hA=65535,fA=Math.pow(2,16);function Pz(n,e){return n+e*fA}function qk(n){return n&hA}function Dz(n){return(n-(n&hA))/fA}const pA=1,mA=2,Xd=4,gA=8;class Ry{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&gA)>0}get deletedBefore(){return(this.delInfo&(pA|Xd))>0}get deletedAfter(){return(this.delInfo&(mA|Xd))>0}get deletedAcross(){return(this.delInfo&Xd)>0}}class hn{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&hn.empty)return hn.empty}recover(e){let t=0,r=qk(e);if(!this.inverted)for(let s=0;s<r;s++)t+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+t+Dz(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+o],h=l+c;if(e<=h){let f=c?e==l?-1:e==h?1:t:t,m=l+s+(f<0?0:u);if(r)return m;let y=e==(t<0?l:h)?null:Pz(a/3,e-l),v=e==l?mA:e==h?pA:Xd;return(t<0?e!=l:e!=h)&&(v|=gA),new Ry(m,v,y)}s+=u-c}return r?e+s:new Ry(e+s,0,null)}touches(e,t){let r=0,s=qk(t),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==s*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),c=this.ranges[s+t],u=this.ranges[s+r];e(a,a+c,l,l+u),i+=u-c}}invert(){return new hn(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?hn.empty:new hn(e<0?[0,-e,0]:[0,0,e])}}hn.empty=new hn([]);class Gc{constructor(e,t,r=0,s=e?e.length:0){this.mirror=t,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Gc(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,r=this._maps.length;t<e._maps.length;t++){let s=e.getMirror(t);this.appendMap(e._maps[t],s!=null&&s<t?r+s:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this._maps.length+e._maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e._maps[t].invert(),s!=null&&s>t?r-s-1:void 0)}}invert(){let e=new Gc;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new Ry(e,s,null)}}const Am=Object.create(null);class jt{getMap(){return hn.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Am[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in Am)throw new RangeError("Duplicate use of step JSON ID "+e);return Am[e]=t,t.prototype.jsonID=e,t}}class Xe{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Xe(e,null)}static fail(e){return new Xe(null,e)}static fromReplace(e,t,r,s){try{return Xe.ok(e.replace(t,r,s))}catch(i){if(i instanceof tf)return Xe.fail(i.message);throw i}}}function Kv(n,e,t){let r=[];for(let s=0;s<n.childCount;s++){let i=n.child(s);i.content.size&&(i=i.copy(Kv(i.content,e,i))),i.isInline&&(i=e(i,t,s)),r.push(i)}return U.fromArray(r)}class Rs extends jt{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new K(Kv(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),t.openStart,t.openEnd);return Xe.fromReplace(e,this.from,this.to,i)}invert(){return new ir(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new Rs(t.pos,r.pos,this.mark)}merge(e){return e instanceof Rs&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Rs(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Rs(t.from,t.to,e.markFromJSON(t.mark))}}jt.jsonID("addMark",Rs);class ir extends jt{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new K(Kv(t.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),t.openStart,t.openEnd);return Xe.fromReplace(e,this.from,this.to,r)}invert(){return new Rs(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new ir(t.pos,r.pos,this.mark)}merge(e){return e instanceof ir&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ir(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ir(t.from,t.to,e.markFromJSON(t.mark))}}jt.jsonID("removeMark",ir);class Ps extends jt{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Xe.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Xe.fromReplace(e,this.pos,this.pos+1,new K(U.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let s=0;s<t.marks.length;s++)if(!t.marks[s].isInSet(r))return new Ps(this.pos,t.marks[s]);return new Ps(this.pos,this.mark)}}return new wo(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ps(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ps(t.pos,e.markFromJSON(t.mark))}}jt.jsonID("addNodeMark",Ps);class wo extends jt{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Xe.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Xe.fromReplace(e,this.pos,this.pos+1,new K(U.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Ps(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new wo(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new wo(t.pos,e.markFromJSON(t.mark))}}jt.jsonID("removeNodeMark",wo);class ct extends jt{constructor(e,t,r,s=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=s}apply(e){return this.structure&&Py(e,this.from,this.to)?Xe.fail("Structure replace would overwrite content"):Xe.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new hn([this.from,this.to-this.from,this.slice.size])}invert(e){return new ct(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new ct(t.pos,Math.max(t.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ct)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?K.empty:new K(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ct(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?K.empty:new K(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ct(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ct(t.from,t.to,K.fromJSON(e,t.slice),!!t.structure)}}jt.jsonID("replace",ct);class dt extends jt{constructor(e,t,r,s,i,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Py(e,this.from,this.gapFrom)||Py(e,this.gapTo,this.to)))return Xe.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Xe.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?Xe.fromReplace(e,this.from,this.to,r):Xe.fail("Content does not fit in gap")}getMap(){return new hn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new dt(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||s<t.pos||i>r.pos?null:new dt(t.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new dt(t.from,t.to,t.gapFrom,t.gapTo,K.fromJSON(e,t.slice),t.insert,!!t.structure)}}jt.jsonID("replaceAround",dt);function Py(n,e,t){let r=n.resolve(e),s=t-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function Mz(n,e,t,r){let s=[],i=[],o,a;n.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),m=Math.min(c+l.nodeSize,t),y=r.addToSet(h);for(let v=0;v<h.length;v++)h[v].isInSet(y)||(o&&o.to==f&&o.mark.eq(h[v])?o.to=m:s.push(o=new ir(f,m,h[v])));a&&a.to==f?a.to=m:i.push(a=new Rs(f,m,r))}}),s.forEach(l=>n.step(l)),i.forEach(l=>n.step(l))}function Oz(n,e,t,r){let s=[],i=0;n.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof ip){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let h=l[u],f;for(let m=0;m<s.length;m++){let y=s[m];y.step==i-1&&h.eq(s[m].style)&&(f=y)}f?(f.to=c,f.step=i):s.push({style:h,from:Math.max(a,e),to:c,step:i})}}}),s.forEach(o=>n.step(new ir(o.from,o.to,o.style)))}function Gv(n,e,t,r=t.contentMatch,s=!0){let i=n.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let c=i.child(l),u=a+c.nodeSize,h=r.matchType(c.type);if(!h)o.push(new ct(a,u,K.empty));else{r=h;for(let f=0;f<c.marks.length;f++)t.allowsMarkType(c.marks[f].type)||n.step(new ir(a,u,c.marks[f]));if(s&&c.isText&&t.whitespace!="pre"){let f,m=/\r?\n|\r/g,y;for(;f=m.exec(c.text);)y||(y=new K(U.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new ct(a+f.index,a+f.index+f[0].length,y))}}a=u}if(!r.validEnd){let l=r.fillBefore(U.empty,!0);n.replace(a,a,new K(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function Vz(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function rl(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let r=n.depth;;--r){let s=n.$from.node(r),i=n.$from.index(r),o=n.$to.indexAfter(r);if(r<n.depth&&s.canReplace(i,o,t))return r;if(r==0||s.type.spec.isolating||!Vz(s,i,o))break}return null}function jz(n,e,t){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,c=a,u=U.empty,h=0;for(let y=i,v=!1;y>t;y--)v||r.index(y)>0?(v=!0,u=U.from(r.node(y).copy(u)),h++):l--;let f=U.empty,m=0;for(let y=i,v=!1;y>t;y--)v||s.after(y+1)<s.end(y)?(v=!0,f=U.from(s.node(y).copy(f)),m++):c++;n.step(new dt(l,c,o,a,new K(u.append(f),h,m),u.size-h,!0))}function Qv(n,e,t=null,r=n){let s=Lz(n,e),i=s&&Fz(r,e);return i?s.map(Hk).concat({type:e,attrs:t}).concat(i.map(Hk)):null}function Hk(n){return{type:n,attrs:null}}function Lz(n,e){let{parent:t,startIndex:r,endIndex:s}=n,i=t.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return t.canReplaceWith(r,s,o)?i:null}function Fz(n,e){let{parent:t,startIndex:r,endIndex:s}=n,i=t.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<s;c++)l=l.matchType(t.child(c).type);return!l||!l.validEnd?null:o}function Bz(n,e,t){let r=U.empty;for(let o=t.length-1;o>=0;o--){if(r.size){let a=t[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=U.from(t[o].type.create(t[o].attrs,r))}let s=e.start,i=e.end;n.step(new dt(s,i,s,i,new K(r,0,0),t.length,!0))}function Uz(n,e,t,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=n.steps.length;n.doc.nodesBetween(e,t,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&$z(n.doc,n.mapping.slice(i).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let m=r.whitespace=="pre",y=!!r.contentMatch.matchType(r.schema.linebreakReplacement);m&&!y?c=!1:!m&&y&&(c=!0)}c===!1&&vA(n,o,a,i),Gv(n,n.mapping.slice(i).map(a,1),r,void 0,c===null);let u=n.mapping.slice(i),h=u.map(a,1),f=u.map(a+o.nodeSize,1);return n.step(new dt(h,f,h+1,f-1,new K(U.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&yA(n,o,a,i),!1}})}function yA(n,e,t,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=n.mapping.slice(r).map(t+1+i+o.index);n.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function vA(n,e,t,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=n.mapping.slice(r).map(t+1+i);n.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function $z(n,e,t){let r=n.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,t)}function zz(n,e,t,r,s){let i=n.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let o=t.create(r,null,s||i.marks);if(i.isLeaf)return n.replaceWith(e,e+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new dt(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new K(U.from(o),0,0),1,!0))}function zr(n,e,t=1,r){let s=n.resolve(e),i=s.depth-t,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,u=t-2;c>i;c--,u--){let h=s.node(c),f=s.index(c);if(h.type.spec.isolating)return!1;let m=h.content.cutByIndex(f,h.childCount),y=r&&r[u+1];y&&(m=m.replaceChild(0,y.type.create(y.attrs)));let v=r&&r[u]||h;if(!h.canReplace(f+1,h.childCount)||!v.type.validContent(m))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function Wz(n,e,t=1,r){let s=n.doc.resolve(e),i=U.empty,o=U.empty;for(let a=s.depth,l=s.depth-t,c=t-1;a>l;a--,c--){i=U.from(s.node(a).copy(i));let u=r&&r[c];o=U.from(u?u.type.create(u.attrs,o):s.node(a).copy(o))}n.step(new ct(e,e,new K(i.append(o),t,t),!0))}function vi(n,e){let t=n.resolve(e),r=t.index();return wA(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(r,r+1)}function qz(n,e){e.content.size||n.type.compatibleContent(e.type);let t=n.contentMatchAt(n.childCount),{linebreakReplacement:r}=n.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?n.type.schema.nodes.text:i.type;if(t=t.matchType(o),!t||!n.type.allowsMarks(i.marks))return!1}return t.validEnd}function wA(n,e){return!!(n&&e&&!n.isLeaf&&qz(n,e))}function op(n,e,t=-1){let r=n.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):t>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&wA(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=t<0?r.before(s):r.after(s)}}function Hz(n,e,t){let r=null,{linebreakReplacement:s}=n.doc.type.schema,i=n.doc.resolve(e-t),o=i.node().type;if(s&&o.inlineContent){let u=o.whitespace=="pre",h=!!o.contentMatch.matchType(s);u&&!h?r=!1:!u&&h&&(r=!0)}let a=n.steps.length;if(r===!1){let u=n.doc.resolve(e+t);vA(n,u.node(),u.before(),a)}o.inlineContent&&Gv(n,e+t-1,o,i.node().contentMatchAt(i.index()),r==null);let l=n.mapping.slice(a),c=l.map(e-t);if(n.step(new ct(c,l.map(e+t,-1),K.empty,!0)),r===!0){let u=n.doc.resolve(c);yA(n,u.node(),u.before(),n.steps.length)}return n}function Kz(n,e,t){let r=n.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),t))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,t))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,t))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function _A(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let s=t.content;for(let i=0;i<t.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(i==1)u=c.canReplace(l,l,s);else{let h=c.contentMatchAt(l).findWrapping(s.firstChild.type);u=h&&c.canReplaceWith(l,l,h[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function ap(n,e,t=e,r=K.empty){if(e==t&&!r.size)return null;let s=n.resolve(e),i=n.resolve(t);return xA(s,i,r)?new ct(e,t,r):new Gz(s,i,r).fit()}function xA(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class Gz{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=U.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=U.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new K(i,o,a);return e>-1?new dt(r.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||r.pos!=this.$to.pos?new ct(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=t.firstChild;if(t.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}t=i.content}for(let t=1;t<=2;t++)for(let r=t==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=Rm(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,h=null;if(t==1&&(o?c.matchType(o.type)||(h=c.fillBefore(U.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:h};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:u};if(i&&c.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,s=Rm(e,t);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new K(e,t+1,Math.max(r,s.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,s=Rm(e,t);if(s.childCount<=1&&t>0){let i=e.size-t<=t+s.size;this.unplaced=new K(ql(e,t-1,1),t-1,i?t-1:r)}else this.unplaced=new K(ql(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:s,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let v=0;v<i.length;v++)this.openFrontierNode(i[v]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:h,type:f}=this.frontier[t];if(s){for(let v=0;v<s.childCount;v++)u.push(s.child(v));h=h.matchFragment(s)}let m=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let v=a.child(c),_=h.matchType(v.type);if(!_)break;c++,(c>1||l==0||v.content.size)&&(h=_,u.push(EA(v.mark(f.allowedMarks(v.marks)),c==1?l:0,c==a.childCount?m:-1)))}let y=c==a.childCount;y||(m=-1),this.placed=Hl(this.placed,t,U.from(u)),this.frontier[t].match=h,y&&m<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let v=0,_=a;v<m;v++){let x=_.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),_=x.content}this.unplaced=y?e==0?K.empty:new K(ql(o.content,e-1,1),e-1,m<0?o.openEnd:e-1):new K(ql(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Pm(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:s}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=Pm(e,t,s,r,i);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Pm(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Hl(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,t=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Hl(this.placed,this.depth,U.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(U.empty,!0);t.childCount&&(this.placed=Hl(this.placed,this.frontier.length,t))}}function ql(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(ql(n.firstChild.content,e-1,t)))}function Hl(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(Hl(n.lastChild.content,e-1,t)))}function Rm(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function EA(n,e,t){if(e<=0)return n;let r=n.content;return e>1&&(r=r.replaceChild(0,EA(r.firstChild,e-1,r.childCount==1?t-1:0))),e>0&&(r=n.type.contentMatch.fillBefore(r).append(r),t<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(U.empty,!0)))),n.copy(r)}function Pm(n,e,t,r,s){let i=n.node(e),o=s?n.indexAfter(e):n.index(e);if(o==i.childCount&&!t.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!Qz(t,i.content,o)?a:null}function Qz(n,e,t){for(let r=t;r<e.childCount;r++)if(!n.allowsMarks(e.child(r).marks))return!0;return!1}function Jz(n){return n.spec.defining||n.spec.definingForContent}function Yz(n,e,t,r){if(!r.size)return n.deleteRange(e,t);let s=n.doc.resolve(e),i=n.doc.resolve(t);if(xA(s,i,r))return n.step(new ct(e,t,r));let o=TA(s,n.doc.resolve(t));o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let f=s.depth,m=s.pos-1;f>0;f--,m--){let y=s.node(f).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;o.indexOf(f)>-1?a=f:s.before(f)==m&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,m=0;;m++){let y=f.firstChild;if(c.push(y),m==r.openStart)break;f=y.content}for(let f=u-1;f>=0;f--){let m=c[f],y=Jz(m.type);if(y&&!m.sameMarkup(s.node(Math.abs(a)-1)))u=f;else if(y||!m.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let m=(f+u+1)%(r.openStart+1),y=c[m];if(y)for(let v=0;v<o.length;v++){let _=o[(v+l)%o.length],x=!0;_<0&&(x=!1,_=-_);let T=s.node(_-1),b=s.index(_-1);if(T.canReplaceWith(b,b,y.type,y.marks))return n.replace(s.before(_),x?i.after(_):t,new K(kA(r.content,0,r.openStart,m),m,r.openEnd))}}let h=n.steps.length;for(let f=o.length-1;f>=0&&(n.replace(e,t,r),!(n.steps.length>h));f--){let m=o[f];m<0||(e=s.before(m),t=i.after(m))}}function kA(n,e,t,r,s){if(e<t){let i=n.firstChild;n=n.replaceChild(0,i.copy(kA(i.content,e+1,t,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(n).append(n);n=o.append(i.matchFragment(o).fillBefore(U.empty,!0))}return n}function Xz(n,e,t,r){if(!r.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let s=Kz(n.doc,e,r.type);s!=null&&(e=t=s)}n.replaceRange(e,t,new K(U.from(r),0,0))}function Zz(n,e,t){let r=n.doc.resolve(e),s=n.doc.resolve(t),i=TA(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return n.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return n.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&t>r.end(o)&&s.end(o)-t!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return n.delete(r.before(o),t);n.delete(e,t)}function TA(n,e){let t=[],r=Math.min(n.depth,e.depth);for(let s=r;s>=0;s--){let i=n.start(s);if(i<n.pos-(n.depth-s)||e.end(s)>e.pos+(e.depth-s)||n.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==n.depth&&s==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&t.push(s)}return t}class Ea extends jt{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return Xe.fail("No node at attribute step's position");let r=Object.create(null);for(let i in t.attrs)r[i]=t.attrs[i];r[this.attr]=this.value;let s=t.type.create(r,null,t.marks);return Xe.fromReplace(e,this.pos,this.pos+1,new K(U.from(s),0,t.isLeaf?0:1))}getMap(){return hn.empty}invert(e){return new Ea(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ea(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ea(t.pos,t.attr,t.value)}}jt.jsonID("attr",Ea);class Qc extends jt{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return Xe.ok(r)}getMap(){return hn.empty}invert(e){return new Qc(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Qc(t.attr,t.value)}}jt.jsonID("docAttr",Qc);let $a=class extends Error{};$a=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};$a.prototype=Object.create(Error.prototype);$a.prototype.constructor=$a;$a.prototype.name="TransformError";class e9{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Gc}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new $a(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=K.empty){let s=ap(this.doc,e,t,r);return s&&this.step(s),this}replaceWith(e,t,r){return this.replace(e,t,new K(U.from(r),0,0))}delete(e,t){return this.replace(e,t,K.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return Yz(this,e,t,r),this}replaceRangeWith(e,t,r){return Xz(this,e,t,r),this}deleteRange(e,t){return Zz(this,e,t),this}lift(e,t){return jz(this,e,t),this}join(e,t=1){return Hz(this,e,t),this}wrap(e,t){return Bz(this,e,t),this}setBlockType(e,t=e,r,s=null){return Uz(this,e,t,r,s),this}setNodeMarkup(e,t,r=null,s){return zz(this,e,t,r,s),this}setNodeAttribute(e,t,r){return this.step(new Ea(e,t,r)),this}setDocAttribute(e,t){return this.step(new Qc(e,t)),this}addNodeMark(e,t){return this.step(new Ps(e,t)),this}removeNodeMark(e,t){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(t instanceof Se)t.isInSet(r.marks)&&this.step(new wo(e,t));else{let s=r.marks,i,o=[];for(;i=t.isInSet(s);)o.push(new wo(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,r){return Wz(this,e,t,r),this}addMark(e,t,r){return Mz(this,e,t,r),this}removeMark(e,t,r){return Oz(this,e,t,r),this}clearIncompatible(e,t,r){return Gv(this,e,t,r),this}}const Dm=Object.create(null);class ce{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new t9(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=K.empty){let r=t.content.lastChild,s=null;for(let a=0;a<t.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?K.empty:t),a==0&&Qk(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),Qk(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let s=e.parent.inlineContent?new se(e):Go(e.node(0),e.parent,e.pos,e.index(),t,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=t<0?Go(e.node(0),e.node(i),e.before(i+1),e.index(i),t,r):Go(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,r);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new vn(e.node(0))}static atStart(e){return Go(e,e,0,0,1)||new vn(e)}static atEnd(e){return Go(e,e,e.content.size,e.childCount,-1)||new vn(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Dm[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in Dm)throw new RangeError("Duplicate use of selection JSON ID "+e);return Dm[e]=t,t.prototype.jsonID=e,t}getBookmark(){return se.between(this.$anchor,this.$head).getBookmark()}}ce.prototype.visible=!0;class t9{constructor(e,t){this.$from=e,this.$to=t}}let Kk=!1;function Gk(n){!Kk&&!n.parent.inlineContent&&(Kk=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class se extends ce{constructor(e,t=e){Gk(e),Gk(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return ce.near(r);let s=e.resolve(t.map(this.anchor));return new se(s.parent.inlineContent?s:r,r)}replace(e,t=K.empty){if(super.replace(e,t),t==K.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof se&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new lp(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new se(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let s=e.resolve(t);return new this(s,r==t?s:e.resolve(r))}static between(e,t,r){let s=e.pos-t.pos;if((!r||s)&&(r=s>=0?1:-1),!t.parent.inlineContent){let i=ce.findFrom(t,r,!0)||ce.findFrom(t,-r,!0);if(i)t=i.$head;else return ce.near(t,r)}return e.parent.inlineContent||(s==0?e=t:(e=(ce.findFrom(e,-r,!0)||ce.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=s<0&&(e=t))),new se(e,t)}}ce.jsonID("text",se);class lp{constructor(e,t){this.anchor=e,this.head=t}map(e){return new lp(e.map(this.anchor),e.map(this.head))}resolve(e){return se.between(e.resolve(this.anchor),e.resolve(this.head))}}class ee extends ce{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:s}=t.mapResult(this.anchor),i=e.resolve(s);return r?ce.near(i):new ee(i)}content(){return new K(U.from(this.node),0,0)}eq(e){return e instanceof ee&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Jv(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ee(e.resolve(t.anchor))}static create(e,t){return new ee(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ee.prototype.visible=!1;ce.jsonID("node",ee);class Jv{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new lp(r,r):new Jv(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&ee.isSelectable(r)?new ee(t):ce.near(t)}}class vn extends ce{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=K.empty){if(t==K.empty){e.delete(0,e.doc.content.size);let r=ce.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new vn(e)}map(e){return new vn(e)}eq(e){return e instanceof vn}getBookmark(){return n9}}ce.jsonID("all",vn);const n9={map(){return this},resolve(n){return new vn(n)}};function Go(n,e,t,r,s,i=!1){if(e.inlineContent)return se.create(n,t);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&ee.isSelectable(a))return ee.create(n,t-(s<0?a.nodeSize:0))}else{let l=Go(n,a,t+s,s<0?a.childCount:0,s,i);if(l)return l}t+=a.nodeSize*s}return null}function Qk(n,e,t){let r=n.steps.length-1;if(r<e)return;let s=n.steps[r];if(!(s instanceof ct||s instanceof dt))return;let i=n.mapping.maps[r],o;i.forEach((a,l,c,u)=>{o==null&&(o=u)}),n.setSelection(ce.near(n.doc.resolve(o),t))}const Jk=1,wd=2,Yk=4;class r9 extends e9{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Jk)&~wd,this.storedMarks=null,this}get selectionSet(){return(this.updated&Jk)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=wd,this}ensureMarks(e){return Se.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&wd)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~wd,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Se.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let s=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=t),!e)return this.deleteRange(t,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(t);i=r==t?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,s.text(e,i)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(ce.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Yk,this}get scrolledIntoView(){return(this.updated&Yk)>0}}function Xk(n,e){return!e||!n?n:n.bind(e)}class Kl{constructor(e,t,r){this.name=e,this.init=Xk(t.init,r),this.apply=Xk(t.apply,r)}}const s9=[new Kl("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Kl("selection",{init(n,e){return n.selection||ce.atStart(e.doc)},apply(n){return n.selection}}),new Kl("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new Kl("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class Mm{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=s9.slice(),t&&t.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Kl(r.key,r.spec.state,r))})}}class ca{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,c=s?s[o].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<o?{state:r,n:t.length}:{state:this,n:0})}t.push(u),r=r.applyInner(u),i=!0}s&&(s[o]={state:r,n:t.length})}}if(!i)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new ca(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new r9(this)}static create(e){let t=new Mm(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new ca(t);for(let s=0;s<t.fields.length;s++)r[t.fields[s].name]=t.fields[s].init(e,r);return r}reconfigure(e){let t=new Mm(this.schema,e.plugins),r=t.fields,s=new ca(t);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(t[r]=i.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Mm(e.schema,e.plugins),i=new ca(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Gs.fromJSON(e.schema,t.doc);else if(o.name=="selection")i.selection=ce.fromJSON(i.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){i[o.name]=c.fromJSON.call(l,e,t[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function bA(n,e,t){for(let r in n){let s=n[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=bA(s,e,{})),t[r]=s}return t}class Xt{constructor(e){this.spec=e,this.props={},e.props&&bA(e.props,this,this.props),this.key=e.key?e.key.key:SA("plugin")}getState(e){return e[this.key]}}const Om=Object.create(null);function SA(n){return n in Om?n+"$"+ ++Om[n]:(Om[n]=0,n+"$")}class Jn{constructor(e="key"){this.key=SA(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const _t=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},za=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let Dy=null;const Cr=function(n,e,t){let r=Dy||(Dy=document.createRange());return r.setEnd(n,t??n.nodeValue.length),r.setStart(n,e||0),r},i9=function(){Dy=null},_o=function(n,e,t,r){return t&&(Zk(n,e,t,r,-1)||Zk(n,e,t,r,1))},o9=/^(img|br|input|textarea|hr)$/i;function Zk(n,e,t,r,s){for(var i;;){if(n==t&&e==r)return!0;if(e==(s<0?0:Sn(n))){let o=n.parentNode;if(!o||o.nodeType!=1||Tu(n)||o9.test(n.nodeName)||n.contentEditable=="false")return!1;e=_t(n)+(s<0?0:1),n=o}else if(n.nodeType==1){let o=n.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else n=o,e=s<0?Sn(n):0}else return!1}}function Sn(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function a9(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=Sn(n)}else if(n.parentNode&&!Tu(n))e=_t(n),n=n.parentNode;else return null}}function l9(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!Tu(n))e=_t(n)+1,n=n.parentNode;else return null}}function c9(n,e,t){for(let r=e==0,s=e==Sn(n);r||s;){if(n==t)return!0;let i=_t(n);if(n=n.parentNode,!n)return!1;r=r&&i==0,s=s&&i==Sn(n)}}function Tu(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const cp=function(n){return n.focusNode&&_o(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function Vi(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function u9(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function d9(n,e,t){if(n.caretPositionFromPoint)try{let r=n.caretPositionFromPoint(e,t);if(r)return{node:r.offsetNode,offset:Math.min(Sn(r.offsetNode),r.offset)}}catch{}if(n.caretRangeFromPoint){let r=n.caretRangeFromPoint(e,t);if(r)return{node:r.startContainer,offset:Math.min(Sn(r.startContainer),r.startOffset)}}}const pr=typeof navigator<"u"?navigator:null,eT=typeof document<"u"?document:null,wi=pr&&pr.userAgent||"",My=/Edge\/(\d+)/.exec(wi),IA=/MSIE \d/.exec(wi),Oy=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(wi),an=!!(IA||Oy||My),Js=IA?document.documentMode:Oy?+Oy[1]:My?+My[1]:0,Pn=!an&&/gecko\/(\d+)/i.test(wi);Pn&&+(/Firefox\/(\d+)/.exec(wi)||[0,0])[1];const Vy=!an&&/Chrome\/(\d+)/.exec(wi),Dt=!!Vy,CA=Vy?+Vy[1]:0,Kt=!an&&!!pr&&/Apple Computer/.test(pr.vendor),Wa=Kt&&(/Mobile\/\w+/.test(wi)||!!pr&&pr.maxTouchPoints>2),kn=Wa||(pr?/Mac/.test(pr.platform):!1),h9=pr?/Win/.test(pr.platform):!1,Vr=/Android \d/.test(wi),bu=!!eT&&"webkitFontSmoothing"in eT.documentElement.style,f9=bu?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function p9(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Sr(n,e){return typeof n=="number"?n:n[e]}function m9(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,r=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*r}}function tT(n,e,t){let r=n.someProp("scrollThreshold")||0,s=n.someProp("scrollMargin")||5,i=n.dom.ownerDocument;for(let o=t||n.dom;o;){if(o.nodeType!=1){o=za(o);continue}let a=o,l=a==i.body,c=l?p9(i):m9(a),u=0,h=0;if(e.top<c.top+Sr(r,"top")?h=-(c.top-e.top+Sr(s,"top")):e.bottom>c.bottom-Sr(r,"bottom")&&(h=e.bottom-e.top>c.bottom-c.top?e.top+Sr(s,"top")-c.top:e.bottom-c.bottom+Sr(s,"bottom")),e.left<c.left+Sr(r,"left")?u=-(c.left-e.left+Sr(s,"left")):e.right>c.right-Sr(r,"right")&&(u=e.right-c.right+Sr(s,"right")),u||h)if(l)i.defaultView.scrollBy(u,h);else{let m=a.scrollLeft,y=a.scrollTop;h&&(a.scrollTop+=h),u&&(a.scrollLeft+=u);let v=a.scrollLeft-m,_=a.scrollTop-y;e={left:e.left-v,top:e.top-_,right:e.right-v,bottom:e.bottom-_}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:za(o)}}function g9(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=n.root.elementFromPoint(i,o);if(!a||a==n.dom||!n.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:NA(n.dom)}}function NA(n){let e=[],t=n.ownerDocument;for(let r=n;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),n!=t);r=za(r));return e}function y9({refDOM:n,refTop:e,stack:t}){let r=n?n.getBoundingClientRect().top:0;AA(t,r==0?0:r-e)}function AA(n,e){for(let t=0;t<n.length;t++){let{dom:r,top:s,left:i}=n[t];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let Uo=null;function v9(n){if(n.setActive)return n.setActive();if(Uo)return n.focus(Uo);let e=NA(n);n.focus(Uo==null?{get preventScroll(){return Uo={preventScroll:!0},!0}}:void 0),Uo||(Uo=!1,AA(e,0))}function RA(n,e){let t,r=2e8,s,i=0,o=e.top,a=e.top,l,c;for(let u=n.firstChild,h=0;u;u=u.nextSibling,h++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=Cr(u).getClientRects();else continue;for(let m=0;m<f.length;m++){let y=f[m];if(y.top<=o&&y.bottom>=a){o=Math.max(y.bottom,o),a=Math.min(y.top,a);let v=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(v<r){t=u,r=v,s=v&&t.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,u.nodeType==1&&v&&(i=h+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=u,c={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!t&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(i=h+1)}}return!t&&l&&(t=l,s=c,r=0),t&&t.nodeType==3?w9(t,s):!t||r&&t.nodeType==1?{node:n,offset:i}:RA(t,s)}function w9(n,e){let t=n.nodeValue.length,r=document.createRange();for(let s=0;s<t;s++){r.setEnd(n,s+1),r.setStart(n,s);let i=fs(r,1);if(i.top!=i.bottom&&Yv(e,i))return{node:n,offset:s+(e.left>=(i.left+i.right)/2?1:0)}}return{node:n,offset:0}}function Yv(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function _9(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function x9(n,e,t){let{node:r,offset:s}=RA(e,t),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return n.docView.posFromDOM(r,s,i)}function E9(n,e,t,r){let s=-1;for(let i=e,o=!1;i!=n.dom;){let a=n.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:n.docView.posFromDOM(e,t,-1)}function PA(n,e,t){let r=n.childNodes.length;if(r&&t.top<t.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-t.top)/(t.bottom-t.top))-2)),i=s;;){let o=n.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Yv(e,c))return PA(o,e,c)}}if((i=(i+1)%r)==s)break}return n}function k9(n,e){let t=n.dom.ownerDocument,r,s=0,i=d9(t,e.left,e.top);i&&({node:r,offset:s}=i);let o=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),a;if(!o||!n.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=n.dom.getBoundingClientRect();if(!Yv(e,c)||(o=PA(n.dom,e,c),!o))return null}if(Kt)for(let c=o;r&&c;c=za(c))c.draggable&&(r=void 0);if(o=_9(o,e),r){if(Pn&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let u=r.childNodes[s],h;u.nodeName=="IMG"&&(h=u.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let c;bu&&s&&r.nodeType==1&&(c=r.childNodes[s-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&s--,r==n.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=n.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=E9(n,r,s,e))}a==null&&(a=x9(n,o,e));let l=n.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function nT(n){return n.top<n.bottom||n.left<n.right}function fs(n,e){let t=n.getClientRects();if(t.length){let r=t[e<0?0:t.length-1];if(nT(r))return r}return Array.prototype.find.call(t,nT)||n.getBoundingClientRect()}const T9=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function DA(n,e,t){let{node:r,offset:s,atom:i}=n.docView.domFromPos(e,t<0?-1:1),o=bu||Pn;if(r.nodeType==3)if(o&&(T9.test(r.nodeValue)||(t<0?!s:s==r.nodeValue.length))){let l=fs(Cr(r,s,s),t);if(Pn&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let c=fs(Cr(r,s-1,s-1),-1);if(c.top==l.top){let u=fs(Cr(r,s,s+1),-1);if(u.top!=l.top)return Dl(u,u.left<c.left)}}return l}else{let l=s,c=s,u=t<0?1:-1;return t<0&&!s?(c++,u=-1):t>=0&&s==r.nodeValue.length?(l--,u=1):t<0?l--:c++,Dl(fs(Cr(r,l,c),u),u<0)}if(!n.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(t<0||s==Sn(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return Vm(l.getBoundingClientRect(),!1)}if(i==null&&s<Sn(r)){let l=r.childNodes[s];if(l.nodeType==1)return Vm(l.getBoundingClientRect(),!0)}return Vm(r.getBoundingClientRect(),t>=0)}if(i==null&&s&&(t<0||s==Sn(r))){let l=r.childNodes[s-1],c=l.nodeType==3?Cr(l,Sn(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Dl(fs(c,1),!1)}if(i==null&&s<Sn(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Cr(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Dl(fs(c,-1),!0)}return Dl(fs(r.nodeType==3?Cr(r):r,-t),t>=0)}function Dl(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function Vm(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function MA(n,e,t){let r=n.state,s=n.root.activeElement;r!=e&&n.updateState(e),s!=n.dom&&n.focus();try{return t()}finally{r!=e&&n.updateState(r),s!=n.dom&&s&&s.focus()}}function b9(n,e,t){let r=e.selection,s=t=="up"?r.$from:r.$to;return MA(n,e,()=>{let{node:i}=n.docView.domFromPos(s.pos,t=="up"?-1:1);for(;;){let a=n.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=DA(n,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Cr(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const S9=/[\u0590-\u08ac]/;function I9(n,e,t){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=n.domSelection();return a?!S9.test(r.parent.textContent)||!a.modify?t=="left"||t=="backward"?i:o:MA(n,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:h}=n.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",t,"character");let m=r.depth?n.docView.domAfterPos(r.before()):n.dom,{focusNode:y,focusOffset:v}=n.domSelectionRange(),_=y&&!m.contains(y.nodeType==1?y:y.parentNode)||l==y&&c==v;try{a.collapse(u,h),l&&(l!=u||c!=h)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),_}):r.pos==r.start()||r.pos==r.end()}let rT=null,sT=null,iT=!1;function C9(n,e,t){return rT==e&&sT==t?iT:(rT=e,sT=t,iT=t=="up"||t=="down"?b9(n,e,t):I9(n,e,t))}const Dn=0,oT=1,Ui=2,mr=3;class Su{constructor(e,t,r,s){this.parent=e,this.children=t,this.dom=r,this.contentDOM=s,this.dirty=Dn,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let s=this.children[t];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=t>_t(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!t||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let r=t;r;r=r.parent)if(r==this)return t}posFromDOM(e,t,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let s=this.children[t],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof VA){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,t);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof OA&&i.side>=0;r--);if(t<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&t&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?_t(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?_t(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(s==-1&&e<=c){let u=o+l.border;if(e>=u&&t<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=o;for(let h=a;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){s=_t(f.dom)+1;break}e-=f.size}s==-1&&(s=0)}if(s>-1&&(c>t||a==this.children.length-1)){t=c;for(let u=a+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=_t(h.dom);break}t+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(t.nodeType!=1||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,s=!1){let i=Math.min(e,t),o=Math.max(e,t);for(let m=0,y=0;m<this.children.length;m++){let v=this.children[m],_=y+v.size;if(i>y&&o<_)return v.setSelection(e-y-v.border,t-y-v.border,r,s);y=_}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),h=!1;if((Pn||Kt)&&e==t){let{node:m,offset:y}=a;if(m.nodeType==3){if(h=!!(y&&m.nodeValue[y-1]==`
`),h&&y==m.nodeValue.length)for(let v=m,_;v;v=v.parentNode){if(_=v.nextSibling){_.nodeName=="BR"&&(a=l={node:_.parentNode,offset:_t(_)+1});break}let x=v.pmViewDesc;if(x&&x.node&&x.node.isBlock)break}}else{let v=m.childNodes[y-1];h=v&&(v.nodeName=="BR"||v.contentEditable=="false")}}if(Pn&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let m=u.focusNode.childNodes[u.focusOffset];m&&m.contentEditable=="false"&&(s=!0)}if(!(s||h&&Kt)&&_o(a.node,a.offset,u.anchorNode,u.anchorOffset)&&_o(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==t)&&!(h&&Pn)){c.collapse(a.node,a.offset);try{e!=t&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>t){let y=a;a=l,l=y}let m=document.createRange();m.setEnd(l.node,l.offset),m.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(m)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&t>=r:e<o&&t>r){let a=r+i.border,l=o-i.border;if(e>=a&&t<=l){this.dirty=e==r||t==o?Ui:oT,e==a&&t==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=mr:i.markDirty(e-a,t-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Ui:mr}r=o}this.dirty=Ui}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=e==1?Ui:oT;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class OA extends Su{constructor(e,t,r,s){let i,o=t.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Dn&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class N9 extends Su{constructor(e,t,r,s){super(e,[],t,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class xo extends Su{constructor(e,t,r,s,i){super(e,[],r,s),this.mark=t,this.spec=i}static create(e,t,r,s){let i=s.nodeViews[t.type.name],o=i&&i(t,s,r);return(!o||!o.dom)&&(o=Ao.renderSpec(document,t.type.spec.toDOM(t,r),null,t.attrs)),new xo(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&mr||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=mr&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Dn){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Dn}}slice(e,t,r){let s=xo.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;t<o&&(i=Ly(i,t,o,r)),e>0&&(i=Ly(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Ys extends Su{constructor(e,t,r,s,i,o,a,l,c){super(e,[],i,o),this.node=t,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,t,r,s,i,o){let a=i.nodeViews[t.type.name],l,c=a&&a(t,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),u=c&&c.dom,h=c&&c.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=Ao.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!h&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let f=u;return u=FA(u,r,t),c?l=new A9(e,t,r,s,u,h||null,f,c,i,o+1):t.isText?new up(e,t,r,s,u,f,i):new Ys(e,t,r,s,u,h||null,f,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>U.empty)}return e}matchesNode(e,t,r){return this.dirty==Dn&&e.eq(this.node)&&of(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,s=t,i=e.composing?this.localCompositionInfo(e,t):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new P9(this,o&&o.node,e);O9(this.node,this.innerDeco,(c,u,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(u==this.node.childCount?Se.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,s)},(c,u,h,f)=>{l.syncToMarks(c.marks,r,e);let m;l.findNodeMatch(c,u,h,f)||a&&e.state.selection.from>s&&e.state.selection.to<s+c.nodeSize&&(m=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(c,u,h,m,e)||l.updateNextNode(c,u,h,e,f,s)||l.addNode(c,u,h,e,s),s+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Ui)&&(o&&this.protectLocalComposition(e,o),jA(this.contentDOM,this.children,e),Wa&&V9(this.dom))}localCompositionInfo(e,t){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof se)||r<t||s>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=j9(this.node.content,o,r-t,s-t);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:s}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new N9(this,i,t,s);e.input.compositionNodes.push(o),this.children=Ly(this.children,r,r+s.length,e,o)}update(e,t,r,s){return this.dirty==mr||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,r,s),!0)}updateInner(e,t,r,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Dn}updateOuterDeco(e){if(of(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=LA(this.dom,this.nodeDOM,jy(this.outerDeco,this.node,t),jy(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function aT(n,e,t,r,s){FA(r,e,n);let i=new Ys(void 0,n,e,t,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class up extends Ys{constructor(e,t,r,s,i,o,a){super(e,t,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,s){return this.dirty==mr||this.dirty!=Dn&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Dn||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Dn,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,r){let s=this.node.cut(e,t),i=document.createTextNode(s.text);return new up(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=mr)}get domAtom(){return!1}isText(e){return this.node.text==e}}class VA extends Su{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Dn&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class A9 extends Ys{constructor(e,t,r,s,i,o,a,l,c,u){super(e,t,r,s,i,o,a,c,u),this.spec=l}update(e,t,r,s){if(this.dirty==mr)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,r);return i&&this.updateInner(e,t,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,s){this.spec.setSelection?this.spec.setSelection(e,t,r.root):super.setSelection(e,t,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function jA(n,e,t){let r=n.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==n){for(;a!=r;)r=lT(r),s=!0;r=r.nextSibling}else s=!0,n.insertBefore(a,r);if(o instanceof xo){let l=r?r.previousSibling:n.lastChild;jA(o.contentDOM,o.children,t),r=l?l.nextSibling:n.firstChild}}for(;r;)r=lT(r),s=!0;s&&t.trackWrites==n&&(t.trackWrites=null)}const dc=function(n){n&&(this.nodeName=n)};dc.prototype=Object.create(null);const $i=[new dc];function jy(n,e,t){if(n.length==0)return $i;let r=t?$i[0]:new dc,s=[r];for(let i=0;i<n.length;i++){let o=n[i].type.attrs;if(o){o.nodeName&&s.push(r=new dc(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&s.length==1&&s.push(r=new dc(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function LA(n,e,t,r){if(t==$i&&r==$i)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=t[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=n&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=$i[0]),s=l}R9(s,a||$i[0],o)}return s}function R9(n,e,t){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in t)&&n.removeAttribute(r);for(let r in t)r!="class"&&r!="style"&&r!="nodeName"&&t[r]!=e[r]&&n.setAttribute(r,t[r]);if(e.class!=t.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&n.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&n.classList.add(s[i]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)n.style.removeProperty(s[1])}t.style&&(n.style.cssText+=t.style)}}function FA(n,e,t){return LA(n,n,$i,jy(e,t,n.nodeType!=1))}function of(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function lT(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class P9{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=D9(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Dn,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[i])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=xo.create(this.top,e[i],t,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,t,r)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,r,s,i){let o=this.top.children[s];return o.dirty==mr&&o.dom==o.contentDOM&&(o.dirty=Ui),o.update(e,t,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=t}}updateNextNode(e,t,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Ys){let c=this.preMatch.matched.get(l);if(c!=null&&c!=i)return!1;let u=l.dom,h,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=mr&&of(t,l.outerDeco));if(!f&&l.update(e,t,r,s))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(l,e,t,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=Ui,h.updateChildren(s,o+1),h.dirty=Dn),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,r,s,i,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!of(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Ys.create(this.top,t,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,r,s,i){let o=Ys.create(this.top,e,t,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new OA(this.top,e,t,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof xo;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof up)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Kt||Dt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new VA(this.top,[],r,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function D9(n,e){let t=e,r=t.children.length,s=n.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let c=t.children[r-1];if(c instanceof xo)t=c,r=c.children.length;else{a=c,r--;break}}else{if(t==e)break e;r=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=n.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function M9(n,e){return n.type.side-e.type.side}function O9(n,e,t,r){let s=e.locals(n),i=0;if(s.length==0){for(let c=0;c<n.childCount;c++){let u=n.child(c);r(u,s,e.forChild(i,u),c),i+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,h;for(;o<s.length&&s[o].to==i;){let _=s[o++];_.widget&&(u?(h||(h=[u])).push(_):u=_)}if(u)if(h){h.sort(M9);for(let _=0;_<h.length;_++)t(h[_],c,!!l)}else t(u,c,!!l);let f,m;if(l)m=-1,f=l,l=null;else if(c<n.childCount)m=c,f=n.child(c++);else break;for(let _=0;_<a.length;_++)a[_].to<=i&&a.splice(_--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let y=i+f.nodeSize;if(f.isText){let _=y;o<s.length&&s[o].from<_&&(_=s[o].from);for(let x=0;x<a.length;x++)a[x].to<_&&(_=a[x].to);_<y&&(l=f.cut(_-i),f=f.cut(0,_-i),y=_,m=-1)}else for(;o<s.length&&s[o].to<y;)o++;let v=f.isInline&&!f.isLeaf?a.filter(_=>!_.inline):a.slice();r(f,v,e.forChild(i,f),m),i=y}}function V9(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function j9(n,e,t,r){for(let s=0,i=0;s<n.childCount&&i<=r;){let o=n.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<n.childCount;){let c=n.child(s++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=t){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=t)return a+c;if(t==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function Ly(n,e,t,r,s){let i=[];for(let o=0,a=0;o<n.length;o++){let l=n[o],c=a,u=a+=l.size;c>=t||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,r)),s&&(i.push(s),s=void 0),u>t&&i.push(l.slice(t-c,l.size,r)))}return i}function Xv(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let s=n.docView.nearestDesc(t.focusNode),i=s&&s.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(cp(t)){for(l=o;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&ee.isSelectable(h)&&s.parent&&!(h.isInline&&c9(t.focusNode,t.focusOffset,s.dom))){let f=s.posBefore;c=new ee(o==f?a:r.resolve(f))}}else{if(t instanceof n.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let h=o,f=o;for(let m=0;m<t.rangeCount;m++){let y=t.getRangeAt(m);h=Math.min(h,n.docView.posFromDOM(y.startContainer,y.startOffset,1)),f=Math.max(f,n.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(h<0)return null;[l,o]=f==n.state.selection.anchor?[f,h]:[h,f],a=r.resolve(o)}else l=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let h=e=="pointer"||n.state.selection.head<a.pos&&!i?1:-1;c=Zv(n,u,a,h)}return c}function BA(n){return n.editable?n.hasFocus():$A(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Wr(n,e=!1){let t=n.state.selection;if(UA(n,t),!!BA(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Dt){let r=n.domSelectionRange(),s=n.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&_o(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)F9(n);else{let{anchor:r,head:s}=t,i,o;cT&&!(t instanceof se)&&(t.$from.parent.inlineContent||(i=uT(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=uT(n,t.to))),n.docView.setSelection(r,s,n,e),cT&&(i&&dT(i),o&&dT(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&L9(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const cT=Kt||Dt&&CA<63;function uT(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),s=r<t.childNodes.length?t.childNodes[r]:null,i=r?t.childNodes[r-1]:null;if(Kt&&s&&s.contentEditable=="false")return jm(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return jm(s);if(i)return jm(i)}}function jm(n){return n.contentEditable="true",Kt&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function dT(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function L9(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,s=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=s)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!BA(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function F9(n){let e=n.domSelection();if(!e)return;let t=n.cursorWrapper.dom,r=t.nodeName=="IMG";r?e.collapse(t.parentNode,_t(t)+1):e.collapse(t,0),!r&&!n.state.selection.visible&&an&&Js<=11&&(t.disabled=!0,t.disabled=!1)}function UA(n,e){if(e instanceof ee){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(hT(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else hT(n)}function hT(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function Zv(n,e,t,r){return n.someProp("createSelectionBetween",s=>s(n,e,t))||se.between(e,t,r)}function fT(n){return n.editable&&!n.hasFocus()?!1:$A(n)}function $A(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function B9(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return _o(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Fy(n,e){let{$anchor:t,$head:r}=n.selection,s=e>0?t.max(r):t.min(r),i=s.parent.inlineContent?s.depth?n.doc.resolve(e>0?s.after():s.before()):null:s;return i&&ce.findFrom(i,e)}function gs(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function pT(n,e,t){let r=n.state.selection;if(r instanceof se)if(t.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=n.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return gs(n,new se(r.$anchor,o))}else if(r.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let s=Fy(n.state,e);return s&&s instanceof ee?gs(n,s):!1}else if(!(kn&&t.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=n.docView.descAt(a))&&!o.contentDOM?ee.isSelectable(i)?gs(n,new ee(e<0?n.state.doc.resolve(s.pos-i.nodeSize):s)):bu?gs(n,new se(n.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof ee&&r.node.isInline)return gs(n,new se(e>0?r.$to:r.$from));{let s=Fy(n.state,e);return s?gs(n,s):!1}}}function af(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function hc(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function $o(n,e){return e<0?U9(n):$9(n)}function U9(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let s,i,o=!1;for(Pn&&t.nodeType==1&&r<af(t)&&hc(t.childNodes[r],-1)&&(o=!0);;)if(r>0){if(t.nodeType!=1)break;{let a=t.childNodes[r-1];if(hc(a,-1))s=t,i=--r;else if(a.nodeType==3)t=a,r=t.nodeValue.length;else break}}else{if(zA(t))break;{let a=t.previousSibling;for(;a&&hc(a,-1);)s=t.parentNode,i=_t(a),a=a.previousSibling;if(a)t=a,r=af(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}o?By(n,t,r):s&&By(n,s,i)}function $9(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let s=af(t),i,o;for(;;)if(r<s){if(t.nodeType!=1)break;let a=t.childNodes[r];if(hc(a,1))i=t,o=++r;else break}else{if(zA(t))break;{let a=t.nextSibling;for(;a&&hc(a,1);)i=a.parentNode,o=_t(a)+1,a=a.nextSibling;if(a)t=a,r=0,s=af(t);else{if(t=t.parentNode,t==n.dom)break;r=s=0}}}i&&By(n,i,o)}function zA(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function z9(n,e){for(;n&&e==n.childNodes.length&&!Tu(n);)e=_t(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function W9(n,e){for(;n&&!e&&!Tu(n);)e=_t(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function By(n,e,t){if(e.nodeType!=3){let i,o;(o=z9(e,t))?(e=o,t=0):(i=W9(e,t))&&(e=i,t=i.nodeValue.length)}let r=n.domSelection();if(!r)return;if(cp(r)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:s}=n;setTimeout(()=>{n.state==s&&Wr(n)},50)}function mT(n,e){let t=n.state.doc.resolve(e);if(!(Dt||h9)&&t.parent.inlineContent){let s=n.coordsAtPos(e);if(e>t.start()){let i=n.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<t.end()){let i=n.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function gT(n,e,t){let r=n.state.selection;if(r instanceof se&&!r.empty||t.indexOf("s")>-1||kn&&t.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=Fy(n.state,e);if(o&&o instanceof ee)return gs(n,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof vn?ce.near(o,e):ce.findFrom(o,e);return a?gs(n,a):!1}return!1}function yT(n,e){if(!(n.state.selection instanceof se))return!0;let{$head:t,$anchor:r,empty:s}=n.state.selection;if(!t.sameParent(r))return!0;if(!s)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let o=n.state.tr;return e<0?o.delete(t.pos-i.nodeSize,t.pos):o.delete(t.pos,t.pos+i.nodeSize),n.dispatch(o),!0}return!1}function vT(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function q9(n){if(!Kt||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;vT(n,r,"true"),setTimeout(()=>vT(n,r,"false"),20)}return!1}function H9(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function K9(n,e){let t=e.keyCode,r=H9(e);if(t==8||kn&&t==72&&r=="c")return yT(n,-1)||$o(n,-1);if(t==46&&!e.shiftKey||kn&&t==68&&r=="c")return yT(n,1)||$o(n,1);if(t==13||t==27)return!0;if(t==37||kn&&t==66&&r=="c"){let s=t==37?mT(n,n.state.selection.from)=="ltr"?-1:1:-1;return pT(n,s,r)||$o(n,s)}else if(t==39||kn&&t==70&&r=="c"){let s=t==39?mT(n,n.state.selection.from)=="ltr"?1:-1:1;return pT(n,s,r)||$o(n,s)}else{if(t==38||kn&&t==80&&r=="c")return gT(n,-1,r)||$o(n,-1);if(t==40||kn&&t==78&&r=="c")return q9(n)||gT(n,1,r)||$o(n,1);if(r==(kn?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function ew(n,e){n.someProp("transformCopied",m=>{e=m(e,n)});let t=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let m=r.firstChild;t.push(m.type.name,m.attrs!=m.type.defaultAttrs?m.attrs:null),r=m.content}let o=n.someProp("clipboardSerializer")||Ao.fromSchema(n.state.schema),a=QA(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,h=0;for(;c&&c.nodeType==1&&(u=GA[c.nodeName.toLowerCase()]);){for(let m=u.length-1;m>=0;m--){let y=a.createElement(u[m]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${i}${h?` -${h}`:""} ${JSON.stringify(t)}`);let f=n.someProp("clipboardTextSerializer",m=>m(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function WA(n,e,t,r,s){let i=s.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=!!e&&(r||i||!t);if(l){if(n.someProp("transformPastedText",f=>{e=f(e,i||r,n)}),i)return a=new K(U.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),n.someProp("transformPasted",f=>{a=f(a,n,!0)}),a;let h=n.someProp("clipboardTextParser",f=>f(e,s,r,n));if(h)a=h;else{let f=s.marks(),{schema:m}=n.state,y=Ao.fromSchema(m);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(v=>{let _=o.appendChild(document.createElement("p"));v&&_.appendChild(y.serializeNode(m.text(v,f)))})}}else n.someProp("transformPastedHTML",h=>{t=h(t,n)}),o=Y9(t),bu&&X9(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(n.someProp("clipboardParser")||n.someProp("domParser")||Qs.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!G9.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Z9(wT(a,+u[1],+u[2]),u[4]);else if(a=K.maxOpen(Q9(a.content,s),!0),a.openStart||a.openEnd){let h=0,f=0;for(let m=a.content.firstChild;h<a.openStart&&!m.type.spec.isolating;h++,m=m.firstChild);for(let m=a.content.lastChild;f<a.openEnd&&!m.type.spec.isolating;f++,m=m.lastChild);a=wT(a,h,f)}return n.someProp("transformPasted",h=>{a=h(a,n,l)}),a}const G9=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Q9(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.index(t)),i,o=[];if(n.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&i.length&&HA(l,i,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=KA(o[o.length-1],i.length));let u=qA(a,l);o.push(u),s=s.matchType(u.type),i=l}}),o)return U.from(o)}return n}function qA(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,U.from(n));return n}function HA(n,e,t,r,s){if(s<n.length&&s<e.length&&n[s]==e[s]){let i=HA(n,e,t,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==n.length-1?t.type:n[s+1]))return r.copy(r.content.append(U.from(qA(t,n,s+1))))}}function KA(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,KA(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(U.empty,!0);return n.copy(t.append(r))}function Uy(n,e,t,r,s,i){let o=e<0?n.firstChild:n.lastChild,a=o.content;return n.childCount>1&&(i=0),s<r-1&&(a=Uy(a,e,t,r,s+1,i)),s>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(U.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(a))}function wT(n,e,t){return e<n.openStart&&(n=new K(Uy(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new K(Uy(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const GA={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _T=null;function QA(){return _T||(_T=document.implementation.createHTMLDocument("title"))}let Lm=null;function J9(n){let e=window.trustedTypes;return e?(Lm||(Lm=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),Lm.createHTML(n)):n}function Y9(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=QA().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),s;if((s=r&&GA[r[1].toLowerCase()])&&(n=s.map(i=>"<"+i+">").join("")+n+s.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=J9(n),s)for(let i=0;i<s.length;i++)t=t.querySelector(s[i])||t;return t}function X9(n){let e=n.querySelectorAll(Dt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function Z9(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:s,openStart:i,openEnd:o}=n;for(let a=r.length-2;a>=0;a-=2){let l=t.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=U.from(l.create(r[a+1],s)),i++,o++}return new K(s,i,o)}const Gt={},Qt={},e5={touchstart:!0,touchmove:!0};class t5{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function n5(n){for(let e in Gt){let t=Gt[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=r=>{s5(n,r)&&!tw(n,r)&&(n.editable||!(r.type in Qt))&&t(n,r)},e5[e]?{passive:!0}:void 0)}Kt&&n.dom.addEventListener("input",()=>null),$y(n)}function Ds(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function r5(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function $y(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=r=>tw(n,r))})}function tw(n,e){return n.someProp("handleDOMEvents",t=>{let r=t[e.type];return r?r(n,e)||e.defaultPrevented:!1})}function s5(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function i5(n,e){!tw(n,e)&&Gt[e.type]&&(n.editable||!(e.type in Qt))&&Gt[e.type](n,e)}Qt.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!YA(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(Vr&&Dt&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),Wa&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",s=>s(n,Vi(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||K9(n,t)?t.preventDefault():Ds(n,"key")};Qt.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};Qt.keypress=(n,e)=>{let t=e;if(YA(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||kn&&t.metaKey)return;if(n.someProp("handleKeyPress",s=>s(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof se)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(t.charCode),i=()=>n.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!n.someProp("handleTextInput",o=>o(n,r.$from.pos,r.$to.pos,s,i))&&n.dispatch(i()),t.preventDefault()}};function dp(n){return{left:n.clientX,top:n.clientY}}function o5(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}function nw(n,e,t,r,s){if(r==-1)return!1;let i=n.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(n.someProp(e,a=>o>i.depth?a(n,t,i.nodeAfter,i.before(o),s,!0):a(n,t,i.node(o),i.before(o),s,!1)))return!0;return!1}function ka(n,e,t){if(n.focused||n.focus(),n.state.selection.eq(e))return;let r=n.state.tr.setSelection(e);r.setMeta("pointer",!0),n.dispatch(r)}function a5(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&ee.isSelectable(r)?(ka(n,new ee(t)),!0):!1}function l5(n,e){if(e==-1)return!1;let t=n.state.selection,r,s;t instanceof ee&&(r=t.node);let i=n.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(ee.isSelectable(a)){r&&t.$from.depth>0&&o>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?s=i.before(t.$from.depth):s=i.before(o);break}}return s!=null?(ka(n,ee.create(n.state.doc,s)),!0):!1}function c5(n,e,t,r,s){return nw(n,"handleClickOn",e,t,r)||n.someProp("handleClick",i=>i(n,e,r))||(s?l5(n,t):a5(n,t))}function u5(n,e,t,r){return nw(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",s=>s(n,e,r))}function d5(n,e,t,r){return nw(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",s=>s(n,e,r))||h5(n,t,r)}function h5(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(ka(n,se.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)ka(n,se.create(r,a+1,a+1+o.content.size));else if(ee.isSelectable(o))ka(n,ee.create(r,a));else continue;return!0}}function rw(n){return lf(n)}const JA=kn?"metaKey":"ctrlKey";Gt.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=rw(n),s=Date.now(),i="singleClick";s-n.input.lastClick.time<500&&o5(t,n.input.lastClick)&&!t[JA]&&n.input.lastClick.button==t.button&&(n.input.lastClick.type=="singleClick"?i="doubleClick":n.input.lastClick.type=="doubleClick"&&(i="tripleClick")),n.input.lastClick={time:s,x:t.clientX,y:t.clientY,type:i,button:t.button};let o=n.posAtCoords(dp(t));o&&(i=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new f5(n,o,t,!!r)):(i=="doubleClick"?u5:d5)(n,o.pos,o.inside,t)?t.preventDefault():Ds(n,"pointer"))};class f5{constructor(e,t,r,s){this.view=e,this.pos=t,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[JA],this.allowDefault=r.shiftKey;let i,o;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);i=u.parent,o=u.depth?u.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof ee&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Pn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ds(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Wr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(dp(e))),this.updateAllowDefault(e),this.allowDefault||!t?Ds(this.view,"pointer"):c5(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Kt&&this.mightDrag&&!this.mightDrag.node.isAtom||Dt&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(ka(this.view,ce.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Ds(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ds(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Gt.touchstart=n=>{n.input.lastTouch=Date.now(),rw(n),Ds(n,"pointer")};Gt.touchmove=n=>{n.input.lastTouch=Date.now(),Ds(n,"pointer")};Gt.contextmenu=n=>rw(n);function YA(n,e){return n.composing?!0:Kt&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const p5=Vr?5e3:-1;Qt.compositionstart=Qt.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$to;if(e.selection instanceof se&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),lf(n,!0),n.markCursor=null;else if(lf(n,!e.selection.empty),Pn&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=n.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}n.input.composing=!0}XA(n,p5)};Qt.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,XA(n,20))};function XA(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>lf(n),e))}function ZA(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=g5());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function m5(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=a9(e.focusNode,e.focusOffset),r=l9(e.focusNode,e.focusOffset);if(t&&r&&t!=r){let s=r.pmViewDesc,i=n.domObserver.lastChangedTextNode;if(t==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(n.input.compositionNode==r){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return r}}return t||r}function g5(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function lf(n,e=!1){if(!(Vr&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),ZA(n),e||n.docView&&n.docView.dirty){let t=Xv(n),r=n.state.selection;return t&&!t.eq(r)?n.dispatch(n.state.tr.setSelection(t)):(n.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function y5(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const Jc=an&&Js<15||Wa&&f9<604;Gt.copy=Qt.cut=(n,e)=>{let t=e,r=n.state.selection,s=t.type=="cut";if(r.empty)return;let i=Jc?null:t.clipboardData,o=r.content(),{dom:a,text:l}=ew(n,o);i?(t.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):y5(n,a),s&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function v5(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function w5(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?Yc(n,r.value,null,s,e):Yc(n,r.textContent,r.innerHTML,s,e)},50)}function Yc(n,e,t,r,s){let i=WA(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,s,i||K.empty)))return!0;if(!i)return!1;let o=v5(i),a=o?n.state.tr.replaceSelectionWith(o,r):n.state.tr.replaceSelection(i);return n.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function eR(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}Qt.paste=(n,e)=>{let t=e;if(n.composing&&!Vr)return;let r=Jc?null:t.clipboardData,s=n.input.shiftKey&&n.input.lastKeyCode!=45;r&&Yc(n,eR(r),r.getData("text/html"),s,t)?t.preventDefault():w5(n,t)};class tR{constructor(e,t,r){this.slice=e,this.move=t,this.node=r}}const _5=kn?"altKey":"ctrlKey";function nR(n,e){let t=n.someProp("dragCopies",r=>!r(e));return t??!e[_5]}Gt.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let s=n.state.selection,i=s.empty?null:n.posAtCoords(dp(t)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof ee?s.to-1:s.to))){if(r&&r.mightDrag)o=ee.create(n.state.doc,r.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let h=n.docView.nearestDesc(t.target,!0);h&&h.node.type.spec.draggable&&h!=n.docView&&(o=ee.create(n.state.doc,h.posBefore))}}let a=(o||n.state.selection).content(),{dom:l,text:c,slice:u}=ew(n,a);(!t.dataTransfer.files.length||!Dt||CA>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Jc?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",Jc||t.dataTransfer.setData("text/plain",c),n.dragging=new tR(u,nR(n,t),o)};Gt.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};Qt.dragover=Qt.dragenter=(n,e)=>e.preventDefault();Qt.drop=(n,e)=>{let t=e,r=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let s=n.posAtCoords(dp(t));if(!s)return;let i=n.state.doc.resolve(s.pos),o=r&&r.slice;o?n.someProp("transformPasted",y=>{o=y(o,n,!1)}):o=WA(n,eR(t.dataTransfer),Jc?null:t.dataTransfer.getData("text/html"),!1,i);let a=!!(r&&nR(n,t));if(n.someProp("handleDrop",y=>y(n,t,o||K.empty,a))){t.preventDefault();return}if(!o)return;t.preventDefault();let l=o?_A(n.state.doc,i.pos,o):i.pos;l==null&&(l=i.pos);let c=n.state.tr;if(a){let{node:y}=r;y?y.replace(c):c.deleteSelection()}let u=c.mapping.map(l),h=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=c.doc;if(h?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(f))return;let m=c.doc.resolve(u);if(h&&ee.isSelectable(o.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new ee(m));else{let y=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((v,_,x,T)=>y=T),c.setSelection(Zv(n,m,c.doc.resolve(y)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))};Gt.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Wr(n)},20))};Gt.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};Gt.beforeinput=(n,e)=>{if(Dt&&Vr&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",i=>i(n,Vi(8,"Backspace")))))return;let{$cursor:s}=n.state.selection;s&&s.pos>0&&n.dispatch(n.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let n in Qt)Gt[n]=Qt[n];function Xc(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class cf{constructor(e,t){this.toDOM=e,this.spec=t||Xi,this.side=this.spec.side||0}map(e,t,r,s){let{pos:i,deleted:o}=e.mapResult(t.from+s,this.side<0?-1:1);return o?null:new gn(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof cf&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Xc(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Xs{constructor(e,t){this.attrs=e,this.spec=t||Xi}map(e,t,r,s){let i=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new gn(i,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Xs&&Xc(this.attrs,e.attrs)&&Xc(this.spec,e.spec)}static is(e){return e.type instanceof Xs}destroy(){}}class sw{constructor(e,t){this.attrs=e,this.spec=t||Xi}map(e,t,r,s){let i=e.mapResult(t.from+s,1);if(i.deleted)return null;let o=e.mapResult(t.to+s,-1);return o.deleted||o.pos<=i.pos?null:new gn(i.pos-r,o.pos-r,this)}valid(e,t){let{index:r,offset:s}=e.content.findIndex(t.from),i;return s==t.from&&!(i=e.child(r)).isText&&s+i.nodeSize==t.to}eq(e){return this==e||e instanceof sw&&Xc(this.attrs,e.attrs)&&Xc(this.spec,e.spec)}destroy(){}}class gn{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new gn(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new gn(e,e,new cf(t,r))}static inline(e,t,r,s){return new gn(e,t,new Xs(r,s))}static node(e,t,r,s){return new gn(e,t,new sw(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Xs}get widget(){return this.type instanceof cf}}const Qo=[],Xi={};class Je{constructor(e,t){this.local=e.length?e:Qo,this.children=t.length?t:Qo}static create(e,t){return t.length?uf(t,e,0,Xi):At}find(e,t,r){let s=[];return this.findInner(e??0,t??1e9,s,0,r),s}findInner(e,t,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,r,s+a,i)}}map(e,t,r){return this==At||e.maps.length==0?this:this.mapInner(e,t,0,0,r||Xi)}mapInner(e,t,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(t,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?x5(this.children,o||[],e,t,r,s,i):o?new Je(o.sort(Zi),Qo):At}add(e,t){return t.length?this==At?Je.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let s,i=0;e.forEach((a,l)=>{let c=l+r,u;if(u=sR(t,a,c)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,u,c+1):s.splice(i,0,l,l+a.nodeSize,uf(u,a,c+1,Xi)),i+=3}});let o=rR(i?iR(t):t,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Je(o.length?this.local.concat(o).sort(Zi):this.local,s||this.children)}remove(e){return e.length==0||this==At?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+t,l=r[i+1]+t;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>a&&h.to<l&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(o,a+1);c!=At?r[i+2]=c:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,t)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new Je(s,r):At}forChild(e,t){if(this==At)return this;if(t.isLeaf)return Je.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Xs){let c=Math.max(i,l.from)-i,u=Math.min(o,l.to)-i;c<u&&(s||(s=[])).push(l.copy(c,u))}}if(s){let a=new Je(s.sort(Zi),Qo);return r?new Ss([a,r]):a}return r||At}eq(e){if(this==e)return!0;if(!(e instanceof Je)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return iw(this.localsInner(e))}localsInner(e){if(this==At)return Qo;if(e.inlineContent||!this.local.some(Xs.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Xs||t.push(this.local[r]);return t}forEachSet(e){e(this)}}Je.empty=new Je([],[]);Je.removeOverlap=iw;const At=Je.empty;class Ss{constructor(e){this.members=e}map(e,t){const r=this.members.map(s=>s.map(e,t,Xi));return Ss.from(r)}forChild(e,t){if(t.isLeaf)return Je.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,t);i!=At&&(i instanceof Ss?r=r.concat(i.members):r.push(i))}return Ss.from(r)}eq(e){if(!(e instanceof Ss)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!t)t=i;else{r&&(t=t.slice(),r=!1);for(let o=0;o<i.length;o++)t.push(i[o])}}return t?iw(r?t:t.sort(Zi)):Qo}static from(e){switch(e.length){case 0:return At;case 1:return e[0];default:return new Ss(e.every(t=>t instanceof Je)?e:e.reduce((t,r)=>t.concat(r instanceof Je?r:r.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function x5(n,e,t,r,s,i,o){let a=n.slice();for(let c=0,u=i;c<t.maps.length;c++){let h=0;t.maps[c].forEach((f,m,y,v)=>{let _=v-y-(m-f);for(let x=0;x<a.length;x+=3){let T=a[x+1];if(T<0||f>T+u-h)continue;let b=a[x]+u-h;m>=b?a[x+1]=f<=b?-2:-1:f>=u&&_&&(a[x]+=_,a[x+1]+=_)}h+=_}),u=t.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=t.map(n[c]+i),h=u-s;if(h<0||h>=r.content.size){l=!0;continue}let f=t.map(n[c+1]+i,-1),m=f-s,{index:y,offset:v}=r.content.findIndex(h),_=r.maybeChild(y);if(_&&v==h&&v+_.nodeSize==m){let x=a[c+2].mapInner(t,_,u+1,n[c]+i+1,o);x!=At?(a[c]=h,a[c+1]=m,a[c+2]=x):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=E5(a,n,e,t,s,i,o),u=uf(c,r,0,o);e=u.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,f=0;h<u.children.length;h+=3){let m=u.children[h];for(;f<a.length&&a[f]<m;)f+=3;a.splice(f,0,u.children[h],u.children[h+1],u.children[h+2])}}return new Je(e.sort(Zi),a)}function rR(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let s=n[r];t.push(new gn(s.from+e,s.to+e,s.type))}return t}function E5(n,e,t,r,s,i,o){function a(l,c){for(let u=0;u<l.local.length;u++){let h=l.local[u].map(r,s,c);h?t.push(h):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<n.length;l+=3)n[l+1]==-1&&a(n[l+2],e[l]+i+1);return t}function sR(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,s=null;for(let i=0,o;i<n.length;i++)(o=n[i])&&o.from>t&&o.to<r&&((s||(s=[])).push(o),n[i]=null);return s}function iR(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function uf(n,e,t,r){let s=[],i=!1;e.forEach((a,l)=>{let c=sR(n,a,l+t);if(c){i=!0;let u=uf(c,a,t+l+1,r);u!=At&&s.push(l,l+a.nodeSize,u)}});let o=rR(i?iR(n):n,-t).sort(Zi);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new Je(o,s):At}function Zi(n,e){return n.from-e.from||n.to-e.to}function iw(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let s=t+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==n&&(e=n.slice()),e[s]=i.copy(i.from,r.to),xT(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,i.from),xT(e,s,r.copy(i.from,r.to)));break}}}return e}function xT(n,e,t){for(;e<n.length&&Zi(t,n[e])>0;)e++;n.splice(e,0,t)}function Fm(n){let e=[];return n.someProp("decorations",t=>{let r=t(n.state);r&&r!=At&&e.push(r)}),n.cursorWrapper&&e.push(Je.create(n.state.doc,[n.cursorWrapper.deco])),Ss.from(e)}const k5={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},T5=an&&Js<=11;class b5{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class S5{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new b5,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);an&&Js<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),T5&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,k5)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(fT(this.view)){if(this.suppressingSelectionUpdates)return Wr(this.view);if(an&&Js<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&_o(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,r;for(let i=e.focusNode;i;i=za(i))t.add(i);for(let i=e.anchorNode;i;i=za(i))if(t.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&fT(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<t.length;u++){let h=this.registerMutation(t[u],l);h&&(i=i<0?h.from:Math.min(h.from,i),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if(Pn&&l.length){let u=l.filter(h=>h.nodeName=="BR");if(u.length==2){let[h,f]=u;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of u){let m=f.parentNode;m&&m.nodeName=="LI"&&(!h||N5(e,h)!=m)&&f.remove()}}}let c=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&cp(r)&&(c=Xv(e))&&c.eq(ce.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Wr(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),I5(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Wr(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let h=e.addedNodes[u];t.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(an&&Js<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:f}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let o=s&&s.parentNode==e.target?_t(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?_t(i):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let ET=new WeakMap,kT=!1;function I5(n){if(!ET.has(n)&&(ET.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Pn,kT)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),kT=!0}}function TT(n,e){let t=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=n.domAtPos(n.state.selection.anchor);return _o(o.node,o.offset,s,i)&&([t,r,s,i]=[s,i,t,r]),{anchorNode:t,anchorOffset:r,focusNode:s,focusOffset:i}}function C5(n,e){if(e.getComposedRanges){let s=e.getComposedRanges(n.root)[0];if(s)return TT(n,s)}let t;function r(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",r,!0),t?TT(n,t):null}function N5(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let r=n.docView.nearestDesc(t,!0);if(r&&r.node.isBlock)return t}return null}function A5(n,e,t){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=n.docView.parseRange(e,t),l=n.domSelectionRange(),c,u=l.anchorNode;if(u&&n.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],cp(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Dt&&n.input.lastKeyCode===8)for(let _=i;_>s;_--){let x=r.childNodes[_-1],T=x.pmViewDesc;if(x.nodeName=="BR"&&!T){i=_;break}if(!T||T.size)break}let h=n.state.doc,f=n.someProp("domParser")||Qs.fromSchema(n.state.schema),m=h.resolve(o),y=null,v=f.parse(r,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:s,to:i,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:R5,context:m});if(c&&c[0].pos!=null){let _=c[0].pos,x=c[1]&&c[1].pos;x==null&&(x=_),y={anchor:_+o,head:x+o}}return{doc:v,sel:y,from:o,to:a}}function R5(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(Kt&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||Kt&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const P5=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function D5(n,e,t,r,s){let i=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let k=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,E=Xv(n,k);if(E&&!n.state.selection.eq(E)){if(Dt&&Vr&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",C=>C(n,Vi(13,"Enter"))))return;let S=n.state.tr.setSelection(E);k=="pointer"?S.setMeta("pointer",!0):k=="key"&&S.scrollIntoView(),i&&S.setMeta("composition",i),n.dispatch(S)}return}let o=n.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=n.state.doc.resolve(t).after(a+1);let l=n.state.selection,c=A5(n,e,t),u=n.state.doc,h=u.slice(c.from,c.to),f,m;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(f=n.state.selection.to,m="end"):(f=n.state.selection.from,m="start"),n.input.lastKeyCode=null;let y=V5(h.content,c.doc.content,c.from,f,m);if(y&&n.input.domChangeCount++,(Wa&&n.input.lastIOSEnter>Date.now()-225||Vr)&&s.some(k=>k.nodeType==1&&!P5.test(k.nodeName))&&(!y||y.endA>=y.endB)&&n.someProp("handleKeyDown",k=>k(n,Vi(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!y)if(r&&l instanceof se&&!l.empty&&l.$head.sameParent(l.$anchor)&&!n.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let k=bT(n,n.state.doc,c.sel);if(k&&!k.eq(n.state.selection)){let E=n.state.tr.setSelection(k);i&&E.setMeta("composition",i),n.dispatch(E)}}return}n.state.selection.from<n.state.selection.to&&y.start==y.endB&&n.state.selection instanceof se&&(y.start>n.state.selection.from&&y.start<=n.state.selection.from+2&&n.state.selection.from>=c.from?y.start=n.state.selection.from:y.endA<n.state.selection.to&&y.endA>=n.state.selection.to-2&&n.state.selection.to<=c.to&&(y.endB+=n.state.selection.to-y.endA,y.endA=n.state.selection.to)),an&&Js<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>c.from&&c.doc.textBetween(y.start-c.from-1,y.start-c.from+1)=="  "&&(y.start--,y.endA--,y.endB--);let v=c.doc.resolveNoCache(y.start-c.from),_=c.doc.resolveNoCache(y.endB-c.from),x=u.resolve(y.start),T=v.sameParent(_)&&v.parent.inlineContent&&x.end()>=y.endA;if((Wa&&n.input.lastIOSEnter>Date.now()-225&&(!T||s.some(k=>k.nodeName=="DIV"||k.nodeName=="P"))||!T&&v.pos<c.doc.content.size&&(!v.sameParent(_)||!v.parent.inlineContent)&&v.pos<_.pos&&!/\S/.test(c.doc.textBetween(v.pos,_.pos,"","")))&&n.someProp("handleKeyDown",k=>k(n,Vi(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>y.start&&O5(u,y.start,y.endA,v,_)&&n.someProp("handleKeyDown",k=>k(n,Vi(8,"Backspace")))){Vr&&Dt&&n.domObserver.suppressSelectionUpdates();return}Dt&&y.endB==y.start&&(n.input.lastChromeDelete=Date.now()),Vr&&!T&&v.start()!=_.start()&&_.parentOffset==0&&v.depth==_.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==y.endA&&(y.endB-=2,_=c.doc.resolveNoCache(y.endB-c.from),setTimeout(()=>{n.someProp("handleKeyDown",function(k){return k(n,Vi(13,"Enter"))})},20));let b=y.start,N=y.endA,R=k=>{let E=k||n.state.tr.replace(b,N,c.doc.slice(y.start-c.from,y.endB-c.from));if(c.sel){let S=bT(n,E.doc,c.sel);S&&!(Dt&&n.composing&&S.empty&&(y.start!=y.endB||n.input.lastChromeDelete<Date.now()-100)&&(S.head==b||S.head==E.mapping.map(N)-1)||an&&S.empty&&S.head==b)&&E.setSelection(S)}return i&&E.setMeta("composition",i),E.scrollIntoView()},P;if(T)if(v.pos==_.pos){an&&Js<=11&&v.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>Wr(n),20));let k=R(n.state.tr.delete(b,N)),E=u.resolve(y.start).marksAcross(u.resolve(y.endA));E&&k.ensureMarks(E),n.dispatch(k)}else if(y.endA==y.endB&&(P=M5(v.parent.content.cut(v.parentOffset,_.parentOffset),x.parent.content.cut(x.parentOffset,y.endA-x.start())))){let k=R(n.state.tr);P.type=="add"?k.addMark(b,N,P.mark):k.removeMark(b,N,P.mark),n.dispatch(k)}else if(v.parent.child(v.index()).isText&&v.index()==_.index()-(_.textOffset?0:1)){let k=v.parent.textBetween(v.parentOffset,_.parentOffset),E=()=>R(n.state.tr.insertText(k,b,N));n.someProp("handleTextInput",S=>S(n,b,N,k,E))||n.dispatch(E())}else n.dispatch(R());else n.dispatch(R())}function bT(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:Zv(n,e.resolve(t.anchor),e.resolve(t.head))}function M5(n,e){let t=n.firstChild.marks,r=e.firstChild.marks,s=t,i=r,o,a,l;for(let u=0;u<r.length;u++)s=r[u].removeFromSet(s);for(let u=0;u<t.length;u++)i=t[u].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(U.from(c).eq(n))return{mark:a,type:o}}function O5(n,e,t,r,s){if(t-e<=s.pos-r.pos||Bm(r,!0,!1)<s.pos)return!1;let i=n.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&t==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=n.resolve(Bm(i,!0,!0));return!o.parent.isTextblock||o.pos>t||Bm(o,!0,!1)<t?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function Bm(n,e,t){let r=n.depth,s=e?n.end():n.pos;for(;r>0&&(e||n.indexAfter(r)==n.node(r).childCount);)r--,s++,e=!1;if(t){let i=n.node(r).maybeChild(n.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function V5(n,e,t,r,s){let i=n.findDiffStart(e,t);if(i==null)return null;let{a:o,b:a}=n.findDiffEnd(e,t+n.size,t+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&n.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&ST(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<n.size&&ST(n.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function ST(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class oR{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new t5,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(RT),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=NT(this),CT(this),this.nodeViews=AT(this),this.docView=aT(this.state.doc,IT(this),Fm(this),this.dom,this),this.domObserver=new S5(this,(r,s,i,o)=>D5(this,r,s,i,o)),this.domObserver.start(),n5(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&$y(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(RT),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(ZA(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let m=AT(this);L5(m,this.nodeViews)&&(this.nodeViews=m,i=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&$y(this),this.editable=NT(this),CT(this);let l=Fm(this),c=IT(this),u=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,c,l);(h||!e.selection.eq(s.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&g9(this);if(o){this.domObserver.stop();let m=h&&(an||Dt)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&j5(s.selection,e.selection);if(h){let y=Dt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=m5(this)),(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=aT(e.doc,c,l,this.dom,this)),y&&!this.trackWrites&&(m=!0)}m||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&B9(this))?Wr(this,m):(UA(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&y9(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof ee){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&tT(this,t.getBoundingClientRect(),e)}else tT(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}}updateDraggedNode(e,t){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new tR(e.slice,e.move,s<0?void 0:ee.create(this.state.doc,s))}someProp(e,t){let r=this._props&&this._props[e],s;if(r!=null&&(s=t?t(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=t?t(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=t?t(a):a))return s}}hasFocus(){if(an){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&v9(this.dom),Wr(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return k9(this,e)}coordsAtPos(e,t=1){return DA(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let s=this.docView.posFromDOM(e,t,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return C9(this,t||this.state,e)}pasteHTML(e,t){return Yc(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Yc(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return ew(this,e)}destroy(){this.docView&&(r5(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Fm(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,i9())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return i5(this,e)}domSelectionRange(){let e=this.domSelection();return e?Kt&&this.root.nodeType===11&&u9(this.dom.ownerDocument)==this.dom&&C5(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}oR.prototype.dispatch=function(n){let e=this._props.dispatchTransaction;e?e.call(this,n):this.updateState(this.state.apply(n))};function IT(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let r in t)r=="class"?e.class+=" "+t[r]:r=="style"?e.style=(e.style?e.style+";":"")+t[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(t[r]))}),e.translate||(e.translate="no"),[gn.node(0,n.state.doc.content.size,e)]}function CT(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:gn.widget(n.state.selection.from,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function NT(n){return!n.someProp("editable",e=>e(n.state)===!1)}function j5(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function AT(n){let e=Object.create(null);function t(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function L5(n,e){let t=0,r=0;for(let s in n){if(n[s]!=e[s])return!0;t++}for(let s in e)r++;return t!=r}function RT(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var li={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},df={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},F5=typeof navigator<"u"&&/Mac/.test(navigator.platform),B5=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var xt=0;xt<10;xt++)li[48+xt]=li[96+xt]=String(xt);for(var xt=1;xt<=24;xt++)li[xt+111]="F"+xt;for(var xt=65;xt<=90;xt++)li[xt]=String.fromCharCode(xt+32),df[xt]=String.fromCharCode(xt);for(var Um in li)df.hasOwnProperty(Um)||(df[Um]=li[Um]);function U5(n){var e=F5&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||B5&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?df:li)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const $5=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),z5=typeof navigator<"u"&&/Win/.test(navigator.platform);function W5(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))$5?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(t="Alt-"+t),s&&(t="Ctrl-"+t),o&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function q5(n){let e=Object.create(null);for(let t in n)e[W5(t)]=n[t];return e}function $m(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function H5(n){return new Xt({props:{handleKeyDown:aR(n)}})}function aR(n){let e=q5(n);return function(t,r){let s=U5(r),i,o=e[$m(s,r)];if(o&&o(t.state,t.dispatch,t))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[$m(s,r,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(z5&&r.ctrlKey&&r.altKey)&&(i=li[r.keyCode])&&i!=s){let a=e[$m(i,r)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}const ow=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function lR(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const cR=(n,e,t)=>{let r=lR(n,t);if(!r)return!1;let s=aw(r);if(!s){let o=r.blockRange(),a=o&&rl(o);return a==null?!1:(e&&e(n.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(vR(n,s,e,-1))return!0;if(r.parent.content.size==0&&(qa(i,"end")||ee.isSelectable(i)))for(let o=r.depth;;o--){let a=ap(n.doc,r.before(o),r.after(o),K.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=n.tr.step(a);l.setSelection(qa(i,"end")?ce.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):ee.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(n.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},K5=(n,e,t)=>{let r=lR(n,t);if(!r)return!1;let s=aw(r);return s?uR(n,s,e):!1},G5=(n,e,t)=>{let r=hR(n,t);if(!r)return!1;let s=lw(r);return s?uR(n,s,e):!1};function uR(n,e,t){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let u=s.lastChild;if(!u)return!1;s=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=ap(n.doc,i,l,K.empty);if(!c||c.from!=i||c instanceof ct&&c.slice.size>=l-i)return!1;if(t){let u=n.tr.step(c);u.setSelection(se.create(u.doc,i)),t(u.scrollIntoView())}return!0}function qa(n,e,t=!1){for(let r=n;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}const dR=(n,e,t)=>{let{$head:r,empty:s}=n.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):r.parentOffset>0)return!1;i=aw(r)}let o=i&&i.nodeBefore;return!o||!ee.isSelectable(o)?!1:(e&&e(n.tr.setSelection(ee.create(n.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function aw(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function hR(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const fR=(n,e,t)=>{let r=hR(n,t);if(!r)return!1;let s=lw(r);if(!s)return!1;let i=s.nodeAfter;if(vR(n,s,e,1))return!0;if(r.parent.content.size==0&&(qa(i,"start")||ee.isSelectable(i))){let o=ap(n.doc,r.before(),r.after(),K.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=n.tr.step(o);a.setSelection(qa(i,"start")?ce.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):ee.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(n.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},pR=(n,e,t)=>{let{$head:r,empty:s}=n.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):r.parentOffset<r.parent.content.size)return!1;i=lw(r)}let o=i&&i.nodeAfter;return!o||!ee.isSelectable(o)?!1:(e&&e(n.tr.setSelection(ee.create(n.doc,i.pos)).scrollIntoView()),!0)};function lw(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const Q5=(n,e)=>{let t=n.selection,r=t instanceof ee,s;if(r){if(t.node.isTextblock||!vi(n.doc,t.from))return!1;s=t.from}else if(s=op(n.doc,t.from,-1),s==null)return!1;if(e){let i=n.tr.join(s);r&&i.setSelection(ee.create(i.doc,s-n.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},J5=(n,e)=>{let t=n.selection,r;if(t instanceof ee){if(t.node.isTextblock||!vi(n.doc,t.to))return!1;r=t.to}else if(r=op(n.doc,t.to,1),r==null)return!1;return e&&e(n.tr.join(r).scrollIntoView()),!0},Y5=(n,e)=>{let{$from:t,$to:r}=n.selection,s=t.blockRange(r),i=s&&rl(s);return i==null?!1:(e&&e(n.tr.lift(s,i).scrollIntoView()),!0)},mR=(n,e)=>{let{$head:t,$anchor:r}=n.selection;return!t.parent.type.spec.code||!t.sameParent(r)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function cw(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const X5=(n,e)=>{let{$head:t,$anchor:r}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(r))return!1;let s=t.node(-1),i=t.indexAfter(-1),o=cw(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=t.after(),l=n.tr.replaceWith(a,a,o.createAndFill());l.setSelection(ce.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},gR=(n,e)=>{let t=n.selection,{$from:r,$to:s}=t;if(t instanceof vn||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=cw(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=n.tr.insert(o,i.createAndFill());a.setSelection(se.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},yR=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(zr(n.doc,i))return e&&e(n.tr.split(i).scrollIntoView()),!0}let r=t.blockRange(),s=r&&rl(r);return s==null?!1:(e&&e(n.tr.lift(r,s).scrollIntoView()),!0)};function Z5(n){return(e,t)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof ee&&e.selection.node.isBlock)return!r.parentOffset||!zr(e.doc,r.pos)?!1:(t&&t(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],o,a,l=!1,c=!1;for(let m=r.depth;;m--)if(r.node(m).isBlock){l=r.end(m)==r.pos+(r.depth-m),c=r.start(m)==r.pos-(r.depth-m),a=cw(r.node(m-1).contentMatchAt(r.indexAfter(m-1))),i.unshift(l&&a?{type:a}:null),o=m;break}else{if(m==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof se||e.selection instanceof vn)&&u.deleteSelection();let h=u.mapping.map(r.pos),f=zr(u.doc,h,i.length,i);if(f||(i[0]=a?{type:a}:null,f=zr(u.doc,h,i.length,i)),!f)return!1;if(u.split(h,i.length,i),!l&&c&&r.node(o).type!=a){let m=u.mapping.map(r.before(o)),y=u.doc.resolve(m);a&&r.node(o-1).canReplaceWith(y.index(),y.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return t&&t(u.scrollIntoView()),!0}}const eW=Z5(),tW=(n,e)=>{let{$from:t,to:r}=n.selection,s,i=t.sharedDepth(r);return i==0?!1:(s=t.before(i),e&&e(n.tr.setSelection(ee.create(n.doc,s))),!0)};function nW(n,e,t){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(t&&t(n.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||vi(n.doc,e.pos))?!1:(t&&t(n.tr.join(e.pos).scrollIntoView()),!0)}function vR(n,e,t,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&nW(n,e,t))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(t){let m=e.pos+i.nodeSize,y=U.empty;for(let x=o.length-1;x>=0;x--)y=U.from(o[x].create(null,y));y=U.from(s.copy(y));let v=n.tr.step(new dt(e.pos-1,m,e.pos,m,new K(y,1,0),o.length,!0)),_=v.doc.resolve(m+2*o.length);_.nodeAfter&&_.nodeAfter.type==s.type&&vi(v.doc,_.pos)&&v.join(_.pos),t(v.scrollIntoView())}return!0}let u=i.type.spec.isolating||r>0&&l?null:ce.findFrom(e,1),h=u&&u.$from.blockRange(u.$to),f=h&&rl(h);if(f!=null&&f>=e.depth)return t&&t(n.tr.lift(h,f).scrollIntoView()),!0;if(c&&qa(i,"start",!0)&&qa(s,"end")){let m=s,y=[];for(;y.push(m),!m.isTextblock;)m=m.lastChild;let v=i,_=1;for(;!v.isTextblock;v=v.firstChild)_++;if(m.canReplace(m.childCount,m.childCount,v.content)){if(t){let x=U.empty;for(let b=y.length-1;b>=0;b--)x=U.from(y[b].copy(x));let T=n.tr.step(new dt(e.pos-y.length,e.pos+i.nodeSize,e.pos+_,e.pos+i.nodeSize-_,new K(x,y.length,0),0,!0));t(T.scrollIntoView())}return!0}}return!1}function wR(n){return function(e,t){let r=e.selection,s=n<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(t&&t(e.tr.setSelection(se.create(e.doc,n<0?s.start(i):s.end(i)))),!0):!1}}const rW=wR(-1),sW=wR(1);function iW(n,e=null){return function(t,r){let{$from:s,$to:i}=t.selection,o=s.blockRange(i),a=o&&Qv(o,n,e);return a?(r&&r(t.tr.wrap(o,a).scrollIntoView()),!0):!1}}function PT(n,e=null){return function(t,r){let s=!1;for(let i=0;i<t.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[i];t.doc.nodesBetween(o,a,(l,c)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(n,e)))if(l.type==n)s=!0;else{let u=t.doc.resolve(c),h=u.index();s=u.parent.canReplaceWith(h,h+1,n)}})}if(!s)return!1;if(r){let i=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[o];i.setBlockType(a,l,n,e)}r(i.scrollIntoView())}return!0}}function uw(...n){return function(e,t,r){for(let s=0;s<n.length;s++)if(n[s](e,t,r))return!0;return!1}}uw(ow,cR,dR);uw(ow,fR,pR);uw(mR,gR,yR,eW);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function oW(n,e=null){return function(t,r){let{$from:s,$to:i}=t.selection,o=s.blockRange(i);if(!o)return!1;let a=r?t.tr:null;return aW(a,o,n,e)?(r&&r(a.scrollIntoView()),!0):!1}}function aW(n,e,t,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new rf(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new rf(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=Qv(i,t,r,e);return a?(n&&lW(n,e,a,s,t),!0):!1}function lW(n,e,t,r,s){let i=U.empty;for(let u=t.length-1;u>=0;u--)i=U.from(t[u].type.create(t[u].attrs,i));n.step(new dt(e.start-(r?2:0),e.end,e.start,e.end,new K(i,0,0),t.length,!0));let o=0;for(let u=0;u<t.length;u++)t[u].type==s&&(o=u+1);let a=t.length-o,l=e.start+t.length-(r?2:0),c=e.parent;for(let u=e.startIndex,h=e.endIndex,f=!0;u<h;u++,f=!1)!f&&zr(n.doc,l,a)&&(n.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return n}function cW(n){return function(e,t){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==n);return i?t?r.node(i.depth-1).type==n?uW(e,t,n,i):dW(e,t,i):!0:!1}}function uW(n,e,t,r){let s=n.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new dt(i-1,o,i,o,new K(U.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new rf(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=rl(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return vi(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function dW(n,e,t){let r=n.tr,s=t.parent;for(let m=t.end,y=t.endIndex-1,v=t.startIndex;y>v;y--)m-=s.child(y).nodeSize,r.delete(m-1,m+1);let i=r.doc.resolve(t.start),o=i.nodeAfter;if(r.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,l=t.endIndex==s.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?U.empty:U.from(s))))return!1;let h=i.pos,f=h+o.nodeSize;return r.step(new dt(h-(a?1:0),f+(l?1:0),h+1,f-1,new K((a?U.empty:U.from(s.copy(U.empty))).append(l?U.empty:U.from(s.copy(U.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function hW(n){return function(e,t){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,c=>c.childCount>0&&c.firstChild.type==n);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=n)return!1;if(t){let c=l.lastChild&&l.lastChild.type==a.type,u=U.from(c?n.create():null),h=new K(U.from(n.create(null,U.from(a.type.create(null,u)))),c?3:1,0),f=i.start,m=i.end;t(e.tr.step(new dt(f-(c?3:1),m,f,m,h,1,!0)).scrollIntoView())}return!0}}function hp(n){const{state:e,transaction:t}=n;let{selection:r}=t,{doc:s}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=t.selection,s=t.doc,i=t.storedMarks,t}}}class fp{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:r}=this,{view:s}=t,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const h=l(...u)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,c=e||i.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(f=>f===!0)),h={...Object.fromEntries(Object.entries(r).map(([f,m])=>[f,(...v)=>{const _=this.buildProps(c,t),x=m(...v)(_);return a.push(x),h}])),run:u};return h}createCan(e){const{rawCommands:t,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,t=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:hp({state:i,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class fW{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,t)),this}off(e,t){const r=this.callbacks[e];return r&&(t?this.callbacks[e]=r.filter(s=>s!==t):delete this.callbacks[e]),this}once(e,t){const r=(...s)=>{this.off(e,r),t.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function J(n,e,t){return n.config[e]===void 0&&n.parent?J(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind({...t,parent:n.parent?J(n.parent,e,t):null}):n.config[e]}function pp(n){const e=n.filter(s=>s.type==="extension"),t=n.filter(s=>s.type==="node"),r=n.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:r}}function _R(n){const e=[],{nodeExtensions:t,markExtensions:r}=pp(n),s=[...t,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=J(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([f,m])=>{e.push({type:h,name:f,attribute:{...i,...m}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=J(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function ft(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}function Ot(...n){return n.filter(e=>!!e).reduce((e,t)=>{const r={...e};return Object.entries(t).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],c=a.filter(u=>!l.includes(u));r[s]=[...l,...c].join(" ")}else if(s==="style"){const a=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[h,f]=u.split(":").map(m=>m.trim());c.set(h,f)}),a.forEach(u=>{const[h,f]=u.split(":").map(m=>m.trim());c.set(h,f)}),r[s]=Array.from(c.entries()).map(([u,h])=>`${u}: ${h}`).join("; ")}else r[s]=i}),r},{})}function zy(n,e){return e.filter(t=>t.type===n.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,r)=>Ot(t,r),{})}function xR(n){return typeof n=="function"}function ue(n,e=void 0,...t){return xR(n)?e?n.bind(e)(...t):n(...t):n}function pW(n={}){return Object.keys(n).length===0&&n.constructor===Object}function mW(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function DT(n,e){return"style"in n?n:{...n,getAttrs:t=>{const r=n.getAttrs?n.getAttrs(t):n.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):mW(t.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function MT(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&pW(t)?!1:t!=null))}function gW(n,e){var t;const r=_R(n),{nodeExtensions:s,markExtensions:i}=pp(n),o=(t=s.find(c=>J(c,"topNode")))===null||t===void 0?void 0:t.name,a=Object.fromEntries(s.map(c=>{const u=r.filter(x=>x.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},f=n.reduce((x,T)=>{const b=J(T,"extendNodeSchema",h);return{...x,...b?b(c):{}}},{}),m=MT({...f,content:ue(J(c,"content",h)),marks:ue(J(c,"marks",h)),group:ue(J(c,"group",h)),inline:ue(J(c,"inline",h)),atom:ue(J(c,"atom",h)),selectable:ue(J(c,"selectable",h)),draggable:ue(J(c,"draggable",h)),code:ue(J(c,"code",h)),whitespace:ue(J(c,"whitespace",h)),linebreakReplacement:ue(J(c,"linebreakReplacement",h)),defining:ue(J(c,"defining",h)),isolating:ue(J(c,"isolating",h)),attrs:Object.fromEntries(u.map(x=>{var T;return[x.name,{default:(T=x==null?void 0:x.attribute)===null||T===void 0?void 0:T.default}]}))}),y=ue(J(c,"parseHTML",h));y&&(m.parseDOM=y.map(x=>DT(x,u)));const v=J(c,"renderHTML",h);v&&(m.toDOM=x=>v({node:x,HTMLAttributes:zy(x,u)}));const _=J(c,"renderText",h);return _&&(m.toText=_),[c.name,m]})),l=Object.fromEntries(i.map(c=>{const u=r.filter(_=>_.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},f=n.reduce((_,x)=>{const T=J(x,"extendMarkSchema",h);return{..._,...T?T(c):{}}},{}),m=MT({...f,inclusive:ue(J(c,"inclusive",h)),excludes:ue(J(c,"excludes",h)),group:ue(J(c,"group",h)),spanning:ue(J(c,"spanning",h)),code:ue(J(c,"code",h)),attrs:Object.fromEntries(u.map(_=>{var x;return[_.name,{default:(x=_==null?void 0:_.attribute)===null||x===void 0?void 0:x.default}]}))}),y=ue(J(c,"parseHTML",h));y&&(m.parseDOM=y.map(_=>DT(_,u)));const v=J(c,"renderHTML",h);return v&&(m.toDOM=_=>v({mark:_,HTMLAttributes:zy(_,u)})),[c.name,m]}));return new cA({topNode:o,nodes:a,marks:l})}function zm(n,e){return e.nodes[n]||e.marks[n]||null}function OT(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function dw(n,e){const t=Ao.fromSchema(e).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(t),s.innerHTML}const yW=(n,e=500)=>{let t="";const r=n.parentOffset;return n.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,c;const u=((c=(l=s.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";t+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,r-i))}),t};function hw(n){return Object.prototype.toString.call(n)==="[object RegExp]"}class mp{constructor(e){this.find=e.find,this.handler=e.handler}}const vW=(n,e)=>{if(hw(e))return e.exec(n);const t=e(n);if(!t)return null;const r=[t.text];return r.index=t.index,r.input=n,r.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(t.replaceWith)),r};function _d(n){var e;const{editor:t,from:r,to:s,text:i,rules:o,plugin:a}=n,{view:l}=t;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const h=yW(c)+i;return o.forEach(f=>{if(u)return;const m=vW(h,f.find);if(!m)return;const y=l.state.tr,v=hp({state:l.state,transaction:y}),_={from:r-(m[0].length-i.length),to:s},{commands:x,chain:T,can:b}=new fp({editor:t,state:v});f.handler({state:v,range:_,match:m,commands:x,chain:T,can:b})===null||!y.steps.length||(y.setMeta(a,{transform:y,from:r,to:s,text:i}),l.dispatch(y),u=!0)}),u}function wW(n){const{editor:e,rules:t}=n,r=new Xt({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=dw(U.from(u),o.schema);const{from:h}=l,f=h+u.length;_d({editor:e,from:h,to:f,text:u,rules:t,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return _d({editor:e,from:i,to:o,text:a,rules:t,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&_d({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?_d({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:r}):!1}},isInputRules:!0});return r}function _W(n){return Object.prototype.toString.call(n).slice(8,-1)}function xd(n){return _W(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function gp(n,e){const t={...n};return xd(n)&&xd(e)&&Object.keys(e).forEach(r=>{xd(e[r])&&xd(n[r])?t[r]=gp(n[r],e[r]):t[r]=e[r]}),t}class Zr{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ue(J(this,"addOptions",{name:this.name}))),this.storage=ue(J(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Zr(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>gp(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Zr(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=ue(J(t,"addOptions",{name:t.name})),t.storage=ue(J(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===t.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===t.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function xW(n){return typeof n=="number"}class EW{constructor(e){this.find=e.find,this.handler=e.handler}}const kW=(n,e,t)=>{if(hw(e))return[...n.matchAll(e)];const r=e(n,t);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=n,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function TW(n){const{editor:e,state:t,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=n,{commands:l,chain:c,can:u}=new fp({editor:e,state:t}),h=[];return t.doc.nodesBetween(r,s,(m,y)=>{if(!m.isTextblock||m.type.spec.code)return;const v=Math.max(r,y),_=Math.min(s,y+m.content.size),x=m.textBetween(v-y,_-y,void 0,"￼");kW(x,i.find,o).forEach(b=>{if(b.index===void 0)return;const N=v+b.index+1,R=N+b[0].length,P={from:t.tr.mapping.map(N),to:t.tr.mapping.map(R)},k=i.handler({state:t,range:P,match:b,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});h.push(k)})}),h.every(m=>m!==null)}let Ed=null;const bW=n=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)===null||e===void 0||e.setData("text/html",n),t};function SW(n){const{editor:e,rules:t}=n;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:h,to:f,rule:m,pasteEvt:y})=>{const v=u.tr,_=hp({state:u,transaction:v});if(!(!TW({editor:e,state:_,from:Math.max(h-1,0),to:f.b-1,rule:m,pasteEvent:y,dropEvent:a})||!v.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,v}};return t.map(u=>new Xt({view(h){const f=y=>{var v;r=!((v=h.dom.parentElement)===null||v===void 0)&&v.contains(y.target)?h.dom.parentElement:null,r&&(Ed=e)},m=()=>{Ed&&(Ed=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",m),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",m)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=r===h.dom.parentElement,a=f,!i){const m=Ed;m!=null&&m.isEditable&&setTimeout(()=>{const y=m.state.selection;y&&m.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(h,f)=>{var m;const y=(m=f.clipboardData)===null||m===void 0?void 0:m.getData("text/html");return o=f,s=!!(y!=null&&y.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,m)=>{const y=h[0],v=y.getMeta("uiEvent")==="paste"&&!s,_=y.getMeta("uiEvent")==="drop"&&!i,x=y.getMeta("applyPasteRules"),T=!!x;if(!v&&!_&&!T)return;if(T){let{text:R}=x;typeof R=="string"?R=R:R=dw(U.from(R),m.schema);const{from:P}=x,k=P+R.length,E=bW(R);return l({rule:u,state:m,from:P,to:{b:k},pasteEvt:E})}const b=f.doc.content.findDiffStart(m.doc.content),N=f.doc.content.findDiffEnd(m.doc.content);if(!(!xW(b)||!N||b===N.b))return l({rule:u,state:m,from:b,to:N,pasteEvt:o})}}))}function IW(n){const e=n.filter((t,r)=>n.indexOf(t)!==r);return Array.from(new Set(e))}class ua{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=ua.resolve(e),this.schema=gW(this.extensions,t),this.setupExtensions()}static resolve(e){const t=ua.sort(ua.flatten(e)),r=IW(t.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const r={name:t.name,options:t.options,storage:t.storage},s=J(t,"addExtensions",r);return s?[t,...this.flatten(s())]:t}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=J(r,"priority")||100,o=J(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const r={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:zm(t.name,this.schema)},s=J(t,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,t=ua.sort([...this.extensions].reverse()),r=[],s=[],i=t.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:zm(o.name,this.schema)},l=[],c=J(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&J(o,"exitable",a)&&(u.ArrowRight=()=>Zr.handleExit({editor:e,mark:o})),c){const v=Object.fromEntries(Object.entries(c()).map(([_,x])=>[_,()=>x({editor:e})]));u={...u,...v}}const h=H5(u);l.push(h);const f=J(o,"addInputRules",a);OT(o,e.options.enableInputRules)&&f&&r.push(...f());const m=J(o,"addPasteRules",a);OT(o,e.options.enablePasteRules)&&m&&s.push(...m());const y=J(o,"addProseMirrorPlugins",a);if(y){const v=y();l.push(...v)}return l}).flat();return[wW({editor:e,rules:r}),...SW({editor:e,rules:s}),...i]}get attributes(){return _R(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=pp(this.extensions);return Object.fromEntries(t.filter(r=>!!J(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:ft(r.name,this.schema)},o=J(r,"addNodeView",i);if(!o)return[];const a=(l,c,u,h,f)=>{const m=zy(l,s);return o()({node:l,view:c,getPos:u,decorations:h,innerDecorations:f,editor:e,extension:r,HTMLAttributes:m})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:zm(e.name,this.schema)};e.type==="mark"&&(!((t=ue(J(e,"keepOnSplit",r)))!==null&&t!==void 0)||t)&&this.splittableMarks.push(e.name);const s=J(e,"onBeforeCreate",r),i=J(e,"onCreate",r),o=J(e,"onUpdate",r),a=J(e,"onSelectionUpdate",r),l=J(e,"onTransaction",r),c=J(e,"onFocus",r),u=J(e,"onBlur",r),h=J(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),h&&this.editor.on("destroy",h)})}}class Vt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ue(J(this,"addOptions",{name:this.name}))),this.storage=ue(J(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Vt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>gp(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Vt({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=ue(J(t,"addOptions",{name:t.name})),t.storage=ue(J(t,"addStorage",{name:t.name,options:t.options})),t}}function ER(n,e,t){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=t||{};let a="";return n.nodesBetween(r,s,(l,c,u,h)=>{var f;l.isBlock&&c>r&&(a+=i);const m=o==null?void 0:o[l.type.name];if(m)return u&&(a+=m({node:l,pos:c,parent:u,index:h,range:e})),!1;l.isText&&(a+=(f=l==null?void 0:l.text)===null||f===void 0?void 0:f.slice(Math.max(r,c)-c,s-c))}),a}function kR(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const CW=Vt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Xt({key:new Jn("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(u=>u.$from.pos)),a=Math.max(...i.map(u=>u.$to.pos)),l=kR(t);return ER(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),NW=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{var t;n.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),AW=(n=!1)=>({commands:e})=>e.setContent("",n),RW=()=>({state:n,tr:e,dispatch:t})=>{const{selection:r}=e,{ranges:s}=r;return t&&s.forEach(({$from:i,$to:o})=>{n.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,h=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),m=h.blockRange(f);if(!m)return;const y=rl(m);if(a.type.isTextblock){const{defaultType:v}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(m.start,v)}(y||y===0)&&e.lift(m,y)})}),!0},PW=n=>e=>n(e),DW=()=>({state:n,dispatch:e})=>gR(n,e),MW=(n,e)=>({editor:t,tr:r})=>{const{state:s}=t,i=s.doc.slice(n.from,n.to);r.deleteRange(n.from,n.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new se(r.doc.resolve(Math.max(o-1,0)))),!0},OW=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,r=t.$anchor.node();if(r.content.size>0)return!1;const s=n.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);n.delete(a,l).scrollIntoView()}return!0}return!1},VW=n=>({tr:e,state:t,dispatch:r})=>{const s=ft(n,t.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),c=i.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},jW=n=>({tr:e,dispatch:t})=>{const{from:r,to:s}=n;return t&&e.delete(r,s),!0},LW=()=>({state:n,dispatch:e})=>ow(n,e),FW=()=>({commands:n})=>n.keyboardShortcut("Enter"),BW=()=>({state:n,dispatch:e})=>X5(n,e);function hf(n,e,t={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>t.strict?e[s]===n[s]:hw(e[s])?e[s].test(n[s]):e[s]===n[s]):!0}function TR(n,e,t={}){return n.find(r=>r.type===e&&hf(Object.fromEntries(Object.keys(t).map(s=>[s,r.attrs[s]])),t))}function VT(n,e,t={}){return!!TR(n,e,t)}function fw(n,e,t){var r;if(!n||!e)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(t=t||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!TR([...s.node.marks],e,t)))return;let o=s.index,a=n.start()+s.offset,l=o+1,c=a+s.node.nodeSize;for(;o>0&&VT([...n.parent.child(o-1).marks],e,t);)o-=1,a-=n.parent.child(o).nodeSize;for(;l<n.parent.childCount&&VT([...n.parent.child(l).marks],e,t);)c+=n.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function _i(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}const UW=(n,e={})=>({tr:t,state:r,dispatch:s})=>{const i=_i(n,r.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(s){const h=fw(l,i,e);if(h&&h.from<=c&&h.to>=u){const f=se.create(o,h.from,h.to);t.setSelection(f)}}return!0},$W=n=>e=>{const t=typeof n=="function"?n(e):n;for(let r=0;r<t.length;r+=1)if(t[r](e))return!0;return!1};function bR(n){return n instanceof se}function zi(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function SR(n,e=null){if(!e)return null;const t=ce.atStart(n),r=ce.atEnd(n);if(e==="start"||e===!0)return t;if(e==="end")return r;const s=t.from,i=r.to;return e==="all"?se.create(n,zi(0,s,i),zi(n.content.size,s,i)):se.create(n,zi(e,s,i),zi(e,s,i))}function zW(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function pw(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const WW=(n=null,e={})=>({editor:t,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(pw()||zW())&&r.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(r.hasFocus()&&n===null||n===!1)return!0;if(i&&n===null&&!bR(t.state.selection))return o(),!0;const a=SR(s.doc,n)||t.state.selection,l=t.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},qW=(n,e)=>t=>n.every((r,s)=>e(r,{...t,index:s})),HW=(n,e)=>({tr:t,commands:r})=>r.insertContentAt({from:t.selection.from,to:t.selection.to},n,e),IR=n=>{const e=n.childNodes;for(let t=e.length-1;t>=0;t-=1){const r=e[t];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?n.removeChild(r):r.nodeType===1&&IR(r)}return n};function kd(n){const e=`<body>${n}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return IR(t)}function Zc(n,e,t){if(n instanceof Gs||n instanceof U)return n;t={slice:!0,parseOptions:{},...t};const r=typeof n=="object"&&n!==null,s=typeof n=="string";if(r)try{if(Array.isArray(n)&&n.length>0)return U.fromArray(n.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(n);return t.errorOnInvalidContent&&o.check(),o}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",i),Zc("",e,t)}if(s){if(t.errorOnInvalidContent){let o=!1,a="";const l=new cA({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?Qs.fromSchema(l).parseSlice(kd(n),t.parseOptions):Qs.fromSchema(l).parse(kd(n),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=Qs.fromSchema(e);return t.slice?i.parseSlice(kd(n),t.parseOptions).content:i.parse(kd(n),t.parseOptions)}return Zc("",e,t)}function KW(n,e,t){const r=n.steps.length-1;if(r<e)return;const s=n.steps[r];if(!(s instanceof ct||s instanceof dt))return;const i=n.mapping.maps[r];let o=0;i.forEach((a,l,c,u)=>{o===0&&(o=u)}),n.setSelection(ce.near(n.doc.resolve(o),t))}const GW=n=>!("type"in n),QW=(n,e,t)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=_=>{i.emit("contentError",{editor:i,error:_,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Zc(e,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(_){l(_)}try{a=Zc(e,i.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(_){return l(_),!1}let{from:u,to:h}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},f=!0,m=!0;if((GW(a)?a:[a]).forEach(_=>{_.check(),f=f?_.isText&&_.marks.length===0:!1,m=m?_.isBlock:!1}),u===h&&m){const{parent:_}=r.doc.resolve(u);_.isTextblock&&!_.type.spec.code&&!_.childCount&&(u-=1,h+=1)}let v;if(f){if(Array.isArray(e))v=e.map(_=>_.text||"").join("");else if(e instanceof U){let _="";e.forEach(x=>{x.text&&(_+=x.text)}),v=_}else typeof e=="object"&&e&&e.text?v=e.text:v=e;r.insertText(v,u,h)}else v=a,r.replaceWith(u,h,v);t.updateSelection&&KW(r,r.steps.length-1,-1),t.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:v}),t.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:v})}return!0},JW=()=>({state:n,dispatch:e})=>Q5(n,e),YW=()=>({state:n,dispatch:e})=>J5(n,e),XW=()=>({state:n,dispatch:e})=>cR(n,e),ZW=()=>({state:n,dispatch:e})=>fR(n,e),e7=()=>({state:n,dispatch:e,tr:t})=>{try{const r=op(n.doc,n.selection.$from.pos,-1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},t7=()=>({state:n,dispatch:e,tr:t})=>{try{const r=op(n.doc,n.selection.$from.pos,1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},n7=()=>({state:n,dispatch:e})=>K5(n,e),r7=()=>({state:n,dispatch:e})=>G5(n,e);function CR(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function s7(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))pw()||CR()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(t=`Alt-${t}`),s&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}const i7=n=>({editor:e,view:t,tr:r,dispatch:s})=>{const i=s7(n).split(/-(?!$)/),o=i.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function eu(n,e,t={}){const{from:r,to:s,empty:i}=n.selection,o=e?ft(e,n.schema):null,a=[];n.doc.nodesBetween(r,s,(h,f)=>{if(h.isText)return;const m=Math.max(r,f),y=Math.min(s,f+h.nodeSize);a.push({node:h,from:m,to:y})});const l=s-r,c=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>hf(h.node.attrs,t,{strict:!1}));return i?!!c.length:c.reduce((h,f)=>h+f.to-f.from,0)>=l}const o7=(n,e={})=>({state:t,dispatch:r})=>{const s=ft(n,t.schema);return eu(t,s,e)?Y5(t,r):!1},a7=()=>({state:n,dispatch:e})=>yR(n,e),l7=n=>({state:e,dispatch:t})=>{const r=ft(n,e.schema);return cW(r)(e,t)},c7=()=>({state:n,dispatch:e})=>mR(n,e);function yp(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function jT(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((r,s)=>(t.includes(s)||(r[s]=n[s]),r),{})}const u7=(n,e)=>({tr:t,state:r,dispatch:s})=>{let i=null,o=null;const a=yp(typeof n=="string"?n:n.name,r.schema);return a?(a==="node"&&(i=ft(n,r.schema)),a==="mark"&&(o=_i(n,r.schema)),s&&t.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{i&&i===c.type&&t.setNodeMarkup(u,void 0,jT(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(h=>{o===h.type&&t.addMark(u,u+c.nodeSize,o.create(jT(h.attrs,e)))})})}),!0):!1},d7=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0),h7=()=>({tr:n,dispatch:e})=>{if(e){const t=new vn(n.doc);n.setSelection(t)}return!0},f7=()=>({state:n,dispatch:e})=>dR(n,e),p7=()=>({state:n,dispatch:e})=>pR(n,e),m7=()=>({state:n,dispatch:e})=>tW(n,e),g7=()=>({state:n,dispatch:e})=>sW(n,e),y7=()=>({state:n,dispatch:e})=>rW(n,e);function Wy(n,e,t={},r={}){return Zc(n,e,{slice:!1,parseOptions:t,errorOnInvalidContent:r.errorOnInvalidContent})}const v7=(n,e=!1,t={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,c;const{doc:u}=i;if(t.preserveWhitespace!=="full"){const h=Wy(n,s.schema,t,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,u.content.size,h).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},n,{parseOptions:t,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:s.options.enableContentCheck})};function NR(n,e){const t=_i(e,n.schema),{from:r,to:s,empty:i}=n.selection,o=[];i?(n.storedMarks&&o.push(...n.storedMarks),o.push(...n.selection.$head.marks())):n.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function w7(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function _7(n,e){for(let t=n.depth;t>0;t-=1){const r=n.node(t);if(e(r))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:r}}}function mw(n){return e=>_7(e.$from,n)}function x7(n,e){const t={from:0,to:n.content.size};return ER(n,t,e)}function E7(n,e){const t=ft(e,n.schema),{from:r,to:s}=n.selection,i=[];n.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function k7(n,e){const t=yp(typeof e=="string"?e:e.name,n.schema);return t==="node"?E7(n,e):t==="mark"?NR(n,e):{}}function AR(n,e,t){const r=[];return n===e?t.resolve(n).marks().forEach(s=>{const i=t.resolve(n),o=fw(i,s.type);o&&r.push({mark:s,...o})}):t.nodesBetween(n,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function Zd(n,e,t){return Object.fromEntries(Object.entries(t).filter(([r])=>{const s=n.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function qy(n,e,t={}){const{empty:r,ranges:s}=n.selection,i=e?_i(e,n.schema):null;if(r)return!!(n.storedMarks||n.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>hf(h.attrs,t,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:h,$to:f})=>{const m=h.pos,y=f.pos;n.doc.nodesBetween(m,y,(v,_)=>{if(!v.isText&&!v.marks.length)return;const x=Math.max(m,_),T=Math.min(y,_+v.nodeSize),b=T-x;o+=b,a.push(...v.marks.map(N=>({mark:N,from:x,to:T})))})}),o===0)return!1;const l=a.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>hf(h.mark.attrs,t,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),c=a.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(l>0?l+c:l)>=o}function T7(n,e,t={}){if(!e)return eu(n,null,t)||qy(n,null,t);const r=yp(e,n.schema);return r==="node"?eu(n,e,t):r==="mark"?qy(n,e,t):!1}function LT(n,e){const{nodeExtensions:t}=pp(e),r=t.find(o=>o.name===n);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=ue(J(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function vp(n,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var r;if(t){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((r=n.text)!==null&&r!==void 0?r:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(e){let s=!0;return n.content.forEach(i=>{s!==!1&&(vp(i,{ignoreWhitespace:t,checkChildren:e})||(s=!1))}),s}return!1}function b7(n){return n instanceof ee}function S7(n,e,t){var r;const{selection:s}=e;let i=null;if(bR(s)&&(i=s.$cursor),i){const a=(r=n.storedMarks)!==null&&r!==void 0?r:i.marks();return!!t.isInSet(a)||!a.some(l=>l.type.excludes(t))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(t):!1;return n.doc.nodesBetween(a.pos,l.pos,(u,h,f)=>{if(c)return!1;if(u.isInline){const m=!f||f.type.allowsMarkType(t),y=!!t.isInSet(u.marks)||!u.marks.some(v=>v.type.excludes(t));c=m&&y}return!c}),c})}const I7=(n,e={})=>({tr:t,state:r,dispatch:s})=>{const{selection:i}=t,{empty:o,ranges:a}=i,l=_i(n,r.schema);if(s)if(o){const c=NR(r,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(u,h,(f,m)=>{const y=Math.max(m,u),v=Math.min(m+f.nodeSize,h);f.marks.find(x=>x.type===l)?f.marks.forEach(x=>{l===x.type&&t.addMark(y,v,l.create({...x.attrs,...e}))}):t.addMark(y,v,l.create(e))})});return S7(r,t,l)},C7=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0),N7=(n,e={})=>({state:t,dispatch:r,chain:s})=>{const i=ft(n,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>PT(i,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>PT(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},A7=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,s=zi(n,0,r.content.size),i=ee.create(r,s);e.setSelection(i)}return!0},R7=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,{from:s,to:i}=typeof n=="number"?{from:n,to:n}:n,o=se.atStart(r).from,a=se.atEnd(r).to,l=zi(s,o,a),c=zi(i,o,a),u=se.create(r,l,c);e.setSelection(u)}return!0},P7=n=>({state:e,dispatch:t})=>{const r=ft(n,e.schema);return hW(r)(e,t)};function FT(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const r=t.filter(s=>e==null?void 0:e.includes(s.type.name));n.tr.ensureMarks(r)}}const D7=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,c=s.extensionManager.attributes,u=Zd(c,a.node().type.name,a.node().attrs);if(i instanceof ee&&i.node.isBlock)return!a.parentOffset||!zr(o,a.pos)?!1:(r&&(n&&FT(t,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:w7(a.node(-1).contentMatchAt(a.indexAfter(-1)));let m=h&&f?[{type:f,attrs:u}]:void 0,y=zr(e.doc,e.mapping.map(a.pos),1,m);if(!m&&!y&&zr(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(y=!0,m=f?[{type:f,attrs:u}]:void 0),r){if(y&&(i instanceof se&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,m),f&&!h&&!a.parentOffset&&a.parent.type!==f)){const v=e.mapping.map(a.before()),_=e.doc.resolve(v);a.node(-1).canReplaceWith(_.index(),_.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}n&&FT(t,s.extensionManager.splittableMarks),e.scrollIntoView()}return y},M7=(n,e={})=>({tr:t,state:r,dispatch:s,editor:i})=>{var o;const a=ft(n,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const h=l.node(-1);if(h.type!==a)return!1;const f=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let x=U.empty;const T=l.index(-1)?1:l.index(-2)?2:3;for(let E=l.depth-T;E>=l.depth-3;E-=1)x=U.from(l.node(E).copy(x));const b=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...Zd(f,l.node().type.name,l.node().attrs),...e},R=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(N))||void 0;x=x.append(U.from(a.createAndFill(null,R)||void 0));const P=l.before(l.depth-(T-1));t.replace(P,l.after(-b),new K(x,4-T,0));let k=-1;t.doc.nodesBetween(P,t.doc.content.size,(E,S)=>{if(k>-1)return!1;E.isTextblock&&E.content.size===0&&(k=S+1)}),k>-1&&t.setSelection(se.near(t.doc.resolve(k))),t.scrollIntoView()}return!0}const m=c.pos===l.end()?h.contentMatchAt(0).defaultType:null,y={...Zd(f,h.type.name,h.attrs),...e},v={...Zd(f,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const _=m?[{type:a,attrs:y},{type:m,attrs:v}]:[{type:a,attrs:y}];if(!zr(t.doc,l.pos,2))return!1;if(s){const{selection:x,storedMarks:T}=r,{splittableMarks:b}=i.extensionManager,N=T||x.$to.parentOffset&&x.$from.marks();if(t.split(l.pos,2,_).scrollIntoView(),!N||!s)return!0;const R=N.filter(P=>b.includes(P.type.name));t.ensureMarks(R)}return!0},Wm=(n,e)=>{const t=mw(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return t.node.type===(s==null?void 0:s.type)&&vi(n.doc,t.pos)&&n.join(t.pos),!0},qm=(n,e)=>{const t=mw(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(t.start).after(t.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return t.node.type===(s==null?void 0:s.type)&&vi(n.doc,r)&&n.join(r),!0},O7=(n,e,t,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:h,splittableMarks:f}=s.extensionManager,m=ft(n,o.schema),y=ft(e,o.schema),{selection:v,storedMarks:_}=o,{$from:x,$to:T}=v,b=x.blockRange(T),N=_||v.$to.parentOffset&&v.$from.marks();if(!b)return!1;const R=mw(P=>LT(P.type.name,h))(v);if(b.depth>=1&&R&&b.depth-R.depth<=1){if(R.node.type===m)return c.liftListItem(y);if(LT(R.node.type.name,h)&&m.validContent(R.node.content)&&a)return l().command(()=>(i.setNodeMarkup(R.pos,m),!0)).command(()=>Wm(i,m)).command(()=>qm(i,m)).run()}return!t||!N||!a?l().command(()=>u().wrapInList(m,r)?!0:c.clearNodes()).wrapInList(m,r).command(()=>Wm(i,m)).command(()=>qm(i,m)).run():l().command(()=>{const P=u().wrapInList(m,r),k=N.filter(E=>f.includes(E.type.name));return i.ensureMarks(k),P?!0:c.clearNodes()}).wrapInList(m,r).command(()=>Wm(i,m)).command(()=>qm(i,m)).run()},V7=(n,e={},t={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=t,o=_i(n,r.schema);return qy(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},j7=(n,e,t={})=>({state:r,commands:s})=>{const i=ft(n,r.schema),o=ft(e,r.schema),a=eu(r,i,t);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...t})},L7=(n,e={})=>({state:t,commands:r})=>{const s=ft(n,t.schema);return eu(t,s,e)?r.lift(s):r.wrapIn(s,e)},F7=()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let r=0;r<t.length;r+=1){const s=t[r];let i;if(s.spec.isInputRules&&(i=s.getState(n))){if(e){const o=n.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,n.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},B7=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,{empty:r,ranges:s}=t;return r||e&&s.forEach(i=>{n.removeMark(i.$from.pos,i.$to.pos)}),!0},U7=(n,e={})=>({tr:t,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=_i(n,r.schema),{$from:c,empty:u,ranges:h}=a;if(!s)return!0;if(u&&o){let{from:f,to:m}=a;const y=(i=c.marks().find(_=>_.type===l))===null||i===void 0?void 0:i.attrs,v=fw(c,l,y);v&&(f=v.from,m=v.to),t.removeMark(f,m,l)}else h.forEach(f=>{t.removeMark(f.$from.pos,f.$to.pos,l)});return t.removeStoredMark(l),!0},$7=(n,e={})=>({tr:t,state:r,dispatch:s})=>{let i=null,o=null;const a=yp(typeof n=="string"?n:n.name,r.schema);return a?(a==="node"&&(i=ft(n,r.schema)),a==="mark"&&(o=_i(n,r.schema)),s&&t.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let h,f,m,y;t.selection.empty?r.doc.nodesBetween(c,u,(v,_)=>{i&&i===v.type&&(m=Math.max(_,c),y=Math.min(_+v.nodeSize,u),h=_,f=v)}):r.doc.nodesBetween(c,u,(v,_)=>{_<c&&i&&i===v.type&&(m=Math.max(_,c),y=Math.min(_+v.nodeSize,u),h=_,f=v),_>=c&&_<=u&&(i&&i===v.type&&t.setNodeMarkup(_,void 0,{...v.attrs,...e}),o&&v.marks.length&&v.marks.forEach(x=>{if(o===x.type){const T=Math.max(_,c),b=Math.min(_+v.nodeSize,u);t.addMark(T,b,o.create({...x.attrs,...e}))}}))}),f&&(h!==void 0&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(v=>{o===v.type&&t.addMark(m,y,o.create({...v.attrs,...e}))}))}),!0):!1},z7=(n,e={})=>({state:t,dispatch:r})=>{const s=ft(n,t.schema);return iW(s,e)(t,r)},W7=(n,e={})=>({state:t,dispatch:r})=>{const s=ft(n,t.schema);return oW(s,e)(t,r)};var q7=Object.freeze({__proto__:null,blur:NW,clearContent:AW,clearNodes:RW,command:PW,createParagraphNear:DW,cut:MW,deleteCurrentNode:OW,deleteNode:VW,deleteRange:jW,deleteSelection:LW,enter:FW,exitCode:BW,extendMarkRange:UW,first:$W,focus:WW,forEach:qW,insertContent:HW,insertContentAt:QW,joinBackward:XW,joinDown:YW,joinForward:ZW,joinItemBackward:e7,joinItemForward:t7,joinTextblockBackward:n7,joinTextblockForward:r7,joinUp:JW,keyboardShortcut:i7,lift:o7,liftEmptyBlock:a7,liftListItem:l7,newlineInCode:c7,resetAttributes:u7,scrollIntoView:d7,selectAll:h7,selectNodeBackward:f7,selectNodeForward:p7,selectParentNode:m7,selectTextblockEnd:g7,selectTextblockStart:y7,setContent:v7,setMark:I7,setMeta:C7,setNode:N7,setNodeSelection:A7,setTextSelection:R7,sinkListItem:P7,splitBlock:D7,splitListItem:M7,toggleList:O7,toggleMark:V7,toggleNode:j7,toggleWrap:L7,undoInputRule:F7,unsetAllMarks:B7,unsetMark:U7,updateAttributes:$7,wrapIn:z7,wrapInList:W7});const H7=Vt.create({name:"commands",addCommands(){return{...q7}}}),K7=Vt.create({name:"drop",addProseMirrorPlugins(){return[new Xt({key:new Jn("tiptapDrop"),props:{handleDrop:(n,e,t,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:r})}}})]}}),G7=Vt.create({name:"editable",addProseMirrorPlugins(){return[new Xt({key:new Jn("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Q7=new Jn("focusEvents"),J7=Vt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new Xt({key:Q7,props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const r=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,t)=>{n.isFocused=!1;const r=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Y7=Vt.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:h}=l,{pos:f,parent:m}=h,y=h.parent.isTextblock&&f>0?a.doc.resolve(f-1):h,v=y.parent.type.spec.isolating,_=h.pos-h.parentOffset,x=v&&y.parent.childCount===1?_===h.pos:ce.atStart(c).from===f;return!u||!m.type.isTextblock||m.textContent.length||!x||x&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return pw()||CR()?i:s},addProseMirrorPlugins(){return[new Xt({key:new Jn("clearDocument"),appendTransaction:(n,e,t)=>{if(n.some(v=>v.getMeta("composition")))return;const r=n.some(v=>v.docChanged)&&!e.doc.eq(t.doc),s=n.some(v=>v.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=ce.atStart(e.doc).from,c=ce.atEnd(e.doc).to;if(i||!(o===l&&a===c)||!vp(t.doc))return;const f=t.tr,m=hp({state:t,transaction:f}),{commands:y}=new fp({editor:this.editor,state:m});if(y.clearNodes(),!!f.steps.length)return f}})]}}),X7=Vt.create({name:"paste",addProseMirrorPlugins(){return[new Xt({key:new Jn("tiptapPaste"),props:{handlePaste:(n,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),Z7=Vt.create({name:"tabindex",addProseMirrorPlugins(){return[new Xt({key:new Jn("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class ji{get name(){return this.node.type.name}constructor(e,t,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=t,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:t,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new ji(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new ji(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new ji(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,r)=>{const s=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new ji(a,this.editor,s,s?t:null);s&&(l.actualDepth=this.depth+1),e.push(new ji(a,this.editor,s,s?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(t).length>0){const i=s.node.attrs,o=Object.keys(t);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==t[l])break}}else r=s;s=s.parent}return r}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(t);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>t[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,t,r))))}),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}const eq=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function tq(n,e,t){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(s),s}class nq extends fW{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:r,moved:s})=>this.options.onDrop(t,r,s)),this.on("paste",({event:t,slice:r})=>this.options.onPaste(t,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=tq(eq,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const r=xR(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let r=t;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),t.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,t;const s=[...this.options.enableCoreExtensions?[G7,CW.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||t===void 0?void 0:t.blockSeparator}),H7,J7,Y7,Z7,K7,X7].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new ua(s,this)}createCommandManager(){this.commandManager=new fp({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=Wy(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),t=Wy(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=SR(t,this.options.autofocus);this.view=new oR(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:ca.create({doc:t,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const t=this.state.apply(e),r=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return k7(this.state,e)}isActive(e,t){const r=typeof e=="string"?e:null,s=typeof e=="string"?t:e;return T7(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return dw(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:r={}}=e||{};return x7(this.state.doc,{blockSeparator:t,textSerializers:{...kR(this.schema),...r}})}get isEmpty(){return vp(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,t){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,t))||null}$nodes(e,t){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new ji(t,this)}get $doc(){return this.$pos(0)}}function Ha(n){return new mp({find:n.find,handler:({state:e,range:t,match:r})=>{const s=ue(n.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(AR(t.from,t.to,e.doc).filter(m=>m.mark.type.excluded.find(v=>v===n.type&&v!==m.mark.type)).filter(m=>m.to>c).length)return null;u<t.to&&i.delete(u,t.to),c>t.from&&i.delete(t.from+l,c);const f=t.from+l+o.length;i.addMark(t.from+l,f,n.type.create(s||{})),i.removeStoredMark(n.type)}}})}function rq(n){return new mp({find:n.find,handler:({state:e,range:t,match:r})=>{const s=ue(n.getAttributes,void 0,r)||{},{tr:i}=e,o=t.from;let a=t.to;const l=n.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const h=r[0][r[0].length-1];i.insertText(h,o+r[0].length-1),i.replaceWith(u,a,l)}else if(r[0]){const c=n.type.isInline?o:o-1;i.insert(c,n.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function Hy(n){return new mp({find:n.find,handler:({state:e,range:t,match:r})=>{const s=e.doc.resolve(t.from),i=ue(n.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,i)}})}function tu(n){return new mp({find:n.find,handler:({state:e,range:t,match:r,chain:s})=>{const i=ue(n.getAttributes,void 0,r)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),c=l&&Qv(l,n.type,i);if(!c)return null;if(o.wrap(l,c),n.keepMarks&&n.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:m}=n.editor.extensionManager,y=f||h.$to.parentOffset&&h.$from.marks();if(y){const v=y.filter(_=>m.includes(_.type.name));o.ensureMarks(v)}}if(n.keepAttributes){const h=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,i).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===n.type&&vi(o.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(r,u))&&o.join(t.from-1)}})}class ln{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ue(J(this,"addOptions",{name:this.name}))),this.storage=ue(J(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ln(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>gp(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new ln(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=ue(J(t,"addOptions",{name:t.name})),t.storage=ue(J(t,"addStorage",{name:t.name,options:t.options})),t}}function Ka(n){return new EW({find:n.find,handler:({state:e,range:t,match:r,pasteEvent:s})=>{const i=ue(n.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=t.to;if(a){const u=l.search(/\S/),h=t.from+l.indexOf(a),f=h+a.length;if(AR(t.from,t.to,e.doc).filter(y=>y.mark.type.excluded.find(_=>_===n.type&&_!==y.mark.type)).filter(y=>y.to>h).length)return null;f<t.to&&o.delete(f,t.to),h>t.from&&o.delete(t.from+u,h),c=t.from+u+a.length,o.addMark(t.from+u,c,n.type.create(i||{})),o.removeStoredMark(n.type)}}})}function sq(n,e){const{selection:t}=n,{$from:r}=t;if(t instanceof ee){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function iq(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var RR={exports:{}},Hm={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BT;function oq(){if(BT)return Hm;BT=1;var n=wt;function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,s=n.useEffect,i=n.useLayoutEffect,o=n.useDebugValue;function a(h,f){var m=f(),y=r({inst:{value:m,getSnapshot:f}}),v=y[0].inst,_=y[1];return i(function(){v.value=m,v.getSnapshot=f,l(v)&&_({inst:v})},[h,m,f]),s(function(){return l(v)&&_({inst:v}),h(function(){l(v)&&_({inst:v})})},[h]),o(m),m}function l(h){var f=h.getSnapshot;h=h.value;try{var m=f();return!t(h,m)}catch{return!0}}function c(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Hm.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:u,Hm}RR.exports=oq();var gw=RR.exports;const aq=(...n)=>e=>{n.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},lq=({contentComponent:n})=>{const e=gw.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return wt.createElement(wt.Fragment,null,Object.values(e))};function cq(){const n=new Set;let e={};return{subscribe(t){return n.add(t),()=>{n.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,r){e={...e,[t]:zM.createPortal(r.reactElement,r.element,t)},n.forEach(s=>s())},removeRenderer(t){const r={...e};delete r[t],e=r,n.forEach(s=>s())}}}class uq extends wt.Component{constructor(e){var t;super(e),this.editorContentRef=wt.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((t=e.editor)===null||t===void 0)&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=cq(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...r}=this.props;return wt.createElement(wt.Fragment,null,wt.createElement("div",{ref:aq(t,this.editorContentRef),...r}),(e==null?void 0:e.contentComponent)&&wt.createElement(lq,{contentComponent:e.contentComponent}))}}const dq=M.forwardRef((n,e)=>{const t=wt.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return wt.createElement(uq,{key:t,innerRef:e,...n})}),hq=wt.memo(dq);var fq=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!n(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!n(s[1],t.get(s[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[s]))return!1;for(s=r;s--!==0;){var o=i[s];if(!(o==="_owner"&&e.$$typeof)&&!n(e[o],t[o]))return!1}return!0}return e!==e&&t!==t},pq=iq(fq),PR={exports:{}},Km={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UT;function mq(){if(UT)return Km;UT=1;var n=wt,e=gw;function t(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var r=typeof Object.is=="function"?Object.is:t,s=e.useSyncExternalStore,i=n.useRef,o=n.useEffect,a=n.useMemo,l=n.useDebugValue;return Km.useSyncExternalStoreWithSelector=function(c,u,h,f,m){var y=i(null);if(y.current===null){var v={hasValue:!1,value:null};y.current=v}else v=y.current;y=a(function(){function x(P){if(!T){if(T=!0,b=P,P=f(P),m!==void 0&&v.hasValue){var k=v.value;if(m(k,P))return N=k}return N=P}if(k=N,r(b,P))return k;var E=f(P);return m!==void 0&&m(k,E)?k:(b=P,N=E)}var T=!1,b,N,R=h===void 0?null:h;return[function(){return x(u())},R===null?void 0:function(){return x(R())}]},[u,h,f,m]);var _=s(c,y[0],y[1]);return o(function(){v.hasValue=!0,v.value=_},[_]),l(_),_},Km}PR.exports=mq();var gq=PR.exports;const yq=typeof window<"u"?M.useLayoutEffect:M.useEffect;class vq{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(s=>s())},r=this.editor;return r.on("transaction",t),()=>{r.off("transaction",t)}}}}function wq(n){var e;const[t]=M.useState(()=>new vq(n.editor)),r=gq.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,n.selector,(e=n.equalityFn)!==null&&e!==void 0?e:pq);return yq(()=>t.watch(n.editor),[n.editor,t]),M.useDebugValue(r),r}const _q=!1,Ky=typeof window>"u",xq=Ky||!!(typeof window<"u"&&window.next);class yw{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Ky||xq?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)===null||i===void 0?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)===null||i===void 0?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)===null||i===void 0?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)===null||i===void 0?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)===null||i===void 0?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)===null||i===void 0?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)===null||i===void 0?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)===null||i===void 0?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)===null||i===void 0?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)===null||i===void 0?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)===null||i===void 0?void 0:i.call(s,...r)}};return new nq(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((s,i)=>{var o;return s===((o=t.extensions)===null||o===void 0?void 0:o[i])}):e[r]===t[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?yw.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function Eq(n={},e=[]){const t=M.useRef(n);t.current=n;const[r]=M.useState(()=>new yw(t)),s=gw.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return M.useDebugValue(s),M.useEffect(r.onRender(e)),wq({editor:s,selector:({transactionNumber:i})=>n.shouldRerenderOnTransaction===!1?null:n.immediatelyRender&&i===0?0:i+1}),s}const kq=M.createContext({editor:null});kq.Consumer;const Tq=M.createContext({onDragStart:void 0}),bq=()=>M.useContext(Tq);wt.forwardRef((n,e)=>{const{onDragStart:t}=bq(),r=n.as||"div";return wt.createElement(r,{...n,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...n.style}})});const Sq=/^\s*>\s$/,Iq=ln.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return["blockquote",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[tu({find:Sq,type:this.type})]}}),Cq=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Nq=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Aq=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Rq=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Pq=Zr.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return["strong",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ha({find:Cq,type:this.type}),Ha({find:Aq,type:this.type})]},addPasteRules(){return[Ka({find:Nq,type:this.type}),Ka({find:Rq,type:this.type})]}}),Dq="listItem",$T="textStyle",zT=/^\s*([-+*])\s$/,Mq=ln.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Dq,this.editor.getAttributes($T)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=tu({find:zT,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=tu({find:zT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes($T),editor:this.editor})),[n]}}),Oq=/(^|[^`])`([^`]+)`(?!`)/,Vq=/(^|[^`])`([^`]+)`(?!`)/g,jq=Zr.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ha({find:Oq,type:this.type})]},addPasteRules(){return[Ka({find:Vq,type:this.type})]}}),Lq=/^```([a-z]+)?[\s\n]$/,Fq=/^~~~([a-z]+)?[\s\n]$/,Bq=ln.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options,i=[...((e=n.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:e}){return["pre",Ot(this.options.HTMLAttributes,e),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode(this.name,n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=n,{selection:t}=e,{$from:r,empty:s}=t;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:n.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=n,{selection:t,doc:r}=e,{$from:s,empty:i}=t;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?n.commands.command(({tr:c})=>(c.setSelection(ce.near(r.resolve(a))),!0)):n.commands.exitCode()}}},addInputRules(){return[Hy({find:Lq,type:this.type,getAttributes:n=>({language:n[1]})}),Hy({find:Fq,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new Xt({key:new Jn("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!t||!i)return!1;const{tr:o,schema:a}=n.state,l=a.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(se.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),n.dispatch(o),!0}}})]}}),Uq=ln.create({name:"doc",topNode:!0,content:"block+"});function $q(n={}){return new Xt({view(e){return new zq(e,n)}})}class zq{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(t){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let m=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(m){let y=m.getBoundingClientRect(),v=h?y.bottom:y.top;h&&f&&(v=(v+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let _=this.width/2*a;r={left:y.left,right:y.right,top:v-_,bottom:v+_}}}}if(!r){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let h=l.getBoundingClientRect(),f=h.width/l.offsetWidth,m=h.height/l.offsetHeight;c=h.left-l.scrollLeft*f,u=h.top-l.scrollTop*m}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,t,e):s;if(t&&!i){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=_A(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Wq=Vt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[$q(this.options)]}});class $e extends ce{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return $e.valid(r)?new $e(r):ce.near(r)}content(){return K.empty}eq(e){return e instanceof $e&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new $e(e.resolve(t.pos))}getBookmark(){return new vw(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!qq(e)||!Hq(e))return!1;let r=t.type.spec.allowGapCursor;if(r!=null)return r;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&$e.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(t>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=t;let l=e.doc.resolve(s);if($e.valid(l))return l}for(;;){let o=t>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!ee.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*t),r=!1;continue e}break}i=o,s+=t;let a=e.doc.resolve(s);if($e.valid(a))return a}return null}}}$e.prototype.visible=!1;$e.findFrom=$e.findGapCursorFrom;ce.jsonID("gapcursor",$e);class vw{constructor(e){this.pos=e}map(e){return new vw(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return $e.valid(t)?new $e(t):ce.near(t)}}function DR(n){return n.isAtom||n.spec.isolating||n.spec.createGapCursor}function qq(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),r=n.node(e);if(t==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(t-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||DR(s.type))return!0;if(s.inlineContent)return!1}}return!0}function Hq(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),r=n.node(e);if(t==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(t);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||DR(s.type))return!0;if(s.inlineContent)return!1}}return!0}function Kq(){return new Xt({props:{decorations:Yq,createSelectionBetween(n,e,t){return e.pos==t.pos&&$e.valid(t)?new $e(t):null},handleClick:Qq,handleKeyDown:Gq,handleDOMEvents:{beforeinput:Jq}}})}const Gq=aR({ArrowLeft:Td("horiz",-1),ArrowRight:Td("horiz",1),ArrowUp:Td("vert",-1),ArrowDown:Td("vert",1)});function Td(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof se){if(!i.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=$e.findGapCursorFrom(a,e,l);return c?(s&&s(r.tr.setSelection(new $e(c))),!0):!1}}function Qq(n,e,t){if(!n||!n.editable)return!1;let r=n.state.doc.resolve(e);if(!$e.valid(r))return!1;let s=n.posAtCoords({left:t.clientX,top:t.clientY});return s&&s.inside>-1&&ee.isSelectable(n.state.doc.nodeAt(s.inside))?!1:(n.dispatch(n.state.tr.setSelection(new $e(r))),!0)}function Jq(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof $e))return!1;let{$from:t}=n.state.selection,r=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!r)return!1;let s=U.empty;for(let o=r.length-1;o>=0;o--)s=U.from(r[o].createAndFill(null,s));let i=n.state.tr.replace(t.pos,t.pos,new K(s,0,0));return i.setSelection(se.near(i.doc.resolve(t.pos+1))),n.dispatch(i),!1}function Yq(n){if(!(n.selection instanceof $e))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Je.create(n.doc,[gn.widget(n.selection.head,e,{key:"gapcursor"})])}const Xq=Vt.create({name:"gapCursor",addProseMirrorPlugins(){return[Kq()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=ue(J(n,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),Zq=ln.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",Ot(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:r})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:s,storedMarks:i}=t;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const h=l.filter(f=>a.includes(f.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),e8=ln.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,Ot(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode(this.name,n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>({...n,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>Hy({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});var ff=200,ht=function(){};ht.prototype.append=function(e){return e.length?(e=ht.from(e),!this.length&&e||e.length<ff&&this.leafAppend(e)||this.length<ff&&e.leafPrepend(this)||this.appendInner(e)):this};ht.prototype.prepend=function(e){return e.length?ht.from(e).append(this):this};ht.prototype.appendInner=function(e){return new t8(this,e)};ht.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?ht.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};ht.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ht.prototype.forEach=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)};ht.prototype.map=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},t,r),s};ht.from=function(e){return e instanceof ht?e:e&&e.length?new MR(e):ht.empty};var MR=function(n){function e(r){n.call(this),this.values=r}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=ff)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=ff)return new e(s.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(ht);ht.empty=new MR([]);var t8=function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(ht);const n8=500;class $n{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;t&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((h,f)=>{if(!h.step){s||(s=this.remapping(r,f+1),i=s.maps.length),i--,u.push(h);return}if(s){u.push(new Zn(h.map));let m=h.step.map(s.slice(i)),y;m&&o.maybeStep(m).doc&&(y=o.mapping.maps[o.mapping.maps.length-1],c.push(new Zn(y,void 0,void 0,c.length+u.length))),i--,y&&s.appendMap(y,i)}else o.maybeStep(h.step);if(h.selection)return a=s?h.selection.map(s.slice(i)):h.selection,l=new $n(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,t,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),f=new Zn(e.mapping.maps[u],h,t),m;(m=l&&l.merge(f))&&(f=m,u?i.pop():a=a.slice(0,a.length-1)),i.push(f),t&&(o++,t=void 0),s||(l=f)}let c=o-r.depth;return c>s8&&(a=r8(a,c),o-=c),new $n(a.append(i),o)}remapping(e,t){let r=new Gc;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,t),r}addMaps(e){return this.eventCount==0?this:new $n(this.items.append(e.map(t=>new Zn(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},s);let l=t;this.items.forEach(f=>{let m=i.getMirror(--l);if(m==null)return;o=Math.min(o,m);let y=i.maps[m];if(f.step){let v=e.steps[m].invert(e.docs[m]),_=f.selection&&f.selection.map(i.slice(l+1,m));_&&a++,r.push(new Zn(y,v,_))}else r.push(new Zn(y))},s);let c=[];for(let f=t;f<o;f++)c.push(new Zn(i.maps[f]));let u=this.items.slice(0,s).append(c).append(r),h=new $n(u,a);return h.emptyItemCount()>n8&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(t.slice(r)),c=l&&l.getMap();if(r--,c&&t.appendMap(c,r),l){let u=o.selection&&o.selection.map(t.slice(r));u&&i++;let h=new Zn(c.invert(),l,u),f,m=s.length-1;(f=s.length&&s[m].merge(h))?s[m]=f:s.push(h)}}else o.map&&r--},this.items.length,0),new $n(ht.from(s.reverse()),i)}}$n.empty=new $n(ht.empty,0);function r8(n,e){let t;return n.forEach((r,s)=>{if(r.selection&&e--==0)return t=s,!1}),n.slice(t)}class Zn{constructor(e,t,r,s){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Zn(t.getMap().invert(),t,this.selection)}}}class ys{constructor(e,t,r,s,i){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const s8=20;function i8(n,e,t,r){let s=t.getMeta(eo),i;if(s)return s.historyState;t.getMeta(l8)&&(n=new ys(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(eo))return o.getMeta(eo).redo?new ys(n.done.addTransform(t,void 0,r,eh(e)),n.undone,WT(t.mapping.maps),n.prevTime,n.prevComposition):new ys(n.done,n.undone.addTransform(t,void 0,r,eh(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),l=n.prevTime==0||!o&&n.prevComposition!=a&&(n.prevTime<(t.time||0)-r.newGroupDelay||!o8(t,n.prevRanges)),c=o?Gm(n.prevRanges,t.mapping):WT(t.mapping.maps);return new ys(n.done.addTransform(t,l?e.selection.getBookmark():void 0,r,eh(e)),$n.empty,c,t.time,a??n.prevComposition)}else return(i=t.getMeta("rebased"))?new ys(n.done.rebased(t,i),n.undone.rebased(t,i),Gm(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new ys(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),Gm(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function o8(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(t=!0)}),t}function WT(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((r,s,i,o)=>e.push(i,o));return e}function Gm(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let s=e.map(n[r],1),i=e.map(n[r+1],-1);s<=i&&t.push(s,i)}return t}function a8(n,e,t){let r=eh(e),s=eo.get(e).spec.config,i=(t?n.undone:n.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(t?n.done:n.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new ys(t?a:i.remaining,t?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(eo,{redo:t,historyState:l})}let Qm=!1,qT=null;function eh(n){let e=n.plugins;if(qT!=e){Qm=!1,qT=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Qm=!0;break}}return Qm}const eo=new Jn("history"),l8=new Jn("closeHistory");function c8(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new Xt({key:eo,state:{init(){return new ys($n.empty,$n.empty,null,0,-1)},apply(e,t,r){return i8(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,s=r=="historyUndo"?VR:r=="historyRedo"?jR:null;return s?(t.preventDefault(),s(e.state,e.dispatch)):!1}}}})}function OR(n,e){return(t,r)=>{let s=eo.getState(t);if(!s||(n?s.undone:s.done).eventCount==0)return!1;if(r){let i=a8(s,t,n);i&&r(e?i.scrollIntoView():i)}return!0}}const VR=OR(!1,!0),jR=OR(!0,!0),u8=Vt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>VR(n,e),redo:()=>({state:n,dispatch:e})=>jR(n,e)}},addProseMirrorPlugins(){return[c8(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),d8=ln.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",Ot(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:e})=>{if(!sq(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$from:r,$to:s}=t,i=n();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):b7(t)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:c}=o.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(se.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(ee.create(o.doc,c.pos)):o.setSelection(se.create(o.doc,c.pos));else{const h=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();h&&(o.insert(u,h),o.setSelection(se.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[rq({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),h8=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,f8=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,p8=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,m8=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,g8=Zr.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ha({find:h8,type:this.type}),Ha({find:p8,type:this.type})]},addPasteRules(){return[Ka({find:f8,type:this.type}),Ka({find:m8,type:this.type})]}}),y8=ln.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",Ot(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),v8="listItem",HT="textStyle",KT=/^(\d+)\.\s$/,w8=ln.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:e,...t}=n;return e===1?["ol",Ot(this.options.HTMLAttributes,t),0]:["ol",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(v8,this.editor.getAttributes(HT)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=tu({find:KT,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=tu({find:KT,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(HT)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[n]}}),_8=ln.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),x8=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,E8=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,k8=Zr.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ha({find:x8,type:this.type})]},addPasteRules(){return[Ka({find:E8,type:this.type})]}}),T8=ln.create({name:"text",group:"inline"}),b8=Vt.create({name:"starterKit",addExtensions(){const n=[];return this.options.bold!==!1&&n.push(Pq.configure(this.options.bold)),this.options.blockquote!==!1&&n.push(Iq.configure(this.options.blockquote)),this.options.bulletList!==!1&&n.push(Mq.configure(this.options.bulletList)),this.options.code!==!1&&n.push(jq.configure(this.options.code)),this.options.codeBlock!==!1&&n.push(Bq.configure(this.options.codeBlock)),this.options.document!==!1&&n.push(Uq.configure(this.options.document)),this.options.dropcursor!==!1&&n.push(Wq.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&n.push(Xq.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&n.push(Zq.configure(this.options.hardBreak)),this.options.heading!==!1&&n.push(e8.configure(this.options.heading)),this.options.history!==!1&&n.push(u8.configure(this.options.history)),this.options.horizontalRule!==!1&&n.push(d8.configure(this.options.horizontalRule)),this.options.italic!==!1&&n.push(g8.configure(this.options.italic)),this.options.listItem!==!1&&n.push(y8.configure(this.options.listItem)),this.options.orderedList!==!1&&n.push(w8.configure(this.options.orderedList)),this.options.paragraph!==!1&&n.push(_8.configure(this.options.paragraph)),this.options.strike!==!1&&n.push(k8.configure(this.options.strike)),this.options.text!==!1&&n.push(T8.configure(this.options.text)),n}}),S8=Vt.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Xt({key:new Jn("placeholder"),props:{decorations:({doc:n,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,s=[];if(!t)return null;const i=this.editor.isEmpty;return n.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&vp(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];i&&u.push(this.options.emptyEditorClass);const h=gn.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});s.push(h)}return this.options.includeChildren}),Je.create(n,s)}}})]}}),I8=Zr.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",Ot(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),GT=({entry:n=null,onSave:e,onCancel:t})=>{var P;const{currentUser:r}=Vn(),[s,i]=M.useState((n==null?void 0:n.title)||""),[o,a]=M.useState((n==null?void 0:n.tags)||[]),[l,c]=M.useState((n==null?void 0:n.linkedGoals)||[]),[u,h]=M.useState([]),[f,m]=M.useState(!1),[y,v]=M.useState(!1),_=["general","finances","fitness","jiu-jitsu","women","attractiveness","nutrition","philosophy","languages"],x=Eq({extensions:[b8.configure({heading:{levels:[1,2,3]}}),I8,S8.configure({placeholder:"Start writing your journal entry...",emptyNodeClass:"is-editor-empty"})],content:(n==null?void 0:n.content)||"",editorProps:{attributes:{class:"tiptap prose dark:prose-invert max-w-none focus:outline-none min-h-[400px] p-4"}}});M.useEffect(()=>{T()},[r]);const T=async()=>{if(r)try{const k=Br(Fr(We,"goals"),mn("userId","==",r.uid),mn("status","==","active")),S=(await Ur(k)).docs.map(C=>({id:C.id.replace(`${r.uid}_`,""),...C.data()}));h(S)}catch(k){console.error("Error fetching goals:",k)}},b=k=>{a(E=>E.includes(k)?E.filter(S=>S!==k):[...E,k])},N=k=>{c(E=>E.includes(k)?E.filter(S=>S!==k):[...E,k])},R=async()=>{if(!s.trim()&&!(x!=null&&x.getText().trim()))return;v(!0);const k={title:s.trim()||"Untitled Entry",content:(x==null?void 0:x.getHTML())||"",tags:o,linkedGoals:l};await e(k),v(!1)};return x?p.jsxs("div",{className:"h-full flex flex-col",children:[p.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n?"Edit Journal Entry":"New Journal Entry"}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("button",{onClick:R,disabled:y,className:"btn-primary flex items-center",children:y?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):p.jsxs(p.Fragment,{children:[p.jsx(Yh,{className:"h-4 w-4 mr-2"}),"Save Entry"]})}),p.jsx("button",{onClick:t,className:"btn-secondary",disabled:y,children:"Cancel"})]})]}),p.jsx("input",{type:"text",value:s,onChange:k=>i(k.target.value),placeholder:"Entry Title",className:"w-full text-xl font-semibold bg-transparent border-none outline-none text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-600 mb-4"}),p.jsxs("div",{className:"mb-4",children:[p.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[p.jsx(LN,{className:"h-4 w-4 mr-1"}),"Tags"]}),p.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(k=>p.jsx("button",{onClick:()=>b(k),className:`px-3 py-1 text-sm rounded-full transition-colors ${o.includes(k)?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:k},k))})]}),p.jsxs("div",{children:[p.jsxs("button",{onClick:()=>m(!f),className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center hover:text-primary-600 dark:hover:text-primary-400",children:[p.jsx(lU,{className:"h-4 w-4 mr-1"}),"Link to Goals (",l.length,")"]}),f&&p.jsx("div",{className:"mt-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg max-h-48 overflow-y-auto",children:u.length===0?p.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No active goals available"}):p.jsx("div",{className:"space-y-2",children:u.map(k=>p.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded",children:[p.jsx("input",{type:"checkbox",checked:l.includes(k.id),onChange:()=>N(k.id),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),p.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:k.title}),p.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",k.subsection,")"]})]},k.id))})})]})]}),p.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("button",{onClick:()=>x.chain().focus().toggleBold().run(),className:`p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors ${x.isActive("bold")?"bg-gray-200 dark:bg-gray-700":""}`,children:p.jsx(U6,{className:"h-4 w-4"})}),p.jsx("button",{onClick:()=>x.chain().focus().toggleItalic().run(),className:`p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors ${x.isActive("italic")?"bg-gray-200 dark:bg-gray-700":""}`,children:p.jsx(oU,{className:"h-4 w-4"})}),p.jsx("button",{onClick:()=>x.chain().focus().toggleUnderline().run(),className:`p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors ${x.isActive("underline")?"bg-gray-200 dark:bg-gray-700":""}`,children:p.jsx(BU,{className:"h-4 w-4"})}),p.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600"}),p.jsx("button",{onClick:()=>x.chain().focus().toggleBulletList().run(),className:`p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors ${x.isActive("bulletList")?"bg-gray-200 dark:bg-gray-700":""}`,children:p.jsx(hU,{className:"h-4 w-4"})}),p.jsx("button",{onClick:()=>x.chain().focus().toggleOrderedList().run(),className:`p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors ${x.isActive("orderedList")?"bg-gray-200 dark:bg-gray-700":""}`,children:p.jsx(uU,{className:"h-4 w-4"})}),p.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600"}),p.jsx("button",{onClick:()=>x.chain().focus().undo().run(),className:"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",disabled:!x.can().undo(),children:p.jsx($U,{className:"h-4 w-4"})}),p.jsx("button",{onClick:()=>x.chain().focus().redo().run(),className:"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",disabled:!x.can().redo(),children:p.jsx(TU,{className:"h-4 w-4"})}),p.jsx("div",{className:"flex-1"}),p.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[((P=x.storage.characterCount)==null?void 0:P.characters())||0," characters"]})]})}),p.jsx("div",{className:"flex-1 overflow-y-auto bg-white dark:bg-gray-900",children:p.jsx(hq,{editor:x})})]}):null},C8=()=>{const{currentUser:n}=Vn(),[e,t]=M.useState([]),[r,s]=M.useState([]),[i,o]=M.useState(null),[a,l]=M.useState(!1),[c,u]=M.useState(!1),[h,f]=M.useState(!0),[m,y]=M.useState(!0),[v,_]=M.useState(""),[x,T]=M.useState([]),[b,N]=M.useState("all"),[R,P]=M.useState(""),[k,E]=M.useState(""),S=["general","finances","fitness","jiu-jitsu","women","attractiveness","nutrition","philosophy","languages"];M.useEffect(()=>{C()},[n]),M.useEffect(()=>{D()},[e,v,x,b,R,k]);const C=async()=>{if(n)try{const X=Br(Fr(We,"journalEntries"),mn("userId","==",n.uid),Ua("date","desc")),B=(await Ur(X)).docs.map(G=>({id:G.id.replace(`${n.uid}_`,""),...G.data()}));t(B),s(B),B.length>0&&!i&&o(B[0])}catch(X){console.error("Error fetching journal entries:",X),pe.error("Failed to load journal entries")}finally{f(!1)}},D=()=>{let X=[...e];if(v&&(X=X.filter(re=>{var B,G;return((B=re.title)==null?void 0:B.toLowerCase().includes(v.toLowerCase()))||((G=re.content)==null?void 0:G.toLowerCase().includes(v.toLowerCase()))})),x.length>0&&(X=X.filter(re=>{var B;return(B=re.tags)==null?void 0:B.some(G=>x.includes(G))})),b!=="all"){const re=new Date;let B,G;switch(b){case"today":B=new Date(re.setHours(0,0,0,0)),G=new Date(re.setHours(23,59,59,999));break;case"week":B=new Date(re.setDate(re.getDate()-7)),G=new Date;break;case"month":B=WN(re),G=zN(re);break;case"three-months":B=az(re),G=new Date;break;case"custom":B=R?new Date(R):null,G=k?new Date(k):null;break}B&&G&&(X=X.filter(oe=>{var we;const Ie=((we=oe.date)==null?void 0:we.toDate())||new Date;return Ie>=B&&Ie<=G}))}s(X)},O=async X=>{if(n)try{const re=`entry_${Date.now()}`,B={...X,userId:n.uid,date:new Date,createdAt:Ks(),updatedAt:Ks()};await Gi(Nn(We,"journalEntries",`${n.uid}_${re}`),B);const G={id:re,...B,date:{toDate:()=>new Date},createdAt:{toDate:()=>new Date},updatedAt:{toDate:()=>new Date}};t([G,...e]),o(G),l(!1),pe.success("Journal entry created successfully")}catch(re){console.error("Error creating entry:",re),pe.error("Failed to create journal entry")}},A=async X=>{if(!(!n||!i))try{const re={...X,updatedAt:Ks()};await Gi(Nn(We,"journalEntries",`${n.uid}_${i.id}`),re,{merge:!0});const B=e.map(G=>G.id===i.id?{...G,...re,updatedAt:{toDate:()=>new Date}}:G);t(B),o({...i,...re}),u(!1),pe.success("Journal entry updated successfully")}catch(re){console.error("Error updating entry:",re),pe.error("Failed to update journal entry")}},qe=async X=>{if(!(!n||!confirm("Are you sure you want to delete this entry?")))try{await IN(Nn(We,"journalEntries",`${n.uid}_${X}`));const re=e.filter(B=>B.id!==X);t(re),(i==null?void 0:i.id)===X&&o(re[0]||null),pe.success("Journal entry deleted successfully")}catch(re){console.error("Error deleting entry:",re),pe.error("Failed to delete journal entry")}},vr=X=>{T(re=>re.includes(X)?re.filter(B=>B!==X):[...re,X])};return h?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):p.jsxs("div",{className:"flex h-[calc(100vh-8rem)] -mx-4 sm:-mx-6 lg:-mx-8",children:[p.jsx("button",{onClick:()=>y(!m),className:"lg:hidden fixed bottom-4 right-4 z-40 btn-primary rounded-full p-3 shadow-lg",children:m?p.jsx(qc,{className:"h-6 w-6"}):p.jsx(Qi,{className:"h-6 w-6"})}),p.jsxs("div",{className:`${m?"translate-x-0":"-translate-x-full"} lg:translate-x-0 fixed lg:relative z-30 lg:z-auto w-80 lg:w-96 h-full bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-transform duration-300 overflow-hidden flex flex-col`,children:[p.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Journal Entries"}),p.jsx("button",{onClick:()=>{l(!0),o(null),y(!1)},className:"btn-primary p-2",children:p.jsx(ii,{className:"h-5 w-5"})})]}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:"text",value:v,onChange:X=>_(X.target.value),placeholder:"Search entries...",className:"input pl-10"}),p.jsx(IU,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),p.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[p.jsxs("div",{className:"mb-3",children:[p.jsx("label",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2 block",children:"Time Period"}),p.jsxs("select",{value:b,onChange:X=>N(X.target.value),className:"input text-sm",children:[p.jsx("option",{value:"all",children:"All Time"}),p.jsx("option",{value:"today",children:"Today"}),p.jsx("option",{value:"week",children:"Past Week"}),p.jsx("option",{value:"month",children:"This Month"}),p.jsx("option",{value:"three-months",children:"Past 3 Months"}),p.jsx("option",{value:"custom",children:"Custom Range"})]})]}),b==="custom"&&p.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[p.jsx("input",{type:"date",value:R,onChange:X=>P(X.target.value),className:"input text-sm"}),p.jsx("input",{type:"date",value:k,onChange:X=>E(X.target.value),className:"input text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2 block",children:"Tags"}),p.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(X=>p.jsx("button",{onClick:()=>vr(X),className:`px-2 py-1 text-xs rounded-full transition-colors ${x.includes(X)?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:X},X))})]})]}),p.jsx("div",{className:"flex-1 overflow-y-auto",children:r.length===0?p.jsxs("div",{className:"p-8 text-center",children:[p.jsx(Qi,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:e.length===0?"No journal entries yet":"No entries match your filters"})]}):p.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.map(X=>{var re;return p.jsxs("div",{onClick:()=>{o(X),l(!1),u(!1),y(!1)},className:`p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${(i==null?void 0:i.id)===X.id?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-primary-600":""}`,children:[p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-1",children:X.title||"Untitled Entry"}),p.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-2",children:[(re=X.content)==null?void 0:re.replace(/<[^>]*>/g,"").substring(0,100),"..."]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[p.jsx(Jh,{className:"h-3 w-3 mr-1"}),X.date&&$r(X.date.toDate(),"MMM d, yyyy")]}),X.tags&&X.tags.length>0&&p.jsxs("div",{className:"flex items-center space-x-1",children:[X.tags.slice(0,2).map(B=>p.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full",children:B},B)),X.tags.length>2&&p.jsxs("span",{className:"text-xs text-gray-500",children:["+",X.tags.length-2]})]})]})]},X.id)})})})]}),p.jsx("div",{className:"flex-1 bg-white dark:bg-gray-900 overflow-hidden",children:a?p.jsx(GT,{onSave:O,onCancel:()=>{l(!1),o(r[0]||null)}}):c&&i?p.jsx(GT,{entry:i,onSave:A,onCancel:()=>u(!1)}):i?p.jsxs("div",{className:"h-full flex flex-col",children:[p.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:i.title||"Untitled Entry"}),p.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(Jh,{className:"h-4 w-4 mr-1"}),i.date&&$r(i.date.toDate(),"MMMM d, yyyy")]}),i.tags&&i.tags.length>0&&p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(LN,{className:"h-4 w-4"}),i.tags.map(X=>p.jsx("span",{className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs",children:X},X))]})]})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("button",{onClick:()=>u(!0),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:p.jsx(qv,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),p.jsx("button",{onClick:()=>qe(i.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:p.jsx(Xh,{className:"h-5 w-5 text-red-600 dark:text-red-400"})})]})]})}),p.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:p.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:i.content}})})]}):p.jsx("div",{className:"h-full flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Qi,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),p.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-4",children:"Select an entry to read or create a new one"}),p.jsxs("button",{onClick:()=>l(!0),className:"btn-primary inline-flex items-center",children:[p.jsx(ii,{className:"h-5 w-5 mr-2"}),"Create New Entry"]})]})})})]})},da=({goal:n,onUpdate:e,onDelete:t})=>{var P;const{currentUser:r}=Vn(),[s,i]=M.useState(!1),[o,a]=M.useState(!1),[l,c]=M.useState(n.actionSteps||[]),[u,h]=M.useState(!1),f=()=>{var E;const k=(E=n.actionSteps)==null?void 0:E.filter(S=>!S.completed);return k==null?void 0:k[0]},m=async k=>{const E=[...l];E[k].completed=!E[k].completed,E[k].targetValue&&(E[k].currentValue=E[k].completed?E[k].targetValue:0),await v(E)},y=k=>{if(!k||k.length===0)return 0;let E=0,S=0;return k.forEach(C=>{C.targetValue?(E+=C.targetValue,S+=C.currentValue||0):(E+=1,S+=C.completed?1:0)}),Math.round(S/E*100)},v=async k=>{h(!0);try{const E=y(k),S=E===100?"completed":"active";await J3(Nn(We,"goals",`${r.uid}_${n.id}`),{actionSteps:k,progress:E,status:S,updatedAt:new Date}),c(k),e&&e({...n,actionSteps:k,progress:E,status:S}),pe.success("Goal updated successfully"),a(!1)}catch(E){console.error("Error updating goal:",E),pe.error("Failed to update goal")}finally{h(!1)}},_=async()=>{if(confirm("Are you sure you want to delete this goal?")){h(!0);try{await IN(Nn(We,"goals",`${r.uid}_${n.id}`)),t&&t(n.id),pe.success("Goal deleted successfully")}catch(k){console.error("Error deleting goal:",k),pe.error("Failed to delete goal")}finally{h(!1)}}},x=()=>{c([...l,{id:Date.now().toString(),description:"",completed:!1,targetValue:null,currentValue:0}])},T=k=>{c(l.filter((E,S)=>S!==k))},b=(k,E,S)=>{const C=[...l];C[k][E]=S,c(C)},N=f(),R={weekly:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",monthly:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",yearly:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",custom:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"};return p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-start justify-between mb-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:n.title}),p.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[p.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${R[n.timeframe]}`,children:n.timeframe}),p.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:n.subsection})]})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("button",{onClick:()=>a(!o),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:u,children:p.jsx(qv,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),p.jsx("button",{onClick:_,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:u,children:p.jsx(Xh,{className:"h-4 w-4 text-red-600 dark:text-red-400"})})]})]}),p.jsxs("div",{className:"mb-4",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Progress"}),p.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[n.progress||0,"%"]})]}),p.jsx("div",{className:"progress-bar",children:p.jsx("div",{className:"progress-bar-fill",style:{width:`${n.progress||0}%`}})})]}),!s&&N&&p.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[p.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200 mb-1",children:"Next Step:"}),p.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[N.description,N.targetValue&&p.jsxs("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:["(",N.currentValue||0,"/",N.targetValue,")"]})]})]}),p.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(Jh,{className:"h-4 w-4 mr-1"}),"Start:"," ",n.startDate&&$r(n.startDate.toDate(),"MMM d, yyyy")]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx(ON,{className:"h-4 w-4 mr-1"}),"End: ",n.endDate&&$r(n.endDate.toDate(),"MMM d, yyyy")]})]}),p.jsx("button",{onClick:()=>i(!s),className:"w-full flex items-center justify-center py-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors",children:s?p.jsxs(p.Fragment,{children:[p.jsx(K6,{className:"h-4 w-4 mr-1"}),"Hide Details"]}):p.jsxs(p.Fragment,{children:[p.jsx(Wv,{className:"h-4 w-4 mr-1"}),"Show All Steps"]})}),s&&p.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[p.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Action Steps"}),o?p.jsxs("div",{className:"space-y-3",children:[l.map((k,E)=>p.jsxs("div",{className:"flex items-start space-x-2",children:[p.jsx("input",{type:"text",value:k.description,onChange:S=>b(E,"description",S.target.value),className:"input flex-1",placeholder:"Step description"}),p.jsx("input",{type:"number",value:k.targetValue||"",onChange:S=>b(E,"targetValue",S.target.value?parseInt(S.target.value):null),className:"input w-20",placeholder:"Target"}),p.jsx("button",{onClick:()=>T(E),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",children:p.jsx(Xh,{className:"h-4 w-4"})})]},k.id)),p.jsxs("div",{className:"flex space-x-2 mt-4",children:[p.jsx("button",{onClick:x,className:"btn-secondary",children:"Add Step"}),p.jsx("button",{onClick:()=>v(l),className:"btn-primary",disabled:u,children:"Save Changes"}),p.jsx("button",{onClick:()=>{c(n.actionSteps||[]),a(!1)},className:"btn-secondary",children:"Cancel"})]})]}):p.jsx("div",{className:"space-y-2",children:(P=n.actionSteps)==null?void 0:P.map((k,E)=>p.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg cursor-pointer",onClick:()=>m(E),children:[k.completed?p.jsx(Q6,{className:"h-5 w-5 text-green-600 flex-shrink-0"}):p.jsx(Y6,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),p.jsx("span",{className:`flex-1 ${k.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:k.description}),k.targetValue&&p.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[k.currentValue||0,"/",k.targetValue]})]},k.id))})]})]})},LR=({subsection:n,onClose:e,onGoalCreated:t,parentGoal:r=null})=>{const{currentUser:s}=Vn(),[i,o]=M.useState(!1),[a,l]=M.useState(!1),[c,u]=M.useState({title:"",description:"",timeframe:"monthly",customStartDate:"",customEndDate:"",actionSteps:[{id:"1",description:"",completed:!1,targetValue:null,currentValue:0}],parentGoalId:(r==null?void 0:r.id)||null}),h=()=>{const _=new Date;let x,T;switch(c.timeframe){case"weekly":x=ai(_),T=n$(_);break;case"monthly":x=WN(_),T=zN(_);break;case"yearly":x=qN(_),T=t$(_);break;case"custom":x=c.customStartDate?new Date(c.customStartDate):_,T=c.customEndDate?new Date(c.customEndDate):Sy(_,30);break;default:x=_,T=Sy(_,30)}return{startDate:x,endDate:T}},f=()=>{u({...c,actionSteps:[...c.actionSteps,{id:Date.now().toString(),description:"",completed:!1,targetValue:null,currentValue:0}]})},m=_=>{c.actionSteps.length>1&&u({...c,actionSteps:c.actionSteps.filter((x,T)=>T!==_)})},y=(_,x,T)=>{const b=[...c.actionSteps];x==="targetValue"?b[_][x]=T?parseInt(T):null:b[_][x]=T,u({...c,actionSteps:b})},v=async _=>{if(_.preventDefault(),!c.title.trim()){pe.error("Please enter a goal title");return}if(c.actionSteps.every(x=>!x.description.trim())){pe.error("Please add at least one action step");return}o(!0);try{const{startDate:x,endDate:T}=h(),b=`goal_${Date.now()}`,N=c.actionSteps.filter(P=>P.description.trim()),R={title:c.title,description:c.description,subsection:n,timeframe:c.timeframe,startDate:x,endDate:T,actionSteps:N,progress:0,status:"active",userId:s.uid,parentGoalId:c.parentGoalId,createdAt:Ks(),updatedAt:Ks()};await Gi(Nn(We,"goals",`${s.uid}_${b}`),R),pe.success("Goal created successfully!"),t&&t({id:b,...R,startDate:{toDate:()=>x},endDate:{toDate:()=>T},createdAt:{toDate:()=>new Date},updatedAt:{toDate:()=>new Date}}),e()}catch(x){console.error("Error creating goal:",x),pe.error("Failed to create goal")}finally{o(!1)}};return p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:p.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[p.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Create New Goal"}),p.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:p.jsx(qc,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),r&&p.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Creating sub-goal for: ",r.title]})]}),p.jsxs("form",{onSubmit:v,className:"p-6 space-y-6",children:[p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Goal Title *"}),p.jsx("input",{type:"text",value:c.title,onChange:_=>u({...c,title:_.target.value}),className:"input",placeholder:"e.g., Attend 20 Jiu Jitsu classes this month",disabled:i})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Description (Optional)"}),p.jsx("textarea",{value:c.description,onChange:_=>u({...c,description:_.target.value}),className:"input min-h-[80px]",placeholder:"Add more details about this goal...",disabled:i})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Timeframe"}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:["weekly","monthly","yearly","custom"].map(_=>p.jsx("button",{type:"button",onClick:()=>u({...c,timeframe:_}),className:`px-4 py-2 rounded-lg border-2 transition-colors ${c.timeframe===_?"border-primary-600 bg-primary-50 dark:bg-primary-900/20 text-primary-600":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,disabled:i,children:_.charAt(0).toUpperCase()+_.slice(1)},_))})]}),c.timeframe==="custom"&&p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Start Date"}),p.jsx("input",{type:"date",value:c.customStartDate,onChange:_=>u({...c,customStartDate:_.target.value}),className:"input",disabled:i})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"End Date"}),p.jsx("input",{type:"date",value:c.customEndDate,onChange:_=>u({...c,customEndDate:_.target.value}),className:"input",disabled:i})]})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"label mb-3",children:["Action Steps *",p.jsx("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"(Define the steps needed to achieve this goal)"})]}),p.jsx("div",{className:"space-y-3",children:c.actionSteps.map((_,x)=>p.jsxs("div",{className:"flex items-start space-x-2",children:[p.jsx("div",{className:"flex-1",children:p.jsx("input",{type:"text",value:_.description,onChange:T=>y(x,"description",T.target.value),className:"input",placeholder:`Step ${x+1}: e.g., Attend class #${x+1}`,disabled:i})}),p.jsx("div",{className:"w-24",children:p.jsx("input",{type:"number",value:_.targetValue||"",onChange:T=>y(x,"targetValue",T.target.value),className:"input",placeholder:"Target",disabled:i})}),c.actionSteps.length>1&&p.jsx("button",{type:"button",onClick:()=>m(x),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",disabled:i,children:p.jsx(Xh,{className:"h-5 w-5"})})]},_.id))}),p.jsxs("button",{type:"button",onClick:f,className:"mt-3 btn-secondary flex items-center",disabled:i,children:[p.jsx(ii,{className:"h-4 w-4 mr-2"}),"Add Step"]})]}),p.jsxs("div",{children:[p.jsxs("button",{type:"button",onClick:()=>l(!a),className:"flex items-center text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",children:[p.jsx(Wv,{className:`h-4 w-4 mr-1 transition-transform ${a?"rotate-180":""}`}),"Advanced Options"]}),a&&p.jsx("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Advanced options like goal dependencies, notifications, and custom metrics will be available soon."})})]}),p.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[p.jsx("button",{type:"button",onClick:e,className:"btn-secondary",disabled:i,children:"Cancel"}),p.jsx("button",{type:"submit",className:"btn-primary flex items-center",disabled:i,children:i?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):p.jsxs(p.Fragment,{children:[p.jsx(oi,{className:"h-4 w-4 mr-2"}),"Create Goal"]})})]})]})]})})},N8=()=>{const{currentUser:n}=Vn(),[e,t]=M.useState([]),[r,s]=M.useState([]),[i,o]=M.useState(!0),[a,l]=M.useState(!1),[c,u]=M.useState("all"),[h,f]=M.useState("all"),[m,y]=M.useState("active"),v=["general","finances","fitness","jiu-jitsu","women","attractiveness","nutrition","philosophy","languages"];M.useEffect(()=>{_()},[n]),M.useEffect(()=>{x()},[e,c,h,m]);const _=async()=>{if(n)try{const N=Br(Fr(We,"goals"),mn("userId","==",n.uid),Ua("createdAt","desc")),P=(await Ur(N)).docs.map(k=>({id:k.id.replace(`${n.uid}_`,""),...k.data()}));t(P)}catch(N){console.error("Error fetching goals:",N)}finally{o(!1)}},x=()=>{let N=[...e];m!=="all"&&(N=N.filter(R=>R.status===m)),c!=="all"&&(N=N.filter(R=>R.timeframe===c)),h!=="all"&&(N=N.filter(R=>R.subsection===h)),s(N)},T=N=>r.filter(R=>R.timeframe===N),b={total:e.length,active:e.filter(N=>N.status==="active").length,completed:e.filter(N=>N.status==="completed").length,thisWeek:e.filter(N=>{var P;const R=(P=N.startDate)==null?void 0:P.toDate();return R&&iz(R)}).length,thisMonth:e.filter(N=>{var P;const R=(P=N.startDate)==null?void 0:P.toDate();return R&&sz(R)}).length,thisYear:e.filter(N=>{var P;const R=(P=N.startDate)==null?void 0:P.toDate();return R&&oz(R)}).length};return i?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):p.jsxs("div",{className:"space-y-6",children:[p.jsx("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg p-6 text-white",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Goals Overview"}),p.jsx("p",{className:"opacity-90",children:"Track and manage all your goals across different life areas"})]}),p.jsxs("button",{onClick:()=>l(!0),className:"bg-white text-primary-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors flex items-center",children:[p.jsx(ii,{className:"h-5 w-5 mr-2"}),"New Goal"]})]})}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[p.jsxs("div",{className:"card text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.total}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Goals"})]}),p.jsxs("div",{className:"card text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-primary-600",children:b.active}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active"})]}),p.jsxs("div",{className:"card text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-green-600",children:b.completed}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"})]}),p.jsxs("div",{className:"card text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.thisWeek}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This Week"})]}),p.jsxs("div",{className:"card text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-purple-600",children:b.thisMonth}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This Month"})]}),p.jsxs("div",{className:"card text-center",children:[p.jsx("p",{className:"text-2xl font-bold text-orange-600",children:b.thisYear}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This Year"})]})]}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"flex flex-wrap gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"Status"}),p.jsxs("select",{value:m,onChange:N=>y(N.target.value),className:"input",children:[p.jsx("option",{value:"all",children:"All Status"}),p.jsx("option",{value:"active",children:"Active"}),p.jsx("option",{value:"completed",children:"Completed"}),p.jsx("option",{value:"paused",children:"Paused"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"Timeframe"}),p.jsxs("select",{value:c,onChange:N=>u(N.target.value),className:"input",children:[p.jsx("option",{value:"all",children:"All Timeframes"}),p.jsx("option",{value:"weekly",children:"Weekly"}),p.jsx("option",{value:"monthly",children:"Monthly"}),p.jsx("option",{value:"yearly",children:"Yearly"}),p.jsx("option",{value:"custom",children:"Custom"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"Life Area"}),p.jsxs("select",{value:h,onChange:N=>f(N.target.value),className:"input",children:[p.jsx("option",{value:"all",children:"All Areas"}),v.map(N=>p.jsx("option",{value:N,children:N.charAt(0).toUpperCase()+N.slice(1)},N))]})]})]})}),c==="all"?p.jsxs(p.Fragment,{children:[T("yearly").length>0&&p.jsxs("div",{children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Yearly Goals (",T("yearly").length,")"]}),p.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:T("yearly").map(N=>p.jsx(da,{goal:N,onUpdate:R=>{t(e.map(P=>P.id===R.id?R:P))},onDelete:R=>{t(e.filter(P=>P.id!==R))}},N.id))})]}),T("monthly").length>0&&p.jsxs("div",{children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Monthly Goals (",T("monthly").length,")"]}),p.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:T("monthly").map(N=>p.jsx(da,{goal:N,onUpdate:R=>{t(e.map(P=>P.id===R.id?R:P))},onDelete:R=>{t(e.filter(P=>P.id!==R))}},N.id))})]}),T("weekly").length>0&&p.jsxs("div",{children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Weekly Goals (",T("weekly").length,")"]}),p.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:T("weekly").map(N=>p.jsx(da,{goal:N,onUpdate:R=>{t(e.map(P=>P.id===R.id?R:P))},onDelete:R=>{t(e.filter(P=>P.id!==R))}},N.id))})]})]}):p.jsxs("div",{children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Filtered Goals (",r.length,")"]}),r.length===0?p.jsxs("div",{className:"card text-center py-12",children:[p.jsx(oi,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No goals match your filters"})]}):p.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:r.map(N=>p.jsx(da,{goal:N,onUpdate:R=>{t(e.map(P=>P.id===R.id?R:P))},onDelete:R=>{t(e.filter(P=>P.id!==R))}},N.id))})]}),p.jsxs("div",{className:"card",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Quick Access to Life Areas"}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:v.map(N=>p.jsxs(dn,{to:`/subsection/${N}`,className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:N.charAt(0).toUpperCase()+N.slice(1)}),p.jsx(Ey,{className:"h-4 w-4 text-gray-400"})]},N))})]}),a&&p.jsx(LR,{subsection:"general",onClose:()=>l(!1),onGoalCreated:N=>{t([N,...e]),l(!1)}})]})},A8=()=>{const{currentUser:n}=Vn(),[e,t]=M.useState(!0),[r,s]=M.useState("30"),[i,o]=M.useState({journalStreak:0,totalJournalEntries:0,goalsCompleted:0,goalsActive:0,avgGoalProgress:0,jiuJitsuClasses:0,workouts:0});M.useEffect(()=>{a()},[n,r]);const a=async()=>{if(n)try{const h=Dk(new Date,parseInt(r)),f=Br(Fr(We,"journalEntries"),mn("userId","==",n.uid),mn("date",">=",h),Ua("date","desc")),m=await Ur(f),y=Br(Fr(We,"goals"),mn("userId","==",n.uid)),_=(await Ur(y)).docs.map(P=>P.data()),x=m.docs.map(P=>P.data()),T=_.filter(P=>P.status==="completed").length,b=_.filter(P=>P.status==="active").length,N=b>0?_.filter(P=>P.status==="active").reduce((P,k)=>P+(k.progress||0),0)/b:0,R=l(x);o({journalStreak:R,totalJournalEntries:x.length,goalsCompleted:T,goalsActive:b,avgGoalProgress:Math.round(N),jiuJitsuClasses:0,workouts:0})}catch(u){console.error("Error fetching stats:",u),pe.error("Failed to load statistics")}finally{t(!1)}},l=u=>{if(u.length===0)return 0;let h=0;const f=new Date,m=u.map(y=>{var v,_;return((_=(v=y.date)==null?void 0:v.toDate)==null?void 0:_.call(v))||new Date}).sort((y,v)=>v-y);for(let y=0;y<m.length;y++){const v=Dk(f,y),_=m[y];if($r(_,"yyyy-MM-dd")===$r(v,"yyyy-MM-dd"))h++;else break}return h},c=()=>{const u=`
Date Range,${r} days
Journal Streak,${i.journalStreak}
Total Journal Entries,${i.totalJournalEntries}
Goals Completed,${i.goalsCompleted}
Goals Active,${i.goalsActive}
Average Goal Progress,${i.avgGoalProgress}%
    `.trim(),h=new Blob([u],{type:"text/csv"}),f=window.URL.createObjectURL(h),m=document.createElement("a");m.href=f,m.download=`stats-${$r(new Date,"yyyy-MM-dd")}.csv`,m.click(),pe.success("Stats exported to CSV")};return e?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):p.jsxs("div",{className:"space-y-6",children:[p.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg p-6 text-white",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Statistics"}),p.jsx("p",{className:"opacity-90",children:"Track your progress and analyze your performance"})]}),p.jsxs("button",{onClick:c,className:"bg-white text-purple-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors flex items-center",children:[p.jsx(eU,{className:"h-5 w-5 mr-2"}),"Export CSV"]})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date Range"}),p.jsxs("select",{value:r,onChange:u=>s(u.target.value),className:"input w-auto",children:[p.jsx("option",{value:"7",children:"Last 7 days"}),p.jsx("option",{value:"30",children:"Last 30 days"}),p.jsx("option",{value:"90",children:"Last 90 days"}),p.jsx("option",{value:"365",children:"Last year"})]})]})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx(Qi,{className:"h-8 w-8 text-purple-600"}),p.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.journalStreak})]}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Journal Streak"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Consecutive days"})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx(Qi,{className:"h-8 w-8 text-purple-600"}),p.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.totalJournalEntries})]}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Total Entries"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"In selected period"})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx(oi,{className:"h-8 w-8 text-green-600"}),p.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.goalsCompleted})]}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Goals Completed"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Successfully achieved"})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx(oi,{className:"h-8 w-8 text-blue-600"}),p.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.goalsActive})]}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Active Goals"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Currently pursuing"})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx(FN,{className:"h-8 w-8 text-orange-600"}),p.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[i.avgGoalProgress,"%"]})]}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Avg Progress"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Across active goals"})]}),p.jsxs("div",{className:"card opacity-50",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx(Jh,{className:"h-8 w-8 text-indigo-600"}),p.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"-"})]}),p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Jiu Jitsu Classes"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Coming soon"})]})]}),p.jsxs("div",{className:"card",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Progress Over Time"}),p.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-800 rounded-lg",children:p.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Chart visualization will be implemented with Chart.js"})})]}),p.jsxs("div",{className:"card",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Life Areas Overview"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-4",children:"Progress towards win states in each life area"}),p.jsx("div",{className:"space-y-4",children:["Finances","Fitness","Jiu Jitsu","Philosophy"].map(u=>p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:u}),p.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[Math.floor(Math.random()*100),"%"]})]}),p.jsx("div",{className:"progress-bar",children:p.jsx("div",{className:"progress-bar-fill",style:{width:`${Math.floor(Math.random()*100)}%`}})})]},u))})]})]})},R8=()=>{var T,b,N,R;const{currentUser:n,userProfile:e,updateUserSettings:t,logout:r,resetPassword:s}=Vn(),{theme:i,toggleTheme:o}=DN(),[a,l]=M.useState(!1),[c,u]=M.useState(!1),[h,f]=M.useState((e==null?void 0:e.displayName)||""),[m,y]=M.useState({emailNotifications:((T=e==null?void 0:e.settings)==null?void 0:T.emailNotifications)||!1,journalReminders:((b=e==null?void 0:e.settings)==null?void 0:b.journalReminders)||!1,goalDeadlineAlerts:((N=e==null?void 0:e.settings)==null?void 0:N.goalDeadlineAlerts)||!0,weeklyReports:((R=e==null?void 0:e.settings)==null?void 0:R.weeklyReports)||!1});M.useEffect(()=>{e!=null&&e.displayName&&f(e.displayName),e!=null&&e.settings&&y({emailNotifications:e.settings.emailNotifications||!1,journalReminders:e.settings.journalReminders||!1,goalDeadlineAlerts:e.settings.goalDeadlineAlerts||!0,weeklyReports:e.settings.weeklyReports||!1})},[e]);const v=async()=>{l(!0);try{await t({...e==null?void 0:e.settings,...m,displayName:h,theme:i}),pe.success("Settings saved successfully")}catch(P){console.error("Error saving settings:",P),pe.error("Failed to save settings")}finally{l(!1)}},_=async()=>{if(n!=null&&n.email){u(!0);try{await s(n.email),pe.success("Password reset email sent")}catch(P){console.error("Error sending reset email:",P),pe.error("Failed to send reset email")}finally{u(!1)}}},x=async()=>{confirm("Are you sure you want to sign out?")&&await r()};return p.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[p.jsxs("div",{className:"bg-gradient-to-r from-gray-700 to-gray-800 dark:from-gray-800 dark:to-gray-900 rounded-lg p-6 text-white",children:[p.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Settings"}),p.jsx("p",{className:"opacity-90",children:"Manage your account and application preferences"})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center mb-6",children:[p.jsx(BN,{className:"h-6 w-6 text-gray-600 dark:text-gray-400 mr-3"}),p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Profile Information"})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Display Name"}),p.jsx("input",{type:"text",value:h,onChange:P=>f(P.target.value),placeholder:"Enter your name",className:"input"}),p.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"This is how you'll be greeted in the app"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Email Address"}),p.jsx("input",{type:"email",value:(n==null?void 0:n.email)||"",disabled:!0,className:"input bg-gray-50 dark:bg-gray-800"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"User ID"}),p.jsx("input",{type:"text",value:(n==null?void 0:n.uid)||"",disabled:!0,className:"input bg-gray-50 dark:bg-gray-800 font-mono text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Member Since"}),p.jsx("input",{type:"text",value:e!=null&&e.createdAt?new Date(e.createdAt.seconds*1e3).toLocaleDateString():"N/A",disabled:!0,className:"input bg-gray-50 dark:bg-gray-800"})]})]}),p.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:p.jsx("button",{onClick:v,disabled:a,className:"btn-primary flex items-center",children:a?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):p.jsxs(p.Fragment,{children:[p.jsx(Yh,{className:"h-4 w-4 mr-2"}),"Save Profile"]})})})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center mb-6",children:[i==="light"?p.jsx(jN,{className:"h-6 w-6 text-gray-600 dark:text-gray-400 mr-3"}):p.jsx(VN,{className:"h-6 w-6 text-gray-600 dark:text-gray-400 mr-3"}),p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Appearance"})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Theme"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose your preferred color scheme"})]}),p.jsx("button",{onClick:o,className:"relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors",children:p.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i==="dark"?"translate-x-6":"translate-x-1"}`})})]})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center mb-6",children:[p.jsx(F6,{className:"h-6 w-6 text-gray-600 dark:text-gray-400 mr-3"}),p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Notifications"})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Email Notifications"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Receive updates about your goals and progress"})]}),p.jsx("button",{onClick:()=>y({...m,emailNotifications:!m.emailNotifications}),className:"relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors",children:p.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.emailNotifications?"translate-x-6":"translate-x-1"}`})})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Journal Reminders"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Daily reminders to write in your journal"})]}),p.jsx("button",{onClick:()=>y({...m,journalReminders:!m.journalReminders}),className:"relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors",children:p.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.journalReminders?"translate-x-6":"translate-x-1"}`})})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Goal Deadline Alerts"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Notifications when goals are approaching deadlines"})]}),p.jsx("button",{onClick:()=>y({...m,goalDeadlineAlerts:!m.goalDeadlineAlerts}),className:"relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors",children:p.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.goalDeadlineAlerts?"translate-x-6":"translate-x-1"}`})})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Weekly Progress Reports"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Weekly email summary of your progress"})]}),p.jsx("button",{onClick:()=>y({...m,weeklyReports:!m.weeklyReports}),className:"relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors",children:p.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.weeklyReports?"translate-x-6":"translate-x-1"}`})})]})]}),p.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:p.jsx("button",{onClick:v,disabled:a,className:"btn-primary flex items-center",children:a?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):p.jsxs(p.Fragment,{children:[p.jsx(Yh,{className:"h-4 w-4 mr-2"}),"Save Notification Settings"]})})})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center mb-6",children:[p.jsx(RU,{className:"h-6 w-6 text-gray-600 dark:text-gray-400 mr-3"}),p.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Security"})]}),p.jsx("div",{className:"space-y-4",children:p.jsxs("div",{children:[p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Password Reset"}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Send a password reset link to your email address"}),p.jsx("button",{onClick:_,disabled:c,className:"btn-secondary flex items-center",children:c?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"}),"Sending..."]}):p.jsxs(p.Fragment,{children:[p.jsx(by,{className:"h-4 w-4 mr-2"}),"Send Reset Email"]})})]})})]}),p.jsxs("div",{className:"card border-red-200 dark:border-red-900",children:[p.jsxs("div",{className:"flex items-center mb-6",children:[p.jsx(Ty,{className:"h-6 w-6 text-red-600 dark:text-red-400 mr-3"}),p.jsx("h2",{className:"text-xl font-semibold text-red-600 dark:text-red-400",children:"Danger Zone"})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Sign out of your account on this device"}),p.jsxs("button",{onClick:x,className:"btn-danger flex items-center",children:[p.jsx(Ty,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})]})},P8=()=>{const{subsectionName:n}=_O(),{currentUser:e}=Vn(),[t,r]=M.useState(null),[s,i]=M.useState([]),[o,a]=M.useState(!1),[l,c]=M.useState(!1),[u,h]=M.useState(!0),[f,m]=M.useState({description:"",metrics:[]}),y={finances:{name:"Finances",icon:"💰",color:"bg-green-500",defaultMetrics:[{name:"Net Worth",unit:"$",targetValue:0,currentValue:0},{name:"Passive Income",unit:"$/month",targetValue:0,currentValue:0}]},fitness:{name:"Fitness",icon:"💪",color:"bg-blue-500",defaultMetrics:[{name:"Body Weight",unit:"lbs",targetValue:0,currentValue:0},{name:"Body Fat %",unit:"%",targetValue:0,currentValue:0},{name:"Bench Press",unit:"lbs",targetValue:0,currentValue:0}]},"jiu-jitsu":{name:"Jiu Jitsu",icon:"🥋",color:"bg-purple-500",defaultMetrics:[{name:"Belt Level",unit:"",targetValue:0,currentValue:0},{name:"Classes Attended",unit:"classes",targetValue:0,currentValue:0},{name:"Competitions Won",unit:"wins",targetValue:0,currentValue:0}]},women:{name:"Women",icon:"💑",color:"bg-pink-500",defaultMetrics:[{name:"Relationship Quality",unit:"/10",targetValue:0,currentValue:0},{name:"Social Confidence",unit:"/10",targetValue:0,currentValue:0}]},attractiveness:{name:"Attractiveness",icon:"✨",color:"bg-yellow-500",defaultMetrics:[{name:"Physical Fitness",unit:"/10",targetValue:0,currentValue:0},{name:"Style & Grooming",unit:"/10",targetValue:0,currentValue:0},{name:"Charisma",unit:"/10",targetValue:0,currentValue:0}]},nutrition:{name:"Nutrition",icon:"🥗",color:"bg-green-400",defaultMetrics:[{name:"Daily Calories",unit:"kcal",targetValue:0,currentValue:0},{name:"Protein Intake",unit:"g/day",targetValue:0,currentValue:0},{name:"Healthy Meals",unit:"/week",targetValue:0,currentValue:0}]},philosophy:{name:"Philosophy",icon:"🧠",color:"bg-indigo-500",defaultMetrics:[{name:"Books Read",unit:"books",targetValue:0,currentValue:0},{name:"Meditation Practice",unit:"days/year",targetValue:0,currentValue:0},{name:"Life Satisfaction",unit:"/10",targetValue:0,currentValue:0}]},languages:{name:"Languages",icon:"🌍",color:"bg-teal-500",defaultMetrics:[{name:"Languages Fluent",unit:"languages",targetValue:0,currentValue:0},{name:"Vocabulary Size",unit:"words",targetValue:0,currentValue:0},{name:"Practice Hours",unit:"hrs/week",targetValue:0,currentValue:0}]}},v=y[n]||y.fitness;M.useEffect(()=>{_()},[e,n]);const _=async()=>{var E,S;if(e)try{const C=await bN(Nn(We,"lifeSubsections",`${e.uid}_${n}`));if(C.exists()){const qe=C.data();r(qe.winState),m({description:((E=qe.winState)==null?void 0:E.description)||"",metrics:((S=qe.winState)==null?void 0:S.metrics)||v.defaultMetrics})}else m({description:"",metrics:v.defaultMetrics});const D=Br(Fr(We,"goals"),mn("userId","==",e.uid),mn("subsection","==",n),Ua("createdAt","desc")),A=(await Ur(D)).docs.map(qe=>({id:qe.id.replace(`${e.uid}_`,""),...qe.data()}));i(A)}catch(C){console.error("Error fetching subsection data:",C),pe.error("Failed to load subsection data")}finally{h(!1)}},x=async()=>{if(e)try{await Gi(Nn(We,"lifeSubsections",`${e.uid}_${n}`),{name:n,userId:e.uid,winState:f,updatedAt:Ks()},{merge:!0}),r(f),a(!1),pe.success("Win state updated successfully")}catch(E){console.error("Error saving win state:",E),pe.error("Failed to save win state")}},T=()=>{m({...f,metrics:[...f.metrics,{name:"",unit:"",targetValue:0,currentValue:0}]})},b=(E,S,C)=>{const D=[...f.metrics];D[E][S]=S.includes("Value")?parseFloat(C)||0:C,m({...f,metrics:D})},N=E=>{m({...f,metrics:f.metrics.filter((S,C)=>C!==E)})},R=()=>{if(!(t!=null&&t.metrics)||t.metrics.length===0)return 0;let E=0,S=0;return t.metrics.forEach(C=>{if(C.targetValue>0){const D=C.currentValue/C.targetValue*100;E+=Math.min(D,100),S++}}),S>0?Math.round(E/S):0},P=s.filter(E=>E.status==="active"),k=s.filter(E=>E.status==="completed");return u?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):p.jsxs("div",{className:"space-y-6",children:[p.jsx("div",{className:"bg-gradient-to-r from-gray-800 to-gray-700 dark:from-gray-900 dark:to-gray-800 rounded-lg p-6 text-white",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center space-x-4",children:[p.jsx("div",{className:`w-16 h-16 ${v.color} rounded-full flex items-center justify-center text-3xl`,children:v.icon}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold",children:v.name}),p.jsx("p",{className:"text-gray-300 mt-1",children:"Track your progress and achieve your goals"})]})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("p",{className:"text-sm text-gray-400",children:"Overall Progress"}),p.jsxs("p",{className:"text-3xl font-bold",children:[R(),"%"]})]})]})}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[p.jsx(LU,{className:"h-6 w-6 mr-2 text-yellow-500"}),"Win State"]}),p.jsx("button",{onClick:()=>a(!o),className:"btn-secondary flex items-center",children:o?p.jsxs(p.Fragment,{children:[p.jsx(qc,{className:"h-4 w-4 mr-2"}),"Cancel"]}):p.jsxs(p.Fragment,{children:[p.jsx(qv,{className:"h-4 w-4 mr-2"}),"Edit"]})})]}),o?p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Win State Description"}),p.jsx("textarea",{value:f.description,onChange:E=>m({...f,description:E.target.value}),className:"input min-h-[100px]",placeholder:"Describe what success looks like in this area..."})]}),p.jsxs("div",{children:[p.jsx("label",{className:"label",children:"Success Metrics"}),p.jsx("div",{className:"space-y-3",children:f.metrics.map((E,S)=>p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx("input",{type:"text",value:E.name,onChange:C=>b(S,"name",C.target.value),className:"input flex-1",placeholder:"Metric name"}),p.jsx("input",{type:"text",value:E.unit,onChange:C=>b(S,"unit",C.target.value),className:"input w-24",placeholder:"Unit"}),p.jsx("input",{type:"number",value:E.currentValue,onChange:C=>b(S,"currentValue",C.target.value),className:"input w-32",placeholder:"Current"}),p.jsx("input",{type:"number",value:E.targetValue,onChange:C=>b(S,"targetValue",C.target.value),className:"input w-32",placeholder:"Target"}),p.jsx("button",{onClick:()=>N(S),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",children:p.jsx(qc,{className:"h-4 w-4"})})]},S))}),p.jsxs("div",{className:"flex space-x-2 mt-4",children:[p.jsx("button",{onClick:T,className:"btn-secondary",children:"Add Metric"}),p.jsxs("button",{onClick:x,className:"btn-primary",children:[p.jsx(Yh,{className:"h-4 w-4 mr-2"}),"Save Win State"]})]})]})]}):p.jsxs("div",{children:[t!=null&&t.description?p.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:t.description}):p.jsx("p",{className:"text-gray-500 dark:text-gray-400 italic mb-4",children:"No win state defined yet. Click edit to define your success criteria."}),(t==null?void 0:t.metrics)&&t.metrics.length>0&&p.jsx("div",{className:"space-y-3",children:t.metrics.map((E,S)=>p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-1",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:E.name}),p.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[E.currentValue," / ",E.targetValue," ",E.unit]})]}),p.jsx("div",{className:"progress-bar",children:p.jsx("div",{className:"progress-bar-fill",style:{width:`${Math.min(E.currentValue/E.targetValue*100,100)}%`}})})]},S))})]})]}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Active Goals (",P.length,")"]}),p.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center",children:[p.jsx(ii,{className:"h-4 w-4 mr-2"}),"Create Goal"]})]}),P.length===0?p.jsxs("div",{className:"card text-center py-12",children:[p.jsx(oi,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No active goals in this area yet"}),p.jsxs("button",{onClick:()=>c(!0),className:"btn-primary inline-flex items-center",children:[p.jsx(ii,{className:"h-4 w-4 mr-2"}),"Create Your First Goal"]})]}):p.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:P.map(E=>p.jsx(da,{goal:E,onUpdate:S=>{i(s.map(C=>C.id===S.id?S:C))},onDelete:S=>{i(s.filter(C=>C.id!==S))}},E.id))})]}),k.length>0&&p.jsxs("div",{children:[p.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Completed Goals (",k.length,")"]}),p.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:k.map(E=>p.jsx(da,{goal:E,onUpdate:S=>{i(s.map(C=>C.id===S.id?S:C))},onDelete:S=>{i(s.filter(C=>C.id!==S))}},E.id))})]}),l&&p.jsx(LR,{subsection:n,onClose:()=>c(!1),onGoalCreated:E=>{i([E,...s]),c(!1)}})]})};function D8(){return p.jsx(zO,{children:p.jsx(A6,{children:p.jsxs(N6,{children:[p.jsx(M2,{position:"top-center",toastOptions:{duration:3e3,style:{background:"rgb(31 41 55)",color:"#fff"},success:{iconTheme:{primary:"rgb(34 197 94)",secondary:"#fff"}},error:{iconTheme:{primary:"rgb(239 68 68)",secondary:"#fff"}}}}),p.jsx(HU,{children:p.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[p.jsx(KU,{}),p.jsx("main",{className:"flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8",children:p.jsxs(VO,{children:[p.jsx(Ci,{path:"/",element:p.jsx(lz,{})}),p.jsx(Ci,{path:"/journal",element:p.jsx(C8,{})}),p.jsx(Ci,{path:"/goals",element:p.jsx(N8,{})}),p.jsx(Ci,{path:"/stats",element:p.jsx(A8,{})}),p.jsx(Ci,{path:"/settings",element:p.jsx(R8,{})}),p.jsx(Ci,{path:"/subsection/:subsectionName",element:p.jsx(P8,{})})]})})]})})]})})})}const M8="modulepreload",O8=function(n){return"/"+n},QT={},V8=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=O8(l),l in QT)return;QT[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":M8,c||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),c)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};function j8(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(h=!0)=>{await l};async function u(){if("serviceWorker"in navigator){if(a=await V8(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/sw.js",{scope:"/",type:"classic"})).catch(h=>{o==null||o(h)}),!a)return;a.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),a.addEventListener("installed",h=>{h.isUpdate||r==null||r()}),a.register({immediate:e}).then(h=>{i?i("/sw.js",h):s==null||s(h)}).catch(h=>{o==null||o(h)})}}return l=u(),c}"serviceWorker"in navigator&&j8({onNeedRefresh(){confirm("New content available. Reload?")&&window.location.reload()},onOfflineReady(){console.log("App ready to work offline")}});Jm.createRoot(document.getElementById("root")).render(p.jsx(wt.StrictMode,{children:p.jsx(D8,{})}));
